define(["connector","_","jc","jquery"],function(e){function r(){return 6e4/(n.bpm||100)}function o(e){if(e)jc.start("canvas",e,!0),i=function(){return $(e).attr("width")},s=function(){return $(e).attr("height")};else{jc.start("canvas",!0);var n=$("#canvas");n.attr("height",s()),n.attr("width",i())}t=jc.rect(0,0,i(),s(),"#131013",!0).id("background"),l&&l()}function u(){var t,i=r()*4,s=e.currentTime(),o=Number(n.start)+Math.ceil((s-n.start)/i)*i;setTimeout(function(){a(Math.round((e.currentTime()-n.start)/i),i)},o-e.currentTime())}function a(e,t){h&&h(e,t),setTimeout(function(){u()},10)}function l(){for(var e in f)f[e]()}function h(e,t){for(var n in c)c[n](e,t)}function v(){return p<0?d[0]:p>=d.length?d[d.length-1]:d[p]}var t,n={bpm:100,start:(new Date).getTime()},i,s;i=function(){return window.innerWidth/2},s=function(){return window.innerHeight/2},$(window).resize(function(){jc.clear(),o()}),$(function(){var e=$("#container");n.bpm=Number(e.data("bpm")),n.start=Number(e.data("start"))}),e.socket.on("loop-stats",function(e){n=e}),u();var f=[],c=[],p=0,d=["#0000FE","#FF5000","#FCFF02","#00FE01","#0367fc","#FD01FF","#75FC04","#FE021C","#131013"];return $(function(){var e=$("#container");p=e.data("color"),scene=e.data("scene")}),{getBackground:function(){return t},onInit:function(e){f.push(e)},onLoop:function(e){c.push(e)},stats:n,init:o,width:function(){return i()},height:function(){return s()},currentColor:v,setColor:function(e){p=e},currentColorId:function(){return p}}})