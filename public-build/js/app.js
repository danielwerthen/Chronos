(function(){function o(){i.attr("height",window.innerHeight),i.attr("width",window.innerWidth)}function u(e,t){e.on("ping",function(e){var n=(new Date).getTime()-e.time;t&&t(n/2)}),e.emit("ping",{time:(new Date).getTime()}),setInterval(function(){e.emit("ping",{time:(new Date).getTime()})},2e3)}function a(e,t){e.on("time",function(e){t&&t(e.now)})}function l(){var e=Math.floor(Math.random()*254),t=Math.floor(Math.random()*254),n=Math.floor(Math.random()*254),r=window.innerWidth,i=window.innerHeight,s="#131013",o=!0;return jc.rect(0,0,r,i,s,o)}function c(e,t){e=e||50,m.animate({color:"#FFF"},e,function(){m.animate({color:"#131013"},t)})}function p(e){for(var t in h)h[t]&&(h[t].markAsDeleted=!0);for(var t in e){var n=e[t];if(!h[n.id]||!h[n.id].circle)h[n.id]={circle:v(n.location.x*window.innerWidth,n.location.y*window.innerHeight)};else{var r=h[n.id].circle,i=r.getCenter();h[n.id].markAsDeleted=!1,r.animate({x:n.location.x*window.innerWidth,y:n.location.y*window.innerHeight},500,function(){b&&b.del(),b=undefined})}}for(var t in h)h[t]&&h[t].markAsDeleted&&(h[t].circle&&h[t].circle.del(),h[t]=undefined)}function v(e,t,n,r,i){function o(e){e.animate({radius:i||100,opacity:0},d,{type:"inOut",fn:"exp"},function(){e._radius=r||10,e._opacity=1,o(e)})}var s=jc.circle(e,t,10,n||"#FFFFFF",!0);return o(s),s}function y(){jc.start(f,!0),m=l(),m.click(function(t){g={x:t.x/window.innerWidth,y:t.y/window.innerHeight},e.emit("move",g),w()})}function w(){if(h[s.id]&&h[s.id].circle){var e=h[s.id].circle;b||(b=v(e._x,e._y,"#E1391E",5,25)),b.animate({x:g.x*window.innerWidth,y:g.y*window.innerHeight},250,function(){this.animate({color:"rgba(248, 103, 45, 0)"},3e3)})}}var e=io.connect("/"),t=0,n=0,r=function(){return(new Date).getTime()-n},i=$("#canvas"),s;e.on("yourUser",function(e){s=e}),o(),$(window).resize(o),u(e,function(e){t=e}),a(e,function(e){n=(new Date).getTime()-(e+t)});var f="canvas";e.on("flash",function(e){var t=e.at-r();if(t<1)return;t<5?c(e.open,e.close):setTimeout(function(){c(e.open,e.close)},t)}),e.on("setPulse",function(e){d=e}),e.on("update",function(e){var t=e.at-r();t<5?p(e.users):setTimeout(function(){p(e.users)},t)});var h={},d=1e3,m,g,b,E=0;document.onload=y()})()