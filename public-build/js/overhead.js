// (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.

// Underscore is freely distributable under the MIT license.

/*!
 * jCanvaScript JavaScript Library v 1.5.15
 * http://jcscript.com/
 *
 * Copyright 2012, Alexander Savin
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */

function initThree(e){function f(){t=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e4),t.position.z=1e3,t.position.x=-200,n=new THREE.Scene;var f=new THREE.Texture(e);s=new THREE.MeshBasicMaterial({map:f,overdraw:!0}),u=function(){var t=new Image;t.onload=function(){f.needsUpdate=!0,s.map.image=this,u()},t.src=e.toDataURL("image/png")},u(),i=new THREE.PlaneGeometry(window.innerWidth,window.innerHeight,1,1),o=new THREE.Mesh(i,s),n.add(o),a=document.createElement("canvas"),a.id="viewport",a.width=window.innerWidth/2,a.height=window.innerHeight/2,r=new THREE.WebGLRenderer({canvas:a}),$("#container").append(r.domElement)}function l(){requestAnimationFrame(l),r.render(n,t)}var t,n,r,i,s,o,u,a;f(),l(),window.onresize=function(){t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),r.setSize(window.innerWidth/2,window.innerHeight/2)}}(function(){function e(t,n,r){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped);if(t.isEqual&&E.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&E.isFunction(n.isEqual))return n.isEqual(t);var i=a.call(t);if(i!=a.call(n))return!1;switch(i){case"[object String]":return t==""+n;case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=typeof t||"object"!=typeof n)return!1;for(var s=r.length;s--;)if(r[s]==t)return!0;r.push(t);var s=0,o=!0;if("[object Array]"==i){if(s=t.length,o=s==n.length)for(;s--&&(o=s in t==s in n&&e(t[s],n[s],r)););}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var u in t)if(E.has(t,u)&&(s++,!(o=E.has(n,u)&&e(t[u],n[u],r))))break;if(o){for(u in n)if(E.has(n,u)&&!(s--))break;o=!s}}return r.pop(),o}var t=this,n=t._,r={},i=Array.prototype,s=Object.prototype,o=i.slice,u=i.unshift,a=s.toString,f=s.hasOwnProperty,l=i.forEach,c=i.map,h=i.reduce,p=i.reduceRight,d=i.filter,v=i.every,m=i.some,g=i.indexOf,y=i.lastIndexOf,s=Array.isArray,b=Object.keys,w=Function.prototype.bind,E=function(e){return new _(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=E),exports._=E):t._=E,E.VERSION="1.3.3";var S=E.each=E.forEach=function(e,t,n){if(e!=null)if(l&&e.forEach===l)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(n,e[i],i,e)===r)break}else for(i in e)if(E.has(e,i)&&t.call(n,e[i],i,e)===r)break};E.map=E.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(S(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},E.reduce=E.foldl=E.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=E.bind(t,r)),i?e.reduce(t,n):e.reduce(t);S(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},E.reduceRight=E.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=E.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=E.toArray(e).reverse();return r&&!i&&(t=E.bind(t,r)),i?E.reduce(s,t,n,r):E.reduce(s,t)},E.find=E.detect=function(e,t,n){var r;return x(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},E.filter=E.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(S(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},E.reject=function(e,t,n){var r=[];return e==null?r:(S(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},E.every=E.all=function(e,t,n){var i=!0;return e==null?i:v&&e.every===v?e.every(t,n):(S(e,function(e,s,o){if(!(i=i&&t.call(n,e,s,o)))return r}),!!i)};var x=E.some=E.any=function(e,t,n){t||(t=E.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,n):(S(e,function(e,s,o){if(i||(i=t.call(n,e,s,o)))return r}),!!i)};E.include=E.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:n=x(e,function(e){return e===t})},E.invoke=function(e,t){var n=o.call(arguments,2);return E.map(e,function(e){return(E.isFunction(t)?t||e:e[t]).apply(e,n)})},E.pluck=function(e,t){return E.map(e,function(e){return e[t]})},E.max=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&E.isEmpty(e))return-Infinity;var r={computed:-Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i>=r.computed&&(r={value:e,computed:i})}),r.value},E.min=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&E.isEmpty(e))return Infinity;var r={computed:Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i<r.computed&&(r={value:e,computed:i})}),r.value},E.shuffle=function(e){var t=[],n;return S(e,function(e,r){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},E.sortBy=function(e,t,n){var r=E.isFunction(t)?t:function(e){return e[t]};return E.pluck(E.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},E.groupBy=function(e,t){var n={},r=E.isFunction(t)?t:function(e){return e[t]};return S(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},E.sortedIndex=function(e,t,n){n||(n=E.identity);for(var r=0,i=e.length;r<i;){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},E.toArray=function(e){return e?E.isArray(e)||E.isArguments(e)?o.call(e):e.toArray&&E.isFunction(e.toArray)?e.toArray():E.values(e):[]},E.size=function(e){return E.isArray(e)?e.length:E.keys(e).length},E.first=E.head=E.take=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},E.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},E.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},E.rest=E.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},E.compact=function(e){return E.filter(e,function(e){return!!e})},E.flatten=function(e,t){return E.reduce(e,function(e,n){return E.isArray(n)?e.concat(t?n:E.flatten(n)):(e[e.length]=n,e)},[])},E.without=function(e){return E.difference(e,o.call(arguments,1))},E.uniq=E.unique=function(e,t,n){var n=n?E.map(e,n):e,r=[];return e.length<3&&(t=!0),E.reduce(n,function(n,i,s){if(t?E.last(n)!==i||!n.length:!E.include(n,i))n.push(i),r.push(e[s]);return n},[]),r},E.union=function(){return E.uniq(E.flatten(arguments,!0))},E.intersection=E.intersect=function(e){var t=o.call(arguments,1);return E.filter(E.uniq(e),function(e){return E.every(t,function(t){return E.indexOf(t,e)>=0})})},E.difference=function(e){var t=E.flatten(o.call(arguments,1),!0);return E.filter(e,function(e){return!E.include(t,e)})},E.zip=function(){for(var e=o.call(arguments),t=E.max(E.pluck(e,"length")),n=Array(t),r=0;r<t;r++)n[r]=E.pluck(e,""+r);return n},E.indexOf=function(e,t,n){if(e==null)return-1;var r;if(n)return n=E.sortedIndex(e,t),e[n]===t?n:-1;if(g&&e.indexOf===g)return e.indexOf(t);n=0;for(r=e.length;n<r;n++)if(n in e&&e[n]===t)return n;return-1},E.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},E.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0);for(var n=arguments[2]||1,r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);i<r;)s[i++]=e,e+=n;return s};var T=function(){};E.bind=function(e,t){var n,r;if(e.bind===w&&w)return w.apply(e,o.call(arguments,1));if(!E.isFunction(e))throw new TypeError;return r=o.call(arguments,2),n=function(){if(this instanceof n){T.prototype=e.prototype;var i=new T,s=e.apply(i,r.concat(o.call(arguments)));return Object(s)===s?s:i}return e.apply(t,r.concat(o.call(arguments)))}},E.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=E.functions(e)),S(t,function(t){e[t]=E.bind(e[t],e)}),e},E.memoize=function(e,t){var n={};return t||(t=E.identity),function(){var r=t.apply(this,arguments);return E.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},E.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},E.defer=function(e){return E.delay.apply(E,[e,1].concat(o.call(arguments,1)))},E.throttle=function(e,t){var n,r,i,s,o,u,a=E.debounce(function(){o=s=!1},t);return function(){return n=this,r=arguments,i||(i=setTimeout(function(){i=null,o&&e.apply(n,r),a()},t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},E.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments;n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,s)},t)}},E.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},E.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},E.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},E.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},E.keys=b||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[],n;for(n in e)E.has(e,n)&&(t[t.length]=n);return t},E.values=function(e){return E.map(e,E.identity)},E.functions=E.methods=function(e){var t=[],n;for(n in e)E.isFunction(e[n])&&t.push(n);return t.sort()},E.extend=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},E.pick=function(e){var t={};return S(E.flatten(o.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},E.defaults=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},E.clone=function(e){return E.isObject(e)?E.isArray(e)?e.slice():E.extend({},e):e},E.tap=function(e,t){return t(e),e},E.isEqual=function(t,n){return e(t,n,[])},E.isEmpty=function(e){if(e==null)return!0;if(E.isArray(e)||E.isString(e))return e.length===0;for(var t in e)if(E.has(e,t))return!1;return!0},E.isElement=function(e){return!!e&&e.nodeType==1},E.isArray=s||function(e){return a.call(e)=="[object Array]"},E.isObject=function(e){return e===Object(e)},E.isArguments=function(e){return a.call(e)=="[object Arguments]"},E.isArguments(arguments)||(E.isArguments=function(e){return!!e&&!!E.has(e,"callee")}),E.isFunction=function(e){return a.call(e)=="[object Function]"},E.isString=function(e){return a.call(e)=="[object String]"},E.isNumber=function(e){return a.call(e)=="[object Number]"},E.isFinite=function(e){return E.isNumber(e)&&isFinite(e)},E.isNaN=function(e){return e!==e},E.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},E.isDate=function(e){return a.call(e)=="[object Date]"},E.isRegExp=function(e){return a.call(e)=="[object RegExp]"},E.isNull=function(e){return e===null},E.isUndefined=function(e){return e===void 0},E.has=function(e,t){return f.call(e,t)},E.noConflict=function(){return t._=n,this},E.identity=function(e){return e},E.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},E.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},E.result=function(e,t){if(e==null)return null;var n=e[t];return E.isFunction(n)?n.call(e):n},E.mixin=function(e){S(E.functions(e),function(t){P(t,E[t]=e[t])})};var N=0;E.uniqueId=function(e){var t=N++;return e?e+t:t},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/.^/,k={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"},L;for(L in k)k[k[L]]=L;var A=/\\|'|\r|\n|\t|\u2028|\u2029/g,O=/\\(\\|'|r|n|t|u2028|u2029)/g,M=function(e){return e.replace(O,function(e,t){return k[t]})};E.template=function(e,t,n){n=E.defaults(n||{},E.templateSettings),e="__p+='"+e.replace(A,function(e){return"\\"+k[e]}).replace(n.escape||C,function(e,t){return"'+\n_.escape("+M(t)+")+\n'"}).replace(n.interpolate||C,function(e,t){return"'+\n("+M(t)+")+\n'"}).replace(n.evaluate||C,function(e,t){return"';\n"+M(t)+"\n;__p+='"})+"';\n",n.variable||(e="with(obj||{}){\n"+e+"}\n");var e="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+e+"return __p;\n",r=new Function(n.variable||"obj","_",e);return t?r(t,E):(t=function(e){return r.call(this,e,E)},t.source="function("+(n.variable||"obj")+"){\n"+e+"}",t)},E.chain=function(e){return E(e).chain()};var _=function(e){this._wrapped=e};E.prototype=_.prototype;var D=function(e,t){return t?E(e).chain():e},P=function(e,t){_.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),D(t.apply(E,e),this._chain)}};E.mixin(E),S("pop,push,reverse,shift,sort,splice,unshift".split(","),function(e){var t=i[e];_.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],D(n,this._chain)}}),S(["concat","join","slice"],function(e){var t=i[e];_.prototype[e]=function(){return D(t.apply(this._wrapped,arguments),this._chain)}}),_.prototype.chain=function(){return this._chain=!0,this},_.prototype.value=function(){return this._wrapped}}).call(this),define("_",[],function(){}),define("connector",["socket.io","_"],function(){function o(){e.emit("ping",{time:(new Date).getTime()})}var e=io.connect("/"),t=[],n=0,r=0,i=function(){return(new Date).getTime()-r},s=!1;e.on("ping",function(e){n=((new Date).getTime()-e.yours.time)/2,t.push(n),t.length>3&&t.splice(0,1);var i=_.reduce(t,function(e,t){return e+t},0)/t.length;r=(new Date).getTime()-(e.now+i);if(t.length<3)o();else{setTimeout(o,7e3);if(!s){for(var a in u)u[a]();s=!0}}}),o();var u=[];return{socket:e,currentTime:i,onEstablished:function(e){s?e():u.push(e)}}}),function(e,t){function k(e,t,r){var i=n[e].layers[t].objs,s=n[e].layers[t].grdntsnptrns,o=i.length,u=s.length;r=r.slice(1);for(var a=0;a<o;a++)if(i[a].optns.id==r)return i[a];for(a=0;a<u;a++)if(s[a].optns.id==r)return s[a];return!1}function L(e,t,r,i){function a(e,t,n){var r=n.length,i,s,o,u;for(o=0;o<r;o++){if(!n[o]._name)continue;i=n[o]._name.split(" ");if(t.length>i.length)continue;var a=t.concat();for(s=0;s<i.length;s++){for(u=0;u<a.length;u++)if(i[s]===a[u]){a.splice(u,1),u--;continue}if(!a.length){e.elements.push(n[o]);break}}}}var s=n[e].layers[t].objs,o=n[e].layers[t].grdntsnptrns,u=i.slice(1).split(".");return a(r,u,s),a(r,u,o),r}function A(e,t,r){var i=n[e].layers[t].objs,s=n[e].layers[t].grdntsnptrns,o=i.length,u=s.length;for(var a=0;a<o;a++)r.elements.push(i[a]);for(a=0;a<u;a++)r.elements.push(s[a]);return r}function M(e){var t=e.optns;e.matrix(U(U(U(t.transformMatrix,t.translateMatrix),t.scaleMatrix),t.rotateMatrix)),D(e)}function _(e,n){for(var r in n)e[r]===t&&(e[r]=n[r]);return e}function D(e){nt(e).optns.redraw=1}function P(e){var n=e.timeDiff,r=1;for(var i=0;i<this.animateQueue.length;i++){var s=this.animateQueue[i],o=s.duration,u=s.easing,a=s.step,f=s.onstep,l=u["type"]=="in"||u["type"]=="inOut"&&r<.5,c=u["type"]=="out"||u["type"]=="inOut"&&r>.5;s.step+=n,r=a/o;for(var h in s)if(this[h]!==t&&s[h]){var p=s[h],d=p.to,v=p.from;H(h,this,s),l&&(this[h]=(d-v)*q[u.fn](r,u)+v),c&&(this[h]=(d-v)*(1-q[u.fn](1-r,u))+v),f&&f.fn.call(this,f),a>=o&&(this[h]=d,H(h,this,s),s[h]=!1,s.animateKeyCount--,s.animateKeyCount||(s.animateFn&&s.animateFn.apply(this),this.animateQueue.splice(i,1),i--))}}return this.animateQueue.length?D(this):this.optns.animated=!1,this}function H(e,n,r){var i=n[e],s=r[e].prev;switch(e){case"_rotateAngle":n.rotate(i-s,n._rotateX,n._rotateY);break;case"_translateX":n.translate(i-s,0);break;case"_translateY":n.translate(0,i-s);break;case"_translateToX":n.translateTo(i,t);break;case"_translateToY":n.translateTo(t,i);break;case"_scaleX":s||(s=1),n.scale(i/s,1);break;case"_scaleY":s||(s=1),n.scale(1,i/s);break;default:return}r[e].prev=i}function B(t,n,r){t=t||e.event,r[n].event=t,r[n].code=t.charCode||t.keyCode,r[n].val=!0,r.redraw=1}function j(t,n,r){if(!r[n].val)return;t=t||e.event;var i={pageX:t.pageX||t.clientX,pageY:t.pageY||t.clientY};r[n].event=t,r[n].x=i.pageX-r.x,r[n].y=i.pageY-r.y,r.redraw=1}function F(e,n){e===t?this["on"+n]():this["on"+n]=e;if(n=="mouseover"||n=="mouseout")n="mousemove";return nt(this).optns[n].val=!0,this}function I(e,n){return e===t?this[n]():this[n]=e,this}function U(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1],e[0][0]*t[0][2]+e[0][1]*t[1][2]+e[0][2]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1],e[1][0]*t[0][2]+e[1][1]*t[1][2]+e[1][2]]]}function z(e,t,n){return{x:e*n[0][0]+t*n[0][1]+n[0][2],y:e*n[1][0]+t*n[1][1]+n[1][2]}}function W(e,t,n){return{x:(e*n[1][1]-t*n[0][1]+n[0][1]*n[1][2]-n[1][1]*n[0][2])/(n[0][0]*n[1][1]-n[1][0]*n[0][1]),y:(-e*n[1][0]+t*n[0][0]-n[0][0]*n[1][2]+n[1][0]*n[0][2])/(n[0][0]*n[1][1]-n[1][0]*n[0][1])}}function X(e,t,n){if(n=="poor")return t;var r={x:t.x,y:t.y},i={x:t.x+t.width,y:t.y+t.height},s=U(e.matrix(),tt(e).matrix()),o=z(r.x,r.y,s),u=z(i.x,r.y,s),a=z(r.x,i.y,s),f=z(i.x,i.y,s),l=[[o.x,o.y],[u.x,u.y],[a.x,a.y],[f.x,f.y]];if(n=="coords")return l;var c,h,p=c=o.x,d=h=o.y;for(var v=0;v<4;v++)p<l[v][0]&&(p=l[v][0]),d<l[v][1]&&(d=l[v][1]),c>l[v][0]&&(c=l[v][0]),h>l[v][1]&&(h=l[v][1]);return{x:c,y:h,width:p-c,height:d-h}}function V(e,t,n){return n=="poor"?t:z(t.x,t.y,U(e.matrix(),tt(e).matrix()))}function $(e){var n={color:{val:e,notColor:t},r:0,g:0,b:0,a:1};if(e.id!==t)return n.color.notColor={level:e._level,canvas:e.optns.canvas.number,layer:e.optns.layer.number},n;if(e.r!==t)return n=_(e,{r:0,g:0,b:0,a:1}),n.color={val:"rgba("+n.r+","+n.g+","+n.b+","+n.a+")",notColor:t},n;if(e.charAt(0)=="#")if(e.length>4)n.r=parseInt(e.substr(1,2),16),n.g=parseInt(e.substr(3,2),16),n.b=parseInt(e.substr(5,2),16);else{var r=e.charAt(1),i=e.charAt(2),s=e.charAt(3);n.r=parseInt(r+r,16),n.g=parseInt(i+i,16),n.b=parseInt(s+s,16)}else{var o=e.split(",");if(o.length==4){var u=o[0].split("("),a=o[3].split(")");n.r=parseInt(u[1]),n.g=parseInt(o[1]),n.b=parseInt(o[2]),n.a=parseFloat(a[0])}if(o.length==3){u=o[0].split("(");var f=o[2].split(")");n.r=parseInt(u[1]),n.g=parseInt(o[1]),n.b=parseInt(f[0])}}return n.color.notColor=t,n}function J(e){return e.getBoundingClientRect?Q(e):K(e)}function K(e){var t=0,n=0;while(e)t+=parseInt(e.offsetTop),n+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:n}}function Q(t){var n=t.getBoundingClientRect(),r=document.body||{},i=document.documentElement,s=e.pageYOffset||i.scrollTop||r.scrollTop,o=e.pageXOffset||i.scrollLeft||r.scrollLeft,u=i.clientTop||r.clientTop||0,a=i.clientLeft||r.clientLeft||0,f=n.top+s-u,l=n.left+o-a;return{top:b(f),left:b(l)}}function G(e,t){et(e,t),Y(e,t)}function Y(e,t){if(!e.optns.focused)return;t.keyDown.val!=0&&typeof e.onkeydown=="function"&&e.onkeydown(t.keyDown),t.keyUp.val!=0&&typeof e.onkeyup=="function"&&e.onkeyup(t.keyUp),t.keyPress.val!=0&&typeof e.onkeypress=="function"&&e.onkeypress(t.keyPress)}function Z(e,n,r){var i={},s=nt(e),o=s.optns.ctx,u=s.layers[e.optns.layer.number];i.x=n,i.y=r,C&&(i=W(n,r,u.matrix()),i=W(i.x,i.y,e.matrix()));if(o.isPointInPath===t||e._img!==t||e._imgData!==t||e._proto=="text"){var a=e.getRect("poor");i=W(n,r,U(e.matrix(),u.matrix()));if(a.x<=i.x&&a.y<=i.y&&a.x+a.width>=i.x&&a.y+a.height>=i.y)return i}else if(o.isPointInPath(i.x,i.y))return i;return!1}function et(e,t){var n=!1,r=t.mousemove,i=t.mousedown,s=t.mouseup,o=t.click,u=t.dblclick,a=r.x||i.x||s.x||u.x||o.x,f=r.y||i.y||s.y||u.y||o.y;a!=0&&(n=Z(e,a,f)),n&&(r.x!=0&&(r.object=e),i.x!=0&&(i.objects[i.objects.length]=e),o.x!=0&&(o.objects[o.objects.length]=e),u.x!=0&&(u.objects[u.objects.length]=e),s.x!=0&&(s.objects[s.objects.length]=e),t.point=n)}function tt(e){return nt(e).layers[e.optns.layer.number]}function nt(e){return n[e.optns.canvas.number]}function rt(e,r,i){D(r);var s=r.optns.canvas,o=r.optns.layer;if(e===t)return o.id;if(o.id==e)return r;var u={i:s.number,j:o.number};o.id=e;var a=O.layer(e),f={i:a.optns.canvas.number,j:a.optns.number},l=n[u.i].layers[u.j][i],c=n[f.i].layers[f.j][i];return l.splice(r.optns.number,1),r._level=r.optns.number=c.length,c[r._level]=r,o.number=f.j,s.number=f.i,s.id=a.optns.canvas.id,D(r),r}function it(e,n){for(var r in n)switch(typeof n[r]){case"function":if(r.substr(0,2)=="on")break;e[r]===t&&(e[r]=n[r]);break;case"object":if(r=="optns"||r=="animateQueue")break;if(r=="objs"||r=="grdntsnptrns"){for(var i in n[r])n[r].hasOwnProperty(i)&&n[r][i].clone().layer(e.optns.id);break}if(!n[r]||r==="ctx")continue;e[r]=typeof n[r].pop=="function"?[]:{},it(e[r],n[r]);break;default:if(r=="_level")break;e[r]=n[r]}}function st(e,r,i){D(r);var s=r.optns.canvas,o=r.optns.layer;if(e===t)return n[s.number].optns.id;if(n[s.number].optns.id==e)return r;var u={i:s.number,j:o.number};O.canvas(e);for(var a=0;a<n.length;a++){var f=n[a];if(f.optns.id==e){var l=n[u.i].layers[u.j][i],c=f.layers[0][i];l.splice(r.optns.number,1),ot(l),r._level=r.optns.number=c.length,c[r._level]=r,o.number=0,s.number=a,s.id=f.optns.id,o.id=f.layers[0].optns.id}}return D(r),r}function ot(e){for(var t=0;t<e.length;t++)e[t].optns.number=t}function ut(e,t,n,r,i){var s=e.length,o,u,a;for(var f=0;f<s;f++)o=e[f].optns,u=o.canvas,a=o.layer,u.id=r,u.number=i,a.id=t,a.number=n}function at(e){return e.sort(function(e,t){return e._level>t._level?1:e._level<t._level?-1:0}),ot(e),e.length}function ft(e){var t;do{t=!1;for(var n=0;n<e.length;n++)e[n].optns.deleted&&(e.splice(n,1),t=!0)}while(t);return ot(e),e.length}function ct(e){var t=new lt.layer;return t.base(e)}function ht(){var e=new lt.group;return e.base()}function pt(e,t,n){var r=n.drag;return n.drag.init&&n.drag.object?(e.optns.drop.val==1?(r.init==r.object&&r.init.visible(!0),typeof e.optns.drop.fn=="function"&&e.optns.drop.fn.call(e,r.init)):(r.object.visible(!1),r.init.visible(!0),r.init.optns.translateMatrix[0][2]=r.object.optns.translateMatrix[0][2],r.init.optns.translateMatrix[1][2]=r.object.optns.translateMatrix[1][2],M(r.init),r.object!=r.init&&r.object.visible(!1),typeof r.init.optns.drag.stop=="function"&&r.init.optns.drag.stop.call(r.init,{x:t.x,y:t.y})),r.x!=r.startX||r.y!==r.startY):!1}var n=[],r=Math,i=r.PI,s=i*2,o=0,u=0,a=!1,f=!1,l=/[A-z]+?/,c=/\d.\w\w/,h=e.navigator.userAgent.match(/Firefox\/\w+\.\w+/i),p=180/i,d=r.max,v=r.min,m=r.cos,g=r.sin,y=r.floor,b=r.round,w=r.abs,E=r.pow,S=r.sqrt,x=1e3/60,T=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e,t){return setTimeout(e,x)}}(),N=function(){return e.cancelAnimationFrame||e.webkitCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||e.oCancelRequestAnimationFrame||e.msCancelRequestAnimationFrame||clearTimeout}();if(h!=""&&h!==null)var C=parseInt(h[0].split(/[ \/\.]/i)[1])<7;var O=function(e,r){if(e===t)return this;typeof e=="object"&&(r=e,e=t);var i=-1,s=-1,o=n.length,u=ht(),a,f,l,c,h,p,d;if(r===t){if(e.charAt(0)==="#")for(a=0;a<o;a++){d=n[a].layers.length;for(f=0;f<d;f++){p=k(a,f,e);if(p)return p}}if(e.charAt(0)===".")for(a=0;a<o;a++){d=n[a].layers.length;for(f=0;f<d;f++)u=L(a,f,u,e)}}else{if(r.canvas!==t)for(a=0;a<o;a++)if(n[a].optns.id==r.canvas){i=a,l=n[a];break}if(r.layer!==t)if(i!=-1){d=l.layers.length;for(a=0;a<d;a++)if(l.layers[a].optns.id==r.layer){s=a,c=l.layers[a];break}}else for(a=0;a<o;a++){h=n[a].layers,d=h.length;for(f=0;f<d;f++)if(h[f].optns.id==r.layer){i=a,s=f,l=n[a],c=l.layers[f];break}if(c>-1)break}if(s<0&&i<0)return ht();if(s<0){h=l.layers,d=h.length;if(e===t)for(f=0;f<d;f++)u=A(i,f,u);else if(e.charAt(0)==="#")for(f=0;f<d;f++){p=k(i,f,e);if(p)return p}else if(e.charAt(0)===".")for(f=0;f<d;f++)u=L(i,f,u,e)}else{e===t&&(u=A(i,s,u));if(e.charAt(0)==="#")return k(i,s,e);e.charAt(0)==="."&&(u=L(i,s,u,e))}}if(r!==t)if(r.attrs!==t||r.fns!==t)return u.find(r);return u.elements.length?u:ht()},q={linear:function(e,t){return e},exp:function(e,t){var n=t.n||2;return E(e,n)},circ:function(e,t){return 1-S(1-e*e)},sine:function(e,t){return 1-g((1-e)*i/2)},back:function(e,t){var n=t.n||2,r=t.x||1.5;return E(e,n)*((r+1)*e-r)},elastic:function(e,t){var n=t.n||2,r=t.m||20,s=t.k||3,o=t.x||1.5;return E(n,10*(e-1))*m(r*e*i*o/s)},bounce:function(e,t){var n=t.n||4,r=t.b||.25,i=[1];for(var s=1;s<n;s++)i[s]=i[s-1]+E(r,s/2);var o=2*i[n-1]-1;for(s=0;s<n;s++)if(o*e>=(s>0?2*i[s-1]-1:0)&&o*e<=2*i[s]-1)return E(o*(e-(2*i[s]-1-E(r,s/2))/o),2)+1-E(r,s);return 1}},R={color:{fn:function(e,t,n,r){var i,s,o;n=n[r];for(s=0;s<e;s++)for(o=0;o<t;o++)i=this.getPixel(s,o),i[n[0]]=i[n[0]]*2-i[n[1]]-i[n[2]],i[n[1]]=0,i[n[2]]=0,i[n[0]]=i[n[0]]>255?255:i[n[0]],this.setPixel(s,o,i)},matrix:{red:[0,1,2],green:[1,0,2],blue:[2,0,1]}},linear:{fn:function(e,t,n,r){var i=[],s,o,u,a,f,l;n=n[r],f=n.length,l=n[0].length;for(o=0;o<e;o++){i[o]=[];for(u=0;u<t;u++){i[o][u]=[0,0,0,1];for(f=0;f<3;f++)for(l=0;l<3;l++){s=this.getPixel(o-parseInt(f/2),u-parseInt(l/2));for(a=0;a<3;a++)i[o][u][a]+=s[a]*n[f][l]}}}for(o=0;o<e;o++)for(u=0;u<t;u++)this.setPixel(o,u,i[o][u])},matrix:{sharp:[[-0.375,-0.375,-0.375],[-0.375,4,-0.375],[-0.375,-0.375,-0.375]],blur:[[.111,.111,.111],[.111,.111,.111],[.111,.111,.111]]}}},lt={};lt.object=function(){this.getCenter=function(e){var t=this.getRect("poor"),n={x:(t.x*2+t.width)/2,y:(t.y*2+t.height)/2};return V(this,n,e)},this.position=function(){return z(this._x,this._y,U(this.matrix(),tt(this).matrix()))},this.buffer=function(e){var n=this.optns.buffer;if(e===t)return n.val?n.cnv:!1;if(n.val===e)return this;if(e){var r=n.cnv=document.createElement("canvas"),i=n.ctx=r.getContext("2d"),s=n.rect=this.getRect(),o=this.transform();r.setAttribute("width",s.width),r.setAttribute("height",s.height),n.x=this._x,n.y=this._y,n.dx=this._transformdx,n.dy=this._transformdy,this._x=this._y=0,this.transform(1,0,0,1,-s.x+n.dx,-s.y+n.dy,!0),this.setOptns(i),it(n.optns={},nt(this).optns),n.optns.ctx=i,this.draw(n.optns),this._x=n.x,this._y=n.y,this.transform(o[0][0],o[1][0],o[0][1],o[1][1],s.x,s.y,!0),n.val=!0}else this.translate(-n.rect.x+n.dx,-n.rect.y+n.dy),this.optns.buffer={val:!1};return this},this.clone=function(e){var n=new lt[this._proto];return lt[this._proto].prototype.base.call(n),it(n,this),n.layer(tt(this).optns.id),it(n.optns.transformMatrix,this.optns.transformMatrix),it(n.optns.translateMatrix,this.optns.translateMatrix),it(n.optns.scaleMatrix,this.optns.scaleMatrix),it(n.optns.rotateMatrix,this.optns.rotateMatrix),e===t?n:n.animate(e)},this.shadow=function(e){for(var t in e)switch(t){case"x":this._shadowX=e.x;break;case"y":this._shadowY=e.y;break;case"blur":this._shadowBlur=e.blur;break;case"color":var n=$(e.color);this._shadowColor=e.color.val,this._shadowColorR=n.r,this._shadowColorG=n.g,this._shadowColorB=n.b,this._shadowColorA=n.a}return D(this),this},this.setOptns=function(e){e.globalAlpha=this._opacity,e.shadowOffsetX=this._shadowX,e.shadowOffsetY=this._shadowY,e.shadowBlur=this._shadowBlur,e.globalCompositeOperation=this._composite;var t=parseInt(this._shadowColorR),n=parseInt(this._shadowColorG),r=parseInt(this._shadowColorB),i=parseInt(this._shadowColorA*100)/100;return this._shadowColorRPrev!==t||this._shadowColorGPrev!==n||this._shadowColorBPrev!==r||this._shadowColorAPrev!==i?(e.shadowColor=this._shadowColor="rgba("+t+", "+n+", "+r+", "+i+")",this._shadowColorRPrev=t,this._shadowColorGPrev=n,this._shadowColorBPrev=r,this._shadowColorAPrev=i):e.shadowColor=this._shadowColor,e.transform(this._transform11,this._transform12,this._transform21,this._transform22,this._transformdx,this._transformdy),this},this.up=function(e){e===t&&(e=1);if(e=="top")this.level(e);else{var n=tt(this).objs[this.optns.number+e];n!==t&&(e=n._level+1-this._level),this.level(this._level+e)}return this},this.down=function(e){e==t&&(e=1);if(e=="bottom")this.level(e);else{var n=tt(this).objs[this.optns.number-e];n!==t&&(e=this._level-(n._level-1)),this.level(this._level-e)}return this},this.level=function(e){if(e==t)return this._level;var n=tt(this);return e=="bottom"&&(this.optns.number==0?e=this._level:e=n.objs[0]._level-1),e=="top"&&(this.optns.number==n.objs.length?e=this._level:e=n.objs[n.objs.length-1]._level+1),this._level=e,n.optns.anyObjLevelChanged=!0,D(this),this},this.del=function(){this.optns.deleted=!0,tt(this).optns.anyObjDeleted=!0,D(this)},this.focus=function(e){return e===t?(this.optns.focused=!0,typeof this.onfocus=="function"&&this.onfocus()):this.onfocus=e,this},this.blur=function(e){return e===t?(this.optns.focused=!1,typeof this.onblur=="function"&&this.onblur()):this.onblur=e,this},this.click=function(e){return F.call(this,e,"click")},this.dblclick=function(e){return F.call(this,e,"dblclick")},this.keypress=function(e){return I.call(this,e,"onkeypress")},this.keydown=function(e){return I.call(this,e,"onkeydown")},this.keyup=function(e){return I.call(this,e,"onkeyup")},this.mousedown=function(e){return F.call(this,e,"mousedown")},this.mouseup=function(e){return F.call(this,e,"mouseup")},this.mousemove=function(e){return F.call(this,e,"mousemove")},this.mouseover=function(e){return F.call(this,e,"mouseover")},this.mouseout=function(e){return F.call(this,e,"mouseout")},this.attr=function(e,n){if(typeof e=="object")var r=e;else{if(n===t)return this["_"+e];r={},r[e]=n}return this.animate(r)},this.queue=function(){var e=this.animateQueue.length,n,r,i,s=0,o=0,u,a=arguments;for(r=0;r<a.length;r++)if(typeof a[r]=="function"){a[r].apply(this),a[r]=!1,r++;if(this.animateQueue.length>e){for(i=e;i<this.animateQueue.length;i++){n=this.animateQueue[i];if(n.duration!==t){n.duration>s&&(s=n.duration,o=i);break}}if(s){n=this.animateQueue[o],n.animateFn?(u=n.animateFn,n.animateFn=function(){u.apply(this),this.queue.apply(this,a)}):n.animateFn=function(){this.queue.apply(this,a)};break}}}},this.stop=function(e,n){this.optns.animated=!1,n===t&&(n=!1),e===t&&(e=!1);for(var r=0;r<this.animateQueue.length;r++){var i=this.animateQueue[r];n&&i.animateFn.call(this);if(e)for(var s in i)i[s].from!==t&&(this[s]=i[s].to,H(s,this,i))}return this.animateQueue=[],this},this.animate=function(e,n,r,i,s){n===t?n=1:(typeof n=="function"&&(s=n,n=1),typeof n=="object"&&(r=n,n=1)),r===t?r={fn:"linear",type:"in"}:(typeof r=="function"&&(s=r,r={fn:"linear",type:"in"}),r.type===t&&(r.type="in")),i===t?i=!1:typeof i=="function"&&(s=i,i=!1),e.scale!==t&&(this._scaleX=this._scaleY=1,typeof e.scale!="object"?e.scaleX=e.scaleY=e.scale:(e.scaleX=e.scale.x||1,e.scaleY=e.scale.y||1)),e.translate!==t&&(this._translateX=this._translateY=0,typeof e.translate!="object"?e.translateX=e.translateY=e.translate:(e.translateX=e.translate.x||0,e.translateY=e.translate.y||0),e.translate=t);if(e.translateTo!==t){var o=this.position();this._translateToX=o.x,this._translateToY=o.y,typeof e.translateTo!="object"?e.translateToX=e.translateToY=e.translateTo:(e.translateToX=e.translateTo.x||0,e.translateToY=e.translateTo.y||0),e.translateTo=t}e.rotate!==t&&(e.rotateAngle=e.rotate.angle,this._rotateAngle=0,this._rotateX=e.rotate.x||0,this._rotateY=e.rotate.y||0,e.rotate=t);if(e.color!==t){var u=$(e.color);u.color.notColor?this.optns.color.notColor=u.color.notColor:(e.colorR=u.r,e.colorG=u.g,e.colorB=u.b,e.alpha=u.a),e.color=t}e.shadowColor!==t&&(u=$(e.shadowColor),e.shadowColorR=u.r,e.shadowColorG=u.g,e.shadowColorB=u.b,e.shadowColorA=u.a,e.shadowColor=t);if(n>1){var a=this.animateQueue[this.animateQueue.length]={animateKeyCount:0};a.animateFn=s||!1,this.optns.animated=!0,a.duration=n,a.step=0,a.easing=r,a.onstep=i}for(var f in e)if(this["_"+f]!==t&&e[f]!==t){var c=e[f],h="_"+f;c!=this[h]&&(c.charAt&&(f=="string"?this._string=c:c.charAt(1)=="="?c=this[h]+parseInt(c.charAt(0)+"1")*parseInt(c.substr(2)):l.test(c)?this[h]=c:c=parseInt(c)),n==1?this[h]=c:(a[h]={from:this[h],to:c,prev:0},a.animateKeyCount++))}return n==1&&(e.rotateAngle&&this.rotate(this._rotateAngle,this._rotateX,this._rotateY),(e.translateX||e.translateY)&&this.translate(this._translateX,this._translateY),(e.translateToX||e.translateToY)&&this.translate(this._translateToX,this._translateToY),(e.scaleX||e.scaleY)&&this.scale(this._scaleX,this._scaleY)),D(this),this},this.matrix=function(e){return e===t?[[this._transform11,this._transform21,this._transformdx],[this._transform12,this._transform22,this._transformdy]]:(this._transform11=e[0][0],this._transform21=e[0][1],this._transform12=e[1][0],this._transform22=e[1][1],this._transformdx=e[0][2],this._transformdy=e[1][2],this)},this.translateTo=function(e,n,r,i,s,o){if(r!==t)return this.animate({translateTo:{x:e,y:n}},r,i,s,o);var u=this.position(),a=0,f=0;return e!==t&&(a=e-u.x),n!==t&&(f=n-u.y),this.translate(a,f)},this.translate=function(e,n,r,i,s,o){return r!==t?this.animate({translate:{x:e,y:n}},r,i,s,o):(this.optns.translateMatrix=U(this.optns.translateMatrix,[[1,0,e],[0,1,n]]),M(this),this)},this.scale=function(e,n,r,i,s,o){return r!==t?this.animate({scale:{x:e,y:n}},r,i,s,o):(n===t&&(n=e),this.optns.scaleMatrix=U(this.optns.scaleMatrix,[[e,0,this._x*(1-e)],[0,n,this._y*(1-n)]]),M(this),this)},this.rotate=function(e,n,r,i,s,o,u){if(i!==t)return this.animate({rotate:{angle:e,x:n,y:r}},i,s,o,u);e/=p;var a=m(e),f=g(e),l=0,c=0;if(n!==t){if(n=="center"){var h=this.getCenter("poor");r===t?(n=h.x,r=h.y):(n=h.x+r.x,r=h.y+r.y)}l=-n*(a-1)+r*f,c=-r*(a-1)-n*f}return this.optns.rotateMatrix=U(this.optns.rotateMatrix,[[a,-f,l],[f,a,c]]),M(this),this},this.transform=function(e,n,r,i,s,o,u){if(e===t)return this.matrix();var a=this.optns;return u!==t?(a.transformMatrix=[[e,r,s],[n,i,o]],a.rotateMatrix=[[1,0,0],[0,1,0]],a.scaleMatrix=[[1,0,0],[0,1,0]],a.translateMatrix=[[1,0,0],[0,1,0]]):a.transformMatrix=U(a.transformMatrix,[[e,r,s],[n,i,o]]),M(this),this},this.beforeDraw=function(e){if(!this._visible)return!1;var t=e.ctx;t.save();if(this.optns.clipObject){var n=this.optns.clipObject;n._visible=!0,n.optns.animated&&P.call(n,e),n.setOptns(t),t.beginPath(),n.draw(t),t.clip()}return this.setOptns(t),this.optns.animated&&P.call(this,e),t.beginPath(),!0},this.clip=function(e){return e===t?this.optns.clipObject:(tt(this).objs.splice(e.optns.number,1),this.optns.clipObject=e,this)},this.afterDraw=function(e){e.ctx.closePath(),G(this,e),e.ctx.restore(),this.optns.clipObject&&lt.shape.prototype.afterDraw.call(this.optns.clipObject,e)},this.isPointIn=function(e,n,r){var i=nt(this).optns,s=i.ctx,o=!1,u=this.optns,a=!1;r!==t&&(e-=i.x,n-=i.y),u.animated&&(o=!0),u.animated=!1;if(u.clipObject){var f=u.clipObject,l=f.optns;l.animated&&(a=!0,l.animated=!1)}tt(this).setOptns(s),this.beforeDraw(i),this.draw(s);var c=Z(this,e,n);return s.closePath(),s.restore(),u.animated=o,a&&(l.animated=a),c},this.layer=function(e){return rt(e,this,"objs")},this.canvas=function(e){return st(e,this,"objs")},this.draggable=function(e,n,r){if(n===t&&typeof e=="object"&&e.optns===t){n=e.params,r=e.drag;var i=e.start,s=e.stop,o=e.disabled;e=e.object}var u=this,a=this.optns.drag;typeof n=="function"&&(r=n,n=t),typeof e=="function"&&(r=e,e=t),a.shiftX=0,a.shiftY=0,n!==t&&(n.shiftX!==t&&(a.shiftX=n.shiftX,n.shiftX=t),n.shiftY!==t&&(a.shiftY=n.shiftY,n.shiftY=t)),e!==t&&(e.id&&(u=n===t?e.visible(!1):e.animate(n).visible(!1)),e=="clone"&&(u=this.clone(n).visible(!1),a.type="clone")),a.val=!0,a.x=this._x,a.y=this._y,a.dx=this._transformdx,a.dy=this._transformdy,a.object=u,a.params=n,a.drag=r||!1,a.start=i||!1,a.stop=s||!1,a.disabled=o||!1;var f=nt(this).optns;return f.mousemove.val=!0,f.mousedown.val=!0,f.mouseup.val=!0,this},this.droppable=function(e){return this.optns.drop.val=!0,e!==t&&(this.optns.drop.fn=e),this},this.name=function(e){return this.attr("name",e)},this.hasName=function(e){var t=this.attr("name").split(" "),n=0;while(n<t.length){if(t[n]===e)return!0;n++}return!1},this.addName=function(e){var t=this.attr("name").split(" "),n=0;while(n<t.length){if(t[n]===e)return this;n++}return t.push(e),this.attr("name",t.join(" "))},this.removeName=function(e){var t=this.attr("name").split(" "),n=0;while(n<t.length){if(t[n]===e)return t.splice(n,1),this.attr("name",t.join(" "));n++}return this},this.visible=function(e){return this.attr("visible",e)},this.composite=function(e){return this.attr("composite",e)},this.id=function(e){return e===t?this.optns.id:(this.optns.id=e,this)},this.opacity=function(e){return this.attr("opacity",e)},this.fadeIn=function(e,t,n,r){return this.fadeTo(1,e,t,n,r)},this.fadeOut=function(e,t,n,r){return this.fadeTo(0,e,t,n,r)},this.fadeTo=function(e,n,r,i,s){return n===t&&(n=600),this.animate({opacity:e},n,r,i,s)},this.fadeToggle=function(e,t,n,r){return this._opacity?this.fadeOut(e,t,n,r):this.fadeIn(e,t,n,r),this},this.instanceOf=function(e){return e===t?this._proto:this instanceof lt[e]},this.base=function(e,r,i){typeof e=="object"?(e=_(e,{x:0,y:0,service:!1}),i=e.service,r=e.y,e=e.x):i===t&&(i=!1);var s=n[o];this.optns={animated:!1,clipObject:!1,drop:{val:!1,fn:function(){}},drag:{val:!1},layer:{id:s.optns.id+"Layer0",number:0},canvas:{number:0},focused:!1,buffer:{val:!1},rotateMatrix:[[1,0,0],[0,1,0]],scaleMatrix:[[1,0,0],[0,1,0]],translateMatrix:[[1,0,0],[0,1,0]],transformMatrix:[[1,0,0],[0,1,0]]},this.animateQueue=[],this._x=e,this._y=r;if(i==0&&s!==t&&s.layers[0]!==t){this.optns.layer.number=0,this.optns.canvas.number=o;var u=tt(this),a=u.objs.length;this.optns.number=a,this._level=a?u.objs[a-1]._level+1:0,u.objs[a]=this,this.optns.layer.id=u.optns.id,D(this)}return this},this._visible=!0,this._composite="source-over",this._name="",this._opacity=1,this._shadowX=0,this._shadowY=0,this._shadowBlur=0,this._shadowColor="rgba(0,0,0,0)",this._shadowColorR=0,this._shadowColorG=0,this._shadowColorB=0,this._shadowColorA=0,this._shadowColorRPrev=0,this._shadowColorGPrev=0,this._shadowColorBPrev=0,this._shadowColorAPrev=0,this._translateX=0,this._translateY=0,this._scaleX=1,this._scaleY=1,this._rotateAngle=0,this._rotateX=0,this._rotateY=0,this._transform11=1,this._transform12=0,this._transform21=0,this._transform22=1,this._transformdx=0,this._transformdy=0,this._matrixChanged=!1},lt.object.prototype=new lt.object,lt.shape=function(){this.color=function(e){return e===t?[this._colorR,this._colorG,this._colorB,this._alpha]:this.attr("color",e)},this.lineStyle=function(e){return this.attr(e)},this.setOptns=function(e){lt.shape.prototype.setOptns.call(this,e),e.lineWidth=this._lineWidth,e.lineCap=this._cap,e.lineJoin=this._join,e.miterLimit=this._miterLimit;var r=this.optns.color;if(r.notColor===t){var i=parseInt(this._colorR),s=parseInt(this._colorG),o=parseInt(this._colorB),u=parseInt(this._alpha*100)/100;this._colorRPrev!==i||this._colorGPrev!==s||this._colorBPrev!==o||this._alphaPrev!==u?(r.val=this._color="rgba("+i+", "+s+", "+o+", "+u+")",this._colorRPrev=i,this._colorGPrev=s,this._colorBPrev=o,this._alphaPrev=u):r.val=this._color}else{var a=r.notColor,f=n[a.canvas].layers[a.layer];f.grdntsnptrns[a.level]!==t&&(r.val=f.grdntsnptrns[a.level].val)}this._fill?e.fillStyle=r.val:e.strokeStyle=r.val},this.afterDraw=function(e){this._fill?e.ctx.fill():e.ctx.stroke(),lt.shape.prototype.afterDraw.call(this,e)},this.base=function(e){return e===t&&(e={}),e.color===t?e.color="rgba(0,0,0,1)":!e.color.charAt&&e.color.id===t&&e.color.r===t&&(e.fill=e.color,e.color="rgba(0,0,0,1)"),e=_(e,{color:"rgba(0,0,0,1)",fill:0}),lt.shape.prototype.base.call(this,e),this._fill=e.fill,this.optns.color={val:e.color,notColor:t},this.color(e.color)},this._colorR=0,this._colorG=0,this._colorB=0,this._alpha=0,this._colorRPrev=0,this._colorGPrev=0,this._colorBPrev=0,this._alphaPrev=0,this._color="rgba(0,0,0,0)",this._lineWidth=1,this._cap="butt",this._join="miter",this._miterLimit=1},lt.shape.prototype=new lt.object,lt.lines=function(){this.getCenter=function(e){var t={x:this._x0,y:this._y0};for(var n=1;n<this.shapesCount;n++)t.x+=this["_x"+n],t.y+=this["_y"+n];return t.x=t.x/this.shapesCount,t.y=t.y/this.shapesCount,V(this,t,e)},this.position=function(){return z(this._x0,this._y0,U(this.matrix(),tt(this).matrix()))},this.getRect=function(e){var t,n,r=t=this._x0,i=n=this._y0;for(var s=1;s<this.shapesCount;s++)r<this["_x"+s]&&(r=this["_x"+s]),i<this["_y"+s]&&(i=this["_y"+s]),t>this["_x"+s]&&(t=this["_x"+s]),n>this["_y"+s]&&(n=this["_y"+s]);var o={x:t,y:n,width:r-t,height:i-n};return X(this,o,e)},this.addPoint=function(){D(this);var e=this.pointNames;for(var t=0;t<e.length;t++)this[e[t]+this.shapesCount]=arguments[t];return this.shapesCount++,this},this.delPoint=function(e,n,r){D(this);if(n===t){var i=this.points();i.splice(e,1),this.points(i)}else{r=r||0;for(var s=0;s<this.shapesCount;s++)this["_x"+s]<e+r&&this["_x"+s]>e-r&&this["_y"+s]<n+r&&this["_y"+s]<n+r&&(this.delPoint(s),s--)}return this},this.points=function(e){var n=this.pointNames;if(e===t){e=[];for(var r=0;r<this.shapesCount;r++){e[r]=[];for(var i=0;i<n.length;i++)e[r][i]=this[n[i]+r]}return e}D(this);var s=this.shapesCount;this.shapesCount=e.length;for(r=0;r<this.shapesCount;r++)for(i=0;i<n.length;i++)this[n[i]+r]=e[r][i];for(r=this.shapesCount;r<s;r++)for(i=0;i<n.length;i++)this[n[i]+r]=t;return this},this.base=function(e,n,r){return e!==t&&typeof e.pop=="function"&&(e={points:e,color:n,fill:r}),lt.lines.prototype.base.call(this,e),this.shapesCount=0,e!==t&&e.points!==t&&this.points(e.points),this}},lt.lines.prototype=new lt.shape,lt.line=function(){this.draw=function(e){if(this._x0===t)return;e.moveTo(this._x0,this._y0);for(var n=1;n<this.shapesCount;n++)e.lineTo(this["_x"+n],this["_y"+n])},this.base=function(e,t,n){return lt.line.prototype.base.call(this,e,t,n),this},this._proto="line",this.pointNames=["_x","_y"]},lt.line.prototype=new lt.lines,lt.qCurve=function(){this.draw=function(e){if(this._x0===t)return;e.moveTo(this._x0,this._y0);for(var n=1;n<this.shapesCount;n++)e.quadraticCurveTo(this["_cp1x"+n],this["_cp1y"+n],this["_x"+n],this["_y"+n])},this.base=function(e,t,n){return lt.qCurve.prototype.base.call(this,e,t,n),this},this._proto="qCurve",this.pointNames=["_x","_y","_cp1x","_cp1y"]},lt.qCurve.prototype=new lt.lines,lt.bCurve=function(){this.draw=function(e){if(this._x0===t)return;e.moveTo(this._x0,this._y0);for(var n=1;n<this.shapesCount;n++)e.bezierCurveTo(this["_cp1x"+n],this["_cp1y"+n],this["_cp2x"+n],this["_cp2y"+n],this["_x"+n],this["_y"+n])},this.base=function(e,t,n){return lt.bCurve.prototype.base.call(this,e,t,n),this},this._proto="bCurve",this.pointNames=["_x","_y","_cp1x","_cp1y","_cp2x","_cp2y"]},lt.bCurve.prototype=new lt.lines,lt.circle=function(){this.getCenter=function(e){return V(this,{x:this._x,y:this._y},e)},this.getRect=function(e){var t={x:Math.floor(this._x-this._radius),y:Math.floor(this._y-this._radius)};return t.width=t.height=Math.ceil(this._radius)*2,X(this,t,e)},this.draw=function(e){e.arc(this._x,this._y,this._radius,0,s,!0)},this.base=function(e,t,n,r,i){return typeof e!="object"&&(e={x:e,y:t,radius:n,color:r,fill:i}),e=_(e,{radius:0}),lt.circle.prototype.base.call(this,e),this._radius=e.radius,this},this._proto="circle"},lt.circle.prototype=new lt.shape,lt.rect=function(){this.getRect=function(e){return X(this,{x:this._x,y:this._y,width:this._width,height:this._height},e)},this.draw=function(e){e.rect(this._x,this._y,this._width,this._height)},this.base=function(e,t,n,r,i,s){return typeof e!="object"&&(e={x:e,y:t,width:n,height:r,color:i,fill:s}),e=_(e,{width:0,height:0}),lt.rect.prototype.base.call(this,e),this._width=e.width,this._height=e.height,this},this._proto="rect"},lt.rect.prototype=new lt.shape,lt.arc=function(){this.getRect=function(e){var t={x:this._x,y:this._y},n=this._startAngle,r=this._endAngle,i=this._radius,s=y(g(n/p)*i),o=y(m(n/p)*i),u=y(g(r/p)*i),a=y(m(r/p)*i),f=o>0&&a>0,l=o<0&&a<0,c=s>0&&u>0,h=s<0&&u<0;return t.width=t.height=i,this._anticlockwise&&n<r||!this._anticlockwise&&n>r?(l||f&&(h||c)||o==0&&a==0?(t.y-=i,t.height+=i):f&&u<0&&s>0?(t.y+=u,t.height+=u):a>0&&u<0&&o<0?(t.y+=v(u,s),t.height-=v(u,s)):(h?t.y-=d(u,s):t.y-=i,t.height+=d(u,s)),c||h&&(l||f)||s==0&&u==0?(t.x-=i,t.width+=i):u<0&&s>0?(t.x+=v(a,o),t.width-=v(a,o)):(l?t.x-=d(a,o):t.x-=i,t.width+=d(a,o))):(f=o>=0&&a>=0,c=s>=0&&u>=0,l=o<=0&&a<=0,h=s<=0&&u<=0,h&&f?(t.x+=v(a,o),t.width-=v(a,o),t.y+=v(u,s),t.height+=d(u,s)):h&&l?(t.x+=v(a,o),t.width+=d(a,o),t.y+=v(u,s),t.height+=d(u,s)):h?(t.x+=v(a,o),t.width+=d(a,o),t.y-=i,t.height+=d(u,s)):f&&c?(t.x+=v(a,o),t.width=w(a-o),t.y+=v(u,s),t.height-=v(u,s)):c?(t.x+=v(a,o),t.width=w(a)+w(o),t.y+=v(u,s),t.height-=v(u,s)):l?(t.x-=i,t.width+=d(a,o),t.y-=i,t.height+=d(u,s)):f&&(t.x-=i,t.width+=d(a,o),t.y-=i,t.height+=i)),X(this,t,e)},this.draw=function(e){e.arc(this._x,this._y,this._radius,this._startAngle/p,this._endAngle/p,this._anticlockwise)},this.base=function(e,n,r,i,s,o,u,a){return o!==t&&(o.charAt&&(u=o),o?o=!0:o=!1),typeof e!="object"&&(e={x:e,y:n,radius:r,startAngle:i,endAngle:s,anticlockwise:o,color:u,fill:a}),e=_(e,{radius:0,startAngle:0,endAngle:0,anticlockwise:!0}),lt.arc.prototype.base.call(this,e),this._radius=e.radius,this._startAngle=e.startAngle,this._endAngle=e.endAngle,this._anticlockwise=e.anticlockwise,this},this._proto="arc"},lt.arc.prototype=new lt.shape,lt.text=function(){this.font=function(e){return this.attr("font",e)},this._font="10px sans-serif",this.align=function(e){return this.attr("align",e)},this._align="start",this.baseline=function(e){return this.attr("baseline",e)},this._baseline="alphabetic",this.string=function(e){return this.attr("string",e)},this.position=function(){var e={x:this._x,y:this._y},t=nt(this).optns.ctx;return e.height=parseInt(this._font.match(c)[0]),e.y-=e.height,t.save(),t.textBaseline=this._baseline,t.font=this._font,t.textAlign=this._align,e.width=t.measureText(this._string).width,t.restore(),X(this,e)},this.getRect=function(e){var t={x:this._x,y:this._y},n=nt(this).optns.ctx;return t.height=parseInt(this._font.match(c)[0]),t.y-=t.height,n.save(),n.textBaseline=this._baseline,n.font=this._font,n.textAlign=this._align,t.width=n.measureText(this._string).width,this._align=="center"&&(t.x-=t.width/2),this._align=="right"&&(t.x-=t.width),n.restore(),X(this,t,e)},this.setOptns=function(e){lt.text.prototype.setOptns.call(this,e),e.textBaseline=this._baseline,e.font=this._font,e.textAlign=this._align},this.draw=function(e){this._maxWidth===!1?this._fill?e.fillText(this._string,this._x,this._y):e.strokeText(this._string,this._x,this._y):this._fill?e.fillText(this._string,this._x,this._y,this._maxWidth):e.strokeText(this._string,this._x,this._y,this._maxWidth)},this.base=function(e,n,r,i,s,o){return i!==t&&i.charAt&&(s!==t&&(o=s),s=i,i=!1),typeof e!="object"&&(e={string:e,x:n,y:r,maxWidth:i,color:s,fill:o}),e=_(e,{string:"",maxWidth:!1,fill:1}),lt.text.prototype.base.call(this,e),this._string=e.string,this._maxWidth=e.maxWidth,this},this._proto="text"},lt.text.prototype=new lt.shape,lt.grdntsnptrn=function(){this.layer=function(e){return rt(e,this,"grdntsnptrns")},this.canvas=function(e){return st(e,this,"grdntsnptrns")};var e=new lt.object;return this.animate=e.animate,this.attr=e.attr,this.id=e.id,this.name=e.name,this.level=e.level,this.base=function(){this.animateQueue=[],this.optns={animated:!1,name:"",layer:{id:n[0].optns.id+"Layer_0",number:0},canvas:{number:0},visible:!0},this.optns.layer.id=n[o].optns.id+"Layer_0",this.optns.layer.number=0,this.optns.canvas.number=o;var e=n[o].layers[0].grdntsnptrns;this._level=e.length,e[this._level]=this,D(this)},this},lt.gradients=function(){this.colorStopsCount=0,this.paramNames=["_pos","_colorR","_colorG","_colorB","_alpha","_name"],this.addColorStop=function(e,t){D(this);var n=$(t),r=this.colorStopsCount;return this["_pos"+r]=e,this["_colorR"+r]=n.r,this["_colorG"+r]=n.g,this["_colorB"+r]=n.b,this["_alpha"+r]=n.a,this.colorStopsCount++,this},this.animate=function(e,t,n,r,i){for(var s in e)if(s.substr(0,5)=="color"){var o=s.substring(5),u=$(e[s]);e["colorR"+o]=u.r,e["colorG"+o]=u.g,e["colorB"+o]=u.b,e["alpha"+o]=u.a}lt.gradients.prototype.animate.call(this,e,t,n,r,i)},this.delColorStop=function(e){D(this);var t=this.colorStops();return t.splice(e,1),t.length>0?this.colorStops(t):this.colorStopsCount=0,this},this.colorStops=function(e){var n=this.paramNames;if(e===t){e=[];for(var r=0;r<this.colorStopsCount;r++){e[r]=[];for(var i=0;i<n.length;i++)e[r][i]=this[n[i]+r]}return e}D(this);var s=this.colorStopsCount,o=e.length;if(e[0].length==2)for(r=0;r<o;r++)this.addColorStop(e[r][0],e[r][1]);else for(r=0;r<o;r++)for(i=0;i<n.length;i++)this[n[i]+r]=e[r][i];for(r=o;r<s;r++)for(i=0;i<n.length;i++)this[n[i]+r]=t;return this.colorStopsCount=o,this},this.base=function(e){return lt.gradients.prototype.base.call(this),e==t?this:this.colorStops(e)}},lt.gradients.prototype=new lt.grdntsnptrn,lt.pattern=function(){this.create=function(e){this.optns.animated&&P.call(this,e),this.val=e.ctx.createPattern(this._img,this._type)},this.base=function(e,t){return e.onload&&(e={image:e,type:t}),e=_(e,{type:"repeat"}),lt.pattern.prototype.base.call(this),this._img=e.image,this._type=e.type,this},this._proto="pattern"},lt.pattern.prototype=new lt.grdntsnptrn,lt.lGradient=function(){this.create=function(e){this.optns.animated&&P.call(this,e),this.val=e.ctx.createLinearGradient(this._x1,this._y1,this._x2,this._y2);for(var t=0;t<this.colorStopsCount;t++)this.val.addColorStop(this["_pos"+t],"rgba("+parseInt(this["_colorR"+t])+","+parseInt(this["_colorG"+t])+","+parseInt(this["_colorB"+t])+","+this["_alpha"+t]+")")},this.base=function(e,t,n,r,i){return typeof e!="object"&&(e={x1:e,y1:t,x2:n,y2:r,colors:i}),e=_(e,{x1:0,y1:0,x2:0,y2:0}),lt.lGradient.prototype.base.call(this,e.colors),this._x1=e.x1,this._y1=e.y1,this._x2=e.x2,this._y2=e.y2,this},this._proto="lGradient"},lt.lGradient.prototype=new lt.gradients,lt.rGradient=function(){this.create=function(e){this.optns.animated&&P.call(this,e),this.val=e.ctx.createRadialGradient(this._x1,this._y1,this._r1,this._x2,this._y2,this._r2);for(var t=0;t<this.colorStopsCount;t++)this.val.addColorStop(this["_pos"+t],"rgba("+parseInt(this["_colorR"+t])+","+parseInt(this["_colorG"+t])+","+parseInt(this["_colorB"+t])+","+this["_alpha"+t]+")")},this.base=function(e,t,n,r,i,s,o){return typeof e!="object"&&(e={x1:e,y1:t,r1:n,x2:r,y2:i,r2:s,colors:o}),e=_(e,{x1:0,y1:0,r1:0,x2:0,y2:0,r2:0}),lt.rGradient.prototype.base.call(this,e.colors),this._x1=e.x1,this._y1=e.y1,this._r1=e.r1,this._x2=e.x2,this._y2=e.y2,this._r2=e.r2,this},this._proto="rGradient"},lt.rGradient.prototype=new lt.gradients,lt.layer=function(){this.position=function(){var e=this.objs,n,r,i,s=e.length;for(i=0;i<s;i++)r=e[i].position(),n===t&&(n=r),n.x>r.x&&(n.x=r.x),n.y>r.y&&(n.y=r.y);return n},this.getRect=function(e){var n=this.objs,r,i,s,o=n.length;if(n.length==0)return!1;if(e=="coords"){for(s=0;s<o;s++)i=n[s].getRect(e),r===t&&(r=i),r[0][0]>i[0][0]&&(r[0][0]=i[0][0]),r[0][1]>i[0][1]&&(r[0][1]=i[0][1]),r[1][0]<i[1][0]&&(r[1][0]=i[1][0]),r[1][1]>i[1][1]&&(r[1][1]=i[1][1]),r[2][0]>i[2][0]&&(r[2][0]=i[2][0]),r[2][1]<i[2][1]&&(r[2][1]=i[2][1]),r[3][0]<i[3][0]&&(r[3][0]=i[3][0]),r[3][1]<i[3][1]&&(r[3][1]=i[3][1]);return r}for(s=0;s<o;s++)i=n[s].getRect(e),i.right=i.width+i.x,i.bottom=i.height+i.y,r===t&&(r=i),r.x>i.x&&(r.x=i.x),r.y>i.y&&(r.y=i.y),r.right<i.right&&(r.right=i.right),r.bottom<i.bottom&&(r.bottom=i.bottom);return r.width=r.right-r.x,r.height=r.bottom-r.y,r},this.canvas=function(e){if(e===t)return this.idCanvas;if(this.optns.canvas.id==e)return this;var r=-1,i=0,s=n.length;for(var o=0;o<s;o++){var u=n[o].optns.id;u==e&&(r=o),u==this.optns.canvas.id&&(i=o)}r<0&&(r=n.length,O.canvas(e)),this.optns.canvas.id=e,this.optns.canvas.number=r,n[i].layers.splice(this.optns.number,1);var a=n[r].layers;return this._level=this.optns.number=a.length,a[this._level]=this,ut(this.objs,this.optns.id,this._level,e,r),ut(this.grdntsnptrns,this.optns.id,this._level,e,r),n[r].optns.redraw=1,this},this.up=function(e){e===t&&(e=1);if(e=="top")this.level(e);else{var n=nt(this).layers[this.optns.number+e];n!==t&&(e=n._level+1-this._level),this.level(this._level+e)}return this},this.down=function(e){e==t&&(e=1);if(e=="bottom")this.level(e);else{var n=nt(this).layers[this.optns.number-e];n!==t&&(e=this._level-(n._level-1)),this.level(this._level-e)}return this},this.level=function(e){if(e==t)return this._level;var n=nt(this),r=n.optns;return e=="bottom"&&(this.optns.number==0?e=this._level:e=n.layers[0]._level-1),e=="top"&&(this.optns.number==n.layers.length-1?e=this._level:e=n.layers[n.layers.length-1]._level+1),this._level=e,r.anyLayerLevelChanged=!0,r.redraw=1,this},this.del=function(){var e=nt(this).optns;e.anyLayerDeleted=!0,this.draw=!1,e.redraw=1;return},this.setOptns=function(e){return e.setTransform(1,0,0,1,0,0),lt.layer.prototype.setOptns.call(this,e),this},this.afterDraw=function(e){e.ctx.closePath(),e.ctx.restore(),this.optns.clipObject&&lt.layer.prototype.afterDraw.call(this.optns.clipObject,e)},this.clone=function(e,n){var r=O.layer(e);return it(r,this),it(r.optns.transformMatrix,this.optns.transformMatrix),it(r.optns.translateMatrix,this.optns.translateMatrix),it(r.optns.scaleMatrix,this.optns.scaleMatrix),it(r.optns.rotateMatrix,this.optns.rotateMatrix),r.canvas(nt(this).optns.id),n===t?r:r.animate(n)},this.isPointIn=function(e,t,n){var r=this.objs,i;for(i=0;i<r.length;i++)if(r[i].isPointIn(e,t,n))return!0;return!1},this.opacity=function(e){var t=this.objs;for(var n=0;n<t.length;n++)t[n].attr("opacity",e);return this},this.fadeTo=function(e,n,r,i,s){n===t&&(n=600);var o=this.objs;for(var u=0;u<o.length;u++)o[u].animate({opacity:e},n,r,i,s);return this},this.draw=function(e){var t=this.optns,n=t.buffer,r=e.ctx;if(n.val)return r.drawImage(n.cnv,n.x,n.y),this;for(var i=0;i<this.grdntsnptrns.length;i++)this.grdntsnptrns[i].create(e);t.anyObjLevelChanged&&(at(this.objs),t.anyObjLevelChanged=!1),t.anyObjDeleted&&(ft(this.objs),t.anyObjDeleted=!1),r.globalCompositeOperation=t.gCO;for(i=0;i<this.objs.length;i++){var s=this.objs[i];if(typeof s.draw=="function"){this.setOptns(r);if(s.beforeDraw(e)&&typeof s.draw=="function"){var o=s.optns.buffer;o.val?r.drawImage(o.cnv,o.x,o.y):s.draw(r),n.optns?s.afterDraw(n.optns):s.afterDraw(e)}}}return this},this.objects=function(e){var n=ht(),r=0;while(this.objs[r]!==t)n.elements[r]=this.objs[r++];return e!==t?n.find(e):n},this.base=function(e){var t=n[o],r=t.layers,i=t.optns;lt.layer.prototype.base.call(this,0,0,!0);var s=r.length;r[s]=this,this.objs=[],this.grdntsnptrns=[],this._level=s?r[s-1]._level+1:0,this.optns.number=s,this.optns.id=e;var u=this.optns;return u.anyObjDeleted=!1,u.anyObjLevelChanged=!1,u.gCO=i.gCO,u.canvas.id=i.id,u.canvas.number=o,this},this._proto="layer"},lt.layer.prototype=new lt.object,lt.imageData=function(){this.filter=function(e,t){var n=R[e];return n.fn.call(this,this._width,this._height,n.matrix,t),this},this.getRect=function(e){var t={x:this._x,y:this._y,width:this._width,height:this._height};return X(this,t,e)},this.setPixel=function(e,n,r){var i,s=(e+n*this._width)*4;return r.r!==t?i=r:r[0]!==t&&(r.charAt?i=$(r):i={r:r[0],g:r[1],b:r[2],a:r[3]}),this._data[s+0]=i.r,this._data[s+1]=i.g,this._data[s+2]=i.b,this._data[s+3]=i.a*255,D(this),this},this.getPixel=function(e,t){var n=(e+t*this._width)*4;return[this._data[n+0],this._data[n+1],this._data[n+2],this._data[n+3]/255]},this._getX=0,this._getY=0,this.getData=function(e,t,n,r){this._getX=e,this._getY=t,this._width=n,this._height=r;var i=nt(this).optns.ctx;try{this._imgData=i.getImageData(this._getX,this._getY,this._width,this._height)}catch(s){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),this._imgData=i.getImageData(this._getX,this._getY,this._width,this._height)}return this._data=this._imgData.data,D(this),this},this.putData=function(e,n){return e!==t&&(this._x=e),n!==t&&(this._y=n),this._putData=!0,D(this),this},this.clone=function(){var e=lt.imageData.prototype.clone.call(this);return e._imgData=t,e},this.draw=function(e){if(this._imgData===t){this._imgData=e.createImageData(this._width,this._height);for(var n=0;n<this._width*this._height*4;n++)this._imgData.data[n]=this._data[n];this._data=this._imgData.data}this._putData&&e.putImageData(this._imgData,this._x,this._y)},this.base=function(e,n){lt.imageData.prototype.base.call(this);if(n===t){var r=e;r._width!==t?(e=r._width,n=r._height):(e=_(e,{width:0,height:0}),n=e.height,e=e.width)}this._width=e,this._height=n,this._data=[];for(var i=0;i<this._width;i++)for(var s=0;s<this._height;s++){var o=(i+s*this._width)*4;this._data[o+0]=0,this._data[o+1]=0,this._data[o+2]=0,this._data[o+3]=0}return this},this._putData=!1,this._proto="imageData"},lt.imageData.prototype=new lt.object,lt.image=function(){this.getRect=function(e){var t={x:this._x,y:this._y,width:this._width,height:this._height};return X(this,t,e)},this.draw=function(e){e.drawImage(this._img,this._sx,this._sy,this._swidth,this._sheight,this._x,this._y,this._width,this._height)},this.base=function(e,n,r,i,s,o,u,a,f){if(typeof e!="object"||e.src!==t||e.nodeName!==t)e={image:e,x:n,y:r,width:i,height:s,sx:o,sy:u,swidth:a,sheight:f};return e=_(e,{width:!1,height:!1,sx:0,sy:0,swidth:!1,sheight:!1}),e.width===!1&&(e.width=e.image.width,e.height=e.image.height),e.swidth===!1&&(e.swidth=e.image.width,e.sheight=e.image.height),lt.image.prototype.base.call(this,e),this._img=e.image,this._width=e.width,this._height=e.height,this._sx=e.sx,this._sy=e.sy,this._swidth=e.swidth,this._sheight=e.sheight,this},this._proto="image"},lt.image.prototype=new lt.object,lt.groups=function(){for(var e in lt){if(e=="group"||e=="groups")continue;var n=new lt[e];for(var r in n)typeof n[r]=="function"&&this[r]===t&&function(e,n){e[n]=function(){var e=[],r=[],i=0;while(arguments[i]!==t)r[i]=arguments[i++];for(i=0;i<this.elements.length;i++){var s=this.elements[i];it(e,r),typeof s[n]=="function"&&s[n].apply(s,e)}return this}}(this,r)}this.reverse=function(){var e=this.elements;return this.elements=this.unmatchedElements,this.unmatchedElements=e,this},this.end=function(e){return this.previousGroup===t||e===0?this:(e!==t&&e--,this.previousGroup.end(e))},this.find=function(e){var n=ht(),r=e.attrs,i=e.fns||[],s,o,u,a,f,l,c;n.previousGroup=this;for(s=0;s<this.elements.length;s++)n.elements[s]=this.elements[s];if(r!==t)for(o in r)r.hasOwnProperty(o)&&(typeof r[o]!="object"&&(r[o]={val:r[o],rel:"=="}),i[i.length]={fn:"attr",args:[o],val:r[o].val,rel:r[o].rel});if(i.length)for(s=0;s<n.elements.length;s++){u=n.elements[s];for(o=0;o<i.length;o++){f=i[o],c=f.val,a=f.rel,typeof u[f.fn]=="function"?l=u[f.fn].apply(u,f.args):a="del";switch(a){case"!=":l==c&&(a="del");break;case"!==":l===c&&(a="del");break;case"==":l!=c&&(a="del");break;case"===":l!==c&&(a="del");break;case">=":l>=c||(a="del");break;case"<=":l<=c||(a="del");break;case">":l>c||(a="del");break;case"<":l<c||(a="del");break;case"typeof":typeof l!=c&&(a="del")}if(a=="del"){n.unmatchedElements[n.unmatchedElements.length]=u,n.elements.splice(s,1),s--;break}}}return n},this.base=function(){return this.elements=[],this.unmatchedElements=[],this}},lt.group=function(){this._proto="group"},lt.group.prototype=new lt.groups,O.addFunction=function(e,t,n){return lt[n||"object"].prototype[e]=t,O},O.addObject=function(e,n,r,i){lt[e]=function(e){this.draw=lt[e].draw,this.base=lt[e].base,this._proto=e};var s=lt[e];return i===t&&(i="shape"),s.prototype=new lt[i],s.draw=r,s.base=function(e,t,n){s.prototype.base.call(this,t);var r=0;for(var i in t)this["_"+i]=n[r]||t[i],i=="color"&&this.color(n[r]||t[i]),r++;return this},function(e,t){O[e]=function(){var n=new lt[e](e);return n.base(e,t,arguments)}}(e,n),O},O.addAnimateFunction=function(e,t){return q[e]=t,O},O.addImageDataFilter=function(e,n){return R[e]===t&&(R[e]={}),n.fn!==t&&(R[e].fn=n.fn),n.matrix!==t&&n.type===t&&(R[e].matrix=n.matrix),n.type!==t&&(R[e].matrix[type]=n.matrix),O},O.clear=function(e){return n[0]===t?O:e===t?(n[0].clear(),O):(O.canvas(e).clear(),O)},O.pause=function(e){return e===t?(n[0].pause(),O):(O.canvas(e).pause(),O)},O.start=function(e,t,n){return n?O.canvas(e,t).start(n):O.canvas(e).start(t),O},O.pattern=function(e,t){var n=new lt.pattern;return n.base(e,t)},O.lGradient=function(e,t,n,r,i){var s=new lt.lGradient;return s.base(e,t,n,r,i)},O.rGradient=function(e,t,n,r,i,s,o){var u=new lt.rGradient;return u.base(e,t,n,r,i,s,o)},O.line=function(e,t,n){var r=new lt.line;return r.base(e,t,n)},O.qCurve=function(e,t,n){var r=new lt.qCurve;return r.base(e,t,n)},O.bCurve=function(e,t,n){var r=new lt.bCurve;return r.base(e,t,n)},O.imageData=function(e,t){var n=new lt.imageData;return n.base(e,t)},O.image=function(e,t,n,r,i,s,o,u,a){var f=new lt.image;return f.base(e,t,n,r,i,s,o,u,a)},O.circle=function(e,t,n,r,i){var s=new lt.circle;return s.base(e,t,n,r,i)},O.rect=function(e,t,n,r,i,s){var o=new lt.rect;return o.base(e,t,n,r,i,s)},O.arc=function(e,t,n,r,i,s,o,u){var a=new lt.arc;return a.base(e,t,n,r,i,s,o,u)},O.text=function(e,t,n,r,i,s){var o=new lt.text;return o.base(e,t,n,r,i,s)},O.canvas=function(e,r){if(e===t)return n[0];var i=n.length;for(var s=0;s<i;s++)if(n[s].optns&&n[s].optns.id==e)return n[s];var u={id:function(e){return e===t?this.optns.id:(this.optns.id=e,this)}};return n[i]=u,o=i,u.cnv=r||document.getElementById(e),u.width=function(e){return e===t?this.cnv.width:(this.optns.width=this.cnv.width=e,this.cnv.style.width=e+"px",this.optns.redraw=1,this)},u.height=function(e){return e===t?this.cnv.height:(this.optns.heigth=this.cnv.height=e,this.cnv.style.height=e+"px",this.optns.redraw=1,this)},u.optns={id:e,number:o,ctx:u.cnv.getContext("2d"),width:u.cnv.offsetWidth||u.cnv.width,height:u.cnv.offsetHeight||u.cnv.height,anyLayerDeleted:!1,anyLayerLevelChanged:!1,keyDown:{val:!1,code:!1},keyUp:{val:!1,code:!1},keyPress:{val:!1,code:!1},mousemove:{val:!1,x:!1,y:!1,object:!1},click:{val:!1,x:!1,y:!1,objects:[]},dblclick:{val:!1,x:!1,y:!1,objects:[]},mouseup:{val:!1,x:!1,y:!1,objects:[]},mousedown:{val:!1,x:!1,y:!1,objects:[]},drag:{object:!1,x:0,y:0},gCO:"source-over",redraw:1},u.toDataURL=function(){return u.cnv.toDataURL.apply(u.cnv,arguments)},u.layers=[],u.interval=0,O.layer(e+"Layer_0").canvas(e),u.start=function(e){o=this.optns.number;if(!e)return this.frame();if(this.interval)return this;this.isAnimated=e;var t=J(this.cnv);this.optns.x=t.left+(parseInt(this.cnv.style.borderTopWidth)||0),this.optns.y=t.top+(parseInt(this.cnv.style.borderLeftWidth)||0);var r=n[this.optns.number],i=r.optns;return this.cnv.onclick=function(e){j(e,"click",i)},this.cnv.ondblclick=function(e){j(e,"dblclick",i);var t=i.mousemove.val;i.mousemove.val=!0,setTimeout(function(){i.mousemove.val=t},3e3)},this.cnv.onmousedown=function(e){j(e,"mousedown",i)},this.cnv.onmouseup=function(e){j(e,"mouseup",i)},this.cnv.onkeyup=function(e){B(e,"keyUp",i)},this.cnv.onkeydown=function(e){B(e,"keyDown",i)},this.cnv.onkeypress=function(e){B(e,"keyPress",i)},this.cnv.onmouseout=this.cnv.onmousemove=function(e){j(e,"mousemove",i)},i.timeLast=new Date,this.interval=T(function(e){r.interval=r.interval||1,r.frame(e)},this.cnv),this},u.pause=function(){return N(this.interval),this.interval=0,this},u.restart=function(){return this.pause().start(!0)},u.del=function(){N(this.interval),this.layers=[],n.splice(this.optns.number,1);for(var e=0;e<n.length;e++){var t=n[e],r=t.layers,i=r.length;t.optns.number=e;for(var s=0;s<i;s++){var u=r[s];u.optns.canvas.number=e,ut(u.objs,u.optns.id,u.optns.number,t.optns.id,t.optns.number),ut(u.grdntsnptrns,u.optns.id,u.optns.number,t.optns.id,t.optns.number)}}return this.cnv.parentNode&&this.cnv.parentNode.removeChild(this.cnv),o=0,!1},u.clear=function(){return N(this.interval),this.interval=0,this.layers=[],O.layer(this.optns.id+"Layer_0").canvas(this.optns.id),this.optns.ctx.clearRect(0,0,this.optns.width,this.optns.height),this.optns.redraw++,this},u.frame=function(n){var r=this.optns,s=this;n=n||new Date,r.timeDiff=n-r.timeLast,r.timeLast=n,this.interval&&(this.interval=T(function(e){s.frame(e)},s.cnv),this.interval=this.interval||1);if(!r.redraw)return this;r.redraw--,r.ctx.clearRect(0,0,r.width,r.height);if(this.layers.length==0)return this;i=this.layers.length,r.anyLayerLevelChanged&&(i=at(this.layers)),r.anyLayerDeleted&&(i=ft(this.layers));if(r.anyLayerLevelChanged||r.anyLayerDeleted){r.anyLayerLevelChanged=r.anyLayerDeleted=!1;for(var o=0;o<i;o++){var u=this.layers[o],l=u.optns;ut(u.objs,l.id,l.number,this.optns.id,this.optns.number),ut(u.grdntsnptrns,l.id,l.number,e,this.optns.number)}}for(o=0;o<i;o++){var c=this.layers[o];typeof c.draw=="function"&&c.beforeDraw(r)&&typeof c.draw=="function"&&(c.draw(r),c.afterDraw(r))}var h=r.mousemove,p=r.mousedown,d=r.mouseup,v=this.optns.click,m=this.optns.dblclick;if(h.x!=0){if(r.drag.object!=0){var g=r.drag,y=g.object;y.translate(h.x-g.x,h.y-g.y),g.x=h.x,g.y=h.y,g.drag&&g.drag.call(y,{x:h.x,y:h.y})}var b=this.optns.point||{};b.event=h.event;if(h.object!=0){var w=h.object,E=tt(w);a===w?(typeof w.onmousemove=="function"&&w.onmousemove(b),E===f?typeof E.onmousemove=="function"&&E.onmousemove(b):(f&&typeof f.onmouseout=="function"&&f.onmouseout(b),typeof E.onmouseover=="function"&&E.onmouseover(b),f=E)):(a&&typeof a.onmouseout=="function"&&a.onmouseout(b),typeof w.onmouseover=="function"&&w.onmouseover(b),a=w)}else a&&(typeof a.onmouseout=="function"&&a.onmouseout(b),a=!1),f&&(typeof f.onmouseout=="function"&&f.onmouseout(b),f=!1);r.mousemove.object=!1}if(p.objects.length){var S=p.objects.length-1;e:for(o=S;o>-1;o--){var x=[p.objects[o],tt(p.objects[o])],N;for(var C=0;C<2;C++){N=x[C];if(N.optns.drag.val==1&&N.optns.drag.disabled==0&&o==S){g=r.drag,y=g.object=N.optns.drag.object.visible(!0),g.drag=N.optns.drag.drag,g.init=N;var k=g.init.optns;k.drag.params!==t&&y.animate(k.drag.params),g.x=g.startX=p.x,g.y=g.startY=p.y,y!=g.init&&k.drag.type!="clone"&&(b=W(p.x,p.y,y.matrix()),y.translate(b.x-y._x,b.y-y._y)),y.translate(k.drag.shiftX,k.drag.shiftY),typeof k.drag.start=="function"&&k.drag.start.call(y,{x:p.x,y:p.y})}if(typeof N.onmousedown=="function"&&N.onmousedown({x:p.x,y:p.y,event:p.event})===!1)break e}}p.objects=[]}if(d.objects.length){t:for(o=d.objects.length-1;o>-1;o--){var L=[d.objects[o],tt(d.objects[o])],A;for(C=0;C<2;C++){A=L[C],pt(A,d,r)&&(v.objects=[]);if(typeof A.onmouseup=="function"&&A.onmouseup({x:d.x,y:d.y,event:d.event})===!1)break t}}this.optns.drag={object:!1,x:0,y:0},d.objects=[]}if(v.objects.length){n:for(o=v.objects.length-1;o>-1;o--){var O=[v.objects[o],tt(v.objects[o])],M;for(C=0;C<2;C++){M=O[C],pt(M,v,r);if(typeof M.onclick=="function"&&M.onclick({x:v.x,y:v.y,event:v.event})===!1)break n}}this.optns.drag={object:!1,x:0,y:0},v.objects=[]}if(m.objects.length){r:for(o=m.objects.length-1;o>-1;o--){var _=[m.objects[o],tt(m.objects[o])];for(C=0;C<2;C++)if(typeof _[C].ondblclick=="function"&&_[C].ondblclick({x:m.x,y:m.y,event:m.event})===!1)break r}m.objects=[]}return r.keyUp.val=r.keyDown.val=r.keyPress.val=v.x=m.x=d.x=p.x=h.x=!1,this},u},O.layer=function(e){if(e===t)return n[0].layers[0];for(var r=0;r<n.length;r++){var i=n[r].layers;for(var s=0;s<i.length;s++)if(i[s].optns.id==e)return i[s]}return ct(e)},e.jCanvaScript=e.jc=O}(window,undefined),define("jc",[],function(){}),define("render-v2",["connector","_","jc","jquery"],function(e){function r(){return 6e4/(n.bpm||100)}function o(e){if(e)jc.start("canvas",e,!0),i=function(){return $(e).attr("width")},s=function(){return $(e).attr("height")};else{jc.start("canvas",!0);var n=$("#canvas");n.attr("height",s()),n.attr("width",i())}t=jc.rect(0,0,i(),s(),"#131013",!0).id("background"),l&&l()}function u(){var t,i=r()*4,s=e.currentTime(),o=Number(n.start)+Math.ceil((s-n.start)/i)*i;setTimeout(function(){a(Math.round((e.currentTime()-n.start)/i),i)},o-e.currentTime())}function a(e,t){h&&h(e,t),setTimeout(function(){u()},10)}function l(){for(var e in f)f[e]()}function h(e,t){for(var n in c)c[n](e,t)}function v(){return p<0?d[0]:p>=d.length?d[d.length-1]:d[p]}var t,n={bpm:100,start:(new Date).getTime()},i,s;i=function(){return window.innerWidth/2},s=function(){return window.innerHeight/2},$(window).resize(function(){jc.clear(),o()}),$(function(){var e=$("#container");n.bpm=Number(e.data("bpm")),n.start=Number(e.data("start"))}),e.socket.on("loop-stats",function(e){n=e}),u();var f=[],c=[],p=0,d=["#0000FE","#FF5000","#FCFF02","#00FE01","#0367fc","#FD01FF","#75FC04","#FE021C","#131013"];return $(function(){var e=$("#container");p=e.data("color"),scene=e.data("scene")}),{getBackground:function(){return t},onInit:function(e){f.push(e)},onLoop:function(e){c.push(e)},stats:n,init:o,width:function(){return i()},height:function(){return s()},currentColor:v,setColor:function(e){p=e},currentColorId:function(){return p}}}),define("clock",["render-v2","jc"],function(e){function s(t){return t*e.width()}function o(t){return t*e.height()}function u(){return 1/(window.innerWidth/e.width())}function a(e,s){if(!t||!n||!i||!r)return;t.animate({opacity:1},s/8,function(){this.animate({opacity:0},s/8)}),setTimeout(function(){n.animate({opacity:1},s/8,function(){this.animate({opacity:0},s/8)})},s/8),setTimeout(function(){i.animate({opacity:1},s/8,function(){this.animate({opacity:0},s/8)})},2*(s/8)),setTimeout(function(){r.animate({opacity:1},s/8,function(){this.animate({opacity:0},s/8)})},3*(s/8)),setTimeout(function(){t.animate({opacity:1},s/8,function(){this.animate({opacity:0},s/8)})},4*(s/8)),setTimeout(function(){n.animate({opacity:1},s/8,function(){this.animate({opacity:0},s/8)})},5*(s/8)),setTimeout(function(){i.animate({opacity:1},s/8,function(){this.animate({opacity:0},s/8)})},6*(s/8)),setTimeout(function(){r.animate({opacity:1},s/8,function(){this.animate({opacity:0},s/8)})},7*(s/8))}function f(e,t,n,r,i){return jc.rect(e,t,n,r,i||"#FFF",!0).name("clock")}function l(u){u?(t=f(s(0),o(0),e.width()*.3,e.height()*.3,e.currentColor()).animate({opacity:0},1),n=f(s(.7),o(0),e.width()*.3,e.height()*.3,e.currentColor()).animate({opacity:0},1),r=f(s(0),o(.7),e.width()*.3,e.height()*.3,e.currentColor()).animate({opacity:0},1),i=f(s(.7),o(.7),e.width()*.3,e.height()*.3,e.currentColor()).animate({opacity:0},1)):jc(".clock").del()}function c(t){jc(".clock").animate({color:e.currentColor()},t)}var t,n,r,i;return{loop:a,update:l,updateColor:c}}),define("boom",["render-v2","jc"],function(e){function n(t){return t*e.width()}function r(t){return t*e.height()}function i(){return 1/(window.innerWidth/e.width())}function s(e,n){if(!t)return;if(e%2==0)return;t.animate({radius:1e3,opacity:0},n*1.8,{type:"out",fn:"exp"},function(){t.animate({radius:.01,opacity:1},1)})}function o(i){i?t=jc.circle(n(.66),r(.66),.01,e.currentColor(),!0).name("boom"):jc(".boom").del()}function u(t){jc(".boom").animate({color:e.currentColor()},t)}var t;return{loop:s,update:o,updateColor:u}}),define("two-step",["render-v2","jc"],function(e){function r(t){return t*e.width()}function i(t){return t*e.height()}function s(){return 1/(window.innerWidth/e.width())}function o(e,r){if(!t||!n)return;t.animate({radius:600*s(),opacity:0},r/1.2,{type:"out",fn:"exp"},function(){this.animate({radius:.01,opacity:.5})}),setTimeout(function(){n.animate({radius:400*s(),opacity:0},r/1.5,{type:"out",fn:"exp"},function(){this.animate({radius:.01,opacity:.5})})},r*(3/8))}function u(s){s?(t=jc.circle(r(.6),i(.4),.01,e.currentColor(),!0).name("two-step"),n=jc.circle(r(.4),i(.6),.01,e.currentColor(),!0).name("two-step")):jc(".two-step").del()}function a(t){jc(".two-step").animate({color:e.currentColor()},t)}var t,n;return{loop:o,update:u,updateColor:a}}),define("pond",["render-v2","jc"],function(e){function i(t){return t*e.width()}function s(t){return t*e.height()}function o(){return 1/(window.innerWidth/e.width())}function u(e,o){if(!t||!n||!r)return;if(e%2!=0)return;var u=.3+Math.random()*.4,a=.3+Math.random()*.4,f=.5-u,l=.5-a;t.animate({radius:400,opacity:0},o/.55,{type:"out",fn:"exp"},function(){this.animate({radius:.01,opacity:.5,x:i(u),y:s(a)},1)}),setTimeout(function(){n.animate({radius:350,opacity:0},o/.6,{type:"out",fn:"exp"},function(){this.animate({radius:.01,opacity:.7,x:i(u+.25*f),y:s(a+.25*l)},1)})},o/8),setTimeout(function(){r.animate({radius:300,opacity:0},o/.65,{type:"out",fn:"exp"},function(){this.animate({radius:.01,opacity:.9,x:i(u+.5*f),y:s(a+.5*l)},1)})},2*(o/8))}function a(o){if(o){var u=.3+Math.random()*.4,a=.3+Math.random()*.4,f=.5-u,l=.5-a;t=jc.circle(i(u),s(a),.01,e.currentColor(),!0).name("pond").animate({opacity:.5},1),n=jc.circle(i(u+.25*f),s(a+.25*l),.01,e.currentColor(),!0).name("pond").animate({opacity:.7},1),r=jc.circle(i(u+.5*f),s(a+.5*l),.01,e.currentColor(),!0).name("pond").animate({opacity:.9},1)}else jc(".pond").del()}function f(t){jc(".pond").animate({color:e.currentColor()},t)}var t,n,r;return{loop:u,update:a,updateColor:f}}),define("scenario",["connector","render-v2","clock","boom","two-step","pond","jquery","jc"],function(e,t,n,r,i,s){function a(e){return e*t.width()}function f(e){return e*t.height()}function l(){return 1/(window.innerWidth/t.width())}function c(e,t,n,r,i,s){return jc.circle(e,t,(r||10)*l(),n||"#FFF",!0).id(i).name(s)}function h(e){jc(".marker").animate({color:"rgba(231,231,231,0)"},e/4,function(){this.animate({color:"rgba(231,231,231,1)"},e/4,function(){})})}function p(){t.onLoop(function(e,t){v(e,t),h(t),setTimeout(function(){h(t)},t/2)})}function d(){for(var e in u)u[e].update(e==o)}function v(e,t){o>=0&&o<u.length&&u[o].loop(e,t)}function m(e){o>=0&&o<u.length&&u[o].updateColor(e)}function g(){d()}var o=1,u=[n,i,s,r];return e.socket.on("sanity-check",function(e){var n=Number(e.scene)-1;n!==o&&(console.log("got: "+n+" is: "+o),o=n,d(),console.log("asylym sceneed"));var r=Number(e.color)-1;r!==t.currentColorId()&&(t.setColor(r),m(1),console.log("asylym colored"))}),e.socket.on("trigger-scene",function(t){var n=t.at-e.currentTime();if(o===t.scene-1)return;n<10?(o=t.scene-1,o<0&&(o=0),d()):setTimeout(function(){o=t.scene-1,o<0&&(o=0),d()},n-50)}),e.socket.on("trigger-push",function(n){setTimeout(function(){var e=jc.circle(n.point.x*t.width(),n.point.y*t.height(),.01,"#FFF",!0).animate({radius:300*l(),opacity:0},1600,{type:"inOut",fn:"exp"},function(){this.del()})},n.at-e.currentTime())}),e.socket.on("trigger-color",function(n){var r=n.at-e.currentTime(),i=n.fade*1e3;n.color-1!==t.currentColorId()&&t.setColor(n.color-1),r<10?m(1):r<i?r<1?m(1):m(r):setTimeout(function(){i<1?m(1):m(i)},r-i)}),t.onInit(g),{run:p}});var THREE=THREE||{REVISION:"51"};void 0===self.console&&(self.console={info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}}),void 0===self.Int32Array&&(self.Int32Array=Array,self.Float32Array=Array),void 0===String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e}),void 0===String.prototype.endsWith&&(String.prototype.endsWith=function(e){var e=String(e),t=this.lastIndexOf(e);return t>=0&&t===this.length-e.length}),void 0===!String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame===void 0&&(window.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame===void 0&&(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Clock=function(e){this.autoStart=e!==void 0?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},THREE.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now(),this.running=!0},THREE.Clock.prototype.stop=function(){this.getElapsedTime(),this.running=!1},THREE.Clock.prototype.getElapsedTime=function(){return this.elapsedTime=this.elapsedTime+this.getDelta()},THREE.Clock.prototype.getDelta=function(){var e=0;this.autoStart&&!this.running&&this.start();if(this.running){var t=Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime=this.elapsedTime+e}return e},THREE.Color=function(e){return e!==void 0&&this.setHex(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSV:function(e,t,n){var r,i,s;return n===0?this.r=this.g=this.b=0:(r=Math.floor(e*6),i=e*6-r,e=n*(1-t),s=n*(1-t*i),t=n*(1-t*(1-i)),r===0?(this.r=n,this.g=t,this.b=e):r===1?(this.r=s,this.g=n,this.b=e):r===2?(this.r=e,this.g=n,this.b=t):r===3?(this.r=e,this.g=s,this.b=n):r===4?(this.r=t,this.g=e,this.b=n):r===5&&(this.r=n,this.g=e,this.b=s)),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},lerpSelf:function(e,t){return this.r=this.r+(e.r-this.r)*t,this.g=this.g+(e.g-this.g)*t,this.b=this.b+(e.b-this.b)*t,this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getContextStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this.z=this.z+e.z,this},addScalar:function(e){return this.x=this.x+e,this.y=this.y+e,this.z=this.z+e,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this.z=this.z-e.z,this},multiply:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},multiplySelf:function(e){return this.x=this.x*e.x,this.y=this.y*e.y,this.z=this.z*e.z,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this},divideSelf:function(e){return this.x=this.x/e.x,this.y=this.y/e.y,this.z=this.z/e.z,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e):this.z=this.y=this.x=0,this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this.z=this.z+(e.z-this.z)*t,this},cross:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},crossSelf:function(e){var t=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-n*e.x,this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){return(new THREE.Vector3).sub(this,e).lengthSq()},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setEulerFromRotationMatrix:function(e,t){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,i=r[0],s=r[4],o=r[8],u=r[1],a=r[5],f=r[9],l=r[2],c=r[6],r=r[10];return t===void 0||t==="XYZ"?(this.y=Math.asin(n(o)),Math.abs(o)<.99999?(this.x=Math.atan2(-f,r),this.z=Math.atan2(-s,i)):(this.x=Math.atan2(c,a),this.z=0)):t==="YXZ"?(this.x=Math.asin(-n(f)),Math.abs(f)<.99999?(this.y=Math.atan2(o,r),this.z=Math.atan2(u,a)):(this.y=Math.atan2(-l,i),this.z=0)):t==="ZXY"?(this.x=Math.asin(n(c)),Math.abs(c)<.99999?(this.y=Math.atan2(-l,r),this.z=Math.atan2(-s,a)):(this.y=0,this.z=Math.atan2(u,i))):t==="ZYX"?(this.y=Math.asin(-n(l)),Math.abs(l)<.99999?(this.x=Math.atan2(c,r),this.z=Math.atan2(u,i)):(this.x=0,this.z=Math.atan2(-s,a))):t==="YZX"?(this.z=Math.asin(n(u)),Math.abs(u)<.99999?(this.x=Math.atan2(-f,a),this.y=Math.atan2(-l,i)):(this.x=0,this.y=Math.atan2(o,r))):t==="XZY"&&(this.z=Math.asin(-n(s)),Math.abs(s)<.99999?(this.x=Math.atan2(c,a),this.y=Math.atan2(o,i)):(this.x=Math.atan2(-f,r),this.y=0)),this},setEulerFromQuaternion:function(e,t){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.x*e.x,i=e.y*e.y,s=e.z*e.z,o=e.w*e.w;return t===void 0||t==="XYZ"?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),o-r-i+s),this.y=Math.asin(n(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),o+r-i-s)):t==="YXZ"?(this.x=Math.asin(n(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),o-r-i+s),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),o-r+i-s)):t==="ZXY"?(this.x=Math.asin(n(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),o-r-i+s),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),o-r+i-s)):t==="ZYX"?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),o-r-i+s),this.y=Math.asin(n(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),o+r-i-s)):t==="YZX"?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),o-r+i-s),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),o+r-i-s),this.z=Math.asin(n(2*(e.x*e.y+e.z*e.w)))):t==="XZY"&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),o-r+i-s),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),o+r-i-s),this.z=Math.asin(n(2*(e.z*e.w-e.x*e.y)))),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=e,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r!==void 0?r:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this.z=this.z+e.z,this.w=this.w+e.w,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this.z=this.z-e.z,this.w=this.w-e.w,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e,this.w=this.w/e):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this.z=this.z+(e.z-this.z)*t,this.w=this.w+(e.w-this.w)*t,this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,e=e.elements,i=e[0];r=e[4];var s=e[8],o=e[1],u=e[5],a=e[9];n=e[2],t=e[6];var f=e[10];return Math.abs(r-o)<.01&&Math.abs(s-n)<.01&&Math.abs(a-t)<.01?Math.abs(r+o)<.1&&Math.abs(s+n)<.1&&Math.abs(a+t)<.1&&Math.abs(i+u+f-3)<.1?(this.set(1,0,0,0),this):(e=Math.PI,i=(i+1)/2,u=(u+1)/2,f=(f+1)/2,r=(r+o)/4,s=(s+n)/4,a=(a+t)/4,i>u&&i>f?i<.01?(t=0,r=n=.707106781):(t=Math.sqrt(i),n=r/t,r=s/t):u>f?u<.01?(t=.707106781,n=0,r=.707106781):(n=Math.sqrt(u),t=r/n,r=a/n):f<.01?(n=t=.707106781,r=0):(r=Math.sqrt(f),t=s/r,n=a/r),this.set(t,n,r,e),this):(e=Math.sqrt((t-a)*(t-a)+(s-n)*(s-n)+(o-r)*(o-r)),Math.abs(e)<.001&&(e=1),this.x=(t-a)/e,this.y=(s-n)/e,this.z=(o-r)/e,this.w=Math.acos((i+u+f-1)/2),this)}},THREE.Matrix3=function(){this.elements=new Float32Array(9)},THREE.Matrix3.prototype={constructor:THREE.Matrix3,getInverse:function(e){var t=e.elements,e=t[10]*t[5]-t[6]*t[9],n=-t[10]*t[1]+t[2]*t[9],r=t[6]*t[1]-t[2]*t[5],i=-t[10]*t[4]+t[6]*t[8],s=t[10]*t[0]-t[2]*t[8],o=-t[6]*t[0]+t[2]*t[4],u=t[9]*t[4]-t[5]*t[8],a=-t[9]*t[0]+t[1]*t[8],f=t[5]*t[0]-t[1]*t[4],t=t[0]*e+t[1]*i+t[2]*u;t===0&&console.warn("Matrix3.getInverse(): determinant == 0");var t=1/t,l=this.elements;return l[0]=t*e,l[1]=t*n,l[2]=t*r,l[3]=t*i,l[4]=t*s,l[5]=t*o,l[6]=t*u,l[7]=t*a,l[8]=t*f,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},transposeIntoArray:function(e){var t=this.m;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},THREE.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){this.elements=new Float32Array(16),this.set(e!==void 0?e:1,t||0,n||0,r||0,i||0,s!==void 0?s:1,o||0,u||0,a||0,f||0,l!==void 0?l:1,c||0,h||0,p||0,d||0,v!==void 0?v:1)},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=s,m[9]=o,m[13]=u,m[2]=a,m[6]=f,m[10]=l,m[14]=c,m[3]=h,m[7]=p,m[11]=d,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},lookAt:function(e,t,n){var r=this.elements,i=THREE.Matrix4.__v1,s=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return o.sub(e,t).normalize(),o.length()===0&&(o.z=1),i.cross(n,o).normalize(),i.length()===0&&(o.x=o.x+1e-4,i.cross(n,o).normalize()),s.cross(o,i),r[0]=i.x,r[4]=s.x,r[8]=o.x,r[1]=i.y,r[5]=s.y,r[9]=o.y,r[2]=i.z,r[6]=s.z,r[10]=o.z,this},multiply:function(e,t){var n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],u=n[8],a=n[12],f=n[1],l=n[5],c=n[9],h=n[13],p=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],n=n[15],w=r[0],E=r[4],S=r[8],x=r[12],T=r[1],N=r[5],C=r[9],k=r[13],L=r[2],A=r[6],O=r[10],M=r[14],_=r[3],D=r[7],P=r[11],r=r[15];return i[0]=s*w+o*T+u*L+a*_,i[4]=s*E+o*N+u*A+a*D,i[8]=s*S+o*C+u*O+a*P,i[12]=s*x+o*k+u*M+a*r,i[1]=f*w+l*T+c*L+h*_,i[5]=f*E+l*N+c*A+h*D,i[9]=f*S+l*C+c*O+h*P,i[13]=f*x+l*k+c*M+h*r,i[2]=p*w+d*T+v*L+m*_,i[6]=p*E+d*N+v*A+m*D,i[10]=p*S+d*C+v*O+m*P,i[14]=p*x+d*k+v*M+m*r,i[3]=g*w+y*T+b*L+n*_,i[7]=g*E+y*N+b*A+n*D,i[11]=g*S+y*C+b*O+n*P,i[15]=g*x+y*k+b*M+n*r,this},multiplySelf:function(e){return this.multiply(this,e)},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiply(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]=t[0]*e,t[4]=t[4]*e,t[8]=t[8]*e,t[12]=t[12]*e,t[1]=t[1]*e,t[5]=t[5]*e,t[9]=t[9]*e,t[13]=t[13]*e,t[2]=t[2]*e,t[6]=t[6]*e,t[10]=t[10]*e,t[14]=t[14]*e,t[3]=t[3]*e,t[7]=t[7]*e,t[11]=t[11]*e,t[15]=t[15]*e,this},multiplyVector3:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=1/(t[3]*n+t[7]*r+t[11]*i+t[15]);return e.x=(t[0]*n+t[4]*r+t[8]*i+t[12])*s,e.y=(t[1]*n+t[5]*r+t[9]*i+t[13])*s,e.z=(t[2]*n+t[6]*r+t[10]*i+t[14])*s,e},multiplyVector4:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w;return e.x=t[0]*n+t[4]*r+t[8]*i+t[12]*s,e.y=t[1]*n+t[5]*r+t[9]*i+t[13]*s,e.z=t[2]*n+t[6]*r+t[10]*i+t[14]*s,e.w=t[3]*n+t[7]*r+t[11]*i+t[15]*s,e},multiplyVector3Array:function(e){for(var t=THREE.Matrix4.__v1,n=0,r=e.length;n<r;n+=3)t.x=e[n],t.y=e[n+1],t.z=e[n+2],this.multiplyVector3(t),e[n]=t.x,e[n+1]=t.y,e[n+2]=t.z;return e},rotateAxis:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return e.x=n*t[0]+r*t[4]+i*t[8],e.y=n*t[1]+r*t[5]+i*t[9],e.z=n*t[2]+r*t[6]+i*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,n=new THREE.Vector4;return n.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,n.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,n.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,n.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,n},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],o=e[5],u=e[9],a=e[13],f=e[2],l=e[6],c=e[10],h=e[14],p=e[3],d=e[7],v=e[11],e=e[15];return i*u*l*p-r*a*l*p-i*o*c*p+n*a*c*p+r*o*h*p-n*u*h*p-i*u*f*d+r*a*f*d+i*s*c*d-t*a*c*d-r*s*h*d+t*u*h*d+i*o*f*v-n*a*f*v-i*s*l*v+t*a*l*v+n*s*h*v-t*o*h*v-r*o*f*e+n*u*f*e+r*s*l*e-t*u*l*e-n*s*c*e+t*o*c*e},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[12],e[13],e[14])},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getColumnX:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[0],e[1],e[2])},getColumnY:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[4],e[5],e[6])},getColumnZ:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[8],e[9],e[10])},getInverse:function(e){var t=this.elements,n=e.elements,r=n[0],i=n[4],s=n[8],o=n[12],u=n[1],a=n[5],f=n[9],l=n[13],c=n[2],h=n[6],p=n[10],d=n[14],v=n[3],m=n[7],g=n[11],n=n[15];return t[0]=f*d*m-l*p*m+l*h*g-a*d*g-f*h*n+a*p*n,t[4]=o*p*m-s*d*m-o*h*g+i*d*g+s*h*n-i*p*n,t[8]=s*l*m-o*f*m+o*a*g-i*l*g-s*a*n+i*f*n,t[12]=o*f*h-s*l*h-o*a*p+i*l*p+s*a*d-i*f*d,t[1]=l*p*v-f*d*v-l*c*g+u*d*g+f*c*n-u*p*n,t[5]=s*d*v-o*p*v+o*c*g-r*d*g-s*c*n+r*p*n,t[9]=o*f*v-s*l*v-o*u*g+r*l*g+s*u*n-r*f*n,t[13]=s*l*c-o*f*c+o*u*p-r*l*p-s*u*d+r*f*d,t[2]=a*d*v-l*h*v+l*c*m-u*d*m-a*c*n+u*h*n,t[6]=o*h*v-i*d*v-o*c*m+r*d*m+i*c*n-r*h*n,t[10]=i*l*v-o*a*v+o*u*m-r*l*m-i*u*n+r*a*n,t[14]=o*a*c-i*l*c-o*u*h+r*l*h+i*u*d-r*a*d,t[3]=f*h*v-a*p*v-f*c*m+u*p*m+a*c*g-u*h*g,t[7]=i*p*v-s*h*v+s*c*m-r*p*m-i*c*g+r*h*g,t[11]=s*a*v-i*f*v-s*u*m+r*f*m+i*u*g-r*a*g,t[15]=i*f*c-s*a*c+s*u*h-r*f*h-i*u*p+r*a*p,this.multiplyScalar(1/e.determinant()),this},setRotationFromEuler:function(e,t){var n=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),r=Math.sin(r),u=Math.cos(i),i=Math.sin(i),a=Math.cos(s),s=Math.sin(s);if(t===void 0||t==="XYZ"){var f=o*a,l=o*s,c=r*a,h=r*s;n[0]=u*a,n[4]=-u*s,n[8]=i,n[1]=l+c*i,n[5]=f-h*i,n[9]=-r*u,n[2]=h-f*i,n[6]=c+l*i,n[10]=o*u}else t==="YXZ"?(f=u*a,l=u*s,c=i*a,h=i*s,n[0]=f+h*r,n[4]=c*r-l,n[8]=o*i,n[1]=o*s,n[5]=o*a,n[9]=-r,n[2]=l*r-c,n[6]=h+f*r,n[10]=o*u):t==="ZXY"?(f=u*a,l=u*s,c=i*a,h=i*s,n[0]=f-h*r,n[4]=-o*s,n[8]=c+l*r,n[1]=l+c*r,n[5]=o*a,n[9]=h-f*r,n[2]=-o*i,n[6]=r,n[10]=o*u):t==="ZYX"?(f=o*a,l=o*s,c=r*a,h=r*s,n[0]=u*a,n[4]=c*i-l,n[8]=f*i+h,n[1]=u*s,n[5]=h*i+f,n[9]=l*i-c,n[2]=-i,n[6]=r*u,n[10]=o*u):t==="YZX"?(f=o*u,l=o*i,c=r*u,h=r*i,n[0]=u*a,n[4]=h-f*s,n[8]=c*s+l,n[1]=s,n[5]=o*a,n[9]=-r*a,n[2]=-i*a,n[6]=l*s+c,n[10]=f-h*s):t==="XZY"&&(f=o*u,l=o*i,c=r*u,h=r*i,n[0]=u*a,n[4]=-s,n[8]=i*a,n[1]=f*s+h,n[5]=o*a,n[9]=l*s-c,n[2]=c*s-l,n[6]=r*a,n[10]=h*s+f);return this},setRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i,e=n*o,f=n*u,n=n*a,l=r*u,r=r*a,i=i*a,o=s*o,u=s*u,s=s*a;return t[0]=1-(l+i),t[4]=f-s,t[8]=n+u,t[1]=f+s,t[5]=1-(e+i),t[9]=r-o,t[2]=n-u,t[6]=r+o,t[10]=1-(e+l),this},compose:function(e,t,n){var r=this.elements,i=THREE.Matrix4.__m1,s=THREE.Matrix4.__m2;return i.identity(),i.setRotationFromQuaternion(t),s.makeScale(n.x,n.y,n.z),this.multiply(i,s),r[12]=e.x,r[13]=e.y,r[14]=e.z,this},decompose:function(e,t,n){var r=this.elements,i=THREE.Matrix4.__v1,s=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return i.set(r[0],r[1],r[2]),s.set(r[4],r[5],r[6]),o.set(r[8],r[9],r[10]),e=e instanceof THREE.Vector3?e:new THREE.Vector3,t=t instanceof THREE.Quaternion?t:new THREE.Quaternion,n=n instanceof THREE.Vector3?n:new THREE.Vector3,n.x=i.length(),n.y=s.length(),n.z=o.length(),e.x=r[12],e.y=r[13],e.z=r[14],r=THREE.Matrix4.__m1,r.copy(this),r.elements[0]=r.elements[0]/n.x,r.elements[1]=r.elements[1]/n.x,r.elements[2]=r.elements[2]/n.x,r.elements[4]=r.elements[4]/n.y,r.elements[5]=r.elements[5]/n.y,r.elements[6]=r.elements[6]/n.y,r.elements[8]=r.elements[8]/n.z,r.elements[9]=r.elements[9]/n.z,r.elements[10]=r.elements[10]/n.z,t.setFromRotationMatrix(r),[e,t,n]},extractPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(e){var t=this.elements,e=e.elements,n=THREE.Matrix4.__v1,r=1/n.set(e[0],e[1],e[2]).length(),i=1/n.set(e[4],e[5],e[6]).length(),n=1/n.set(e[8],e[9],e[10]).length();return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,this},translate:function(e){var t=this.elements,n=e.x,r=e.y,e=e.z;return t[12]=t[0]*n+t[4]*r+t[8]*e+t[12],t[13]=t[1]*n+t[5]*r+t[9]*e+t[13],t[14]=t[2]*n+t[6]*r+t[10]*e+t[14],t[15]=t[3]*n+t[7]*r+t[11]*e+t[15],this},rotateX:function(e){var t=this.elements,n=t[4],r=t[5],i=t[6],s=t[7],o=t[8],u=t[9],a=t[10],f=t[11],l=Math.cos(e),e=Math.sin(e);return t[4]=l*n+e*o,t[5]=l*r+e*u,t[6]=l*i+e*a,t[7]=l*s+e*f,t[8]=l*o-e*n,t[9]=l*u-e*r,t[10]=l*a-e*i,t[11]=l*f-e*s,this},rotateY:function(e){var t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[8],u=t[9],a=t[10],f=t[11],l=Math.cos(e),e=Math.sin(e);return t[0]=l*n-e*o,t[1]=l*r-e*u,t[2]=l*i-e*a,t[3]=l*s-e*f,t[8]=l*o+e*n,t[9]=l*u+e*r,t[10]=l*a+e*i,t[11]=l*f+e*s,this},rotateZ:function(e){var t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=Math.cos(e),e=Math.sin(e);return t[0]=l*n+e*o,t[1]=l*r+e*u,t[2]=l*i+e*a,t[3]=l*s+e*f,t[4]=l*o-e*n,t[5]=l*u-e*r,t[6]=l*a-e*i,t[7]=l*f-e*s,this},rotateByAxis:function(e,t){var n=this.elements;if(e.x===1&&e.y===0&&e.z===0)return this.rotateX(t);if(e.x===0&&e.y===1&&e.z===0)return this.rotateY(t);if(e.x===0&&e.y===0&&e.z===1)return this.rotateZ(t);var r=e.x,i=e.y,s=e.z,o=Math.sqrt(r*r+i*i+s*s),r=r/o,i=i/o,s=s/o,o=r*r,u=i*i,a=s*s,f=Math.cos(t),l=Math.sin(t),c=1-f,h=r*i*c,p=r*s*c,c=i*s*c,r=r*l,d=i*l,l=s*l,s=o+(1-o)*f,o=h+l,i=p-d,h=h-l,u=u+(1-u)*f,l=c+r,p=p+d,c=c-r,a=a+(1-a)*f,f=n[0],r=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8],E=n[9],S=n[10],x=n[11];return n[0]=s*f+o*m+i*w,n[1]=s*r+o*g+i*E,n[2]=s*d+o*y+i*S,n[3]=s*v+o*b+i*x,n[4]=h*f+u*m+l*w,n[5]=h*r+u*g+l*E,n[6]=h*d+u*y+l*S,n[7]=h*v+u*b+l*x,n[8]=p*f+c*m+a*w,n[9]=p*r+c*g+a*E,n[10]=p*d+c*y+a*S,n[11]=p*v+c*b+a*x,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,e=e.z;return t[0]=t[0]*n,t[4]=t[4]*r,t[8]=t[8]*e,t[1]=t[1]*n,t[5]=t[5]*r,t[9]=t[9]*e,t[2]=t[2]*n,t[6]=t[6]*r,t[10]=t[10]*e,t[3]=t[3]*n,t[7]=t[7]*r,t[11]=t[11]*e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,u=e.z,a=i*s,f=i*o;return this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeFrustum:function(e,t,n,r,i,s){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(r-n),o[9]=(r+n)/(r-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(s+i)/(s-i),o[14]=-2*s*i/(s-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,n,r){var e=n*Math.tan(e*Math.PI/360),i=-e;return this.makeFrustum(i*t,e*t,i,e,n,r)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements,u=t-e,a=n-r,f=s-i;return o[0]=2/u,o[4]=0,o[8]=0,o[12]=-((t+e)/u),o[1]=0,o[5]=2/a,o[9]=0,o[13]=-((n+r)/a),o[2]=0,o[6]=0,o[10]=-2/f,o[14]=-((s+i)/f),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},THREE.Matrix4.__v1=new THREE.Vector3,THREE.Matrix4.__v2=new THREE.Vector3,THREE.Matrix4.__v3=new THREE.Vector3,THREE.Matrix4.__m1=new THREE.Matrix4,THREE.Matrix4.__m2=new THREE.Matrix4,THREE.EventTarget=function(){var e={};this.addEventListener=function(t,n){e[t]===void 0&&(e[t]=[]),e[t].indexOf(n)===-1&&e[t].push(n)},this.dispatchEvent=function(t){for(var n in e[t.type])e[t.type][n](t)},this.removeEventListener=function(t,n){var r=e[t].indexOf(n);r!==-1&&e[t].splice(r,1)}},THREE.Frustum=function(){this.planes=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4]},THREE.Frustum.prototype.setFromMatrix=function(e){var t=this.planes,n=e.elements,e=n[0],r=n[1],i=n[2],s=n[3],o=n[4],u=n[5],a=n[6],f=n[7],l=n[8],c=n[9],h=n[10],p=n[11],d=n[12],v=n[13],m=n[14],n=n[15];t[0].set(s-e,f-o,p-l,n-d),t[1].set(s+e,f+o,p+l,n+d),t[2].set(s+r,f+u,p+c,n+v),t[3].set(s-r,f-u,p-c,n-v),t[4].set(s-i,f-a,p-h,n-m),t[5].set(s+i,f+a,p+h,n+m);for(r=0;r<6;r++)e=t[r],e.divideScalar(Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z))},THREE.Frustum.prototype.contains=function(e){for(var t=0,n=this.planes,t=e.matrixWorld,r=t.elements,e=-e.geometry.boundingSphere.radius*t.getMaxScaleOnAxis(),i=0;i<6;i++){t=n[i].x*r[12]+n[i].y*r[13]+n[i].z*r[14]+n[i].w;if(t<=e)return!1}return!0},THREE.Frustum.__v1=new THREE.Vector3,function(e){e.Ray=function(t,n,r,i){this.origin=t||new e.Vector3,this.direction=n||new e.Vector3,this.near=r||0,this.far=i||Infinity};var t=new e.Vector3,n=new e.Vector3,r=new e.Vector3,i=new e.Vector3,s=new e.Vector3,o=new e.Vector3,u=new e.Matrix4,a=function(e,t){return e.distance-t.distance},f=new e.Vector3,l=new e.Vector3,c=new e.Vector3,h=function(e,t,n){f.sub(n,e);var r=f.dot(t),e=l.add(e,c.copy(t).multiplyScalar(r));return n.distanceTo(e)},p=function(e,t,n,r){f.sub(r,t),l.sub(n,t),c.sub(e,t);var e=f.dot(f),t=f.dot(l),n=f.dot(c),i=l.dot(l),r=l.dot(c),s=1/(e*i-t*t),i=(i*n-t*r)*s,e=(e*r-t*n)*s;return i>=0&&e>=0&&i+e<1},d=function(a,f,l){var c,d;if(a instanceof e.Particle){c=h(f.origin,f.direction,a.matrixWorld.getPosition());if(c>a.scale.x)return l;d={distance:c,point:a.position,face:null,object:a},l.push(d)}else if(a instanceof e.Mesh){var v=a.geometry.boundingSphere.radius*a.matrixWorld.getMaxScaleOnAxis();c=h(f.origin,f.direction,a.matrixWorld.getPosition());if(c>v)return l;var y,w,E=a.geometry,S=E.vertices,x,T,N;x=a.geometry.materials,T=a.material instanceof e.MeshFaceMaterial;var C,k=f.precision;a.matrixRotationWorld.extractRotation(a.matrixWorld),t.copy(f.origin),u.getInverse(a.matrixWorld),n.copy(t),u.multiplyVector3(n),r.copy(f.direction),u.rotateAxis(r).normalize(),v=0;for(y=E.faces.length;v<y;v++){d=E.faces[v],c=T===!0?x[d.materialIndex]:a.material;if(c!==void 0){N=c.side,i.sub(d.centroid,n),s=d.normal,c=r.dot(s);if(!(Math.abs(c)<k)){w=s.dot(i)/c;if(!(w<0)&&(N===e.DoubleSide||(N===e.FrontSide?c<0:c>0))){o.add(n,r.multiplyScalar(w));if(d instanceof e.Face3)c=S[d.a],w=S[d.b],N=S[d.c],p(o,c,w,N)&&(w=a.matrixWorld.multiplyVector3(o.clone()),c=t.distanceTo(w),c<f.near||c>f.far||(d={distance:c,point:w,face:d,faceIndex:v,object:a},l.push(d)));else if(d instanceof e.Face4){c=S[d.a],w=S[d.b],N=S[d.c],C=S[d.d];if(p(o,c,w,C)||p(o,w,N,C))w=a.matrixWorld.multiplyVector3(o.clone()),c=t.distanceTo(w),c<f.near||c>f.far||(d={distance:c,point:w,face:d,faceIndex:v,object:a},l.push(d))}}}}}}},v=function(e,t,n){for(var e=e.getDescendants(),r=0,i=e.length;r<i;r++)d(e[r],t,n)};e.Ray.prototype.precision=1e-4,e.Ray.prototype.set=function(e,t){this.origin=e,this.direction=t},e.Ray.prototype.intersectObject=function(e,t){var n=[];return t===!0&&v(e,this,n),d(e,this,n),n.sort(a),n},e.Ray.prototype.intersectObjects=function(e,t){for(var n=[],r=0,i=e.length;r<i;r++)d(e[r],this,n),t===!0&&v(e[r],this,n);return n.sort(a),n}}(THREE),THREE.Rectangle=function(){function e(){s=r-t,o=i-n}var t=0,n=0,r=0,i=0,s=0,o=0,u=!0;this.getX=function(){return t},this.getY=function(){return n},this.getWidth=function(){return s},this.getHeight=function(){return o},this.getLeft=function(){return t},this.getTop=function(){return n},this.getRight=function(){return r},this.getBottom=function(){return i},this.set=function(s,o,l,p){u=!1,t=s,n=o,r=l,i=p,e()},this.addPoint=function(s,o){u===!0?(u=!1,t=s,n=o,r=s,i=o):(t=t<s?t:s,n=n<o?n:o,r=r>s?r:s,i=i>o?i:o),e()},this.add3Points=function(s,o,l,p,v,m){u===!0?(u=!1,t=s<l?s<v?s:v:l<v?l:v,n=o<p?o<m?o:m:p<m?p:m,r=s>l?s>v?s:v:l>v?l:v,i=o>p?o>m?o:m:p>m?p:m):(t=s<l?s<v?s<t?s:t:v<t?v:t:l<v?l<t?l:t:v<t?v:t,n=o<p?o<m?o<n?o:n:m<n?m:n:p<m?p<n?p:n:m<n?m:n,r=s>l?s>v?s>r?s:r:v>r?v:r:l>v?l>r?l:r:v>r?v:r,i=o>p?o>m?o>i?o:i:m>i?m:i:p>m?p>i?p:i:m>i?m:i),e()},this.addRectangle=function(s){u===!0?(u=!1,t=s.getLeft(),n=s.getTop(),r=s.getRight(),i=s.getBottom()):(t=t<s.getLeft()?t:s.getLeft(),n=n<s.getTop()?n:s.getTop(),r=r>s.getRight()?r:s.getRight(),i=i>s.getBottom()?i:s.getBottom()),e()},this.inflate=function(s){t-=s,n-=s,r+=s,i+=s,e()},this.minSelf=function(s){t=t>s.getLeft()?t:s.getLeft(),n=n>s.getTop()?n:s.getTop(),r=r<s.getRight()?r:s.getRight(),i=i<s.getBottom()?i:s.getBottom(),e()},this.intersects=function(e){return r<e.getLeft()||t>e.getRight()||i<e.getTop()||n>e.getBottom()?!1:!0},this.empty=function(){u=!0,i=r=n=t=0,e()},this.isEmpty=function(){return u}},THREE.Math={clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0}},THREE.Object3D=function(){this.id=THREE.Object3DCount++,this.name="",this.properties={},this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder="XYZ",this.scale=new THREE.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new THREE.Vector3},THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(e){this.matrix.multiply(e,this.matrix),this.scale.getScaleFromMatrix(this.matrix),e=(new THREE.Matrix4).extractRotation(this.matrix),this.rotation.setEulerFromRotationMatrix(e,this.eulerOrder),this.position.getPositionFromMatrix(this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.position.addSelf(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},localToWorld:function(e){return this.matrixWorld.multiplyVector3(e)},worldToLocal:function(e){return THREE.Object3D.__m1.getInverse(this.matrixWorld).multiplyVector3(e)},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)},add:function(e){if(e===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(e instanceof THREE.Object3D){e.parent!==void 0&&e.parent.remove(e),e.parent=this,this.children.push(e);for(var t=this;t.parent!==void 0;)t=t.parent;t!==void 0&&t instanceof THREE.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(t!==-1){e.parent=void 0,this.children.splice(t,1);for(t=this;t.parent!==void 0;)t=t.parent;t!==void 0&&t instanceof THREE.Scene&&t.__removeObject(e)}},getChildByName:function(e,t){var n,r,i;n=0;for(r=this.children.length;n<r;n++){i=this.children[n];if(i.name===e)return i;if(t){i=i.getChildByName(e,t);if(i!==void 0)return i}}},getDescendants:function(e){e===void 0&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,n=this.children.length;t<n;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z));this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix();if(this.matrixWorldNeedsUpdate===!0||e===!0)this.parent===void 0?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},clone:function(){}},THREE.Object3D.__m1=new THREE.Matrix4,THREE.Object3DCount=0,THREE.Projector=function(){function e(){if(s===u){var e=new THREE.RenderableObject;return o.push(e),u++,s++,e}return o[s++]}function t(){if(f===c){var e=new THREE.RenderableVertex;return l.push(e),c++,f++,e}return l[f++]}function n(e,t){return t.z-e.z}function r(e,t){var n=0,r=1,i=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,u=-t.z+t.w;return i>=0&&s>=0&&o>=0&&u>=0?!0:i<0&&s<0||o<0&&u<0?!1:(i<0?n=Math.max(n,i/(i-s)):s<0&&(r=Math.min(r,i/(i-s))),o<0?n=Math.max(n,o/(o-u)):u<0&&(r=Math.min(r,o/(o-u))),r<n?!1:(e.lerpSelf(t,n),t.lerpSelf(e,1-r),!0))}var i,s,o=[],u=0,a,f,l=[],c=0,h,p,d=[],v=0,m,g=[],y=0,b,w,E=[],S=0,x,T,N=[],C=0,k={objects:[],sprites:[],lights:[],elements:[]},L=new THREE.Vector3,A=new THREE.Vector4,O=new THREE.Matrix4,M=new THREE.Matrix4,_=new THREE.Frustum,D=new THREE.Vector4,P=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),O.multiply(t.projectionMatrix,t.matrixWorldInverse),O.multiplyVector3(e),e},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),O.multiply(t.matrixWorld,t.projectionMatrixInverse),O.multiplyVector3(e),e},this.pickingRay=function(e,t){var n;return e.z=-1,n=new THREE.Vector3(e.x,e.y,1),this.unprojectVector(e,t),this.unprojectVector(n,t),n.subSelf(e).normalize(),new THREE.Ray(e,n)},this.projectScene=function(o,u,c,R){var U=u.near,W=u.far,X=!1,V,$,Q,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt;T=w=m=p=0,k.elements.length=0,o.updateMatrixWorld(),u.parent===void 0&&u.updateMatrixWorld(),u.matrixWorldInverse.getInverse(u.matrixWorld),O.multiply(u.projectionMatrix,u.matrixWorldInverse),_.setFromMatrix(O),s=0,k.objects.length=0,k.sprites.length=0,k.lights.length=0;var ct=function(t){for(var n=0,r=t.children.length;n<r;n++){var s=t.children[n];if(s.visible!==!1){if(s instanceof THREE.Light)k.lights.push(s);else if(s instanceof THREE.Mesh||s instanceof THREE.Line){if(s.frustumCulled===!1||_.contains(s)===!0)i=e(),i.object=s,s.renderDepth!==null?i.z=s.renderDepth:(L.copy(s.matrixWorld.getPosition()),O.multiplyVector3(L),i.z=L.z),k.objects.push(i)}else s instanceof THREE.Sprite||s instanceof THREE.Particle?(i=e(),i.object=s,s.renderDepth!==null?i.z=s.renderDepth:(L.copy(s.matrixWorld.getPosition()),O.multiplyVector3(L),i.z=L.z),k.sprites.push(i)):(i=e(),i.object=s,s.renderDepth!==null?i.z=s.renderDepth:(L.copy(s.matrixWorld.getPosition()),O.multiplyVector3(L),i.z=L.z),k.objects.push(i));ct(s)}}};ct(o),c===!0&&k.objects.sort(n),o=0;for(c=k.objects.length;o<c;o++){nt=k.objects[o].object,rt=nt.matrixWorld,f=0;if(nt instanceof THREE.Mesh){it=nt.geometry,st=nt.geometry.materials,Q=it.vertices,ot=it.faces,at=it.faceVertexUvs,it=nt.matrixRotationWorld.extractRotation(rt),lt=nt.material instanceof THREE.MeshFaceMaterial,V=0;for($=Q.length;V<$;V++)a=t(),a.positionWorld.copy(Q[V]),rt.multiplyVector3(a.positionWorld),a.positionScreen.copy(a.positionWorld),O.multiplyVector4(a.positionScreen),a.positionScreen.x=a.positionScreen.x/a.positionScreen.w,a.positionScreen.y=a.positionScreen.y/a.positionScreen.w,a.visible=a.positionScreen.z>U&&a.positionScreen.z<W;Q=0;for(V=ot.length;Q<V;Q++){tt=ot[Q],$=lt===!0?st[tt.materialIndex]:nt.material;if($!==void 0){et=$.side;if(tt instanceof THREE.Face3){Y=l[tt.a],Z=l[tt.b],ut=l[tt.c];if(Y.visible!==!0||Z.visible!==!0||ut.visible!==!0)continue;X=(ut.positionScreen.x-Y.positionScreen.x)*(Z.positionScreen.y-Y.positionScreen.y)-(ut.positionScreen.y-Y.positionScreen.y)*(Z.positionScreen.x-Y.positionScreen.x)<0;if(et!==THREE.DoubleSide&&X!==(et===THREE.FrontSide))continue;p===v?(ft=new THREE.RenderableFace3,d.push(ft),v++,p++,h=ft):h=d[p++],h.v1.copy(Y),h.v2.copy(Z),h.v3.copy(ut)}else if(tt instanceof THREE.Face4){Y=l[tt.a],Z=l[tt.b],ut=l[tt.c],ft=l[tt.d];if(Y.visible!==!0||Z.visible!==!0||ut.visible!==!0||ft.visible!==!0)continue;X=(ft.positionScreen.x-Y.positionScreen.x)*(Z.positionScreen.y-Y.positionScreen.y)-(ft.positionScreen.y-Y.positionScreen.y)*(Z.positionScreen.x-Y.positionScreen.x)<0||(Z.positionScreen.x-ut.positionScreen.x)*(ft.positionScreen.y-ut.positionScreen.y)-(Z.positionScreen.y-ut.positionScreen.y)*(ft.positionScreen.x-ut.positionScreen.x)<0;if(et!==THREE.DoubleSide&&X!==(et===THREE.FrontSide))continue;if(m===y){var ht=new THREE.RenderableFace4;g.push(ht),y++,m++,h=ht}else h=g[m++];h.v1.copy(Y),h.v2.copy(Z),h.v3.copy(ut),h.v4.copy(ft)}h.normalWorld.copy(tt.normal),X===!1&&(et===THREE.BackSide||et===THREE.DoubleSide)&&h.normalWorld.negate(),it.multiplyVector3(h.normalWorld),h.centroidWorld.copy(tt.centroid),rt.multiplyVector3(h.centroidWorld),h.centroidScreen.copy(h.centroidWorld),O.multiplyVector3(h.centroidScreen),tt=tt.vertexNormals,Y=0;for(Z=tt.length;Y<Z;Y++)ut=h.vertexNormalsWorld[Y],ut.copy(tt[Y]),X===!1&&(et===THREE.BackSide||et===THREE.DoubleSide)&&ut.negate(),it.multiplyVector3(ut);h.vertexNormalsLength=tt.length,Y=0;for(Z=at.length;Y<Z;Y++){ut=at[Y][Q];if(ut!==void 0){et=0;for(tt=ut.length;et<tt;et++)h.uvs[Y][et]=ut[et]}}h.material=$,h.z=h.centroidScreen.z,k.elements.push(h)}}}else if(nt instanceof THREE.Line){M.multiply(O,rt),Q=nt.geometry.vertices,Y=t(),Y.positionScreen.copy(Q[0]),M.multiplyVector4(Y.positionScreen),rt=nt.type===THREE.LinePieces?2:1,V=1;for($=Q.length;V<$;V++)Y=t(),Y.positionScreen.copy(Q[V]),M.multiplyVector4(Y.positionScreen),(V+1)%rt>0||(Z=l[f-2],D.copy(Y.positionScreen),P.copy(Z.positionScreen),r(D,P)===!0&&(D.multiplyScalar(1/D.w),P.multiplyScalar(1/P.w),w===S?(st=new THREE.RenderableLine,E.push(st),S++,w++,b=st):b=E[w++],b.v1.positionScreen.copy(D),b.v2.positionScreen.copy(P),b.z=Math.max(D.z,P.z),b.material=nt.material,k.elements.push(b)))}}o=0;for(c=k.sprites.length;o<c;o++)nt=k.sprites[o].object,rt=nt.matrixWorld,nt instanceof THREE.Particle&&(A.set(rt.elements[12],rt.elements[13],rt.elements[14],1),O.multiplyVector4(A),A.z=A.z/A.w,A.z>0&&A.z<1&&(T===C?(U=new THREE.RenderableParticle,N.push(U),C++,T++,x=U):x=N[T++],x.object=nt,x.x=A.x/A.w,x.y=A.y/A.w,x.z=A.z,x.rotation=nt.rotation.z,x.scale.x=nt.scale.x*Math.abs(x.x-(A.x+u.projectionMatrix.elements[0])/(A.w+u.projectionMatrix.elements[12])),x.scale.y=nt.scale.y*Math.abs(x.y-(A.y+u.projectionMatrix.elements[5])/(A.w+u.projectionMatrix.elements[13])),x.material=nt.material,k.elements.push(x)));return R===!0&&k.elements.sort(n),k}},THREE.Quaternion=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r!==void 0?r:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var n=Math.cos(e.x/2),r=Math.cos(e.y/2),i=Math.cos(e.z/2),s=Math.sin(e.x/2),o=Math.sin(e.y/2),u=Math.sin(e.z/2);return t===void 0||t==="XYZ"?(this.x=s*r*i+n*o*u,this.y=n*o*i-s*r*u,this.z=n*r*u+s*o*i,this.w=n*r*i-s*o*u):t==="YXZ"?(this.x=s*r*i+n*o*u,this.y=n*o*i-s*r*u,this.z=n*r*u-s*o*i,this.w=n*r*i+s*o*u):t==="ZXY"?(this.x=s*r*i-n*o*u,this.y=n*o*i+s*r*u,this.z=n*r*u+s*o*i,this.w=n*r*i-s*o*u):t==="ZYX"?(this.x=s*r*i-n*o*u,this.y=n*o*i+s*r*u,this.z=n*r*u-s*o*i,this.w=n*r*i+s*o*u):t==="YZX"?(this.x=s*r*i+n*o*u,this.y=n*o*i+s*r*u,this.z=n*r*u-s*o*i,this.w=n*r*i-s*o*u):t==="XZY"&&(this.x=s*r*i-n*o*u,this.y=n*o*i-s*r*u,this.z=n*r*u+s*o*i,this.w=n*r*i+s*o*u),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0],e=t[4],r=t[8],i=t[1],s=t[5],o=t[9],u=t[2],a=t[6],t=t[10],f=n+s+t;return f>0?(n=.5/Math.sqrt(f+1),this.w=.25/n,this.x=(a-o)*n,this.y=(r-u)*n,this.z=(i-e)*n):n>s&&n>t?(n=2*Math.sqrt(1+n-s-t),this.w=(a-o)/n,this.x=.25*n,this.y=(e+i)/n,this.z=(r+u)/n):s>t?(n=2*Math.sqrt(1+s-n-t),this.w=(r-u)/n,this.x=(e+i)/n,this.y=.25*n,this.z=(o+a)/n):(n=2*Math.sqrt(1+t-n-s),this.w=(i-e)/n,this.x=(r+u)/n,this.y=(o+a)/n,this.z=.25*n),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x=this.x*-1,this.y=this.y*-1,this.z=this.z*-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?this.w=this.z=this.y=this.x=0:(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e,t){var n=e.x,r=e.y,i=e.z,s=e.w,o=t.x,u=t.y,a=t.z,f=t.w;return this.x=n*f+r*a-i*u+s*o,this.y=-n*a+r*f+i*o+s*u,this.z=n*u-r*o+i*f+s*a,this.w=-n*o-r*u-i*a+s*f,this},multiplySelf:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,s=e.x,o=e.y,u=e.z,e=e.w;return this.x=t*e+i*s+n*u-r*o,this.y=n*e+i*o+r*s-t*u,this.z=r*e+i*u+t*o-n*s,this.w=i*e-t*s-n*o-r*u,this},multiplyVector3:function(e,t){t||(t=e);var n=e.x,r=e.y,i=e.z,s=this.x,o=this.y,u=this.z,a=this.w,f=a*n+o*i-u*r,l=a*r+u*n-s*i,c=a*i+s*r-o*n,n=-s*n-o*r-u*i;return t.x=f*a+n*-s+l*-u-c*-o,t.y=l*a+n*-o+c*-s-f*-u,t.z=c*a+n*-u+f*-o-l*-s,t},slerpSelf:function(e,t){var n=this.x,r=this.y,i=this.z,s=this.w,o=s*e.w+n*e.x+r*e.y+i*e.z;o<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e);if(o>=1)return this.w=s,this.x=n,this.y=r,this.z=i,this;var u=Math.acos(o),a=Math.sqrt(1-o*o);return Math.abs(a)<.001?(this.w=.5*(s+this.w),this.x=.5*(n+this.x),this.y=.5*(r+this.y),this.z=.5*(i+this.z),this):(o=Math.sin((1-t)*u)/a,u=Math.sin(t*u)/a,this.w=s*o+this.w*u,this.x=n*o+this.x*u,this.y=r*o+this.y*u,this.z=i*o+this.z*u,this)},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}},THREE.Quaternion.slerp=function(e,t,n,r){var i=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;i<0?(n.w=-t.w,n.x=-t.x,n.y=-t.y,n.z=-t.z,i=-i):n.copy(t);if(Math.abs(i)>=1)return n.w=e.w,n.x=e.x,n.y=e.y,n.z=e.z,n;var t=Math.acos(i),s=Math.sqrt(1-i*i);return Math.abs(s)<.001?(n.w=.5*(e.w+n.w),n.x=.5*(e.x+n.x),n.y=.5*(e.y+n.y),n.z=.5*(e.z+n.z),n):(i=Math.sin((1-r)*t)/s,r=Math.sin(r*t)/s,n.w=e.w*i+n.w*r,n.x=e.x*i+n.x*r,n.y=e.y*i+n.y*r,n.z=e.z*i+n.z*r,n)},THREE.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},THREE.Face3=function(e,t,n,r,i,s){this.a=e,this.b=t,this.c=n,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=i instanceof THREE.Color?i:new THREE.Color,this.vertexColors=i instanceof Array?i:[],this.vertexTangents=[],this.materialIndex=s,this.centroid=new THREE.Vector3},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,n;t=0;for(n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();t=0;for(n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();t=0;for(n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,n,r,i,s,o){this.a=e,this.b=t,this.c=n,this.d=r,this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=s instanceof THREE.Color?s:new THREE.Color,this.vertexColors=s instanceof Array?s:[],this.vertexTangents=[],this.materialIndex=o,this.centroid=new THREE.Vector3},THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var e=new THREE.Face4(this.a,this.b,this.c,this.d);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,n;t=0;for(n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();t=0;for(n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();t=0;for(n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.UV=function(e,t){this.u=e||0,this.v=t||0},THREE.UV.prototype={constructor:THREE.UV,set:function(e,t){return this.u=e,this.v=t,this},copy:function(e){return this.u=e.u,this.v=e.v,this},lerpSelf:function(e,t){return this.u=this.u+(e.u-this.u)*t,this.v=this.v+(e.v-this.v)*t,this},clone:function(){return new THREE.UV(this.u,this.v)}},THREE.Geometry=function(){this.id=THREE.GeometryCount++,this.name="",this.vertices=[],this.colors=[],this.materials=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){var t=new THREE.Matrix4;t.extractRotation(e);for(var n=0,r=this.vertices.length;n<r;n++)e.multiplyVector3(this.vertices[n]);n=0;for(r=this.faces.length;n<r;n++){var i=this.faces[n];t.multiplyVector3(i.normal);for(var s=0,o=i.vertexNormals.length;s<o;s++)t.multiplyVector3(i.vertexNormals[s]);e.multiplyVector3(i.centroid)}},computeCentroids:function(){var e,t,n;e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n.centroid.set(0,0,0),n instanceof THREE.Face3?(n.centroid.addSelf(this.vertices[n.a]),n.centroid.addSelf(this.vertices[n.b]),n.centroid.addSelf(this.vertices[n.c]),n.centroid.divideScalar(3)):n instanceof THREE.Face4&&(n.centroid.addSelf(this.vertices[n.a]),n.centroid.addSelf(this.vertices[n.b]),n.centroid.addSelf(this.vertices[n.c]),n.centroid.addSelf(this.vertices[n.d]),n.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,n,r,i,s,o=new THREE.Vector3,u=new THREE.Vector3;e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],r=this.vertices[n.a],i=this.vertices[n.b],s=this.vertices[n.c],o.sub(s,i),u.sub(r,i),o.crossSelf(u),o.isZero()||o.normalize(),n.normal.copy(o)},computeVertexNormals:function(){var e,t,n,r;if(this.__tmpVertices===void 0){r=this.__tmpVertices=Array(this.vertices.length),e=0;for(t=this.vertices.length;e<t;e++)r[e]=new THREE.Vector3;e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n instanceof THREE.Face3?n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:n instanceof THREE.Face4&&(n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else{r=this.__tmpVertices,e=0;for(t=this.vertices.length;e<t;e++)r[e].set(0,0,0)}e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n instanceof THREE.Face3?(r[n.a].addSelf(n.normal),r[n.b].addSelf(n.normal),r[n.c].addSelf(n.normal)):n instanceof THREE.Face4&&(r[n.a].addSelf(n.normal),r[n.b].addSelf(n.normal),r[n.c].addSelf(n.normal),r[n.d].addSelf(n.normal));e=0;for(t=this.vertices.length;e<t;e++)r[e].normalize();e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n instanceof THREE.Face3?(n.vertexNormals[0].copy(r[n.a]),n.vertexNormals[1].copy(r[n.b]),n.vertexNormals[2].copy(r[n.c])):n instanceof THREE.Face4&&(n.vertexNormals[0].copy(r[n.a]),n.vertexNormals[1].copy(r[n.b]),n.vertexNormals[2].copy(r[n.c]),n.vertexNormals[3].copy(r[n.d]))},computeMorphNormals:function(){var e,t,n,r,i;n=0;for(r=this.faces.length;n<r;n++){i=this.faces[n],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0;for(t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone()}var s=new THREE.Geometry;s.faces=this.faces,e=0;for(t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,u=this.morphNormals[e].vertexNormals,a,f;n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],a=new THREE.Vector3,f=i instanceof THREE.Face3?{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3},o.push(a),u.push(f)}o=this.morphNormals[e],s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals(),n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],a=o.faceNormals[n],f=o.vertexNormals[n],a.copy(i.normal),i instanceof THREE.Face3?(f.a.copy(i.vertexNormals[0]),f.b.copy(i.vertexNormals[1]),f.c.copy(i.vertexNormals[2])):(f.a.copy(i.vertexNormals[0]),f.b.copy(i.vertexNormals[1]),f.c.copy(i.vertexNormals[2]),f.d.copy(i.vertexNormals[3]))}n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){function e(e,t,n,r,i,s,T){u=e.vertices[t],a=e.vertices[n],f=e.vertices[r],l=o[i],c=o[s],h=o[T],p=a.x-u.x,d=f.x-u.x,v=a.y-u.y,m=f.y-u.y,g=a.z-u.z,y=f.z-u.z,b=c.u-l.u,w=h.u-l.u,E=c.v-l.v,S=h.v-l.v,x=1/(b*S-w*E),k.set((S*p-E*d)*x,(S*v-E*m)*x,(S*g-E*y)*x),L.set((b*d-w*p)*x,(b*m-w*v)*x,(b*y-w*g)*x),N[t].addSelf(k),N[n].addSelf(k),N[r].addSelf(k),C[t].addSelf(L),C[n].addSelf(L),C[r].addSelf(L)}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=[],C=[],k=new THREE.Vector3,L=new THREE.Vector3,A=new THREE.Vector3,O=new THREE.Vector3,M=new THREE.Vector3;t=0;for(n=this.vertices.length;t<n;t++)N[t]=new THREE.Vector3,C[t]=new THREE.Vector3;t=0;for(n=this.faces.length;t<n;t++)s=this.faces[t],o=this.faceVertexUvs[0][t],s instanceof THREE.Face3?e(this,s.a,s.b,s.c,0,1,2):s instanceof THREE.Face4&&(e(this,s.a,s.b,s.d,0,1,3),e(this,s.b,s.c,s.d,1,2,3));var _=["a","b","c","d"];t=0;for(n=this.faces.length;t<n;t++){s=this.faces[t];for(r=0;r<s.vertexNormals.length;r++)M.copy(s.vertexNormals[r]),i=s[_[r]],T=N[i],A.copy(T),A.subSelf(M.multiplyScalar(M.dot(T))).normalize(),O.cross(s.vertexNormals[r],T),i=O.dot(C[i]),i=i<0?-1:1,s.vertexTangents[r]=new THREE.Vector4(A.x,A.y,A.z,i)}this.hasTangents=!0},computeBoundingBox:function(){this.boundingBox||(this.boundingBox={min:new THREE.Vector3,max:new THREE.Vector3});if(this.vertices.length>0){var e;e=this.vertices[0],this.boundingBox.min.copy(e),this.boundingBox.max.copy(e);for(var t=this.boundingBox.min,n=this.boundingBox.max,r=1,i=this.vertices.length;r<i;r++)e=this.vertices[r],e.x<t.x?t.x=e.x:e.x>n.x&&(n.x=e.x),e.y<t.y?t.y=e.y:e.y>n.y&&(n.y=e.y),e.z<t.z?t.z=e.z:e.z>n.z&&(n.z=e.z)}else this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){var e=0;this.boundingSphere===null&&(this.boundingSphere={radius:0});for(var t=0,n=this.vertices.length;t<n;t++){var r=this.vertices[t].lengthSq();r>e&&(e=r)}this.boundingSphere.radius=Math.sqrt(e)},mergeVertices:function(){var e={},t=[],n=[],r,i=Math.pow(10,4),s,o,u,a;s=0;for(o=this.vertices.length;s<o;s++)r=this.vertices[s],r=[Math.round(r.x*i),Math.round(r.y*i),Math.round(r.z*i)].join("_"),e[r]===void 0?(e[r]=s,t.push(this.vertices[s]),n[s]=t.length-1):n[s]=n[e[r]];s=0;for(o=this.faces.length;s<o;s++){e=this.faces[s];if(e instanceof THREE.Face3)e.a=n[e.a],e.b=n[e.b],e.c=n[e.c];else if(e instanceof THREE.Face4){e.a=n[e.a],e.b=n[e.b],e.c=n[e.c],e.d=n[e.d],r=[e.a,e.b,e.c,e.d];for(i=3;i>0;i--)if(r.indexOf(e["abcd"[i]])!==i){r.splice(i,1),this.faces[s]=new THREE.Face3(r[0],r[1],r[2],e.normal,e.color,e.materialIndex),r=0;for(u=this.faceVertexUvs.length;r<u;r++)(a=this.faceVertexUvs[r][s])&&a.splice(i,1);this.faces[s].vertexColors=e.vertexColors;break}}}return n=this.vertices.length-t.length,this.vertices=t,n},clone:function(){}},THREE.GeometryCount=0,THREE.BufferGeometry=function(){this.id=THREE.GeometryCount++,this.attributes={},this.dynamic=!1,this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.morphTargets=[]},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,applyMatrix:function(e){var t,n;this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(n=this.attributes.normal.array),t!==void 0&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),n!==void 0&&(t=new THREE.Matrix4,t.extractRotation(e),t.multiplyVector3Array(n),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){this.boundingBox||(this.boundingBox={min:new THREE.Vector3(Infinity,Infinity,Infinity),max:new THREE.Vector3(-Infinity,-Infinity,-Infinity)});var e=this.attributes.position.array;if(e)for(var t=this.boundingBox,n,r,i,s=0,o=e.length;s<o;s+=3)n=e[s],r=e[s+1],i=e[s+2],n<t.min.x?t.min.x=n:n>t.max.x&&(t.max.x=n),r<t.min.y?t.min.y=r:r>t.max.y&&(t.max.y=r),i<t.min.z?t.min.z=i:i>t.max.z&&(t.max.z=i);if(e===void 0||e.length===0)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){this.boundingSphere||(this.boundingSphere={radius:0});var e=this.attributes.position.array;if(e){for(var t,n=0,r,i,s=0,o=e.length;s<o;s+=3)t=e[s],r=e[s+1],i=e[s+2],t=t*t+r*r+i*i,t>n&&(n=t);this.boundingSphere.radius=Math.sqrt(n)}},computeVertexNormals:function(){if(this.attributes.position&&this.attributes.index){var e,t,n,r;e=this.attributes.position.array.length;if(this.attributes.normal===void 0)this.attributes.normal={itemSize:3,array:new Float32Array(e),numItems:e};else{e=0;for(t=this.attributes.normal.array.length;e<t;e++)this.attributes.normal.array[e]=0}var i=this.offsets,s=this.attributes.index.array,o=this.attributes.position.array,u=this.attributes.normal.array,a,f,l,c,h,p,d=new THREE.Vector3,v=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Vector3;n=0;for(r=i.length;n<r;++n){t=i[n].start,a=i[n].count;var b=i[n].index;e=t;for(t+=a;e<t;e+=3)a=b+s[e],f=b+s[e+1],l=b+s[e+2],c=o[a*3],h=o[a*3+1],p=o[a*3+2],d.set(c,h,p),c=o[f*3],h=o[f*3+1],p=o[f*3+2],v.set(c,h,p),c=o[l*3],h=o[l*3+1],p=o[l*3+2],m.set(c,h,p),g.sub(m,v),y.sub(d,v),g.crossSelf(y),u[a*3]=u[a*3]+g.x,u[a*3+1]=u[a*3+1]+g.y,u[a*3+2]=u[a*3+2]+g.z,u[f*3]=u[f*3]+g.x,u[f*3+1]=u[f*3+1]+g.y,u[f*3+2]=u[f*3+2]+g.z,u[l*3]=u[l*3]+g.x,u[l*3+1]=u[l*3+1]+g.y,u[l*3+2]=u[l*3+2]+g.z}e=0;for(t=u.length;e<t;e+=3)c=u[e],h=u[e+1],p=u[e+2],n=1/Math.sqrt(c*c+h*h+p*p),u[e]=u[e]*n,u[e+1]=u[e+1]*n,u[e+2]=u[e+2]*n;this.normalsNeedUpdate=!0}},computeTangents:function(){function e(e){B.x=r[e*3],B.y=r[e*3+1],B.z=r[e*3+2],j.copy(B),I=a[e],P.copy(I),P.subSelf(B.multiplyScalar(B.dot(I))).normalize(),H.cross(j,I),q=H.dot(f[e]),F=q<0?-1:1,u[e*4]=P.x,u[e*4+1]=P.y,u[e*4+2]=P.z,u[e*4+3]=F}if(this.attributes.index===void 0||this.attributes.position===void 0||this.attributes.normal===void 0||this.attributes.uv===void 0)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var t=this.attributes.index.array,n=this.attributes.position.array,r=this.attributes.normal.array,i=this.attributes.uv.array,s=n.length/3;if(this.attributes.tangent===void 0){var o=4*s;this.attributes.tangent={itemSize:4,array:new Float32Array(o),numItems:o}}for(var u=this.attributes.tangent.array,a=[],f=[],o=0;o<s;o++)a[o]=new THREE.Vector3,f[o]=new THREE.Vector3;var l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,s=new THREE.Vector3,o=new THREE.Vector3,N,C,k,L,A,O,M,_=this.offsets;k=0;for(L=_.length;k<L;++k){C=_[k].start,A=_[k].count;var D=_[k].index;N=C;for(C+=A;N<C;N+=3)A=D+t[N],O=D+t[N+1],M=D+t[N+2],l=n[A*3],c=n[A*3+1],h=n[A*3+2],p=n[O*3],d=n[O*3+1],v=n[O*3+2],m=n[M*3],g=n[M*3+1],y=n[M*3+2],b=i[A*2],w=i[A*2+1],E=i[O*2],S=i[O*2+1],x=i[M*2],T=i[M*2+1],p-=l,l=m-l,d-=c,c=g-c,v-=h,h=y-h,E-=b,b=x-b,S-=w,w=T-w,T=1/(E*w-b*S),s.set((w*p-S*l)*T,(w*d-S*c)*T,(w*v-S*h)*T),o.set((E*l-b*p)*T,(E*c-b*d)*T,(E*h-b*v)*T),a[A].addSelf(s),a[O].addSelf(s),a[M].addSelf(s),f[A].addSelf(o),f[O].addSelf(o),f[M].addSelf(o)}var P=new THREE.Vector3,H=new THREE.Vector3,B=new THREE.Vector3,j=new THREE.Vector3,F,I,q;k=0;for(L=_.length;k<L;++k){C=_[k].start,A=_[k].count,D=_[k].index,N=C;for(C+=A;N<C;N+=3)A=D+t[N],O=D+t[N+1],M=D+t[N+2],e(A),e(O),e(M)}this.tangentsNeedUpdate=this.hasTangents=!0}}},THREE.Spline=function(e){function t(e,t,n,r,i,s,o){return e=(n-e)*.5,r=(r-t)*.5,(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t}this.points=e;var n=[],r={x:0,y:0,z:0},i,s,o,u,a,f,l,c,h;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,s=Math.floor(i),o=i-s,n[0]=s===0?s:s-1,n[1]=s,n[2]=s>this.points.length-2?this.points.length-1:s+1,n[3]=s>this.points.length-3?this.points.length-1:s+2,f=this.points[n[0]],l=this.points[n[1]],c=this.points[n[2]],h=this.points[n[3]],u=o*o,a=o*u,r.x=t(f.x,l.x,c.x,h.x,o,u,a),r.y=t(f.y,l.y,c.y,h.y,o,u,a),r.z=t(f.z,l.z,c.z,h.z,o,u,a),r},this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,n,r,i=t=t=0,s=new THREE.Vector3,o=new THREE.Vector3,u=[],a=0;u[0]=0,e||(e=100),n=this.points.length*e,s.copy(this.points[0]);for(e=1;e<n;e++)t=e/n,r=this.getPoint(t),o.copy(r),a+=o.distanceTo(s),s.copy(r),t=(this.points.length-1)*t,t=Math.floor(t),t!=i&&(u[t]=a,i=t);return u[u.length]=a,{chunks:u,total:a}},this.reparametrizeByArcLength=function(e){var t,n,r,i,s,o,u=[],a=new THREE.Vector3,f=this.getLength();u.push(a.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){n=f.chunks[t]-f.chunks[t-1],o=Math.ceil(e*n/f.total),i=(t-1)/(this.points.length-1),s=t/(this.points.length-1);for(n=1;n<o-1;n++)r=i+n*(1/o)*(s-i),r=this.getPoint(r),u.push(a.copy(r).clone());u.push(a.copy(this.points[t]).clone())}this.points=u}},THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate===!0&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)},THREE.OrthographicCamera=function(e,t,n,r,i,s){THREE.Camera.call(this),this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i!==void 0?i:.1,this.far=s!==void 0?s:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(e,t,n,r){THREE.Camera.call(this),this.fov=e!==void 0?e:50,this.aspect=t!==void 0?t:1,this.near=n!==void 0?n:.1,this.far=r!==void 0?r:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(e,t){t===void 0&&(t=24),this.fov=2*Math.atan(t/(e*2))*(180/Math.PI),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=s,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(this.fov*Math.PI/360)*this.near,n=-t,r=e*n,e=Math.abs(e*t-r),n=Math.abs(t-n);this.projectionMatrix.makeFrustum(r+this.x*e/this.fullWidth,r+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*n/this.fullHeight,t-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(e,t,n){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=t!==void 0?t:1,this.distance=n!==void 0?n:0,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight=function(e,t,n){THREE.Light.call(this,e),this.groundColor=new THREE.Color(t),this.position=new THREE.Vector3(0,100,0),this.intensity=n!==void 0?n:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight=function(e,t,n){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,0,0),this.intensity=t!==void 0?t:1,this.distance=n!==void 0?n:0},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight=function(e,t,n,r,i){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=t!==void 0?t:1,this.distance=n!==void 0?n:0,this.angle=r!==void 0?r:Math.PI/2,this.exponent=i!==void 0?i:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.Loader=function(e){this.statusDomElement=(this.showStatus=e)?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),e.pop(),(e.length<1?".":e.join("/"))+"/"},initMaterials:function(e,t,n){e.materials=[];for(var r=0;r<t.length;++r)e.materials[r]=THREE.Loader.prototype.createMaterial(t[r],n)},hasNormals:function(e){var t,n,r=e.materials.length;for(n=0;n<r;n++){t=e.materials[n];if(t instanceof THREE.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){function n(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function r(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function i(e,i,s,u,a,f,l){var h=s.toLowerCase().endsWith(".dds"),p=t+"/"+s;if(h){var v=THREE.ImageUtils.loadCompressedTexture(p);e[i]=v}else v=document.createElement("canvas"),e[i]=new THREE.Texture(v);e[i].sourceFile=s,u&&(e[i].repeat.set(u[0],u[1]),u[0]!==1&&(e[i].wrapS=THREE.RepeatWrapping),u[1]!==1&&(e[i].wrapT=THREE.RepeatWrapping)),a&&e[i].offset.set(a[0],a[1]),f&&(s={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},s[f[0]]!==void 0&&(e[i].wrapS=s[f[0]]),s[f[1]]!==void 0&&(e[i].wrapT=s[f[1]])),l&&(e[i].anisotropy=l);if(!h){var m=e[i],e=new Image;e.onload=function(){if(!n(this.width)||!n(this.height)){var e=r(this.width),t=r(this.height);m.image.width=e,m.image.height=t,m.image.getContext("2d").drawImage(this,0,0,e,t)}else m.image=this;m.needsUpdate=!0},e.crossOrigin=o.crossOrigin,e.src=p}}function s(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}var o=this,u="MeshLambertMaterial",a={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var f=e.shading.toLowerCase();f==="phong"?u="MeshPhongMaterial":f==="basic"&&(u="MeshBasicMaterial")}e.blending!==void 0&&THREE[e.blending]!==void 0&&(a.blending=THREE[e.blending]);if(e.transparent!==void 0||e.opacity<1)a.transparent=e.transparent;return e.depthTest!==void 0&&(a.depthTest=e.depthTest),e.depthWrite!==void 0&&(a.depthWrite=e.depthWrite),e.visible!==void 0&&(a.visible=e.visible),e.flipSided!==void 0&&(a.side=THREE.BackSide),e.doubleSided!==void 0&&(a.side=THREE.DoubleSide),e.wireframe!==void 0&&(a.wireframe=e.wireframe),e.vertexColors!==void 0&&(e.vertexColors==="face"?a.vertexColors=THREE.FaceColors:e.vertexColors&&(a.vertexColors=THREE.VertexColors)),e.colorDiffuse?a.color=s(e.colorDiffuse):e.DbgColor&&(a.color=e.DbgColor),e.colorSpecular&&(a.specular=s(e.colorSpecular)),e.colorAmbient&&(a.ambient=s(e.colorAmbient)),e.transparency&&(a.opacity=e.transparency),e.specularCoef&&(a.shininess=e.specularCoef),e.mapDiffuse&&t&&i(a,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&i(a,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&i(a,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&i(a,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&i(a,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(a.bumpScale=e.mapBumpScale),e.mapNormal?(u=THREE.ShaderUtils.lib.normal,f=THREE.UniformsUtils.clone(u.uniforms),f.tNormal.value=a.normalMap,e.mapNormalFactor&&f.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),a.map&&(f.tDiffuse.value=a.map,f.enableDiffuse.value=!0),a.specularMap&&(f.tSpecular.value=a.specularMap,f.enableSpecular.value=!0),a.lightMap&&(f.tAO.value=a.lightMap,f.enableAO.value=!0),f.uDiffuseColor.value.setHex(a.color),f.uSpecularColor.value.setHex(a.specular),f.uAmbientColor.value.setHex(a.ambient),f.uShininess.value=a.shininess,a.opacity!==void 0&&(f.uOpacity.value=a.opacity),a=new THREE.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:f,lights:!0,fog:!0})):a=new THREE[u](a),e.DbgName!==void 0&&(a.name=e.DbgName),a}},THREE.BinaryLoader=function(e){THREE.Loader.call(this,e)},THREE.BinaryLoader.prototype=Object.create(THREE.Loader.prototype),THREE.BinaryLoader.prototype.load=function(e,t,n,r){var n=n?n:this.extractUrlBase(e),r=r?r:this.extractUrlBase(e),i=this.showProgress?THREE.Loader.prototype.updateProgress:null;this.onLoadStart(),this.loadAjaxJSON(this,e,t,n,r,i)},THREE.BinaryLoader.prototype.loadAjaxJSON=function(e,t,n,r,i,s){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState==4)if(o.status==200||o.status==0){var u=JSON.parse(o.responseText);e.loadAjaxBuffers(u,n,i,r,s)}else console.error("THREE.BinaryLoader: Couldn't load ["+t+"] ["+o.status+"]")},o.open("GET",t,!0),o.send(null)},THREE.BinaryLoader.prototype.loadAjaxBuffers=function(e,t,n,r,i){var s=new XMLHttpRequest,o=n+"/"+e.buffers,u=0;s.onreadystatechange=function(){if(s.readyState==4)if(s.status==200||s.status==0){var n=s.response;n===void 0&&(n=(new Uint8Array(s.responseBody)).buffer),THREE.BinaryLoader.prototype.createBinModel(n,t,r,e.materials)}else console.error("THREE.BinaryLoader: Couldn't load ["+o+"] ["+s.status+"]");else s.readyState==3?i&&(u==0&&(u=s.getResponseHeader("Content-Length")),i({total:u,loaded:s.responseText.length})):s.readyState==2&&(u=s.getResponseHeader("Content-Length"))},s.open("GET",o,!0),s.responseType="arraybuffer",s.send(null)},THREE.BinaryLoader.prototype.createBinModel=function(e,t,n,r){var i=function(t){function w(e){return e%4?4-e%4:0}function E(e,t){return(new Uint8Array(e,t,1))[0]}function S(e,t){return(new Uint32Array(e,t,1))[0]}function x(t,n){var r,i,s,o,u,f,l,c,h=new Uint32Array(e,n,3*t);for(r=0;r<t;r++){i=h[r*3],s=h[r*3+1],o=h[r*3+2],u=_[i*2],i=_[i*2+1],f=_[s*2],l=_[s*2+1],s=_[o*2],c=_[o*2+1],o=A.faceVertexUvs[0];var p=[];p.push(new THREE.UV(u,i)),p.push(new THREE.UV(f,l)),p.push(new THREE.UV(s,c)),o.push(p)}}function T(t,n){var r,i,s,o,u,f,l,c,h,p,d=new Uint32Array(e,n,4*t);for(r=0;r<t;r++){i=d[r*4],s=d[r*4+1],o=d[r*4+2],u=d[r*4+3],f=_[i*2],i=_[i*2+1],l=_[s*2],h=_[s*2+1],c=_[o*2],p=_[o*2+1],o=_[u*2],s=_[u*2+1],u=A.faceVertexUvs[0];var v=[];v.push(new THREE.UV(f,i)),v.push(new THREE.UV(l,h)),v.push(new THREE.UV(c,p)),v.push(new THREE.UV(o,s)),u.push(v)}}function N(t,n,r){for(var i,s,o,u,n=new Uint32Array(e,n,3*t),f=new Uint16Array(e,r,t),r=0;r<t;r++)i=n[r*3],s=n[r*3+1],o=n[r*3+2],u=f[r],A.faces.push(new THREE.Face3(i,s,o,null,null,u))}function C(t,n,r){for(var i,s,o,u,f,n=new Uint32Array(e,n,4*t),l=new Uint16Array(e,r,t),r=0;r<t;r++)i=n[r*4],s=n[r*4+1],o=n[r*4+2],u=n[r*4+3],f=l[r],A.faces.push(new THREE.Face4(i,s,o,u,null,null,f))}function k(t,n,r,i){for(var s,o,u,f,l,c,h,n=new Uint32Array(e,n,3*t),r=new Uint32Array(e,r,3*t),p=new Uint16Array(e,i,t),i=0;i<t;i++){s=n[i*3],o=n[i*3+1],u=n[i*3+2],l=r[i*3],c=r[i*3+1],h=r[i*3+2],f=p[i];var d=M[c*3],v=M[c*3+1];c=M[c*3+2];var m=M[h*3],g=M[h*3+1];h=M[h*3+2],A.faces.push(new THREE.Face3(s,o,u,[new THREE.Vector3(M[l*3],M[l*3+1],M[l*3+2]),new THREE.Vector3(d,v,c),new THREE.Vector3(m,g,h)],null,f))}}function L(t,n,r,i){for(var s,o,u,f,l,c,h,p,d,n=new Uint32Array(e,n,4*t),r=new Uint32Array(e,r,4*t),v=new Uint16Array(e,i,t),i=0;i<t;i++){s=n[i*4],o=n[i*4+1],u=n[i*4+2],f=n[i*4+3],c=r[i*4],h=r[i*4+1],p=r[i*4+2],d=r[i*4+3],l=v[i];var m=M[h*3],g=M[h*3+1];h=M[h*3+2];var y=M[p*3],b=M[p*3+1];p=M[p*3+2];var w=M[d*3],E=M[d*3+1];d=M[d*3+2],A.faces.push(new THREE.Face4(s,o,u,f,[new THREE.Vector3(M[c*3],M[c*3+1],M[c*3+2]),new THREE.Vector3(m,g,h),new THREE.Vector3(y,b,p),new THREE.Vector3(w,E,d)],null,l))}}var n,i,s,o,u,f,l,c,h,p,v,m,g,y,b,A=this,O=0,M=[],_=[],D,P,H;THREE.Geometry.call(this),THREE.Loader.prototype.initMaterials(A,r,t),b=e,P=O,t=new Uint8Array(b,P,12),p="";for(g=0;g<12;g++)p+=String.fromCharCode(t[P+g]);n=E(b,P+12),E(b,P+13),E(b,P+14),E(b,P+15),i=E(b,P+16),s=E(b,P+17),o=E(b,P+18),u=E(b,P+19),f=S(b,P+20),l=S(b,P+20+4),c=S(b,P+20+8),h=S(b,P+20+12),p=S(b,P+20+16),v=S(b,P+20+20),m=S(b,P+20+24),g=S(b,P+20+28),t=S(b,P+20+32),y=S(b,P+20+36),b=S(b,P+20+40),O+=n,P=i*3+u,H=i*4+u,D=h*P,n=p*(P+s*3),i=v*(P+o*3),u=m*(P+s*3+o*3),P=g*H,s=t*(H+s*4),o=y*(H+o*4),H=O;var O=new Float32Array(e,O,f*3),B,j,F,I;for(B=0;B<f;B++)j=O[B*3],F=O[B*3+1],I=O[B*3+2],A.vertices.push(new THREE.Vector3(j,F,I));f=O=H+f*3*Float32Array.BYTES_PER_ELEMENT;if(l){O=new Int8Array(e,O,l*3);for(H=0;H<l;H++)B=O[H*3],j=O[H*3+1],F=O[H*3+2],M.push(B/127,j/127,F/127)}O=f+l*3*Int8Array.BYTES_PER_ELEMENT,l=O+=w(l*3);if(c){O=new Float32Array(e,O,c*2);for(f=0;f<c;f++)H=O[f*2],B=O[f*2+1],_.push(H,B)}c=O=l+c*2*Float32Array.BYTES_PER_ELEMENT,D=c+D+w(h*2),l=D+n+w(p*2),n=l+i+w(v*2),i=n+u+w(m*2),P=i+P+w(g*2),u=P+s+w(t*2),s=u+o+w(y*2),v&&(o=l+v*Uint32Array.BYTES_PER_ELEMENT*3,N(v,l,o+v*Uint32Array.BYTES_PER_ELEMENT*3),x(v,o)),m&&(v=n+m*Uint32Array.BYTES_PER_ELEMENT*3,o=v+m*Uint32Array.BYTES_PER_ELEMENT*3,k(m,n,v,o+m*Uint32Array.BYTES_PER_ELEMENT*3),x(m,o)),y&&(m=u+y*Uint32Array.BYTES_PER_ELEMENT*4,C(y,u,m+y*Uint32Array.BYTES_PER_ELEMENT*4),T(y,m)),b&&(y=s+b*Uint32Array.BYTES_PER_ELEMENT*4,m=y+b*Uint32Array.BYTES_PER_ELEMENT*4,L(b,s,y,m+b*Uint32Array.BYTES_PER_ELEMENT*4),T(b,m)),h&&N(h,c,c+h*Uint32Array.BYTES_PER_ELEMENT*3),p&&(h=D+p*Uint32Array.BYTES_PER_ELEMENT*3,k(p,D,h,h+p*Uint32Array.BYTES_PER_ELEMENT*3)),g&&C(g,i,i+g*Uint32Array.BYTES_PER_ELEMENT*4),t&&(p=P+t*Uint32Array.BYTES_PER_ELEMENT*4,L(t,P,p,p+t*Uint32Array.BYTES_PER_ELEMENT*4)),this.computeCentroids(),this.computeFaceNormals(),THREE.Loader.prototype.hasNormals(this)&&this.computeTangents()};i.prototype=Object.create(THREE.Geometry.prototype),t(new i(n))},THREE.ImageLoader=function(){THREE.EventTarget.call(this),this.crossOrigin=null},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t){var n=this;t===void 0&&(t=new Image),t.addEventListener("load",function(){n.dispatchEvent({type:"load",content:t})},!1),t.addEventListener("error",function(){n.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),n.crossOrigin&&(t.crossOrigin=n.crossOrigin),t.src=e}},THREE.JSONLoader=function(e){THREE.Loader.call(this,e)},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.load=function(e,t,n){n=n?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var s=new XMLHttpRequest,o=0;s.onreadystatechange=function(){if(s.readyState===s.DONE)if(s.status===200||s.status===0){if(s.responseText){var u=JSON.parse(s.responseText);e.createModel(u,n,r)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+s.status+"]");else s.readyState===s.LOADING?i&&(o===0&&(o=s.getResponseHeader("Content-Length")),i({total:o,loaded:s.responseText.length})):s.readyState===s.HEADERS_RECEIVED&&(o=s.getResponseHeader("Content-Length"))},s.open("GET",t,!0),s.send(null)},THREE.JSONLoader.prototype.createModel=function(e,t,n){var r=new THREE.Geometry,i=e.scale!==void 0?1/e.scale:1;this.initMaterials(r,e.materials,n);var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=e.faces;p=e.vertices;var w=e.normals,E=e.colors,S=0;for(s=0;s<e.uvs.length;s++)e.uvs[s].length&&S++;for(s=0;s<S;s++)r.faceUvs[s]=[],r.faceVertexUvs[s]=[];n=0;for(a=p.length;n<a;)f=new THREE.Vector3,f.x=p[n++]*i,f.y=p[n++]*i,f.z=p[n++]*i,r.vertices.push(f);n=0;for(a=b.length;n<a;){p=b[n++],f=p&1,u=p&2,s=p&4,o=p&8,c=p&16,l=p&32,d=p&64,p&=128,f?(v=new THREE.Face4,v.a=b[n++],v.b=b[n++],v.c=b[n++],v.d=b[n++],f=4):(v=new THREE.Face3,v.a=b[n++],v.b=b[n++],v.c=b[n++],f=3),u&&(u=b[n++],v.materialIndex=u),u=r.faces.length;if(s)for(s=0;s<S;s++)m=e.uvs[s],h=b[n++],y=m[h*2],h=m[h*2+1],r.faceUvs[s][u]=new THREE.UV(y,h);if(o)for(s=0;s<S;s++){m=e.uvs[s],g=[];for(o=0;o<f;o++)h=b[n++],y=m[h*2],h=m[h*2+1],g[o]=new THREE.UV(y,h);r.faceVertexUvs[s][u]=g}c&&(c=b[n++]*3,o=new THREE.Vector3,o.x=w[c++],o.y=w[c++],o.z=w[c],v.normal=o);if(l)for(s=0;s<f;s++)c=b[n++]*3,o=new THREE.Vector3,o.x=w[c++],o.y=w[c++],o.z=w[c],v.vertexNormals.push(o);d&&(l=b[n++],l=new THREE.Color(E[l]),v.color=l);if(p)for(s=0;s<f;s++)l=b[n++],l=new THREE.Color(E[l]),v.vertexColors.push(l);r.faces.push(v)}if(e.skinWeights){n=0;for(a=e.skinWeights.length;n<a;n+=2)b=e.skinWeights[n],w=e.skinWeights[n+1],r.skinWeights.push(new THREE.Vector4(b,w,0,0))}if(e.skinIndices){n=0;for(a=e.skinIndices.length;n<a;n+=2)b=e.skinIndices[n],w=e.skinIndices[n+1],r.skinIndices.push(new THREE.Vector4(b,w,0,0))}r.bones=e.bones,r.animation=e.animation;if(e.morphTargets!==void 0){n=0;for(a=e.morphTargets.length;n<a;n++){r.morphTargets[n]={},r.morphTargets[n].name=e.morphTargets[n].name,r.morphTargets[n].vertices=[],E=r.morphTargets[n].vertices,S=e.morphTargets[n].vertices,b=0;for(w=S.length;b<w;b+=3)p=new THREE.Vector3,p.x=S[b]*i,p.y=S[b+1]*i,p.z=S[b+2]*i,E.push(p)}}if(e.morphColors!==void 0){n=0;for(a=e.morphColors.length;n<a;n++){r.morphColors[n]={},r.morphColors[n].name=e.morphColors[n].name,r.morphColors[n].colors=[],w=r.morphColors[n].colors,E=e.morphColors[n].colors,i=0;for(b=E.length;i<b;i+=3)S=new THREE.Color(16755200),S.setRGB(E[i],E[i+1],E[i+2]),w.push(S)}}r.computeCentroids(),r.computeFaceNormals(),this.hasNormals(r)&&r.computeTangents(),t(r)},THREE.GeometryLoader=function(){THREE.EventTarget.call(this),this.path=this.crossOrigin=null},THREE.GeometryLoader.prototype={constructor:THREE.GeometryLoader,load:function(e){var t=this,n=null;if(t.path===null){var r=e.split("/");r.pop(),t.path=r.length<1?".":r.join("/")}r=new XMLHttpRequest,r.addEventListener("load",function(r){r.target.responseText?n=t.parse(JSON.parse(r.target.responseText),i):t.dispatchEvent({type:"error",message:"Invalid file ["+e+"]"})},!1),r.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),r.open("GET",e,!0),r.send(null);var i=new THREE.LoadingMonitor;i.addEventListener("load",function(){t.dispatchEvent({type:"load",content:n})}),i.add(r)},parse:function(e,t){var n=this,r=new THREE.Geometry,i=e.scale!==void 0?1/e.scale:1;if(e.materials){r.materials=[];for(var s=0;s<e.materials.length;++s){var o=e.materials[s],u=function(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e},a=function(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))},f=function(e,r,i,s,o,f){e[r]=new THREE.Texture,e[r].sourceFile=i,s&&(e[r].repeat.set(s[0],s[1]),s[0]!==1&&(e[r].wrapS=THREE.RepeatWrapping),s[1]!==1&&(e[r].wrapT=THREE.RepeatWrapping)),o&&e[r].offset.set(o[0],o[1]),f&&(s={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},s[f[0]]!==void 0&&(e[r].wrapS=s[f[0]]),s[f[1]]!==void 0&&(e[r].wrapT=s[f[1]]));var l=e[r],e=new THREE.ImageLoader;e.addEventListener("load",function(e){e=e.content;if(!u(e.width)||!u(e.height)){var t=a(e.width),n=a(e.height);l.image=document.createElement("canvas"),l.image.width=t,l.image.height=n,l.image.getContext("2d").drawImage(e,0,0,t,n)}else l.image=e;l.needsUpdate=!0}),e.crossOrigin=n.crossOrigin,e.load(n.path+"/"+i),t&&t.add(e)},l=function(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255},c="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(o.shading){var p=o.shading.toLowerCase();p==="phong"?c="MeshPhongMaterial":p==="basic"&&(c="MeshBasicMaterial")}o.blending!==void 0&&THREE[o.blending]!==void 0&&(h.blending=THREE[o.blending]);if(o.transparent!==void 0||o.opacity<1)h.transparent=o.transparent;o.depthTest!==void 0&&(h.depthTest=o.depthTest),o.depthWrite!==void 0&&(h.depthWrite=o.depthWrite),o.vertexColors!==void 0&&(o.vertexColors=="face"?h.vertexColors=THREE.FaceColors:o.vertexColors&&(h.vertexColors=THREE.VertexColors)),o.colorDiffuse?h.color=l(o.colorDiffuse):o.DbgColor&&(h.color=o.DbgColor),o.colorSpecular&&(h.specular=l(o.colorSpecular)),o.colorAmbient&&(h.ambient=l(o.colorAmbient)),o.transparency&&(h.opacity=o.transparency),o.specularCoef&&(h.shininess=o.specularCoef),o.visible!==void 0&&(h.visible=o.visible),o.flipSided!==void 0&&(h.side=THREE.BackSide),o.doubleSided!==void 0&&(h.side=THREE.DoubleSide),o.wireframe!==void 0&&(h.wireframe=o.wireframe),o.mapDiffuse&&f(h,"map",o.mapDiffuse,o.mapDiffuseRepeat,o.mapDiffuseOffset,o.mapDiffuseWrap),o.mapLight&&f(h,"lightMap",o.mapLight,o.mapLightRepeat,o.mapLightOffset,o.mapLightWrap),o.mapBump&&f(h,"bumpMap",o.mapBump,o.mapBumpRepeat,o.mapBumpOffset,o.mapBumpWrap),o.mapNormal&&f(h,"normalMap",o.mapNormal,o.mapNormalRepeat,o.mapNormalOffset,o.mapNormalWrap),o.mapSpecular&&f(h,"specularMap",o.mapSpecular,o.mapSpecularRepeat,o.mapSpecularOffset,o.mapSpecularWrap),o.mapNormal?(f=THREE.ShaderUtils.lib.normal,l=THREE.UniformsUtils.clone(f.uniforms),l.tNormal.value=h.normalMap,o.mapNormalFactor&&l.uNormalScale.value.set(o.mapNormalFactor,o.mapNormalFactor),h.map&&(l.tDiffuse.value=h.map,l.enableDiffuse.value=!0),h.specularMap&&(l.tSpecular.value=h.specularMap,l.enableSpecular.value=!0),h.lightMap&&(l.tAO.value=h.lightMap,l.enableAO.value=!0),l.uDiffuseColor.value.setHex(h.color),l.uSpecularColor.value.setHex(h.specular),l.uAmbientColor.value.setHex(h.ambient),l.uShininess.value=h.shininess,h.opacity!==void 0&&(l.uOpacity.value=h.opacity),h=new THREE.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:l,lights:!0,fog:!0})):h=new THREE[c](h),o.DbgName!==void 0&&(h.name=o.DbgName),r.materials[s]=h}}var o=e.faces,d=e.vertices,h=e.normals,f=e.colors,l=0;if(e.uvs)for(s=0;s<e.uvs.length;s++)e.uvs[s].length&&l++;for(s=0;s<l;s++)r.faceUvs[s]=[],r.faceVertexUvs[s]=[];c=0;for(p=d.length;c<p;){var v=new THREE.Vector3;v.x=d[c++]*i,v.y=d[c++]*i,v.z=d[c++]*i,r.vertices.push(v)}c=0;for(p=o.length;c<p;){var m=o[c++],g=m&2,s=m&4,y=m&8,b=m&16,d=m&32,w=m&64,v=m&128;if(m&1){m=new THREE.Face4,m.a=o[c++],m.b=o[c++],m.c=o[c++],m.d=o[c++];var E=4}else m=new THREE.Face3,m.a=o[c++],m.b=o[c++],m.c=o[c++],E=3;g&&(g=o[c++],m.materialIndex=g);var S=r.faces.length;if(s)for(s=0;s<l;s++){var x=e.uvs[s],g=o[c++],T=x[g*2],g=x[g*2+1];r.faceUvs[s][S]=new THREE.UV(T,g)}if(y)for(s=0;s<l;s++){for(var x=e.uvs[s],y=[],N=0;N<E;N++)g=o[c++],T=x[g*2],g=x[g*2+1],y[N]=new THREE.UV(T,g);r.faceVertexUvs[s][S]=y}b&&(b=o[c++]*3,g=new THREE.Vector3,g.x=h[b++],g.y=h[b++],g.z=h[b],m.normal=g);if(d)for(s=0;s<E;s++)b=o[c++]*3,g=new THREE.Vector3,g.x=h[b++],g.y=h[b++],g.z=h[b],m.vertexNormals.push(g);w&&(d=o[c++],m.color=new THREE.Color(f[d]));if(v)for(s=0;s<E;s++)d=o[c++],m.vertexColors.push(new THREE.Color(f[d]));r.faces.push(m)}if(e.skinWeights){s=0;for(o=e.skinWeights.length;s<o;s+=2)r.skinWeights.push(new THREE.Vector4(e.skinWeights[s],e.skinWeights[s+1],0,0))}if(e.skinIndices){s=0;for(o=e.skinIndices.length;s<o;s+=2)h=0,r.skinIndices.push(new THREE.Vector4(e.skinIndices[s],e.skinIndices[s+1],h,0))}r.bones=e.bones,r.animation=e.animation;if(e.morphTargets){s=0;for(o=e.morphTargets.length;s<o;s++){r.morphTargets[s]={},r.morphTargets[s].name=e.morphTargets[s].name,r.morphTargets[s].vertices=[],h=r.morphTargets[s].vertices,f=e.morphTargets[s].vertices,g=0;for(l=f.length;g<l;g+=3)v=new THREE.Vector3,v.x=f[g]*i,v.y=f[g+1]*i,v.z=f[g+2]*i,h.push(v)}}if(e.morphColors){s=0;for(o=e.morphColors.length;s<o;s++){r.morphColors[s]={},r.morphColors[s].name=e.morphColors[s].name,r.morphColors[s].colors=[],i=r.morphColors[s].colors,f=e.morphColors[s].colors,h=0;for(l=f.length;h<l;h+=3)c=new THREE.Color(16755200),c.setRGB(f[h],f[h+1],f[h+2]),i.push(c)}}return r.computeCentroids(),r.computeFaceNormals(),r}},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.addGeometryHandler("ascii",THREE.JSONLoader),this.addGeometryHandler("binary",THREE.BinaryLoader)},THREE.SceneLoader.prototype.constructor=THREE.SceneLoader,THREE.SceneLoader.prototype.load=function(e,t){var n=this,r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState===4)if(r.status===200||r.status===0){var i=JSON.parse(r.responseText);n.parse(i,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+r.status+"]")},r.open("GET",e,!0),r.send(null)},THREE.SceneLoader.prototype.addGeometryHandler=function(e,t){this.geometryHandlerMap[e]={loaderClass:t}},THREE.SceneLoader.prototype.parse=function(e,t,n){function r(e,t){return t=="relativeToHTML"?e:f+"/"+e}function i(e,t){for(var n in t)if(D.objects[n]===void 0){var r=t[n],s=null;if(r.geometry!==void 0){if(T=D.geometries[r.geometry])s=!1,N=D.materials[r.materials[0]],(s=N instanceof THREE.ShaderMaterial)&&T.computeTangents(),y=r.position,b=r.rotation,w=r.quaternion,E=r.scale,m=r.matrix,w=0,r.materials.length===0&&(N=new THREE.MeshFaceMaterial),r.materials.length>1&&(N=new THREE.MeshFaceMaterial),r.morph?(s=new THREE.MorphAnimMesh(T,N),r.duration!==void 0&&(s.duration=r.duration),r.time!==void 0&&(s.time=r.time),r.mirroredLoop!==void 0&&(s.mirroredLoop=r.mirroredLoop),N.morphNormals&&T.computeMorphNormals()):s=new THREE.Mesh(T,N),s.name=n,m?(s.matrixAutoUpdate=!1,s.matrix.set(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15])):(s.position.set(y[0],y[1],y[2]),w?(s.quaternion.set(w[0],w[1],w[2],w[3]),s.useQuaternion=!0):s.rotation.set(b[0],b[1],b[2]),s.scale.set(E[0],E[1],E[2])),s.visible=r.visible,s.castShadow=r.castShadow,s.receiveShadow=r.receiveShadow,e.add(s),D.objects[n]=s}else y=r.position,b=r.rotation,w=r.quaternion,E=r.scale,w=0,s=new THREE.Object3D,s.name=n,s.position.set(y[0],y[1],y[2]),w?(s.quaternion.set(w[0],w[1],w[2],w[3]),s.useQuaternion=!0):s.rotation.set(b[0],b[1],b[2]),s.scale.set(E[0],E[1],E[2]),s.visible=r.visible!==void 0?r.visible:!1,e.add(s),D.objects[n]=s,D.empties[n]=s;if(s){if(r.properties!==void 0)for(var o in r.properties)s.properties[o]=r.properties[o];r.children!==void 0&&i(s,r.children)}}}function s(e){return function(t){D.geometries[e]=t,i(D.scene,P.objects),A-=1,a.onLoadComplete(),u()}}function o(e){return function(t){D.geometries[e]=t}}function u(){a.callbackProgress({totalModels:M,totalTextures:_,loadedModels:M-A,loadedTextures:_-O},D),a.onLoadProgress(),A===0&&O===0&&t(D)}var a=this,f=THREE.Loader.prototype.extractUrlBase(n),l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P=e;for(S in this.geometryHandlerMap)this.geometryHandlerMap[S].loaderObject=new this.geometryHandlerMap[S].loaderClass;O=A=0,D={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}};if(P.transform){e=P.transform.position,n=P.transform.rotation,S=P.transform.scale,e&&D.scene.position.set(e[0],e[1],e[2]),n&&D.scene.rotation.set(n[0],n[1],n[2]),S&&D.scene.scale.set(S[0],S[1],S[2]);if(e||n||S)D.scene.updateMatrix(),D.scene.updateMatrixWorld()}e=function(e){return function(){O-=e,u(),a.onLoadComplete()}};for(p in P.cameras)S=P.cameras[p],S.type==="perspective"?C=new THREE.PerspectiveCamera(S.fov,S.aspect,S.near,S.far):S.type==="ortho"&&(C=new THREE.OrthographicCamera(S.left,S.right,S.top,S.bottom,S.near,S.far)),y=S.position,n=S.target,S=S.up,C.position.set(y[0],y[1],y[2]),C.target=new THREE.Vector3(n[0],n[1],n[2]),S&&C.up.set(S[0],S[1],S[2]),D.cameras[p]=C;for(h in P.lights)n=P.lights[h],p=n.color!==void 0?n.color:16777215,C=n.intensity!==void 0?n.intensity:1,n.type==="directional"?(y=n.direction,g=new THREE.DirectionalLight(p,C),g.position.set(y[0],y[1],y[2]),g.position.normalize()):n.type==="point"?(y=n.position,g=n.distance,g=new THREE.PointLight(p,C,g),g.position.set(y[0],y[1],y[2])):n.type==="ambient"&&(g=new THREE.AmbientLight(p)),D.scene.add(g),D.lights[h]=g;for(d in P.fogs)h=P.fogs[d],h.type==="linear"?k=new THREE.Fog(0,h.near,h.far):h.type==="exp2"&&(k=new THREE.FogExp2(0,h.density)),S=h.color,k.color.setRGB(S[0],S[1],S[2]),D.fogs[d]=k;D.cameras&&P.defaults.camera&&(D.currentCamera=D.cameras[P.defaults.camera]),D.fogs&&P.defaults.fog&&(D.scene.fog=D.fogs[P.defaults.fog]),S=P.defaults.bgcolor,D.bgColor=new THREE.Color,D.bgColor.setRGB(S[0],S[1],S[2]),D.bgColorAlpha=P.defaults.bgalpha;for(l in P.geometries)d=P.geometries[l],d.type in this.geometryHandlerMap&&(A+=1,a.onLoadStart());M=A;for(l in P.geometries){d=P.geometries[l];if(d.type==="cube")T=new THREE.CubeGeometry(d.width,d.height,d.depth,d.segmentsWidth,d.segmentsHeight,d.segmentsDepth,null,d.flipped,d.sides),D.geometries[l]=T;else if(d.type==="plane")T=new THREE.PlaneGeometry(d.width,d.height,d.segmentsWidth,d.segmentsHeight),D.geometries[l]=T;else if(d.type==="sphere")T=new THREE.SphereGeometry(d.radius,d.segmentsWidth,d.segmentsHeight),D.geometries[l]=T;else if(d.type==="cylinder")T=new THREE.CylinderGeometry(d.topRad,d.botRad,d.height,d.radSegs,d.heightSegs),D.geometries[l]=T;else if(d.type==="torus")T=new THREE.TorusGeometry(d.radius,d.tube,d.segmentsR,d.segmentsT),D.geometries[l]=T;else if(d.type==="icosahedron")T=new THREE.IcosahedronGeometry(d.radius,d.subdivisions),D.geometries[l]=T;else if(d.type in this.geometryHandlerMap){k={};for(L in d)L!=="type"&&L!=="url"&&(k[L]=d[L]);this.geometryHandlerMap[d.type].loaderObject.load(r(d.url,P.urlBaseType),s(l),k)}else d.type==="embedded"&&(d=P.embeds[d.id],d.metadata=P.metadata,d&&this.geometryHandlerMap.ascii.loaderObject.createModel(d,o(l),""))}for(v in P.textures){l=P.textures[v];if(l.url instanceof Array){O+=l.url.length;for(L=0;L<l.url.length;L++)a.onLoadStart()}else O+=1,a.onLoadStart()}_=O;for(v in P.textures){l=P.textures[v],l.mapping!==void 0&&THREE[l.mapping]!==void 0&&(l.mapping=new THREE[l.mapping]);if(l.url instanceof Array){d=l.url.length,k=[];for(L=0;L<d;L++)k[L]=r(l.url[L],P.urlBaseType);L=(L=k[0].endsWith(".dds"))?THREE.ImageUtils.loadCompressedTextureCube(k,l.mapping,e(d)):THREE.ImageUtils.loadTextureCube(k,l.mapping,e(d))}else L=l.url.toLowerCase().endsWith(".dds"),d=r(l.url,P.urlBaseType),k=e(1),L=L?THREE.ImageUtils.loadCompressedTexture(d,l.mapping,k):THREE.ImageUtils.loadTexture(d,l.mapping,k),THREE[l.minFilter]!==void 0&&(L.minFilter=THREE[l.minFilter]),THREE[l.magFilter]!==void 0&&(L.magFilter=THREE[l.magFilter]),l.anisotropy&&(L.anisotropy=l.anisotropy),l.repeat&&(L.repeat.set(l.repeat[0],l.repeat[1]),l.repeat[0]!==1&&(L.wrapS=THREE.RepeatWrapping),l.repeat[1]!==1&&(L.wrapT=THREE.RepeatWrapping)),l.offset&&L.offset.set(l.offset[0],l.offset[1]),l.wrap&&(d={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},d[l.wrap[0]]!==void 0&&(L.wrapS=d[l.wrap[0]]),d[l.wrap[1]]!==void 0&&(L.wrapT=d[l.wrap[1]]));D.textures[v]=L}for(c in P.materials){m=P.materials[c];for(x in m.parameters)x==="envMap"||x==="map"||x==="lightMap"||x==="bumpMap"?m.parameters[x]=D.textures[m.parameters[x]]:x==="shading"?m.parameters[x]=m.parameters[x]==="flat"?THREE.FlatShading:THREE.SmoothShading:x==="side"?m.parameters[x]=m.parameters[x]=="double"?THREE.DoubleSide:m.parameters[x]=="back"?THREE.BackSide:THREE.FrontSide:x==="blending"?m.parameters[x]=m.parameters[x]in THREE?THREE[m.parameters[x]]:THREE.NormalBlending:x==="combine"?m.parameters[x]=m.parameters[x]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation:x==="vertexColors"?m.parameters[x]=="face"?m.parameters[x]=THREE.FaceColors:m.parameters[x]&&(m.parameters[x]=THREE.VertexColors):x==="wrapRGB"&&(v=m.parameters[x],m.parameters[x]=new THREE.Vector3(v[0],v[1],v[2]));m.parameters.opacity!==void 0&&m.parameters.opacity<1&&(m.parameters.transparent=!0),m.parameters.normalMap?(v=THREE.ShaderUtils.lib.normal,e=THREE.UniformsUtils.clone(v.uniforms),l=m.parameters.color,L=m.parameters.specular,d=m.parameters.ambient,k=m.parameters.shininess,e.tNormal.value=D.textures[m.parameters.normalMap],m.parameters.normalScale&&e.uNormalScale.value.set(m.parameters.normalScale[0],m.parameters.normalScale[1]),m.parameters.map&&(e.tDiffuse.value=m.parameters.map,e.enableDiffuse.value=!0),m.parameters.envMap&&(e.tCube.value=m.parameters.envMap,e.enableReflection.value=!0,e.uReflectivity.value=m.parameters.reflectivity),m.parameters.lightMap&&(e.tAO.value=m.parameters.lightMap,e.enableAO.value=!0),m.parameters.specularMap&&(e.tSpecular.value=D.textures[m.parameters.specularMap],e.enableSpecular.value=!0),m.parameters.displacementMap&&(e.tDisplacement.value=D.textures[m.parameters.displacementMap],e.enableDisplacement.value=!0,e.uDisplacementBias.value=m.parameters.displacementBias,e.uDisplacementScale.value=m.parameters.displacementScale),e.uDiffuseColor.value.setHex(l),e.uSpecularColor.value.setHex(L),e.uAmbientColor.value.setHex(d),e.uShininess.value=k,m.parameters.opacity&&(e.uOpacity.value=m.parameters.opacity),N=new THREE.ShaderMaterial({fragmentShader:v.fragmentShader,vertexShader:v.vertexShader,uniforms:e,lights:!0,fog:!0})):N=new THREE[m.type](m.parameters),D.materials[c]=N}i(D.scene,P.objects),a.callbackSync(D),u()},THREE.TextureLoader=function(){THREE.EventTarget.call(this),this.crossOrigin=null},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e){var t=this,n=new Image;n.addEventListener("load",function(){var e=new THREE.Texture(n);e.needsUpdate=!0,t.dispatchEvent({type:"load",content:e})},!1),n.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),t.crossOrigin&&(n.crossOrigin=t.crossOrigin),n.src=e}},THREE.Material=function(){this.id=THREE.MaterialCount++,this.name="",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.overdraw=!1,this.needsUpdate=this.visible=!0},THREE.Material.prototype.setValues=function(e){if(e!==void 0)for(var t in e){var n=e[t];if(n===void 0)console.warn("THREE.Material: '"+t+"' parameter is undefined.");else if(t in this){var r=this[t];r instanceof THREE.Color&&n instanceof THREE.Color?r.copy(n):r instanceof THREE.Color&&typeof n=="number"?r.setHex(n):r instanceof THREE.Vector3&&n instanceof THREE.Vector3?r.copy(n):this[t]=n}}},THREE.Material.prototype.clone=function(e){return e===void 0&&(e=new THREE.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},THREE.MaterialCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.wrapAround=this.perPixel=this.metal=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.envMap=this.specularMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshFaceMaterial=function(){},THREE.MeshFaceMaterial.prototype.clone=function(){return new THREE.MeshFaceMaterial},THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.ParticleBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleBasicMaterial.prototype.clone=function(){var e=new THREE.ParticleBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.ParticleCanvasMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.ParticleCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleCanvasMaterial.prototype.clone=function(){var e=new THREE.ParticleCanvasMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.ParticleDOMMaterial=function(e){this.element=e},THREE.ParticleDOMMaterial.prototype.clone=function(){return new THREE.ParticleDOMMaterial(this.element)},THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.vertexShader=this.fragmentShader="void main() {}",this.uniforms={},this.attributes=null,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=this.uniforms,e.attributes=this.attributes,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.Texture=function(e,t,n,r,i,s,o,u,a){this.id=THREE.TextureCount++,this.image=e,this.mapping=t!==void 0?t:new THREE.UVMapping,this.wrapS=n!==void 0?n:THREE.ClampToEdgeWrapping,this.wrapT=r!==void 0?r:THREE.ClampToEdgeWrapping,this.magFilter=i!==void 0?i:THREE.LinearFilter,this.minFilter=s!==void 0?s:THREE.LinearMipMapLinearFilter,this.anisotropy=a!==void 0?a:1,this.format=o!==void 0?o:THREE.RGBAFormat,this.type=u!==void 0?u:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var e=new THREE.Texture;return e.image=this.image,e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e}},THREE.TextureCount=0,THREE.CompressedTexture=function(e,t,n,r,i,s,o,u,a,f){THREE.Texture.call(this,null,s,o,u,a,f,r,i),this.image={width:t,height:n},this.mipmaps=e},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;return e.image=this.image,e.mipmaps=this.mipmaps,e.format=this.format,e.type=this.type,e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e},THREE.DataTexture=function(e,t,n,r,i,s,o,u,a,f){THREE.Texture.call(this,null,s,o,u,a,f,r,i),this.image={data:e,width:t,height:n}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e},THREE.Particle=function(e){THREE.Object3D.call(this),this.material=e},THREE.Particle.prototype=Object.create(THREE.Object3D.prototype),THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t!==void 0?t:new THREE.ParticleBasicMaterial({color:Math.random()*16777215}),this.sortParticles=!1,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius),this.frustumCulled=!1},THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype),THREE.Line=function(e,t,n){THREE.Object3D.call(this),this.geometry=e,this.material=t!==void 0?t:new THREE.LineBasicMaterial({color:Math.random()*16777215}),this.type=n!==void 0?n:THREE.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t!==void 0?t:new THREE.MeshBasicMaterial({color:Math.random()*16777215,wireframe:!0});if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var n=0;n<this.geometry.morphTargets.length;n++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[n].name]=n}}},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return this.morphTargetDictionary[e]!==void 0?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix());if(t||this.matrixWorldNeedsUpdate)e?this.skinMatrix.multiply(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0;var n,r=this.children.length;for(n=0;n<r;n++)this.children[n].update(this.skinMatrix,t)},THREE.SkinnedMesh=function(e,t,n){THREE.Mesh.call(this,e,t),this.useVertexTexture=n!==void 0?n:!0,this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];var r,i,s;if(this.geometry.bones!==void 0){for(e=0;e<this.geometry.bones.length;e++)n=this.geometry.bones[e],r=n.pos,i=n.rotq,s=n.scl,t=this.addBone(),t.name=n.name,t.position.set(r[0],r[1],r[2]),t.quaternion.set(i[0],i[1],i[2],i[3]),t.useQuaternion=!0,s!==void 0?t.scale.set(s[0],s[1],s[2]):t.scale.set(1,1,1);for(e=0;e<this.bones.length;e++)n=this.geometry.bones[e],t=this.bones[e],n.parent===-1?this.add(t):this.bones[n.parent].add(t);e=this.bones.length,this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=e=e>256?64:e>64?32:e>16?16:8,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*e),this.pose()}},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.addBone=function(e){return e===void 0&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1;for(var e=0,t=this.children.length;e<t;e++){var n=this.children[e];n instanceof THREE.Bone?n.update(this.identityMatrix,!1):n.updateMatrixWorld(!0)}if(this.boneInverses==void 0){this.boneInverses=[],e=0;for(t=this.bones.length;e<t;e++)n=new THREE.Matrix4,n.getInverse(this.bones[e].skinMatrix),this.boneInverses.push(n)}e=0;for(t=this.bones.length;e<t;e++)THREE.SkinnedMesh.offsetMatrix.multiply(this.bones[e].skinMatrix,this.boneInverses[e]),THREE.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,e*16);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],n=1/t.lengthManhattan();n!==Infinity?t.multiplyScalar(n):t.set(1)}},THREE.SkinnedMesh.offsetMatrix=new THREE.Matrix4,THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,n=e.animations,r=/([a-z]+)(\d+)/,i=0,s=e.morphTargets.length;i<s;i++){var o=e.morphTargets[i].name.match(r);if(o&&o.length>1){o=o[1],n[o]||(n[o]={start:Infinity,end:-Infinity});var u=n[o];i<u.start&&(u.start=i),i>u.end&&(u.end=i),t||(t=o)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=1e3*((n.end-n.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time=this.time+this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||this.time<0)this.direction=this.direction*-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)}else this.time=this.time%this.duration,this.time<0&&(this.time=this.time+this.duration);e=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1),e!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[e]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=e),t=this.time%t/t,this.directionBackwards&&(t=1-t),this.morphTargetInfluences[this.currentKeyframe]=t,this.morphTargetInfluences[this.lastKeyframe]=1-t},THREE.Ribbon=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t},THREE.Ribbon.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD=function(){THREE.Object3D.call(this),this.LODs=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(e,t){t===void 0&&(t=0);for(var t=Math.abs(t),n=0;n<this.LODs.length;n++)if(t<this.LODs[n].visibleAtDistance)break;this.LODs.splice(n,0,{visibleAtDistance:t,object3D:e}),this.add(e)},THREE.LOD.prototype.update=function(e){if(this.LODs.length>1){e.matrixWorldInverse.getInverse(e.matrixWorld),e=e.matrixWorldInverse,e=-(e.elements[2]*this.matrixWorld.elements[12]+e.elements[6]*this.matrixWorld.elements[13]+e.elements[10]*this.matrixWorld.elements[14]+e.elements[14]),this.LODs[0].object3D.visible=!0;for(var t=1;t<this.LODs.length;t++){if(!(e>=this.LODs[t].visibleAtDistance))break;this.LODs[t-1].object3D.visible=!1,this.LODs[t].object3D.visible=!0}for(;t<this.LODs.length;t++)this.LODs[t].object3D.visible=!1}},THREE.Sprite=function(e){THREE.Object3D.call(this),this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.map=e.map!==void 0?e.map:new THREE.Texture,this.blending=e.blending!==void 0?e.blending:THREE.NormalBlending,this.blendSrc=e.blendSrc!==void 0?e.blendSrc:THREE.SrcAlphaFactor,this.blendDst=e.blendDst!==void 0?e.blendDst:THREE.OneMinusSrcAlphaFactor,this.blendEquation=e.blendEquation!==void 0?e.blendEquation:THREE.AddEquation,this.useScreenCoordinates=e.useScreenCoordinates!==void 0?e.useScreenCoordinates:!0,this.mergeWith3D=e.mergeWith3D!==void 0?e.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=e.affectedByDistance!==void 0?e.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=e.scaleByViewport!==void 0?e.scaleByViewport:!this.affectedByDistance,this.alignment=e.alignment instanceof THREE.Vector2?e.alignment:THREE.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1)},THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y);this.matrixWorldNeedsUpdate=!0},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)this.__lights.indexOf(e)===-1&&this.__lights.push(e),e.target&&e.target.parent===void 0&&this.add(e.target);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&this.__objects.indexOf(e)===-1){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);t!==-1&&this.__objectsRemoved.splice(t,1)}for(t=0;t<e.children.length;t++)this.__addObject(e.children[t])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);t!==-1&&this.__lights.splice(t,1)}else e instanceof THREE.Camera||(t=this.__objects.indexOf(e),t!==-1&&(this.__objects.splice(t,1),this.__objectsRemoved.push(e),t=this.__objectsAdded.indexOf(e),t!==-1&&this.__objectsAdded.splice(t,1)));for(t=0;t<e.children.length;t++)this.__removeObject(e.children[t])},THREE.Fog=function(e,t,n){this.color=new THREE.Color(e),this.near=t!==void 0?t:1,this.far=n!==void 0?n:1e3},THREE.FogExp2=function(e,t){this.color=new THREE.Color(e),this.density=t!==void 0?t:25e-5},THREE.CanvasRenderer=function(e){function t(e){y!==e&&(y=v.globalAlpha=e)}function n(e){b!==e&&(e===THREE.NormalBlending?v.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?v.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(v.globalCompositeOperation="darker"),b=e)}function r(e){w!==e&&(w=v.strokeStyle=e)}function i(e){E!==e&&(E=v.fillStyle=e)}console.log("THREE.CanvasRenderer",THREE.REVISION);var e=e||{},s=this,o,u,a,f=new THREE.Projector,l=e.canvas!==void 0?e.canvas:document.createElement("canvas"),c,h,p,d,v=l.getContext("2d"),m=new THREE.Color(0),g=0,y=1,b=0,w=null,E=null,S=null,x=null,T=null,N,C,k,L,A=new THREE.RenderableVertex,O=new THREE.RenderableVertex,M,_,D,P,H,B,j,F,I,q,R,U,z=new THREE.Color,W=new THREE.Color,X=new THREE.Color,V=new THREE.Color,$=new THREE.Color,J={},K={},Q,G,Y,Z,et,tt,nt,rt,it,st,ot=new THREE.Rectangle,ut=new THREE.Rectangle,at=new THREE.Rectangle,ft=!1,lt=new THREE.Color,ct=new THREE.Color,ht=new THREE.Color,pt=new THREE.Vector3,dt,vt,mt,gt,yt,bt,e=16;dt=document.createElement("canvas"),dt.width=dt.height=2,vt=dt.getContext("2d"),vt.fillStyle="rgba(0,0,0,1)",vt.fillRect(0,0,2,2),mt=vt.getImageData(0,0,2,2),gt=mt.data,yt=document.createElement("canvas"),yt.width=yt.height=e,bt=yt.getContext("2d"),bt.translate(-e/2,-e/2),bt.scale(e,e),e--,this.domElement=l,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(e,t){c=e,h=t,p=Math.floor(c/2),d=Math.floor(h/2),l.width=c,l.height=h,ot.set(-p,-d,p,d),ut.set(-p,-d,p,d),y=1,b=0,T=x=S=E=w=null},this.setClearColor=function(e,t){m.copy(e),g=t!==void 0?t:1,ut.set(-p,-d,p,d)},this.setClearColorHex=function(e,t){m.setHex(e),g=t!==void 0?t:1,ut.set(-p,-d,p,d)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){v.setTransform(1,0,0,-1,p,d),ut.isEmpty()===!1&&(ut.minSelf(ot),ut.inflate(2),g<1&&v.clearRect(Math.floor(ut.getX()),Math.floor(ut.getY()),Math.floor(ut.getWidth()),Math.floor(ut.getHeight())),g>0&&(n(THREE.NormalBlending),t(1),i("rgba("+Math.floor(m.r*255)+","+Math.floor(m.g*255)+","+Math.floor(m.b*255)+","+g+")"),v.fillRect(Math.floor(ut.getX()),Math.floor(ut.getY()),Math.floor(ut.getWidth()),Math.floor(ut.getHeight()))),ut.empty())},this.render=function(e,l){function c(e,t,n){for(var r=0,i=a.length;r<i;r++){var s=a[r],o=s.color;if(s instanceof THREE.DirectionalLight){var u=s.matrixWorld.getPosition().normalize(),f=t.dot(u);f<=0||(f*=s.intensity,n.r=n.r+o.r*f,n.g=n.g+o.g*f,n.b=n.b+o.b*f)}else s instanceof THREE.PointLight&&(u=s.matrixWorld.getPosition(),f=t.dot(pt.sub(u,e).normalize()),f<=0||(f*=s.distance==0?1:1-Math.min(e.distanceTo(u)/s.distance,1),f!=0&&(f*=s.intensity,n.r=n.r+o.r*f,n.g=n.g+o.g*f,n.b=n.b+o.b*f)))}}function h(e,r,i,o,u,a,f,h){s.info.render.vertices=s.info.render.vertices+3,s.info.render.faces++,t(h.opacity),n(h.blending),M=e.positionScreen.x,_=e.positionScreen.y,D=r.positionScreen.x,P=r.positionScreen.y,H=i.positionScreen.x,B=i.positionScreen.y,m(M,_,D,P,H,B),(h instanceof THREE.MeshLambertMaterial||h instanceof THREE.MeshPhongMaterial)&&h.map===null&&h.map===null?ft===!0?(o=h.color,u=h.emissive,h.wireframe===!1&&h.shading==THREE.SmoothShading&&f.vertexNormalsLength==3?(W.r=X.r=V.r=lt.r,W.g=X.g=V.g=lt.g,W.b=X.b=V.b=lt.b,c(f.v1.positionWorld,f.vertexNormalsWorld[0],W),c(f.v2.positionWorld,f.vertexNormalsWorld[1],X),c(f.v3.positionWorld,f.vertexNormalsWorld[2],V),W.r=o.r*W.r+u.r,W.g=o.g*W.g+u.g,W.b=o.b*W.b+u.b,X.r=o.r*X.r+u.r,X.g=o.g*X.g+u.g,X.b=o.b*X.b+u.b,V.r=o.r*V.r+u.r,V.g=o.g*V.g+u.g,V.b=o.b*V.b+u.b,$.r=(X.r+V.r)*.5,$.g=(X.g+V.g)*.5,$.b=(X.b+V.b)*.5,Y=wt(W,X,V,$),E(M,_,D,P,H,B,0,0,1,0,0,1,Y)):(z.r=lt.r,z.g=lt.g,z.b=lt.b,c(f.centroidWorld,f.normalWorld,z),z.r=o.r*z.r+u.r,z.g=o.g*z.g+u.g,z.b=o.b*z.b+u.b,h.wireframe===!0?y(z,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):b(z))):h.wireframe===!0?y(h.color,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):b(h.color):h instanceof THREE.MeshBasicMaterial||h instanceof THREE.MeshLambertMaterial||h instanceof THREE.MeshPhongMaterial?h.map!==null?h.map.mapping instanceof THREE.UVMapping&&(Z=f.uvs[0],w(M,_,D,P,H,B,Z[o].u,Z[o].v,Z[u].u,Z[u].v,Z[a].u,Z[a].v,h.map)):h.envMap!==null?h.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(e=l.matrixWorldInverse,pt.copy(f.vertexNormalsWorld[o]),et=(pt.x*e.elements[0]+pt.y*e.elements[4]+pt.z*e.elements[8])*.5+.5,tt=(pt.x*e.elements[1]+pt.y*e.elements[5]+pt.z*e.elements[9])*.5+.5,pt.copy(f.vertexNormalsWorld[u]),nt=(pt.x*e.elements[0]+pt.y*e.elements[4]+pt.z*e.elements[8])*.5+.5,rt=(pt.x*e.elements[1]+pt.y*e.elements[5]+pt.z*e.elements[9])*.5+.5,pt.copy(f.vertexNormalsWorld[a]),it=(pt.x*e.elements[0]+pt.y*e.elements[4]+pt.z*e.elements[8])*.5+.5,st=(pt.x*e.elements[1]+pt.y*e.elements[5]+pt.z*e.elements[9])*.5+.5,w(M,_,D,P,H,B,et,tt,nt,rt,it,st,h.envMap)):h.wireframe===!0?y(h.color,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):b(h.color):h instanceof THREE.MeshDepthMaterial?(Q=l.near,G=l.far,W.r=W.g=W.b=1-Et(e.positionScreen.z,Q,G),X.r=X.g=X.b=1-Et(r.positionScreen.z,Q,G),V.r=V.g=V.b=1-Et(i.positionScreen.z,Q,G),$.r=(X.r+V.r)*.5,$.g=(X.g+V.g)*.5,$.b=(X.b+V.b)*.5,Y=wt(W,X,V,$),E(M,_,D,P,H,B,0,0,1,0,0,1,Y)):h instanceof THREE.MeshNormalMaterial&&(z.r=St(f.normalWorld.x),z.g=St(f.normalWorld.y),z.b=St(f.normalWorld.z),h.wireframe===!0?y(z,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):b(z))}function m(e,t,n,r,i,s){v.beginPath(),v.moveTo(e,t),v.lineTo(n,r),v.lineTo(i,s),v.closePath()}function g(e,t,n,r,i,s,o,u){v.beginPath(),v.moveTo(e,t),v.lineTo(n,r),v.lineTo(i,s),v.lineTo(o,u),v.closePath()}function y(e,t,n,i){S!==t&&(S=v.lineWidth=t),x!==n&&(x=v.lineCap=n),T!==i&&(T=v.lineJoin=i),r(e.getContextStyle()),v.stroke(),at.inflate(t*2)}function b(e){i(e.getContextStyle()),v.fill()}function w(e,t,n,r,s,o,u,a,f,l,c,h,p){if(!(p instanceof THREE.DataTexture||p.image===void 0||p.image.width==0)){if(p.needsUpdate===!0){var d=p.wrapS==THREE.RepeatWrapping,m=p.wrapT==THREE.RepeatWrapping;J[p.id]=v.createPattern(p.image,d===!0&&m===!0?"repeat":d===!0&&m===!1?"repeat-x":d===!1&&m===!0?"repeat-y":"no-repeat"),p.needsUpdate=!1}J[p.id]===void 0?i("rgba(0,0,0,1)"):i(J[p.id]);var d=p.offset.x/p.repeat.x,m=p.offset.y/p.repeat.y,g=p.image.width*p.repeat.x,y=p.image.height*p.repeat.y,u=(u+d)*g,a=(1-a+m)*y,n=n-e,r=r-t,s=s-e,o=o-t,f=(f+d)*g-u,l=(1-l+m)*y-a,c=(c+d)*g-u,h=(1-h+m)*y-a,d=f*h-c*l;d===0?(K[p.id]===void 0&&(t=document.createElement("canvas"),t.width=p.image.width,t.height=p.image.height,t=t.getContext("2d"),t.drawImage(p.image,0,0),K[p.id]=t.getImageData(0,0,p.image.width,p.image.height).data),t=K[p.id],u=(Math.floor(u)+Math.floor(a)*p.image.width)*4,z.setRGB(t[u]/255,t[u+1]/255,t[u+2]/255),b(z)):(d=1/d,p=(h*n-l*s)*d,l=(h*r-l*o)*d,n=(f*s-c*n)*d,r=(f*o-c*r)*d,e=e-p*u-n*a,u=t-l*u-r*a,v.save(),v.transform(p,l,n,r,e,u),v.fill(),v.restore())}}function E(e,t,n,r,i,s,o,u,a,f,l,c,h){var p,d;p=h.width-1,d=h.height-1,o*=p,u*=d,n-=e,r-=t,i-=e,s-=t,a=a*p-o,f=f*d-u,l=l*p-o,c=c*d-u,d=1/(a*c-l*f),p=(c*n-f*i)*d,f=(c*r-f*s)*d,n=(a*i-l*n)*d,r=(a*s-l*r)*d,e=e-p*o-n*u,t=t-f*o-r*u,v.save(),v.transform(p,f,n,r,e,t),v.clip(),v.drawImage(h,0,0),v.restore()}function wt(e,t,n,r){return gt[0]=e.r*255|0,gt[1]=e.g*255|0,gt[2]=e.b*255|0,gt[4]=t.r*255|0,gt[5]=t.g*255|0,gt[6]=t.b*255|0,gt[8]=n.r*255|0,gt[9]=n.g*255|0,gt[10]=n.b*255|0,gt[12]=r.r*255|0,gt[13]=r.g*255|0,gt[14]=r.b*255|0,vt.putImageData(mt,0,0),bt.drawImage(dt,0,0),yt}function Et(e,t,n){return e=(e-t)/(n-t),e*e*(3-2*e)}function St(e){return e=(e+1)*.5,e<0?0:e>1?1:e}function xt(e,t){var n=t.x-e.x,r=t.y-e.y,i=n*n+r*r;i!==0&&(i=1/Math.sqrt(i),n*=i,r*=i,t.x=t.x+n,t.y=t.y+r,e.x=e.x-n,e.y=e.y-r)}if(l instanceof THREE.Camera==0)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{var Tt,Nt,Ct,kt;this.autoClear===!0?this.clear():v.setTransform(1,0,0,-1,p,d),s.info.render.vertices=0,s.info.render.faces=0,o=f.projectScene(e,l,this.sortObjects,this.sortElements),u=o.elements,a=o.lights,ft=a.length>0;if(ft===!0){lt.setRGB(0,0,0),ct.setRGB(0,0,0),ht.setRGB(0,0,0),Tt=0;for(Nt=a.length;Tt<Nt;Tt++){kt=a[Tt];var Lt=kt.color;kt instanceof THREE.AmbientLight?(lt.r=lt.r+Lt.r,lt.g=lt.g+Lt.g,lt.b=lt.b+Lt.b):kt instanceof THREE.DirectionalLight?(ct.r=ct.r+Lt.r,ct.g=ct.g+Lt.g,ct.b=ct.b+Lt.b):kt instanceof THREE.PointLight&&(ht.r=ht.r+Lt.r,ht.g=ht.g+Lt.g,ht.b=ht.b+Lt.b)}}Tt=0;for(Nt=u.length;Tt<Nt;Tt++){Ct=u[Tt],kt=Ct.material;if(kt!==void 0&&kt.visible!==!1){at.empty();if(Ct instanceof THREE.RenderableParticle){N=Ct,N.x=N.x*p,N.y=N.y*d;var Lt=N,At=Ct;t(kt.opacity),n(kt.blending);var Ot=void 0,Mt=void 0,_t=void 0,Dt=void 0,Pt=void 0,Ht=Ct=void 0;kt instanceof THREE.ParticleBasicMaterial?kt.map===null?(_t=At.object.scale.x,Dt=At.object.scale.y,_t=_t*At.scale.x*p,Dt=Dt*At.scale.y*d,at.set(Lt.x-_t,Lt.y-Dt,Lt.x+_t,Lt.y+Dt),ot.intersects(at)!==!1&&(i(kt.color.getContextStyle()),v.save(),v.translate(Lt.x,Lt.y),v.rotate(-At.rotation),v.scale(_t,Dt),v.fillRect(-1,-1,2,2),v.restore())):(Pt=kt.map.image,Ct=Pt.width>>1,Ht=Pt.height>>1,_t=At.scale.x*p,Dt=At.scale.y*d,Ot=_t*Ct,Mt=Dt*Ht,at.set(Lt.x-Ot,Lt.y-Mt,Lt.x+Ot,Lt.y+Mt),ot.intersects(at)!==!1&&(v.save(),v.translate(Lt.x,Lt.y),v.rotate(-At.rotation),v.scale(_t,-Dt),v.translate(-Ct,-Ht),v.drawImage(Pt,0,0),v.restore())):kt instanceof THREE.ParticleCanvasMaterial&&(Ot=At.scale.x*p,Mt=At.scale.y*d,at.set(Lt.x-Ot,Lt.y-Mt,Lt.x+Ot,Lt.y+Mt),ot.intersects(at)!==!1&&(r(kt.color.getContextStyle()),i(kt.color.getContextStyle()),v.save(),v.translate(Lt.x,Lt.y),v.rotate(-At.rotation),v.scale(Ot,Mt),kt.program(v),v.restore()))}else Ct instanceof THREE.RenderableLine?(N=Ct.v1,C=Ct.v2,N.positionScreen.x=N.positionScreen.x*p,N.positionScreen.y=N.positionScreen.y*d,C.positionScreen.x=C.positionScreen.x*p,C.positionScreen.y=C.positionScreen.y*d,at.addPoint(N.positionScreen.x,N.positionScreen.y),at.addPoint(C.positionScreen.x,C.positionScreen.y),ot.intersects(at)===!0&&(Lt=N,At=C,t(kt.opacity),n(kt.blending),v.beginPath(),v.moveTo(Lt.positionScreen.x,Lt.positionScreen.y),v.lineTo(At.positionScreen.x,At.positionScreen.y),kt instanceof THREE.LineBasicMaterial&&(Lt=kt.linewidth,S!==Lt&&(S=v.lineWidth=Lt),Lt=kt.linecap,x!==Lt&&(x=v.lineCap=Lt),Lt=kt.linejoin,T!==Lt&&(T=v.lineJoin=Lt),r(kt.color.getContextStyle()),v.stroke(),at.inflate(kt.linewidth*2)))):Ct instanceof THREE.RenderableFace3?(N=Ct.v1,C=Ct.v2,k=Ct.v3,N.positionScreen.x=N.positionScreen.x*p,N.positionScreen.y=N.positionScreen.y*d,C.positionScreen.x=C.positionScreen.x*p,C.positionScreen.y=C.positionScreen.y*d,k.positionScreen.x=k.positionScreen.x*p,k.positionScreen.y=k.positionScreen.y*d,kt.overdraw===!0&&(xt(N.positionScreen,C.positionScreen),xt(C.positionScreen,k.positionScreen),xt(k.positionScreen,N.positionScreen)),at.add3Points(N.positionScreen.x,N.positionScreen.y,C.positionScreen.x,C.positionScreen.y,k.positionScreen.x,k.positionScreen.y),ot.intersects(at)===!0&&h(N,C,k,0,1,2,Ct,kt,e)):Ct instanceof THREE.RenderableFace4&&(N=Ct.v1,C=Ct.v2,k=Ct.v3,L=Ct.v4,N.positionScreen.x=N.positionScreen.x*p,N.positionScreen.y=N.positionScreen.y*d,C.positionScreen.x=C.positionScreen.x*p,C.positionScreen.y=C.positionScreen.y*d,k.positionScreen.x=k.positionScreen.x*p,k.positionScreen.y=k.positionScreen.y*d,L.positionScreen.x=L.positionScreen.x*p,L.positionScreen.y=L.positionScreen.y*d,A.positionScreen.copy(C.positionScreen),O.positionScreen.copy(L.positionScreen),kt.overdraw===!0&&(xt(N.positionScreen,C.positionScreen),xt(C.positionScreen,L.positionScreen),xt(L.positionScreen,N.positionScreen),xt(k.positionScreen,A.positionScreen),xt(k.positionScreen,O.positionScreen)),at.addPoint(N.positionScreen.x,N.positionScreen.y),at.addPoint(C.positionScreen.x,C.positionScreen.y),at.addPoint(k.positionScreen.x,k.positionScreen.y),at.addPoint(L.positionScreen.x,L.positionScreen.y),ot.intersects(at)===!0&&(At=N,Ot=C,Mt=k,_t=L,Dt=A,Pt=O,Lt=Ct,Ct=e,s.info.render.vertices=s.info.render.vertices+4,s.info.render.faces++,t(kt.opacity),n(kt.blending),kt.map!==void 0&&kt.map!==null||kt.envMap!==void 0&&kt.envMap!==null?(h(At,Ot,_t,0,1,3,Lt,kt,Ct),h(Dt,Mt,Pt,1,2,3,Lt,kt,Ct)):(M=At.positionScreen.x,_=At.positionScreen.y,D=Ot.positionScreen.x,P=Ot.positionScreen.y,H=Mt.positionScreen.x,B=Mt.positionScreen.y,j=_t.positionScreen.x,F=_t.positionScreen.y,I=Dt.positionScreen.x,q=Dt.positionScreen.y,R=Pt.positionScreen.x,U=Pt.positionScreen.y,kt instanceof THREE.MeshLambertMaterial||kt instanceof THREE.MeshPhongMaterial?ft===!0?(At=kt.color,Ot=kt.emissive,kt.wireframe===!1&&kt.shading==THREE.SmoothShading&&Lt.vertexNormalsLength==4?(W.r=X.r=V.r=$.r=lt.r,W.g=X.g=V.g=$.g=lt.g,W.b=X.b=V.b=$.b=lt.b,c(Lt.v1.positionWorld,Lt.vertexNormalsWorld[0],W),c(Lt.v2.positionWorld,Lt.vertexNormalsWorld[1],X),c(Lt.v4.positionWorld,Lt.vertexNormalsWorld[3],V),c(Lt.v3.positionWorld,Lt.vertexNormalsWorld[2],$),W.r=At.r*W.r+Ot.r,W.g=At.g*W.g+Ot.g,W.b=At.b*W.b+Ot.b,X.r=At.r*X.r+Ot.r,X.g=At.g*X.g+Ot.g,X.b=At.b*X.b+Ot.b,V.r=At.r*V.r+Ot.r,V.g=At.g*V.g+Ot.g,V.b=At.b*V.b+Ot.b,$.r=At.r*$.r+Ot.r,$.g=At.g*$.g+Ot.g,$.b=At.b*$.b+Ot.b,Y=wt(W,X,V,$),m(M,_,D,P,j,F),E(M,_,D,P,j,F,0,0,1,0,0,1,Y),m(I,q,H,B,R,U),E(I,q,H,B,R,U,1,0,1,1,0,1,Y)):(z.r=lt.r,z.g=lt.g,z.b=lt.b,c(Lt.centroidWorld,Lt.normalWorld,z),z.r=At.r*z.r+Ot.r,z.g=At.g*z.g+Ot.g,z.b=At.b*z.b+Ot.b,g(M,_,D,P,H,B,j,F),kt.wireframe===!0?y(z,kt.wireframeLinewidth,kt.wireframeLinecap,kt.wireframeLinejoin):b(z))):(g(M,_,D,P,H,B,j,F),kt.wireframe===!0?y(kt.color,kt.wireframeLinewidth,kt.wireframeLinecap,kt.wireframeLinejoin):b(kt.color)):kt instanceof THREE.MeshBasicMaterial?(g(M,_,D,P,H,B,j,F),kt.wireframe===!0?y(kt.color,kt.wireframeLinewidth,kt.wireframeLinecap,kt.wireframeLinejoin):b(kt.color)):kt instanceof THREE.MeshNormalMaterial?(z.r=St(Lt.normalWorld.x),z.g=St(Lt.normalWorld.y),z.b=St(Lt.normalWorld.z),g(M,_,D,P,H,B,j,F),kt.wireframe===!0?y(z,kt.wireframeLinewidth,kt.wireframeLinecap,kt.wireframeLinejoin):b(z)):kt instanceof THREE.MeshDepthMaterial&&(Q=l.near,G=l.far,W.r=W.g=W.b=1-Et(At.positionScreen.z,Q,G),X.r=X.g=X.b=1-Et(Ot.positionScreen.z,Q,G),V.r=V.g=V.b=1-Et(_t.positionScreen.z,Q,G),$.r=$.g=$.b=1-Et(Mt.positionScreen.z,Q,G),Y=wt(W,X,V,$),m(M,_,D,P,j,F),E(M,_,D,P,j,F,0,0,1,0,0,1,Y),m(I,q,H,B,R,U),E(I,q,H,B,R,U,1,0,1,1,0,1,Y)))));ut.addRectangle(at)}}v.setTransform(1,0,0,1,0,0)}}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform bool useRefract;\nuniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nreflectVec = refract( cameraToVertex, normal, refractionRatio );\n} else { \nreflectVec = reflect( cameraToVertex, normal );\n}\n#else\nreflectVec = vReflect;\n#endif\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n} else {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n#ifdef USE_SKINNING\nvec4 mPosition = modelMatrix * skinned;\n#endif\n#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 mPosition = modelMatrix * vec4( morphed, 1.0 );\n#endif\n#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 mPosition = modelMatrix * vec4( position, 1.0 );\n#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvec3 nWorld = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUv );\nvec2 dSTdy = dFdy( vUv );\nfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\nfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\nfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = dFdx( surf_pos );\nvec3 vSigmaY = dFdy( surf_pos );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = dFdx( eye_pos.xyz );\nvec3 q1 = dFdy( eye_pos.xyz );\nvec2 st0 = dFdx( vUv.st );\nvec2 st1 = dFdy( vUv.st );\nvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\nvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n#ifdef DOUBLE_SIDED\nvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n#endif\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvWorldPosition = mPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -viewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );\nvec3 lVector = normalize( lPosition.xyz + vViewPosition.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += diffuse * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\nvec3 lVectorGround = normalize( -lPosition.xyz + vViewPosition.xyz );\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;\nmat4 getBoneMatrix( const in float i ) {\nfloat j = i * 4.0;\nfloat x = mod( j, N_BONE_PIXEL_X );\nfloat y = floor( j / N_BONE_PIXEL_X );\nconst float dx = 1.0 / N_BONE_PIXEL_X;\nconst float dy = 1.0 / N_BONE_PIXEL_Y;\ny = dy * ( y + 0.5 );\nvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\nvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\nvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\nvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\nmat4 bone = mat4( v1, v2, v3, v4 );\nreturn bone;\n}\n#else\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\nmat4 getBoneMatrix( const in float i ) {\nmat4 bone = boneGlobalMatrices[ int(i) ];\nreturn bone;\n}\n#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\nmat4 boneMatX = getBoneMatrix( skinIndex.x );\nmat4 boneMatY = getBoneMatrix( skinIndex.y );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n#ifdef USE_MORPHTARGETS\nvec4 skinVertex = vec4( morphed, 1.0 );\n#else\nvec4 skinVertex = vec4( position, 1.0 );\n#endif\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\nmvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\nmat4 skinMatrix = skinWeight.x * boneMatX;\nskinMatrix 	+= skinWeight.y * boneMatY;\n#ifdef USE_MORPHNORMALS\nvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n#else\nvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\nobjectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\nobjectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\nobjectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * mPosition;\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},THREE.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++){r=this.clone(e[t]);for(n in r)i[n]=r[n]}return i},clone:function(e){var t,n,r,i={};for(t in e){i[t]={};for(n in e[t])r=e[t][n],i[t][n]=r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?r.clone():r instanceof Array?r.slice():r}return i}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightPosition:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngle:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalMatrix * normal;\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,"#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = transformedNormal;",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},THREE.WebGLRenderer=function(e){function t(e,t){var n=e.vertices.length,r=t.material;if(r.attributes){e.__webglCustomAttributesList===void 0&&(e.__webglCustomAttributesList=[]);for(var i in r.attributes){var s=r.attributes[i];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var o=1;s.type==="v2"?o=2:s.type==="v3"?o=3:s.type==="v4"?o=4:s.type==="c"&&(o=3),s.size=o,s.array=new Float32Array(n*o),s.buffer=Et.createBuffer(),s.buffer.belongsToAttribute=i,s.needsUpdate=!0}e.__webglCustomAttributesList.push(s)}}}function n(e,t){if(!(!e.material||e.material instanceof THREE.MeshFaceMaterial))return e.material;if(t.materialIndex>=0)return e.geometry.materials[t.materialIndex]}function r(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:e&&e.shading!==void 0&&e.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function i(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof THREE.ShaderMaterial?!0:!1}function s(e){var t,n,r;for(t in e.attributes)r=t==="index"?Et.ELEMENT_ARRAY_BUFFER:Et.ARRAY_BUFFER,n=e.attributes[t],n.buffer=Et.createBuffer(),Et.bindBuffer(r,n.buffer),Et.bufferData(r,n.array,Et.STATIC_DRAW)}function o(e,t,n){var r,i,s,o,u=e.vertices;o=u.length;var a=e.colors,f=a.length,l=e.__vertexArray,c=e.__colorArray,h=e.__sortArray,p=e.verticesNeedUpdate,d=e.colorsNeedUpdate,v=e.__webglCustomAttributesList;if(n.sortParticles){mt.copy(vt),mt.multiplySelf(n.matrixWorld);for(r=0;r<o;r++)i=u[r],gt.copy(i),mt.multiplyVector3(gt),h[r]=[gt.z,r];h.sort(function(e,t){return t[0]-e[0]});for(r=0;r<o;r++)i=u[h[r][1]],s=r*3,l[s]=i.x,l[s+1]=i.y,l[s+2]=i.z;for(r=0;r<f;r++)s=r*3,i=a[h[r][1]],c[s]=i.r,c[s+1]=i.g,c[s+2]=i.b;if(v){a=0;for(f=v.length;a<f;a++){u=v[a];if(u.boundTo===void 0||u.boundTo==="vertices"){s=0,i=u.value.length;if(u.size===1)for(r=0;r<i;r++)o=h[r][1],u.array[r]=u.value[o];else if(u.size===2)for(r=0;r<i;r++)o=h[r][1],o=u.value[o],u.array[s]=o.x,u.array[s+1]=o.y,s+=2;else if(u.size===3)if(u.type==="c")for(r=0;r<i;r++)o=h[r][1],o=u.value[o],u.array[s]=o.r,u.array[s+1]=o.g,u.array[s+2]=o.b,s+=3;else for(r=0;r<i;r++)o=h[r][1],o=u.value[o],u.array[s]=o.x,u.array[s+1]=o.y,u.array[s+2]=o.z,s+=3;else if(u.size===4)for(r=0;r<i;r++)o=h[r][1],o=u.value[o],u.array[s]=o.x,u.array[s+1]=o.y,u.array[s+2]=o.z,u.array[s+3]=o.w,s+=4}}}}else{if(p)for(r=0;r<o;r++)i=u[r],s=r*3,l[s]=i.x,l[s+1]=i.y,l[s+2]=i.z;if(d)for(r=0;r<f;r++)i=a[r],s=r*3,c[s]=i.r,c[s+1]=i.g,c[s+2]=i.b;if(v){a=0;for(f=v.length;a<f;a++){u=v[a];if(u.needsUpdate&&(u.boundTo===void 0||u.boundTo==="vertices")){i=u.value.length,s=0;if(u.size===1)for(r=0;r<i;r++)u.array[r]=u.value[r];else if(u.size===2)for(r=0;r<i;r++)o=u.value[r],u.array[s]=o.x,u.array[s+1]=o.y,s+=2;else if(u.size===3)if(u.type==="c")for(r=0;r<i;r++)o=u.value[r],u.array[s]=o.r,u.array[s+1]=o.g,u.array[s+2]=o.b,s+=3;else for(r=0;r<i;r++)o=u.value[r],u.array[s]=o.x,u.array[s+1]=o.y,u.array[s+2]=o.z,s+=3;else if(u.size===4)for(r=0;r<i;r++)o=u.value[r],u.array[s]=o.x,u.array[s+1]=o.y,u.array[s+2]=o.z,u.array[s+3]=o.w,s+=4}}}}if(p||n.sortParticles)Et.bindBuffer(Et.ARRAY_BUFFER,e.__webglVertexBuffer),Et.bufferData(Et.ARRAY_BUFFER,l,t);if(d||n.sortParticles)Et.bindBuffer(Et.ARRAY_BUFFER,e.__webglColorBuffer),Et.bufferData(Et.ARRAY_BUFFER,c,t);if(v){a=0;for(f=v.length;a<f;a++){u=v[a];if(u.needsUpdate||n.sortParticles)Et.bindBuffer(Et.ARRAY_BUFFER,u.buffer),Et.bufferData(Et.ARRAY_BUFFER,u.array,t)}}}function u(e,t,n){var r=e.attributes,i=r.index,s=r.position,o=r.normal,u=r.uv,a=r.color,r=r.tangent;e.elementsNeedUpdate&&i!==void 0&&(Et.bindBuffer(Et.ELEMENT_ARRAY_BUFFER,i.buffer),Et.bufferData(Et.ELEMENT_ARRAY_BUFFER,i.array,t)),e.verticesNeedUpdate&&s!==void 0&&(Et.bindBuffer(Et.ARRAY_BUFFER,s.buffer),Et.bufferData(Et.ARRAY_BUFFER,s.array,t)),e.normalsNeedUpdate&&o!==void 0&&(Et.bindBuffer(Et.ARRAY_BUFFER,o.buffer),Et.bufferData(Et.ARRAY_BUFFER,o.array,t)),e.uvsNeedUpdate&&u!==void 0&&(Et.bindBuffer(Et.ARRAY_BUFFER,u.buffer),Et.bufferData(Et.ARRAY_BUFFER,u.array,t)),e.colorsNeedUpdate&&a!==void 0&&(Et.bindBuffer(Et.ARRAY_BUFFER,a.buffer),Et.bufferData(Et.ARRAY_BUFFER,a.array,t)),e.tangentsNeedUpdate&&r!==void 0&&(Et.bindBuffer(Et.ARRAY_BUFFER,r.buffer),Et.bufferData(Et.ARRAY_BUFFER,r.array,t));if(n)for(var f in e.attributes)delete e.attributes[f].array}function a(e,t){return t.z-e.z}function f(e,t){return t[1]-e[1]}function l(e,t,n){if(e.length)for(var r=0,i=e.length;r<i;r++)$=z=null,X=V=G=Q=rt=nt=Y=-1,bt=!0,e[r].render(t,n,ht,pt),$=z=null,X=V=G=Q=rt=nt=Y=-1,bt=!0}function c(e,t,n,r,i,s,o,u){var a,f,l,c;t?(f=e.length-1,c=t=-1):(f=0,t=e.length,c=1);for(var h=f;h!==t;h+=c){a=e[h];if(a.render){f=a.object,l=a.buffer;if(u)a=u;else{a=a[n];if(!a)continue;o&&q.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst),q.setDepthTest(a.depthTest),q.setDepthWrite(a.depthWrite),x(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}q.setMaterialFaces(a),l instanceof THREE.BufferGeometry?q.renderBufferDirect(r,i,s,a,l,f):q.renderBuffer(r,i,s,a,l,f)}}}function h(e,t,n,r,i,s,o){for(var u,a,f=0,l=e.length;f<l;f++){u=e[f],a=u.object;if(a.visible){if(o)u=o;else{u=u[t];if(!u)continue;s&&q.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),q.setDepthTest(u.depthTest),q.setDepthWrite(u.depthWrite),x(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}q.renderImmediateObject(n,r,i,u,a)}}}function p(e,t,n){e.push({buffer:t,object:n,opaque:null,transparent:null})}function d(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function v(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function m(e,t){for(var n=e.length-1;n>=0;n--)e[n].object===t&&e.splice(n,1)}function g(e,t){for(var n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1)}function y(e,t,n,r,i){K=0,r.needsUpdate&&(r.program&&q.deallocateMaterial(r),q.initMaterial(r,t,n,i),r.needsUpdate=!1),r.morphTargets&&!i.__webglMorphTargetInfluences&&(i.__webglMorphTargetInfluences=new Float32Array(q.maxMorphTargets));var s=!1,o=r.program,u=o.uniforms,a=r.uniforms;o!==z&&(Et.useProgram(o),z=o,s=!0),r.id!==X&&(X=r.id,s=!0);if(s||e!==$)Et.uniformMatrix4fv(u.projectionMatrix,!1,e._projectionMatrixArray),e!==$&&($=e);if(r.skinning)if(At&&i.useVertexTexture){if(u.boneTexture!==null){var f=b();Et.uniform1i(u.boneTexture,f),q.setTexture(i.boneTexture,f)}}else u.boneGlobalMatrices!==null&&Et.uniformMatrix4fv(u.boneGlobalMatrices,!1,i.boneMatrices);if(s){n&&r.fog&&(a.fogColor.value=n.color,n instanceof THREE.Fog?(a.fogNear.value=n.near,a.fogFar.value=n.far):n instanceof THREE.FogExp2&&(a.fogDensity.value=n.density));if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(bt){for(var l=0,c=0,h=0,p,d,v,m,g=wt,y=g.directional.colors,w=g.directional.positions,x=g.point.colors,T=g.point.positions,N=g.point.distances,k=g.spot.colors,L=g.spot.positions,M=g.spot.distances,_=g.spot.directions,D=g.spot.angles,P=g.spot.exponents,H=g.hemi.skyColors,B=g.hemi.groundColors,j=g.hemi.positions,F=0,I=0,R=0,U=0,n=p=v=v=d=0,s=t.length;n<s;n++)f=t[n],!f.onlyShadow&&f.visible&&(p=f.color,m=f.intensity,d=f.distance,f instanceof THREE.AmbientLight?q.gammaInput?(l+=p.r*p.r,c+=p.g*p.g,h+=p.b*p.b):(l+=p.r,c+=p.g,h+=p.b):f instanceof THREE.DirectionalLight?(d=F*3,q.gammaInput?E(y,d,p,m*m):S(y,d,p,m),yt.copy(f.matrixWorld.getPosition()),yt.subSelf(f.target.matrixWorld.getPosition()),yt.normalize(),w[d]=yt.x,w[d+1]=yt.y,w[d+2]=yt.z,F+=1):f instanceof THREE.PointLight?(v=I*3,q.gammaInput?E(x,v,p,m*m):S(x,v,p,m),m=f.matrixWorld.getPosition(),T[v]=m.x,T[v+1]=m.y,T[v+2]=m.z,N[I]=d,I+=1):f instanceof THREE.SpotLight?(v=R*3,q.gammaInput?E(k,v,p,m*m):S(k,v,p,m),m=f.matrixWorld.getPosition(),L[v]=m.x,L[v+1]=m.y,L[v+2]=m.z,M[R]=d,yt.copy(m),yt.subSelf(f.target.matrixWorld.getPosition()),yt.normalize(),_[v]=yt.x,_[v+1]=yt.y,_[v+2]=yt.z,D[R]=Math.cos(f.angle),P[R]=f.exponent,R+=1):f instanceof THREE.HemisphereLight&&(d=f.color,v=f.groundColor,p=U*3,q.gammaInput?(m*=m,E(H,p,d,m),E(B,p,v,m)):(S(H,p,d,m),S(B,p,v,m)),m=f.matrixWorld.getPosition(),j[p]=m.x,j[p+1]=m.y,j[p+2]=m.z,U+=1));n=F*3;for(s=y.length;n<s;n++)y[n]=0;n=I*3;for(s=x.length;n<s;n++)x[n]=0;n=R*3;for(s=k.length;n<s;n++)k[n]=0;n=U*3;for(s=H.length;n<s;n++)H[n]=0;n=U*3;for(s=B.length;n<s;n++)B[n]=0;g.directional.length=F,g.point.length=I,g.spot.length=R,g.hemi.length=U,g.ambient[0]=l,g.ambient[1]=c,g.ambient[2]=h,bt=!1}n=wt,a.ambientLightColor.value=n.ambient,a.directionalLightColor.value=n.directional.colors,a.directionalLightDirection.value=n.directional.positions,a.pointLightColor.value=n.point.colors,a.pointLightPosition.value=n.point.positions,a.pointLightDistance.value=n.point.distances,a.spotLightColor.value=n.spot.colors,a.spotLightPosition.value=n.spot.positions,a.spotLightDistance.value=n.spot.distances,a.spotLightDirection.value=n.spot.directions,a.spotLightAngle.value=n.spot.angles,a.spotLightExponent.value=n.spot.exponents,a.hemisphereLightSkyColor.value=n.hemi.skyColors,a.hemisphereLightGroundColor.value=n.hemi.groundColors,a.hemisphereLightPosition.value=n.hemi.positions}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial){a.opacity.value=r.opacity,q.gammaInput?a.diffuse.value.copyGammaToLinear(r.color):a.diffuse.value=r.color,a.map.value=r.map,a.lightMap.value=r.lightMap,a.specularMap.value=r.specularMap,r.bumpMap&&(a.bumpMap.value=r.bumpMap,a.bumpScale.value=r.bumpScale),r.normalMap&&(a.normalMap.value=r.normalMap,a.normalScale.value.copy(r.normalScale));var W;r.map?W=r.map:r.specularMap?W=r.specularMap:r.normalMap?W=r.normalMap:r.bumpMap&&(W=r.bumpMap),W!==void 0&&(n=W.offset,W=W.repeat,a.offsetRepeat.value.set(n.x,n.y,W.x,W.y)),a.envMap.value=r.envMap,a.flipEnvMap.value=r.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,a.reflectivity.value=r.reflectivity,a.refractionRatio.value=r.refractionRatio,a.combine.value=r.combine,a.useRefract.value=r.envMap&&r.envMap.mapping instanceof THREE.CubeRefractionMapping}r instanceof THREE.LineBasicMaterial?(a.diffuse.value=r.color,a.opacity.value=r.opacity):r instanceof THREE.ParticleBasicMaterial?(a.psColor.value=r.color,a.opacity.value=r.opacity,a.size.value=r.size,a.scale.value=O.height/2,a.map.value=r.map):r instanceof THREE.MeshPhongMaterial?(a.shininess.value=r.shininess,q.gammaInput?(a.ambient.value.copyGammaToLinear(r.ambient),a.emissive.value.copyGammaToLinear(r.emissive),a.specular.value.copyGammaToLinear(r.specular)):(a.ambient.value=r.ambient,a.emissive.value=r.emissive,a.specular.value=r.specular),r.wrapAround&&a.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshLambertMaterial?(q.gammaInput?(a.ambient.value.copyGammaToLinear(r.ambient),a.emissive.value.copyGammaToLinear(r.emissive)):(a.ambient.value=r.ambient,a.emissive.value=r.emissive),r.wrapAround&&a.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshDepthMaterial?(a.mNear.value=e.near,a.mFar.value=e.far,a.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(a.opacity.value=r.opacity);if(i.receiveShadow&&!r._shadowPass&&a.shadowMatrix){n=W=0;for(s=t.length;n<s;n++)f=t[n],f.castShadow&&(f instanceof THREE.SpotLight||f instanceof THREE.DirectionalLight&&!f.shadowCascade)&&(a.shadowMap.value[W]=f.shadowMap,a.shadowMapSize.value[W]=f.shadowMapSize,a.shadowMatrix.value[W]=f.shadowMatrix,a.shadowDarkness.value[W]=f.shadowDarkness,a.shadowBias.value[W]=f.shadowBias,W++)}t=r.uniformsList,a=0;for(W=t.length;a<W;a++)if(s=o.uniforms[t[a][1]]){n=t[a][0],l=n.type,f=n.value;if(l==="i")Et.uniform1i(s,f);else if(l==="f")Et.uniform1f(s,f);else if(l==="v2")Et.uniform2f(s,f.x,f.y);else if(l==="v3")Et.uniform3f(s,f.x,f.y,f.z);else if(l==="v4")Et.uniform4f(s,f.x,f.y,f.z,f.w);else if(l==="c")Et.uniform3f(s,f.r,f.g,f.b);else if(l==="iv1")Et.uniform1iv(s,f);else if(l==="iv")Et.uniform3iv(s,f);else if(l==="fv1")Et.uniform1fv(s,f);else if(l==="fv")Et.uniform3fv(s,f);else if(l==="v2v"){n._array===void 0&&(n._array=new Float32Array(2*f.length)),l=0;for(c=f.length;l<c;l++)h=l*2,n._array[h]=f[l].x,n._array[h+1]=f[l].y;Et.uniform2fv(s,n._array)}else if(l==="v3v"){n._array===void 0&&(n._array=new Float32Array(3*f.length)),l=0;for(c=f.length;l<c;l++)h=l*3,n._array[h]=f[l].x,n._array[h+1]=f[l].y,n._array[h+2]=f[l].z;Et.uniform3fv(s,n._array)}else if(l==="v4v"){n._array===void 0&&(n._array=new Float32Array(4*f.length)),l=0;for(c=f.length;l<c;l++)h=l*4,n._array[h]=f[l].x,n._array[h+1]=f[l].y,n._array[h+2]=f[l].z,n._array[h+3]=f[l].w;Et.uniform4fv(s,n._array)}else if(l==="m4")n._array===void 0&&(n._array=new Float32Array(16)),f.flattenToArray(n._array),Et.uniformMatrix4fv(s,!1,n._array);else if(l==="m4v"){n._array===void 0&&(n._array=new Float32Array(16*f.length)),l=0;for(c=f.length;l<c;l++)f[l].flattenToArrayOffset(n._array,l*16);Et.uniformMatrix4fv(s,!1,n._array)}else if(l==="t"){h=f,f=b(),Et.uniform1i(s,f);if(h)if(h.image instanceof Array&&h.image.length===6){n=h,s=f;if(n.image.length===6)if(n.needsUpdate){n.image.__webglTextureCube||(n.image.__webglTextureCube=Et.createTexture()),Et.activeTexture(Et.TEXTURE0+s),Et.bindTexture(Et.TEXTURE_CUBE_MAP,n.image.__webglTextureCube),Et.pixelStorei(Et.UNPACK_FLIP_Y_WEBGL,n.flipY),s=n instanceof THREE.CompressedTexture,f=[];for(l=0;l<6;l++)q.autoScaleCubemaps&&!s?(c=f,h=l,g=n.image[l],w=Ct,g.width<=w&&g.height<=w||(x=Math.max(g.width,g.height),y=Math.floor(g.width*w/x),w=Math.floor(g.height*w/x),x=document.createElement("canvas"),x.width=y,x.height=w,x.getContext("2d").drawImage(g,0,0,g.width,g.height,0,0,y,w),g=x),c[h]=g):f[l]=n.image[l];l=f[0],c=(l.width&l.width-1)===0&&(l.height&l.height-1)===0,h=A(n.format),g=A(n.type),C(Et.TEXTURE_CUBE_MAP,n,c);for(l=0;l<6;l++)if(s){w=f[l].mipmaps,x=0;for(T=w.length;x<T;x++)y=w[x],Et.compressedTexImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+l,x,h,y.width,y.height,0,y.data)}else Et.texImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,h,h,g,f[l]);n.generateMipmaps&&c&&Et.generateMipmap(Et.TEXTURE_CUBE_MAP),n.needsUpdate=!1,n.onUpdate&&n.onUpdate()}else Et.activeTexture(Et.TEXTURE0+s),Et.bindTexture(Et.TEXTURE_CUBE_MAP,n.image.__webglTextureCube)}else h instanceof THREE.WebGLRenderTargetCube?(n=h,Et.activeTexture(Et.TEXTURE0+f),Et.bindTexture(Et.TEXTURE_CUBE_MAP,n.__webglTexture)):q.setTexture(h,f)}else if(l==="tv"){n._array===void 0&&(n._array=[]),l=0;for(c=n.value.length;l<c;l++)n._array[l]=b();Et.uniform1iv(s,n._array),l=0;for(c=n.value.length;l<c;l++)h=n.value[l],f=n._array[l],h&&q.setTexture(h,f)}}(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&u.cameraPosition!==null&&(t=e.matrixWorld.getPosition(),Et.uniform3f(u.cameraPosition,t.x,t.y,t.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&u.viewMatrix!==null&&Et.uniformMatrix4fv(u.viewMatrix,!1,e._viewMatrixArray)}return Et.uniformMatrix4fv(u.modelViewMatrix,!1,i._modelViewMatrix.elements),u.normalMatrix&&Et.uniformMatrix3fv(u.normalMatrix,!1,i._normalMatrix.elements),u.modelMatrix!==null&&Et.uniformMatrix4fv(u.modelMatrix,!1,i.matrixWorld.elements),o}function b(){var e=K;return e>=Nt&&console.warn("Trying to use "+e+" texture units while this GPU supports only "+Nt),K+=1,e}function w(e,t){e._modelViewMatrix.multiply(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}function E(e,t,n,r){e[t]=n.r*n.r*r,e[t+1]=n.g*n.g*r,e[t+2]=n.b*n.b*r}function S(e,t,n,r){e[t]=n.r*r,e[t+1]=n.g*r,e[t+2]=n.b*r}function x(e,t,n){it!==e&&(e?Et.enable(Et.POLYGON_OFFSET_FILL):Et.disable(Et.POLYGON_OFFSET_FILL),it=e),e&&(st!==t||ot!==n)&&(Et.polygonOffset(t,n),st=t,ot=n)}function T(e){for(var e=e.split("\n"),t=0,n=e.length;t<n;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function N(e,t){var n;return e==="fragment"?n=Et.createShader(Et.FRAGMENT_SHADER):e==="vertex"&&(n=Et.createShader(Et.VERTEX_SHADER)),Et.shaderSource(n,t),Et.compileShader(n),Et.getShaderParameter(n,Et.COMPILE_STATUS)?n:(console.error(Et.getShaderInfoLog(n)),console.error(T(t)),null)}function C(e,t,n){n?(Et.texParameteri(e,Et.TEXTURE_WRAP_S,A(t.wrapS)),Et.texParameteri(e,Et.TEXTURE_WRAP_T,A(t.wrapT)),Et.texParameteri(e,Et.TEXTURE_MAG_FILTER,A(t.magFilter)),Et.texParameteri(e,Et.TEXTURE_MIN_FILTER,A(t.minFilter))):(Et.texParameteri(e,Et.TEXTURE_WRAP_S,Et.CLAMP_TO_EDGE),Et.texParameteri(e,Et.TEXTURE_WRAP_T,Et.CLAMP_TO_EDGE),Et.texParameteri(e,Et.TEXTURE_MAG_FILTER,L(t.magFilter)),Et.texParameteri(e,Et.TEXTURE_MIN_FILTER,L(t.minFilter))),St&&t.type!==THREE.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(Et.texParameterf(e,St.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,kt)),t.__oldAnisotropy=t.anisotropy)}function k(e,t){Et.bindRenderbuffer(Et.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Et.renderbufferStorage(Et.RENDERBUFFER,Et.DEPTH_COMPONENT16,t.width,t.height),Et.framebufferRenderbuffer(Et.FRAMEBUFFER,Et.DEPTH_ATTACHMENT,Et.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Et.renderbufferStorage(Et.RENDERBUFFER,Et.DEPTH_STENCIL,t.width,t.height),Et.framebufferRenderbuffer(Et.FRAMEBUFFER,Et.DEPTH_STENCIL_ATTACHMENT,Et.RENDERBUFFER,e)):Et.renderbufferStorage(Et.RENDERBUFFER,Et.RGBA4,t.width,t.height)}function L(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?Et.NEAREST:Et.LINEAR}function A(e){if(e===THREE.RepeatWrapping)return Et.REPEAT;if(e===THREE.ClampToEdgeWrapping)return Et.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return Et.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return Et.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return Et.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return Et.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return Et.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return Et.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return Et.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return Et.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return Et.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return Et.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return Et.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return Et.BYTE;if(e===THREE.ShortType)return Et.SHORT;if(e===THREE.UnsignedShortType)return Et.UNSIGNED_SHORT;if(e===THREE.IntType)return Et.INT;if(e===THREE.UnsignedIntType)return Et.UNSIGNED_INT;if(e===THREE.FloatType)return Et.FLOAT;if(e===THREE.AlphaFormat)return Et.ALPHA;if(e===THREE.RGBFormat)return Et.RGB;if(e===THREE.RGBAFormat)return Et.RGBA;if(e===THREE.LuminanceFormat)return Et.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return Et.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return Et.FUNC_ADD;if(e===THREE.SubtractEquation)return Et.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return Et.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return Et.ZERO;if(e===THREE.OneFactor)return Et.ONE;if(e===THREE.SrcColorFactor)return Et.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return Et.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return Et.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return Et.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return Et.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return Et.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return Et.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return Et.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return Et.SRC_ALPHA_SATURATE;if(xt!==void 0){if(e===THREE.RGB_S3TC_DXT1_Format)return xt.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return xt.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return xt.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return xt.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);var e=e||{},O=e.canvas!==void 0?e.canvas:document.createElement("canvas"),M=e.precision!==void 0?e.precision:"highp",_=e.alpha!==void 0?e.alpha:!0,D=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,P=e.antialias!==void 0?e.antialias:!1,H=e.stencil!==void 0?e.stencil:!0,B=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,j=e.clearColor!==void 0?new THREE.Color(e.clearColor):new THREE.Color(0),F=e.clearAlpha!==void 0?e.clearAlpha:0,I=e.maxLights!==void 0?e.maxLights:4;this.domElement=O,this.context=null,this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapCullFrontFaces=this.shadowMapSoft=this.shadowMapAutoUpdate=!0,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var q=this,R=[],U=0,z=null,W=null,X=-1,V=null,$=null,J=0,K=0,Q=-1,G=-1,Y=-1,Z=-1,et=-1,tt=-1,nt=-1,rt=-1,it=null,st=null,ot=null,ut=null,at=0,ft=0,lt=0,ct=0,ht=0,pt=0,dt=new THREE.Frustum,vt=new THREE.Matrix4,mt=new THREE.Matrix4,gt=new THREE.Vector4,yt=new THREE.Vector3,bt=!0,wt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],angles:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},Et,St,xt;try{if(!(Et=O.getContext("experimental-webgl",{alpha:_,premultipliedAlpha:D,antialias:P,stencil:H,preserveDrawingBuffer:B})))throw"Error creating WebGL context."}catch(Tt){console.error(Tt)}e=Et.getExtension("OES_texture_float"),_=Et.getExtension("OES_standard_derivatives"),St=Et.getExtension("EXT_texture_filter_anisotropic")||Et.getExtension("MOZ_EXT_texture_filter_anisotropic")||Et.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),xt=Et.getExtension("WEBGL_compressed_texture_s3tc")||Et.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Et.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),e||console.log("THREE.WebGLRenderer: Float textures not supported."),_||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),St||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),xt||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),Et.clearColor(0,0,0,1),Et.clearDepth(1),Et.clearStencil(0),Et.enable(Et.DEPTH_TEST),Et.depthFunc(Et.LEQUAL),Et.frontFace(Et.CCW),Et.cullFace(Et.BACK),Et.enable(Et.CULL_FACE),Et.enable(Et.BLEND),Et.blendEquation(Et.FUNC_ADD),Et.blendFunc(Et.SRC_ALPHA,Et.ONE_MINUS_SRC_ALPHA),Et.clearColor(j.r,j.g,j.b,F),this.context=Et;var Nt=Et.getParameter(Et.MAX_TEXTURE_IMAGE_UNITS),_=Et.getParameter(Et.MAX_VERTEX_TEXTURE_IMAGE_UNITS);Et.getParameter(Et.MAX_TEXTURE_SIZE);var Ct=Et.getParameter(Et.MAX_CUBE_MAP_TEXTURE_SIZE),kt=St?Et.getParameter(St.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Lt=_>0,At=Lt&&e;xt&&Et.getParameter(Et.COMPRESSED_TEXTURE_FORMATS),this.getContext=function(){return Et},this.supportsVertexTextures=function(){return Lt},this.getMaxAnisotropy=function(){return kt},this.setSize=function(e,t){O.width=e,O.height=t,this.setViewport(0,0,O.width,O.height)},this.setViewport=function(e,t,n,r){at=e!==void 0?e:0,ft=t!==void 0?t:0,lt=n!==void 0?n:O.width,ct=r!==void 0?r:O.height,Et.viewport(at,ft,lt,ct)},this.setScissor=function(e,t,n,r){Et.scissor(e,t,n,r)},this.enableScissorTest=function(e){e?Et.enable(Et.SCISSOR_TEST):Et.disable(Et.SCISSOR_TEST)},this.setClearColorHex=function(e,t){j.setHex(e),F=t,Et.clearColor(j.r,j.g,j.b,F)},this.setClearColor=function(e,t){j.copy(e),F=t,Et.clearColor(j.r,j.g,j.b,F)},this.getClearColor=function(){return j},this.getClearAlpha=function(){return F},this.clear=function(e,t,n){var r=0;if(e===void 0||e)r|=Et.COLOR_BUFFER_BIT;if(t===void 0||t)r|=Et.DEPTH_BUFFER_BIT;if(n===void 0||n)r|=Et.STENCIL_BUFFER_BIT;Et.clear(r)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.deallocateObject=function(e){if(e.__webglInit){e.__webglInit=!1,delete e._modelViewMatrix,delete e._normalMatrix,delete e._normalMatrixArray,delete e._modelViewMatrixArray,delete e._modelMatrixArray;if(e instanceof THREE.Mesh)for(var t in e.geometry.geometryGroups){var n=e.geometry.geometryGroups[t];Et.deleteBuffer(n.__webglVertexBuffer),Et.deleteBuffer(n.__webglNormalBuffer),Et.deleteBuffer(n.__webglTangentBuffer),Et.deleteBuffer(n.__webglColorBuffer),Et.deleteBuffer(n.__webglUVBuffer),Et.deleteBuffer(n.__webglUV2Buffer),Et.deleteBuffer(n.__webglSkinIndicesBuffer),Et.deleteBuffer(n.__webglSkinWeightsBuffer),Et.deleteBuffer(n.__webglFaceBuffer),Et.deleteBuffer(n.__webglLineBuffer);var r=void 0,i=void 0;if(n.numMorphTargets){r=0;for(i=n.numMorphTargets;r<i;r++)Et.deleteBuffer(n.__webglMorphTargetsBuffers[r])}if(n.numMorphNormals){r=0;for(i=n.numMorphNormals;r<i;r++)Et.deleteBuffer(n.__webglMorphNormalsBuffers[r])}if(n.__webglCustomAttributesList){r=void 0;for(r in n.__webglCustomAttributesList)Et.deleteBuffer(n.__webglCustomAttributesList[r].buffer)}q.info.memory.geometries--}else e instanceof THREE.Ribbon?(e=e.geometry,Et.deleteBuffer(e.__webglVertexBuffer),Et.deleteBuffer(e.__webglColorBuffer),q.info.memory.geometries--):e instanceof THREE.Line?(e=e.geometry,Et.deleteBuffer(e.__webglVertexBuffer),Et.deleteBuffer(e.__webglColorBuffer),q.info.memory.geometries--):e instanceof THREE.ParticleSystem&&(e=e.geometry,Et.deleteBuffer(e.__webglVertexBuffer),Et.deleteBuffer(e.__webglColorBuffer),q.info.memory.geometries--)}},this.deallocateTexture=function(e){e.__webglInit&&(e.__webglInit=!1,Et.deleteTexture(e.__webglTexture),q.info.memory.textures--)},this.deallocateRenderTarget=function(e){if(e&&e.__webglTexture){Et.deleteTexture(e.__webglTexture);if(e instanceof THREE.WebGLRenderTargetCube)for(var t=0;t<6;t++)Et.deleteFramebuffer(e.__webglFramebuffer[t]),Et.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Et.deleteFramebuffer(e.__webglFramebuffer),Et.deleteRenderbuffer(e.__webglRenderbuffer)}},this.deallocateMaterial=function(e){var t=e.program;if(t){e.program=void 0;var n,r,i=!1,e=0;for(n=R.length;e<n;e++){r=R[e];if(r.program===t){r.usedTimes--,r.usedTimes===0&&(i=!0);break}}if(i){i=[],e=0;for(n=R.length;e<n;e++)r=R[e],r.program!==t&&i.push(r);R=i,Et.deleteProgram(t),q.info.memory.programs--}}},this.updateShadowMap=function(e,t){z=null,X=V=rt=nt=Y=-1,bt=!0,G=Q=-1,this.shadowMapPlugin.update(e,t)},this.renderBufferImmediate=function(e,t,n){e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Et.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Et.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Et.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Et.createBuffer()),e.hasPositions&&(Et.bindBuffer(Et.ARRAY_BUFFER,e.__webglVertexBuffer),Et.bufferData(Et.ARRAY_BUFFER,e.positionArray,Et.DYNAMIC_DRAW),Et.enableVertexAttribArray(t.attributes.position),Et.vertexAttribPointer(t.attributes.position,3,Et.FLOAT,!1,0,0));if(e.hasNormals){Et.bindBuffer(Et.ARRAY_BUFFER,e.__webglNormalBuffer);if(n.shading===THREE.FlatShading){var r,i,s,o,u,a,f,l,c,h,p,d=e.count*3;for(p=0;p<d;p+=9)h=e.normalArray,r=h[p],i=h[p+1],s=h[p+2],o=h[p+3],a=h[p+4],l=h[p+5],u=h[p+6],f=h[p+7],c=h[p+8],r=(r+o+u)/3,i=(i+a+f)/3,s=(s+l+c)/3,h[p]=r,h[p+1]=i,h[p+2]=s,h[p+3]=r,h[p+4]=i,h[p+5]=s,h[p+6]=r,h[p+7]=i,h[p+8]=s}Et.bufferData(Et.ARRAY_BUFFER,e.normalArray,Et.DYNAMIC_DRAW),Et.enableVertexAttribArray(t.attributes.normal),Et.vertexAttribPointer(t.attributes.normal,3,Et.FLOAT,!1,0,0)}e.hasUvs&&n.map&&(Et.bindBuffer(Et.ARRAY_BUFFER,e.__webglUvBuffer),Et.bufferData(Et.ARRAY_BUFFER,e.uvArray,Et.DYNAMIC_DRAW),Et.enableVertexAttribArray(t.attributes.uv),Et.vertexAttribPointer(t.attributes.uv,2,Et.FLOAT,!1,0,0)),e.hasColors&&n.vertexColors!==THREE.NoColors&&(Et.bindBuffer(Et.ARRAY_BUFFER,e.__webglColorBuffer),Et.bufferData(Et.ARRAY_BUFFER,e.colorArray,Et.DYNAMIC_DRAW),Et.enableVertexAttribArray(t.attributes.color),Et.vertexAttribPointer(t.attributes.color,3,Et.FLOAT,!1,0,0)),Et.drawArrays(Et.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,s){if(r.visible!==!1){n=y(e,t,n,r,s),e=n.attributes,t=!1,r=i.id*16777215+n.id*2+(r.wireframe?1:0),r!==V&&(V=r,t=!0);if(s instanceof THREE.Mesh){s=i.offsets,s.length>1&&(t=!0),r=0;for(n=s.length;r<n;++r){var o=s[r].index;if(t){var u=i.attributes.position,a=u.itemSize;Et.bindBuffer(Et.ARRAY_BUFFER,u.buffer),Et.vertexAttribPointer(e.position,a,Et.FLOAT,!1,0,o*a*4),u=i.attributes.normal,e.normal>=0&&u&&(a=u.itemSize,Et.bindBuffer(Et.ARRAY_BUFFER,u.buffer),Et.vertexAttribPointer(e.normal,a,Et.FLOAT,!1,0,o*a*4)),u=i.attributes.uv,e.uv>=0&&u&&(u.buffer?(a=u.itemSize,Et.bindBuffer(Et.ARRAY_BUFFER,u.buffer),Et.vertexAttribPointer(e.uv,a,Et.FLOAT,!1,0,o*a*4),Et.enableVertexAttribArray(e.uv)):Et.disableVertexAttribArray(e.uv)),a=i.attributes.color;if(e.color>=0&&a){var f=a.itemSize;Et.bindBuffer(Et.ARRAY_BUFFER,a.buffer),Et.vertexAttribPointer(e.color,f,Et.FLOAT,!1,0,o*f*4)}u=i.attributes.tangent,e.tangent>=0&&u&&(a=u.itemSize,Et.bindBuffer(Et.ARRAY_BUFFER,u.buffer),Et.vertexAttribPointer(e.tangent,a,Et.FLOAT,!1,0,o*a*4)),Et.bindBuffer(Et.ELEMENT_ARRAY_BUFFER,i.attributes.index.buffer)}Et.drawElements(Et.TRIANGLES,s[r].count,Et.UNSIGNED_SHORT,s[r].start*2),q.info.render.calls++,q.info.render.vertices=q.info.render.vertices+s[r].count,q.info.render.faces=q.info.render.faces+s[r].count/3}}else s instanceof THREE.ParticleSystem&&t&&(u=i.attributes.position,a=u.itemSize,Et.bindBuffer(Et.ARRAY_BUFFER,u.buffer),Et.vertexAttribPointer(e.position,a,Et.FLOAT,!1,0,0),a=i.attributes.color,e.color>=0&&a&&(f=a.itemSize,Et.bindBuffer(Et.ARRAY_BUFFER,a.buffer),Et.vertexAttribPointer(e.color,f,Et.FLOAT,!1,0,0)),Et.drawArrays(Et.POINTS,0,u.numItems/3),q.info.render.calls++,q.info.render.points=q.info.render.points+u.numItems/3)}},this.renderBuffer=function(e,t,n,r,i,s){if(r.visible!==!1){var o,u,n=y(e,t,n,r,s),t=n.attributes,e=!1,n=i.id*16777215+n.id*2+(r.wireframe?1:0);n!==V&&(V=n,e=!0);if(!r.morphTargets&&t.position>=0)e&&(Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglVertexBuffer),Et.vertexAttribPointer(t.position,3,Et.FLOAT,!1,0,0));else if(s.morphTargetBase){n=r.program.attributes,s.morphTargetBase!==-1?(Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[s.morphTargetBase]),Et.vertexAttribPointer(n.position,3,Et.FLOAT,!1,0,0)):n.position>=0&&(Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglVertexBuffer),Et.vertexAttribPointer(n.position,3,Et.FLOAT,!1,0,0));if(s.morphTargetForcedOrder.length){var a=0;u=s.morphTargetForcedOrder;for(o=s.morphTargetInfluences;a<r.numSupportedMorphTargets&&a<u.length;)Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[u[a]]),Et.vertexAttribPointer(n["morphTarget"+a],3,Et.FLOAT,!1,0,0),r.morphNormals&&(Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[u[a]]),Et.vertexAttribPointer(n["morphNormal"+a],3,Et.FLOAT,!1,0,0)),s.__webglMorphTargetInfluences[a]=o[u[a]],a++}else{u=[],o=s.morphTargetInfluences;var l,c=o.length;for(l=0;l<c;l++)a=o[l],a>0&&u.push([l,a]);u.length>r.numSupportedMorphTargets?(u.sort(f),u.length=r.numSupportedMorphTargets):u.length>r.numSupportedMorphNormals?u.sort(f):u.length===0&&u.push([0,0]);for(a=0;a<r.numSupportedMorphTargets;)u[a]?(l=u[a][0],Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[l]),Et.vertexAttribPointer(n["morphTarget"+a],3,Et.FLOAT,!1,0,0),r.morphNormals&&(Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[l]),Et.vertexAttribPointer(n["morphNormal"+a],3,Et.FLOAT,!1,0,0)),s.__webglMorphTargetInfluences[a]=o[l]):(Et.vertexAttribPointer(n["morphTarget"+a],3,Et.FLOAT,!1,0,0),r.morphNormals&&Et.vertexAttribPointer(n["morphNormal"+a],3,Et.FLOAT,!1,0,0),s.__webglMorphTargetInfluences[a]=0),a++}r.program.uniforms.morphTargetInfluences!==null&&Et.uniform1fv(r.program.uniforms.morphTargetInfluences,s.__webglMorphTargetInfluences)}if(e){if(i.__webglCustomAttributesList){o=0;for(u=i.__webglCustomAttributesList.length;o<u;o++)n=i.__webglCustomAttributesList[o],t[n.buffer.belongsToAttribute]>=0&&(Et.bindBuffer(Et.ARRAY_BUFFER,n.buffer),Et.vertexAttribPointer(t[n.buffer.belongsToAttribute],n.size,Et.FLOAT,!1,0,0))}t.color>=0&&(Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglColorBuffer),Et.vertexAttribPointer(t.color,3,Et.FLOAT,!1,0,0)),t.normal>=0&&(Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglNormalBuffer),Et.vertexAttribPointer(t.normal,3,Et.FLOAT,!1,0,0)),t.tangent>=0&&(Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglTangentBuffer),Et.vertexAttribPointer(t.tangent,4,Et.FLOAT,!1,0,0)),t.uv>=0&&(i.__webglUVBuffer?(Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglUVBuffer),Et.vertexAttribPointer(t.uv,2,Et.FLOAT,!1,0,0),Et.enableVertexAttribArray(t.uv)):Et.disableVertexAttribArray(t.uv)),t.uv2>=0&&(i.__webglUV2Buffer?(Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglUV2Buffer),Et.vertexAttribPointer(t.uv2,2,Et.FLOAT,!1,0,0),Et.enableVertexAttribArray(t.uv2)):Et.disableVertexAttribArray(t.uv2)),r.skinning&&t.skinIndex>=0&&t.skinWeight>=0&&(Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglSkinIndicesBuffer),Et.vertexAttribPointer(t.skinIndex,4,Et.FLOAT,!1,0,0),Et.bindBuffer(Et.ARRAY_BUFFER,i.__webglSkinWeightsBuffer),Et.vertexAttribPointer(t.skinWeight,4,Et.FLOAT,!1,0,0))}s instanceof THREE.Mesh?(r.wireframe?(r=r.wireframeLinewidth,r!==ut&&(Et.lineWidth(r),ut=r),e&&Et.bindBuffer(Et.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),Et.drawElements(Et.LINES,i.__webglLineCount,Et.UNSIGNED_SHORT,0)):(e&&Et.bindBuffer(Et.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),Et.drawElements(Et.TRIANGLES,i.__webglFaceCount,Et.UNSIGNED_SHORT,0)),q.info.render.calls++,q.info.render.vertices=q.info.render.vertices+i.__webglFaceCount,q.info.render.faces=q.info.render.faces+i.__webglFaceCount/3):s instanceof THREE.Line?(s=s.type===THREE.LineStrip?Et.LINE_STRIP:Et.LINES,r=r.linewidth,r!==ut&&(Et.lineWidth(r),ut=r),Et.drawArrays(s,0,i.__webglLineCount),q.info.render.calls++):s instanceof THREE.ParticleSystem?(Et.drawArrays(Et.POINTS,0,i.__webglParticleCount),q.info.render.calls++,q.info.render.points=q.info.render.points+i.__webglParticleCount):s instanceof THREE.Ribbon&&(Et.drawArrays(Et.TRIANGLE_STRIP,0,i.__webglVertexCount),q.info.render.calls++)}},this.render=function(e,t,n,r){if(t instanceof THREE.Camera==0)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var i,s,o,u,f=e.__lights,p=e.fog;X=-1,bt=!0,this.autoUpdateScene&&e.updateMatrixWorld(),t.parent===void 0&&t.updateMatrixWorld(),t._viewMatrixArray||(t._viewMatrixArray=new Float32Array(16)),t._projectionMatrixArray||(t._projectionMatrixArray=new Float32Array(16)),t.matrixWorldInverse.getInverse(t.matrixWorld),t.matrixWorldInverse.flattenToArray(t._viewMatrixArray),t.projectionMatrix.flattenToArray(t._projectionMatrixArray),vt.multiply(t.projectionMatrix,t.matrixWorldInverse),dt.setFromMatrix(vt),this.autoUpdateObjects&&this.initWebGLObjects(e),l(this.renderPluginsPre,e,t),q.info.render.calls=0,q.info.render.vertices=0,q.info.render.faces=0,q.info.render.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),u=e.__webglObjects,r=0;for(i=u.length;r<i;r++){s=u[r],o=s.object,s.render=!1;if(o.visible&&(!(o instanceof THREE.Mesh||o instanceof THREE.ParticleSystem)||!o.frustumCulled||dt.contains(o))){w(o,t);var d=s,v=d.object,m=d.buffer,g=void 0,g=g=void 0,g=v.material;g instanceof THREE.MeshFaceMaterial?(g=m.materialIndex,g>=0&&(g=v.geometry.materials[g],g.transparent?(d.transparent=g,d.opaque=null):(d.opaque=g,d.transparent=null))):g&&(g.transparent?(d.transparent=g,d.opaque=null):(d.opaque=g,d.transparent=null)),s.render=!0,this.sortObjects===!0&&(o.renderDepth!==null?s.z=o.renderDepth:(gt.copy(o.matrixWorld.getPosition()),vt.multiplyVector3(gt),s.z=gt.z))}}this.sortObjects&&u.sort(a),u=e.__webglObjectsImmediate,r=0;for(i=u.length;r<i;r++)s=u[r],o=s.object,o.visible&&(w(o,t),o=s.object.material,o.transparent?(s.transparent=o,s.opaque=null):(s.opaque=o,s.transparent=null));e.overrideMaterial?(r=e.overrideMaterial,this.setBlending(r.blending,r.blendEquation,r.blendSrc,r.blendDst),this.setDepthTest(r.depthTest),this.setDepthWrite(r.depthWrite),x(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),c(e.__webglObjects,!1,"",t,f,p,!0,r),h(e.__webglObjectsImmediate,"",t,f,p,!1,r)):(this.setBlending(THREE.NormalBlending),c(e.__webglObjects,!0,"opaque",t,f,p,!1),h(e.__webglObjectsImmediate,"opaque",t,f,p,!1),c(e.__webglObjects,!1,"transparent",t,f,p,!0),h(e.__webglObjectsImmediate,"transparent",t,f,p,!0)),l(this.renderPluginsPost,e,t),n&&n.generateMipmaps&&n.minFilter!==THREE.NearestFilter&&n.minFilter!==THREE.LinearFilter&&(n instanceof THREE.WebGLRenderTargetCube?(Et.bindTexture(Et.TEXTURE_CUBE_MAP,n.__webglTexture),Et.generateMipmap(Et.TEXTURE_CUBE_MAP),Et.bindTexture(Et.TEXTURE_CUBE_MAP,null)):(Et.bindTexture(Et.TEXTURE_2D,n.__webglTexture),Et.generateMipmap(Et.TEXTURE_2D),Et.bindTexture(Et.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(e,t,n,r,i){var s=y(e,t,n,r,i);V=-1,q.setMaterialFaces(r),i.immediateRenderCallback?i.immediateRenderCallback(s,Et,dt):i.render(function(e){q.renderBufferImmediate(e,s,r)})},this.initWebGLObjects=function(e){e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);for(;e.__objectsAdded.length;){var a=e.__objectsAdded[0],f=e,l=void 0,c=void 0,h=void 0;if(!a.__webglInit){a.__webglInit=!0,a._modelViewMatrix=new THREE.Matrix4,a._normalMatrix=new THREE.Matrix3;if(a instanceof THREE.Mesh){c=a.geometry;if(c instanceof THREE.Geometry){if(c.geometryGroups===void 0){var y=c,b=void 0,w=void 0,E=void 0,S=void 0,x=void 0,T=void 0,N=void 0,C={},k=y.morphTargets.length,L=y.morphNormals.length;y.geometryGroups={},b=0;for(w=y.faces.length;b<w;b++)E=y.faces[b],S=E.materialIndex,T=S!==void 0?S:-1,C[T]===void 0&&(C[T]={hash:T,counter:0}),N=C[T].hash+"_"+C[T].counter,y.geometryGroups[N]===void 0&&(y.geometryGroups[N]={faces3:[],faces4:[],materialIndex:S,vertices:0,numMorphTargets:k,numMorphNormals:L}),x=E instanceof THREE.Face3?3:4,y.geometryGroups[N].vertices+x>65535&&(C[T].counter=C[T].counter+1,N=C[T].hash+"_"+C[T].counter,y.geometryGroups[N]===void 0&&(y.geometryGroups[N]={faces3:[],faces4:[],materialIndex:S,vertices:0,numMorphTargets:k,numMorphNormals:L})),E instanceof THREE.Face3?y.geometryGroups[N].faces3.push(b):y.geometryGroups[N].faces4.push(b),y.geometryGroups[N].vertices=y.geometryGroups[N].vertices+x;y.geometryGroupsList=[];var A=void 0;for(A in y.geometryGroups)y.geometryGroups[A].id=J++,y.geometryGroupsList.push(y.geometryGroups[A])}for(l in c.geometryGroups){h=c.geometryGroups[l];if(!h.__webglVertexBuffer){var O=h;O.__webglVertexBuffer=Et.createBuffer(),O.__webglNormalBuffer=Et.createBuffer(),O.__webglTangentBuffer=Et.createBuffer(),O.__webglColorBuffer=Et.createBuffer(),O.__webglUVBuffer=Et.createBuffer(),O.__webglUV2Buffer=Et.createBuffer(),O.__webglSkinIndicesBuffer=Et.createBuffer(),O.__webglSkinWeightsBuffer=Et.createBuffer(),O.__webglFaceBuffer=Et.createBuffer(),O.__webglLineBuffer=Et.createBuffer();var M=void 0,_=void 0;if(O.numMorphTargets){O.__webglMorphTargetsBuffers=[],M=0;for(_=O.numMorphTargets;M<_;M++)O.__webglMorphTargetsBuffers.push(Et.createBuffer())}if(O.numMorphNormals){O.__webglMorphNormalsBuffers=[],M=0;for(_=O.numMorphNormals;M<_;M++)O.__webglMorphNormalsBuffers.push(Et.createBuffer())}q.info.memory.geometries++;var D=h,P=a,H=P.geometry,B=D.faces3,j=D.faces4,F=B.length*3+j.length*4,I=B.length*1+j.length*2,R=B.length*3+j.length*4,U=n(P,D),z=i(U),W=r(U),X=U.vertexColors?U.vertexColors:!1;D.__vertexArray=new Float32Array(F*3),W&&(D.__normalArray=new Float32Array(F*3)),H.hasTangents&&(D.__tangentArray=new Float32Array(F*4)),X&&(D.__colorArray=new Float32Array(F*3));if(z){if(H.faceUvs.length>0||H.faceVertexUvs.length>0)D.__uvArray=new Float32Array(F*2);if(H.faceUvs.length>1||H.faceVertexUvs.length>1)D.__uv2Array=new Float32Array(F*2)}P.geometry.skinWeights.length&&P.geometry.skinIndices.length&&(D.__skinIndexArray=new Float32Array(F*4),D.__skinWeightArray=new Float32Array(F*4)),D.__faceArray=new Uint16Array(I*3),D.__lineArray=new Uint16Array(R*2);var V=void 0,$=void 0;if(D.numMorphTargets){D.__morphTargetsArrays=[],V=0;for($=D.numMorphTargets;V<$;V++)D.__morphTargetsArrays.push(new Float32Array(F*3))}if(D.numMorphNormals){D.__morphNormalsArrays=[],V=0;for($=D.numMorphNormals;V<$;V++)D.__morphNormalsArrays.push(new Float32Array(F*3))}D.__webglFaceCount=I*3,D.__webglLineCount=R*2;if(U.attributes){D.__webglCustomAttributesList===void 0&&(D.__webglCustomAttributesList=[]);var K=void 0;for(K in U.attributes){var Q=U.attributes[K],G={},Y;for(Y in Q)G[Y]=Q[Y];if(!G.__webglInitialized||G.createUniqueBuffers){G.__webglInitialized=!0;var Z=1;G.type==="v2"?Z=2:G.type==="v3"?Z=3:G.type==="v4"?Z=4:G.type==="c"&&(Z=3),G.size=Z,G.array=new Float32Array(F*Z),G.buffer=Et.createBuffer(),G.buffer.belongsToAttribute=K,Q.needsUpdate=!0,G.__original=Q}D.__webglCustomAttributesList.push(G)}}D.__inittedArrays=!0,c.verticesNeedUpdate=!0,c.morphTargetsNeedUpdate=!0,c.elementsNeedUpdate=!0,c.uvsNeedUpdate=!0,c.normalsNeedUpdate=!0,c.tangentsNeedUpdate=!0,c.colorsNeedUpdate=!0}}}else c instanceof THREE.BufferGeometry&&s(c)}else if(a instanceof THREE.Ribbon){c=a.geometry;if(!c.__webglVertexBuffer){var et=c;et.__webglVertexBuffer=Et.createBuffer(),et.__webglColorBuffer=Et.createBuffer(),q.info.memory.geometries++;var tt=c,nt=tt.vertices.length;tt.__vertexArray=new Float32Array(nt*3),tt.__colorArray=new Float32Array(nt*3),tt.__webglVertexCount=nt,c.verticesNeedUpdate=!0,c.colorsNeedUpdate=!0}}else if(a instanceof THREE.Line){c=a.geometry;if(!c.__webglVertexBuffer){var rt=c;rt.__webglVertexBuffer=Et.createBuffer(),rt.__webglColorBuffer=Et.createBuffer(),q.info.memory.geometries++;var it=c,st=a,ot=it.vertices.length;it.__vertexArray=new Float32Array(ot*3),it.__colorArray=new Float32Array(ot*3),it.__webglLineCount=ot,t(it,st),c.verticesNeedUpdate=!0,c.colorsNeedUpdate=!0}}else if(a instanceof THREE.ParticleSystem){c=a.geometry;if(!c.__webglVertexBuffer)if(c instanceof THREE.Geometry){var ut=c;ut.__webglVertexBuffer=Et.createBuffer(),ut.__webglColorBuffer=Et.createBuffer(),q.info.memory.geometries++;var at=c,ft=a,lt=at.vertices.length;at.__vertexArray=new Float32Array(lt*3),at.__colorArray=new Float32Array(lt*3),at.__sortArray=[],at.__webglParticleCount=lt,t(at,ft),c.verticesNeedUpdate=!0,c.colorsNeedUpdate=!0}else c instanceof THREE.BufferGeometry&&s(c)}}if(!a.__webglActive){if(a instanceof THREE.Mesh){c=a.geometry;if(c instanceof THREE.BufferGeometry)p(f.__webglObjects,c,a);else for(l in c.geometryGroups)h=c.geometryGroups[l],p(f.__webglObjects,h,a)}else a instanceof THREE.Ribbon||a instanceof THREE.Line||a instanceof THREE.ParticleSystem?(c=a.geometry,p(f.__webglObjects,c,a)):a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback?f.__webglObjectsImmediate.push({object:a,opaque:null,transparent:null}):a instanceof THREE.Sprite?f.__webglSprites.push(a):a instanceof THREE.LensFlare&&f.__webglFlares.push(a);a.__webglActive=!0}e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){var ct=e.__objectsRemoved[0],ht=e;ct instanceof THREE.Mesh||ct instanceof THREE.ParticleSystem||ct instanceof THREE.Ribbon||ct instanceof THREE.Line?m(ht.__webglObjects,ct):ct instanceof THREE.Sprite?g(ht.__webglSprites,ct):ct instanceof THREE.LensFlare?g(ht.__webglFlares,ct):(ct instanceof THREE.ImmediateRenderObject||ct.immediateRenderCallback)&&m(ht.__webglObjectsImmediate,ct),ct.__webglActive=!1,e.__objectsRemoved.splice(0,1)}for(var pt=0,dt=e.__webglObjects.length;pt<dt;pt++){var vt=e.__webglObjects[pt].object,mt=vt.geometry,gt=void 0,yt=void 0,bt=void 0;if(vt instanceof THREE.Mesh)if(mt instanceof THREE.BufferGeometry)(mt.verticesNeedUpdate||mt.elementsNeedUpdate||mt.uvsNeedUpdate||mt.normalsNeedUpdate||mt.colorsNeedUpdate||mt.tangentsNeedUpdate)&&u(mt,Et.DYNAMIC_DRAW,!mt.dynamic),mt.verticesNeedUpdate=!1,mt.elementsNeedUpdate=!1,mt.uvsNeedUpdate=!1,mt.normalsNeedUpdate=!1,mt.colorsNeedUpdate=!1,mt.tangentsNeedUpdate=!1;else{for(var wt=0,St=mt.geometryGroupsList.length;wt<St;wt++){gt=mt.geometryGroupsList[wt],bt=n(vt,gt),yt=bt.attributes&&d(bt);if(mt.verticesNeedUpdate||mt.morphTargetsNeedUpdate||mt.elementsNeedUpdate||mt.uvsNeedUpdate||mt.normalsNeedUpdate||mt.colorsNeedUpdate||mt.tangentsNeedUpdate||yt){var xt=gt,Tt=vt,Nt=Et.DYNAMIC_DRAW,Ct=!mt.dynamic,kt=bt;if(xt.__inittedArrays){var Lt=r(kt),At=kt.vertexColors?kt.vertexColors:!1,Ot=i(kt),Mt=Lt===THREE.SmoothShading,_t=void 0,Dt=void 0,Pt=void 0,Ht=void 0,Bt=void 0,jt=void 0,Ft=void 0,It=void 0,qt=void 0,Rt=void 0,Ut=void 0,zt=void 0,Wt=void 0,Xt=void 0,Vt=void 0,$t=void 0,Jt=void 0,Kt=void 0,Qt=void 0,Gt=void 0,Yt=void 0,Zt=void 0,en=void 0,tn=void 0,nn=void 0,rn=void 0,sn=void 0,on=void 0,un=void 0,an=void 0,fn=void 0,ln=void 0,cn=void 0,hn=void 0,pn=void 0,dn=void 0,vn=void 0,mn=void 0,gn=void 0,yn=void 0,bn=void 0,wn=void 0,En=void 0,Sn=void 0,xn=void 0,Tn=void 0,Nn=0,Cn=0,kn=0,Ln=0,An=0,On=0,Mn=0,_n=0,Dn=0,Pn=0,Hn=0,Bn=0,jn=void 0,Fn=xt.__vertexArray,In=xt.__uvArray,qn=xt.__uv2Array,Rn=xt.__normalArray,Un=xt.__tangentArray,zn=xt.__colorArray,Wn=xt.__skinIndexArray,Xn=xt.__skinWeightArray,Vn=xt.__morphTargetsArrays,$n=xt.__morphNormalsArrays,Jn=xt.__webglCustomAttributesList,Kn=void 0,Qn=xt.__faceArray,Gn=xt.__lineArray,Yn=Tt.geometry,Zn=Yn.elementsNeedUpdate,er=Yn.uvsNeedUpdate,tr=Yn.normalsNeedUpdate,nr=Yn.tangentsNeedUpdate,rr=Yn.colorsNeedUpdate,ir=Yn.morphTargetsNeedUpdate,sr=Yn.vertices,or=xt.faces3,ur=xt.faces4,ar=Yn.faces,fr=Yn.faceVertexUvs[0],lr=Yn.faceVertexUvs[1],cr=Yn.skinIndices,hr=Yn.skinWeights,pr=Yn.morphTargets,dr=Yn.morphNormals;if(Yn.verticesNeedUpdate){_t=0;for(Dt=or.length;_t<Dt;_t++)Ht=ar[or[_t]],zt=sr[Ht.a],Wt=sr[Ht.b],Xt=sr[Ht.c],Fn[Cn]=zt.x,Fn[Cn+1]=zt.y,Fn[Cn+2]=zt.z,Fn[Cn+3]=Wt.x,Fn[Cn+4]=Wt.y,Fn[Cn+5]=Wt.z,Fn[Cn+6]=Xt.x,Fn[Cn+7]=Xt.y,Fn[Cn+8]=Xt.z,Cn+=9;_t=0;for(Dt=ur.length;_t<Dt;_t++)Ht=ar[ur[_t]],zt=sr[Ht.a],Wt=sr[Ht.b],Xt=sr[Ht.c],Vt=sr[Ht.d],Fn[Cn]=zt.x,Fn[Cn+1]=zt.y,Fn[Cn+2]=zt.z,Fn[Cn+3]=Wt.x,Fn[Cn+4]=Wt.y,Fn[Cn+5]=Wt.z,Fn[Cn+6]=Xt.x,Fn[Cn+7]=Xt.y,Fn[Cn+8]=Xt.z,Fn[Cn+9]=Vt.x,Fn[Cn+10]=Vt.y,Fn[Cn+11]=Vt.z,Cn+=12;Et.bindBuffer(Et.ARRAY_BUFFER,xt.__webglVertexBuffer),Et.bufferData(Et.ARRAY_BUFFER,Fn,Nt)}if(ir){bn=0;for(wn=pr.length;bn<wn;bn++){_t=Hn=0;for(Dt=or.length;_t<Dt;_t++)xn=or[_t],Ht=ar[xn],zt=pr[bn].vertices[Ht.a],Wt=pr[bn].vertices[Ht.b],Xt=pr[bn].vertices[Ht.c],En=Vn[bn],En[Hn]=zt.x,En[Hn+1]=zt.y,En[Hn+2]=zt.z,En[Hn+3]=Wt.x,En[Hn+4]=Wt.y,En[Hn+5]=Wt.z,En[Hn+6]=Xt.x,En[Hn+7]=Xt.y,En[Hn+8]=Xt.z,kt.morphNormals&&(Mt?(Tn=dr[bn].vertexNormals[xn],Gt=Tn.a,Yt=Tn.b,Zt=Tn.c):Zt=Yt=Gt=dr[bn].faceNormals[xn],Sn=$n[bn],Sn[Hn]=Gt.x,Sn[Hn+1]=Gt.y,Sn[Hn+2]=Gt.z,Sn[Hn+3]=Yt.x,Sn[Hn+4]=Yt.y,Sn[Hn+5]=Yt.z,Sn[Hn+6]=Zt.x,Sn[Hn+7]=Zt.y,Sn[Hn+8]=Zt.z),Hn+=9;_t=0;for(Dt=ur.length;_t<Dt;_t++)xn=ur[_t],Ht=ar[xn],zt=pr[bn].vertices[Ht.a],Wt=pr[bn].vertices[Ht.b],Xt=pr[bn].vertices[Ht.c],Vt=pr[bn].vertices[Ht.d],En=Vn[bn],En[Hn]=zt.x,En[Hn+1]=zt.y,En[Hn+2]=zt.z,En[Hn+3]=Wt.x,En[Hn+4]=Wt.y,En[Hn+5]=Wt.z,En[Hn+6]=Xt.x,En[Hn+7]=Xt.y,En[Hn+8]=Xt.z,En[Hn+9]=Vt.x,En[Hn+10]=Vt.y,En[Hn+11]=Vt.z,kt.morphNormals&&(Mt?(Tn=dr[bn].vertexNormals[xn],Gt=Tn.a,Yt=Tn.b,Zt=Tn.c,en=Tn.d):en=Zt=Yt=Gt=dr[bn].faceNormals[xn],Sn=$n[bn],Sn[Hn]=Gt.x,Sn[Hn+1]=Gt.y,Sn[Hn+2]=Gt.z,Sn[Hn+3]=Yt.x,Sn[Hn+4]=Yt.y,Sn[Hn+5]=Yt.z,Sn[Hn+6]=Zt.x,Sn[Hn+7]=Zt.y,Sn[Hn+8]=Zt.z,Sn[Hn+9]=en.x,Sn[Hn+10]=en.y,Sn[Hn+11]=en.z),Hn+=12;Et.bindBuffer(Et.ARRAY_BUFFER,xt.__webglMorphTargetsBuffers[bn]),Et.bufferData(Et.ARRAY_BUFFER,Vn[bn],Nt),kt.morphNormals&&(Et.bindBuffer(Et.ARRAY_BUFFER,xt.__webglMorphNormalsBuffers[bn]),Et.bufferData(Et.ARRAY_BUFFER,$n[bn],Nt))}}if(hr.length){_t=0;for(Dt=or.length;_t<Dt;_t++)Ht=ar[or[_t]],on=hr[Ht.a],un=hr[Ht.b],an=hr[Ht.c],Xn[Pn]=on.x,Xn[Pn+1]=on.y,Xn[Pn+2]=on.z,Xn[Pn+3]=on.w,Xn[Pn+4]=un.x,Xn[Pn+5]=un.y,Xn[Pn+6]=un.z,Xn[Pn+7]=un.w,Xn[Pn+8]=an.x,Xn[Pn+9]=an.y,Xn[Pn+10]=an.z,Xn[Pn+11]=an.w,ln=cr[Ht.a],cn=cr[Ht.b],hn=cr[Ht.c],Wn[Pn]=ln.x,Wn[Pn+1]=ln.y,Wn[Pn+2]=ln.z,Wn[Pn+3]=ln.w,Wn[Pn+4]=cn.x,Wn[Pn+5]=cn.y,Wn[Pn+6]=cn.z,Wn[Pn+7]=cn.w,Wn[Pn+8]=hn.x,Wn[Pn+9]=hn.y,Wn[Pn+10]=hn.z,Wn[Pn+11]=hn.w,Pn+=12;_t=0;for(Dt=ur.length;_t<Dt;_t++)Ht=ar[ur[_t]],on=hr[Ht.a],un=hr[Ht.b],an=hr[Ht.c],fn=hr[Ht.d],Xn[Pn]=on.x,Xn[Pn+1]=on.y,Xn[Pn+2]=on.z,Xn[Pn+3]=on.w,Xn[Pn+4]=un.x,Xn[Pn+5]=un.y,Xn[Pn+6]=un.z,Xn[Pn+7]=un.w,Xn[Pn+8]=an.x,Xn[Pn+9]=an.y,Xn[Pn+10]=an.z,Xn[Pn+11]=an.w,Xn[Pn+12]=fn.x,Xn[Pn+13]=fn.y,Xn[Pn+14]=fn.z,Xn[Pn+15]=fn.w,ln=cr[Ht.a],cn=cr[Ht.b],hn=cr[Ht.c],pn=cr[Ht.d],Wn[Pn]=ln.x,Wn[Pn+1]=ln.y,Wn[Pn+2]=ln.z,Wn[Pn+3]=ln.w,Wn[Pn+4]=cn.x,Wn[Pn+5]=cn.y,Wn[Pn+6]=cn.z,Wn[Pn+7]=cn.w,Wn[Pn+8]=hn.x,Wn[Pn+9]=hn.y,Wn[Pn+10]=hn.z,Wn[Pn+11]=hn.w,Wn[Pn+12]=pn.x,Wn[Pn+13]=pn.y,Wn[Pn+14]=pn.z,Wn[Pn+15]=pn.w,Pn+=16;Pn>0&&(Et.bindBuffer(Et.ARRAY_BUFFER,xt.__webglSkinIndicesBuffer),Et.bufferData(Et.ARRAY_BUFFER,Wn,Nt),Et.bindBuffer(Et.ARRAY_BUFFER,xt.__webglSkinWeightsBuffer),Et.bufferData(Et.ARRAY_BUFFER,Xn,Nt))}if(rr&&At){_t=0;for(Dt=or.length;_t<Dt;_t++)Ht=ar[or[_t]],Ft=Ht.vertexColors,It=Ht.color,Ft.length===3&&At===THREE.VertexColors?(tn=Ft[0],nn=Ft[1],rn=Ft[2]):rn=nn=tn=It,zn[Dn]=tn.r,zn[Dn+1]=tn.g,zn[Dn+2]=tn.b,zn[Dn+3]=nn.r,zn[Dn+4]=nn.g,zn[Dn+5]=nn.b,zn[Dn+6]=rn.r,zn[Dn+7]=rn.g,zn[Dn+8]=rn.b,Dn+=9;_t=0;for(Dt=ur.length;_t<Dt;_t++)Ht=ar[ur[_t]],Ft=Ht.vertexColors,It=Ht.color,Ft.length===4&&At===THREE.VertexColors?(tn=Ft[0],nn=Ft[1],rn=Ft[2],sn=Ft[3]):sn=rn=nn=tn=It,zn[Dn]=tn.r,zn[Dn+1]=tn.g,zn[Dn+2]=tn.b,zn[Dn+3]=nn.r,zn[Dn+4]=nn.g,zn[Dn+5]=nn.b,zn[Dn+6]=rn.r,zn[Dn+7]=rn.g,zn[Dn+8]=rn.b,zn[Dn+9]=sn.r,zn[Dn+10]=sn.g,zn[Dn+11]=sn.b,Dn+=12;Dn>0&&(Et.bindBuffer(Et.ARRAY_BUFFER,xt.__webglColorBuffer),Et.bufferData(Et.ARRAY_BUFFER,zn,Nt))}if(nr&&Yn.hasTangents){_t=0;for(Dt=or.length;_t<Dt;_t++)Ht=ar[or[_t]],qt=Ht.vertexTangents,$t=qt[0],Jt=qt[1],Kt=qt[2],Un[Mn]=$t.x,Un[Mn+1]=$t.y,Un[Mn+2]=$t.z,Un[Mn+3]=$t.w,Un[Mn+4]=Jt.x,Un[Mn+5]=Jt.y,Un[Mn+6]=Jt.z,Un[Mn+7]=Jt.w,Un[Mn+8]=Kt.x,Un[Mn+9]=Kt.y,Un[Mn+10]=Kt.z,Un[Mn+11]=Kt.w,Mn+=12;_t=0;for(Dt=ur.length;_t<Dt;_t++)Ht=ar[ur[_t]],qt=Ht.vertexTangents,$t=qt[0],Jt=qt[1],Kt=qt[2],Qt=qt[3],Un[Mn]=$t.x,Un[Mn+1]=$t.y,Un[Mn+2]=$t.z,Un[Mn+3]=$t.w,Un[Mn+4]=Jt.x,Un[Mn+5]=Jt.y,Un[Mn+6]=Jt.z,Un[Mn+7]=Jt.w,Un[Mn+8]=Kt.x,Un[Mn+9]=Kt.y,Un[Mn+10]=Kt.z,Un[Mn+11]=Kt.w,Un[Mn+12]=Qt.x,Un[Mn+13]=Qt.y,Un[Mn+14]=Qt.z,Un[Mn+15]=Qt.w,Mn+=16;Et.bindBuffer(Et.ARRAY_BUFFER,xt.__webglTangentBuffer),Et.bufferData(Et.ARRAY_BUFFER,Un,Nt)}if(tr&&Lt){_t=0;for(Dt=or.length;_t<Dt;_t++){Ht=ar[or[_t]],Bt=Ht.vertexNormals,jt=Ht.normal;if(Bt.length===3&&Mt)for(dn=0;dn<3;dn++)mn=Bt[dn],Rn[On]=mn.x,Rn[On+1]=mn.y,Rn[On+2]=mn.z,On+=3;else for(dn=0;dn<3;dn++)Rn[On]=jt.x,Rn[On+1]=jt.y,Rn[On+2]=jt.z,On+=3}_t=0;for(Dt=ur.length;_t<Dt;_t++){Ht=ar[ur[_t]],Bt=Ht.vertexNormals,jt=Ht.normal;if(Bt.length===4&&Mt)for(dn=0;dn<4;dn++)mn=Bt[dn],Rn[On]=mn.x,Rn[On+1]=mn.y,Rn[On+2]=mn.z,On+=3;else for(dn=0;dn<4;dn++)Rn[On]=jt.x,Rn[On+1]=jt.y,Rn[On+2]=jt.z,On+=3}Et.bindBuffer(Et.ARRAY_BUFFER,xt.__webglNormalBuffer),Et.bufferData(Et.ARRAY_BUFFER,Rn,Nt)}if(er&&fr&&Ot){_t=0;for(Dt=or.length;_t<Dt;_t++){Pt=or[_t],Rt=fr[Pt];if(Rt!==void 0)for(dn=0;dn<3;dn++)gn=Rt[dn],In[kn]=gn.u,In[kn+1]=gn.v,kn+=2}_t=0;for(Dt=ur.length;_t<Dt;_t++){Pt=ur[_t],Rt=fr[Pt];if(Rt!==void 0)for(dn=0;dn<4;dn++)gn=Rt[dn],In[kn]=gn.u,In[kn+1]=gn.v,kn+=2}kn>0&&(Et.bindBuffer(Et.ARRAY_BUFFER,xt.__webglUVBuffer),Et.bufferData(Et.ARRAY_BUFFER,In,Nt))}if(er&&lr&&Ot){_t=0;for(Dt=or.length;_t<Dt;_t++){Pt=or[_t],Ut=lr[Pt];if(Ut!==void 0)for(dn=0;dn<3;dn++)yn=Ut[dn],qn[Ln]=yn.u,qn[Ln+1]=yn.v,Ln+=2}_t=0;for(Dt=ur.length;_t<Dt;_t++){Pt=ur[_t],Ut=lr[Pt];if(Ut!==void 0)for(dn=0;dn<4;dn++)yn=Ut[dn],qn[Ln]=yn.u,qn[Ln+1]=yn.v,Ln+=2}Ln>0&&(Et.bindBuffer(Et.ARRAY_BUFFER,xt.__webglUV2Buffer),Et.bufferData(Et.ARRAY_BUFFER,qn,Nt))}if(Zn){_t=0;for(Dt=or.length;_t<Dt;_t++)Qn[An]=Nn,Qn[An+1]=Nn+1,Qn[An+2]=Nn+2,An+=3,Gn[_n]=Nn,Gn[_n+1]=Nn+1,Gn[_n+2]=Nn,Gn[_n+3]=Nn+2,Gn[_n+4]=Nn+1,Gn[_n+5]=Nn+2,_n+=6,Nn+=3;_t=0;for(Dt=ur.length;_t<Dt;_t++)Qn[An]=Nn,Qn[An+1]=Nn+1,Qn[An+2]=Nn+3,Qn[An+3]=Nn+1,Qn[An+4]=Nn+2,Qn[An+5]=Nn+3,An+=6,Gn[_n]=Nn,Gn[_n+1]=Nn+1,Gn[_n+2]=Nn,Gn[_n+3]=Nn+3,Gn[_n+4]=Nn+1,Gn[_n+5]=Nn+2,Gn[_n+6]=Nn+2,Gn[_n+7]=Nn+3,_n+=8,Nn+=4;Et.bindBuffer(Et.ELEMENT_ARRAY_BUFFER,xt.__webglFaceBuffer),Et.bufferData(Et.ELEMENT_ARRAY_BUFFER,Qn,Nt),Et.bindBuffer(Et.ELEMENT_ARRAY_BUFFER,xt.__webglLineBuffer),Et.bufferData(Et.ELEMENT_ARRAY_BUFFER,Gn,Nt)}if(Jn){dn=0;for(vn=Jn.length;dn<vn;dn++){Kn=Jn[dn];if(Kn.__original.needsUpdate){Bn=0;if(Kn.size===1){if(Kn.boundTo===void 0||Kn.boundTo==="vertices"){_t=0;for(Dt=or.length;_t<Dt;_t++)Ht=ar[or[_t]],Kn.array[Bn]=Kn.value[Ht.a],Kn.array[Bn+1]=Kn.value[Ht.b],Kn.array[Bn+2]=Kn.value[Ht.c],Bn+=3;_t=0;for(Dt=ur.length;_t<Dt;_t++)Ht=ar[ur[_t]],Kn.array[Bn]=Kn.value[Ht.a],Kn.array[Bn+1]=Kn.value[Ht.b],Kn.array[Bn+2]=Kn.value[Ht.c],Kn.array[Bn+3]=Kn.value[Ht.d],Bn+=4}else if(Kn.boundTo==="faces"){_t=0;for(Dt=or.length;_t<Dt;_t++)jn=Kn.value[or[_t]],Kn.array[Bn]=jn,Kn.array[Bn+1]=jn,Kn.array[Bn+2]=jn,Bn+=3;_t=0;for(Dt=ur.length;_t<Dt;_t++)jn=Kn.value[ur[_t]],Kn.array[Bn]=jn,Kn.array[Bn+1]=jn,Kn.array[Bn+2]=jn,Kn.array[Bn+3]=jn,Bn+=4}}else if(Kn.size===2){if(Kn.boundTo===void 0||Kn.boundTo==="vertices"){_t=0;for(Dt=or.length;_t<Dt;_t++)Ht=ar[or[_t]],zt=Kn.value[Ht.a],Wt=Kn.value[Ht.b],Xt=Kn.value[Ht.c],Kn.array[Bn]=zt.x,Kn.array[Bn+1]=zt.y,Kn.array[Bn+2]=Wt.x,Kn.array[Bn+3]=Wt.y,Kn.array[Bn+4]=Xt.x,Kn.array[Bn+5]=Xt.y,Bn+=6;_t=0;for(Dt=ur.length;_t<Dt;_t++)Ht=ar[ur[_t]],zt=Kn.value[Ht.a],Wt=Kn.value[Ht.b],Xt=Kn.value[Ht.c],Vt=Kn.value[Ht.d],Kn.array[Bn]=zt.x,Kn.array[Bn+1]=zt.y,Kn.array[Bn+2]=Wt.x,Kn.array[Bn+3]=Wt.y,Kn.array[Bn+4]=Xt.x,Kn.array[Bn+5]=Xt.y,Kn.array[Bn+6]=Vt.x,Kn.array[Bn+7]=Vt.y,Bn+=8}else if(Kn.boundTo==="faces"){_t=0;for(Dt=or.length;_t<Dt;_t++)Xt=Wt=zt=jn=Kn.value[or[_t]],Kn.array[Bn]=zt.x,Kn.array[Bn+1]=zt.y,Kn.array[Bn+2]=Wt.x,Kn.array[Bn+3]=Wt.y,Kn.array[Bn+4]=Xt.x,Kn.array[Bn+5]=Xt.y,Bn+=6;_t=0;for(Dt=ur.length;_t<Dt;_t++)Vt=Xt=Wt=zt=jn=Kn.value[ur[_t]],Kn.array[Bn]=zt.x,Kn.array[Bn+1]=zt.y,Kn.array[Bn+2]=Wt.x,Kn.array[Bn+3]=Wt.y,Kn.array[Bn+4]=Xt.x,Kn.array[Bn+5]=Xt.y,Kn.array[Bn+6]=Vt.x,Kn.array[Bn+7]=Vt.y,Bn+=8}}else if(Kn.size===3){var vr;vr=Kn.type==="c"?["r","g","b"]:["x","y","z"];if(Kn.boundTo===void 0||Kn.boundTo==="vertices"){_t=0;for(Dt=or.length;_t<Dt;_t++)Ht=ar[or[_t]],zt=Kn.value[Ht.a],Wt=Kn.value[Ht.b],Xt=Kn.value[Ht.c],Kn.array[Bn]=zt[vr[0]],Kn.array[Bn+1]=zt[vr[1]],Kn.array[Bn+2]=zt[vr[2]],Kn.array[Bn+3]=Wt[vr[0]],Kn.array[Bn+4]=Wt[vr[1]],Kn.array[Bn+5]=Wt[vr[2]],Kn.array[Bn+6]=Xt[vr[0]],Kn.array[Bn+7]=Xt[vr[1]],Kn.array[Bn+8]=Xt[vr[2]],Bn+=9;_t=0;for(Dt=ur.length;_t<Dt;_t++)Ht=ar[ur[_t]],zt=Kn.value[Ht.a],Wt=Kn.value[Ht.b],Xt=Kn.value[Ht.c],Vt=Kn.value[Ht.d],Kn.array[Bn]=zt[vr[0]],Kn.array[Bn+1]=zt[vr[1]],Kn.array[Bn+2]=zt[vr[2]],Kn.array[Bn+3]=Wt[vr[0]],Kn.array[Bn+4]=Wt[vr[1]],Kn.array[Bn+5]=Wt[vr[2]],Kn.array[Bn+6]=Xt[vr[0]],Kn.array[Bn+7]=Xt[vr[1]],Kn.array[Bn+8]=Xt[vr[2]],Kn.array[Bn+9]=Vt[vr[0]],Kn.array[Bn+10]=Vt[vr[1]],Kn.array[Bn+11]=Vt[vr[2]],Bn+=12}else if(Kn.boundTo==="faces"){_t=0;for(Dt=or.length;_t<Dt;_t++)Xt=Wt=zt=jn=Kn.value[or[_t]],Kn.array[Bn]=zt[vr[0]],Kn.array[Bn+1]=zt[vr[1]],Kn.array[Bn+2]=zt[vr[2]],Kn.array[Bn+3]=Wt[vr[0]],Kn.array[Bn+4]=Wt[vr[1]],Kn.array[Bn+5]=Wt[vr[2]],Kn.array[Bn+6]=Xt[vr[0]],Kn.array[Bn+7]=Xt[vr[1]],Kn.array[Bn+8]=Xt[vr[2]],Bn+=9;_t=0;for(Dt=ur.length;_t<Dt;_t++)Vt=Xt=Wt=zt=jn=Kn.value[ur[_t]],Kn.array[Bn]=zt[vr[0]],Kn.array[Bn+1]=zt[vr[1]],Kn.array[Bn+2]=zt[vr[2]],Kn.array[Bn+3]=Wt[vr[0]],Kn.array[Bn+4]=Wt[vr[1]],Kn.array[Bn+5]=Wt[vr[2]],Kn.array[Bn+6]=Xt[vr[0]],Kn.array[Bn+7]=Xt[vr[1]],Kn.array[Bn+8]=Xt[vr[2]],Kn.array[Bn+9]=Vt[vr[0]],Kn.array[Bn+10]=Vt[vr[1]],Kn.array[Bn+11]=Vt[vr[2]],Bn+=12}else if(Kn.boundTo==="faceVertices"){_t=0;for(Dt=or.length;_t<Dt;_t++)jn=Kn.value[or[_t]],zt=jn[0],Wt=jn[1],Xt=jn[2],Kn.array[Bn]=zt[vr[0]],Kn.array[Bn+1]=zt[vr[1]],Kn.array[Bn+2]=zt[vr[2]],Kn.array[Bn+3]=Wt[vr[0]],Kn.array[Bn+4]=Wt[vr[1]],Kn.array[Bn+5]=Wt[vr[2]],Kn.array[Bn+6]=Xt[vr[0]],Kn.array[Bn+7]=Xt[vr[1]],Kn.array[Bn+8]=Xt[vr[2]],Bn+=9;_t=0;for(Dt=ur.length;_t<Dt;_t++)jn=Kn.value[ur[_t]],zt=jn[0],Wt=jn[1],Xt=jn[2],Vt=jn[3],Kn.array[Bn]=zt[vr[0]],Kn.array[Bn+1]=zt[vr[1]],Kn.array[Bn+2]=zt[vr[2]],Kn.array[Bn+3]=Wt[vr[0]],Kn.array[Bn+4]=Wt[vr[1]],Kn.array[Bn+5]=Wt[vr[2]],Kn.array[Bn+6]=Xt[vr[0]],Kn.array[Bn+7]=Xt[vr[1]],Kn.array[Bn+8]=Xt[vr[2]],Kn.array[Bn+9]=Vt[vr[0]],Kn.array[Bn+10]=Vt[vr[1]],Kn.array[Bn+11]=Vt[vr[2]],Bn+=12}}else if(Kn.size===4)if(Kn.boundTo===void 0||Kn.boundTo==="vertices"){_t=0;for(Dt=or.length;_t<Dt;_t++)Ht=ar[or[_t]],zt=Kn.value[Ht.a],Wt=Kn.value[Ht.b],Xt=Kn.value[Ht.c],Kn.array[Bn]=zt.x,Kn.array[Bn+1]=zt.y,Kn.array[Bn+2]=zt.z,Kn.array[Bn+3]=zt.w,Kn.array[Bn+4]=Wt.x,Kn.array[Bn+5]=Wt.y,Kn.array[Bn+6]=Wt.z,Kn.array[Bn+7]=Wt.w,Kn.array[Bn+8]=Xt.x,Kn.array[Bn+9]=Xt.y,Kn.array[Bn+10]=Xt.z,Kn.array[Bn+11]=Xt.w,Bn+=12;_t=0;for(Dt=ur.length;_t<Dt;_t++)Ht=ar[ur[_t]],zt=Kn.value[Ht.a],Wt=Kn.value[Ht.b],Xt=Kn.value[Ht.c],Vt=Kn.value[Ht.d],Kn.array[Bn]=zt.x,Kn.array[Bn+1]=zt.y,Kn.array[Bn+2]=zt.z,Kn.array[Bn+3]=zt.w,Kn.array[Bn+4]=Wt.x,Kn.array[Bn+5]=Wt.y,Kn.array[Bn+6]=Wt.z,Kn.array[Bn+7]=Wt.w,Kn.array[Bn+8]=Xt.x,Kn.array[Bn+9]=Xt.y,Kn.array[Bn+10]=Xt.z,Kn.array[Bn+11]=Xt.w,Kn.array[Bn+12]=Vt.x,Kn.array[Bn+13]=Vt.y,Kn.array[Bn+14]=Vt.z,Kn.array[Bn+15]=Vt.w,Bn+=16}else if(Kn.boundTo==="faces"){_t=0;for(Dt=or.length;_t<Dt;_t++)Xt=Wt=zt=jn=Kn.value[or[_t]],Kn.array[Bn]=zt.x,Kn.array[Bn+1]=zt.y,Kn.array[Bn+2]=zt.z,Kn.array[Bn+3]=zt.w,Kn.array[Bn+4]=Wt.x,Kn.array[Bn+5]=Wt.y,Kn.array[Bn+6]=Wt.z,Kn.array[Bn+7]=Wt.w,Kn.array[Bn+8]=Xt.x,Kn.array[Bn+9]=Xt.y,Kn.array[Bn+10]=Xt.z,Kn.array[Bn+11]=Xt.w,Bn+=12;_t=0;for(Dt=ur.length;_t<Dt;_t++)Vt=Xt=Wt=zt=jn=Kn.value[ur[_t]],Kn.array[Bn]=zt.x,Kn.array[Bn+1]=zt.y,Kn.array[Bn+2]=zt.z,Kn.array[Bn+3]=zt.w,Kn.array[Bn+4]=Wt.x,Kn.array[Bn+5]=Wt.y,Kn.array[Bn+6]=Wt.z,Kn.array[Bn+7]=Wt.w,Kn.array[Bn+8]=Xt.x,Kn.array[Bn+9]=Xt.y,Kn.array[Bn+10]=Xt.z,Kn.array[Bn+11]=Xt.w,Kn.array[Bn+12]=Vt.x,Kn.array[Bn+13]=Vt.y,Kn.array[Bn+14]=Vt.z,Kn.array[Bn+15]=Vt.w,Bn+=16}else if(Kn.boundTo==="faceVertices"){_t=0;for(Dt=or.length;_t<Dt;_t++)jn=Kn.value[or[_t]],zt=jn[0],Wt=jn[1],Xt=jn[2],Kn.array[Bn]=zt.x,Kn.array[Bn+1]=zt.y,Kn.array[Bn+2]=zt.z,Kn.array[Bn+3]=zt.w,Kn.array[Bn+4]=Wt.x,Kn.array[Bn+5]=Wt.y,Kn.array[Bn+6]=Wt.z,Kn.array[Bn+7]=Wt.w,Kn.array[Bn+8]=Xt.x,Kn.array[Bn+9]=Xt.y,Kn.array[Bn+10]=Xt.z,Kn.array[Bn+11]=Xt.w,Bn+=12;_t=0;for(Dt=ur.length;_t<Dt;_t++)jn=Kn.value[ur[_t]],zt=jn[0],Wt=jn[1],Xt=jn[2],Vt=jn[3],Kn.array[Bn]=zt.x,Kn.array[Bn+1]=zt.y,Kn.array[Bn+2]=zt.z,Kn.array[Bn+3]=zt.w,Kn.array[Bn+4]=Wt.x,Kn.array[Bn+5]=Wt.y,Kn.array[Bn+6]=Wt.z,Kn.array[Bn+7]=Wt.w,Kn.array[Bn+8]=Xt.x,Kn.array[Bn+9]=Xt.y,Kn.array[Bn+10]=Xt.z,Kn.array[Bn+11]=Xt.w,Kn.array[Bn+12]=Vt.x,Kn.array[Bn+13]=Vt.y,Kn.array[Bn+14]=Vt.z,Kn.array[Bn+15]=Vt.w,Bn+=16}Et.bindBuffer(Et.ARRAY_BUFFER,Kn.buffer),Et.bufferData(Et.ARRAY_BUFFER,Kn.array,Nt)}}}Ct&&(delete xt.__inittedArrays,delete xt.__colorArray,delete xt.__normalArray,delete xt.__tangentArray,delete xt.__uvArray,delete xt.__uv2Array,delete xt.__faceArray,delete xt.__vertexArray,delete xt.__lineArray,delete xt.__skinIndexArray,delete xt.__skinWeightArray)}}}mt.verticesNeedUpdate=!1,mt.morphTargetsNeedUpdate=!1,mt.elementsNeedUpdate=!1,mt.uvsNeedUpdate=!1,mt.normalsNeedUpdate=!1,mt.colorsNeedUpdate=!1,mt.tangentsNeedUpdate=!1,bt.attributes&&v(bt)}else if(vt instanceof THREE.Ribbon){if(mt.verticesNeedUpdate||mt.colorsNeedUpdate){var mr=mt,gr=Et.DYNAMIC_DRAW,yr=void 0,br=void 0,wr=void 0,Er=void 0,Sr=void 0,xr=mr.vertices,Tr=mr.colors,Nr=xr.length,Cr=Tr.length,kr=mr.__vertexArray,Lr=mr.__colorArray,Ar=mr.colorsNeedUpdate;if(mr.verticesNeedUpdate){for(yr=0;yr<Nr;yr++)wr=xr[yr],Er=yr*3,kr[Er]=wr.x,kr[Er+1]=wr.y,kr[Er+2]=wr.z;Et.bindBuffer(Et.ARRAY_BUFFER,mr.__webglVertexBuffer),Et.bufferData(Et.ARRAY_BUFFER,kr,gr)}if(Ar){for(br=0;br<Cr;br++)Sr=Tr[br],Er=br*3,Lr[Er]=Sr.r,Lr[Er+1]=Sr.g,Lr[Er+2]=Sr.b;Et.bindBuffer(Et.ARRAY_BUFFER,mr.__webglColorBuffer),Et.bufferData(Et.ARRAY_BUFFER,Lr,gr)}}mt.verticesNeedUpdate=!1,mt.colorsNeedUpdate=!1}else if(vt instanceof THREE.Line){bt=n(vt,gt),yt=bt.attributes&&d(bt);if(mt.verticesNeedUpdate||mt.colorsNeedUpdate||yt){var Or=mt,Mr=Et.DYNAMIC_DRAW,_r=void 0,Dr=void 0,Pr=void 0,Hr=void 0,Br=void 0,jr=Or.vertices,Fr=Or.colors,Ir=jr.length,qr=Fr.length,Rr=Or.__vertexArray,Ur=Or.__colorArray,zr=Or.colorsNeedUpdate,Wr=Or.__webglCustomAttributesList,Xr=void 0,Vr=void 0,$r=void 0,Jr=void 0,Kr=void 0,Qr=void 0;if(Or.verticesNeedUpdate){for(_r=0;_r<Ir;_r++)Pr=jr[_r],Hr=_r*3,Rr[Hr]=Pr.x,Rr[Hr+1]=Pr.y,Rr[Hr+2]=Pr.z;Et.bindBuffer(Et.ARRAY_BUFFER,Or.__webglVertexBuffer),Et.bufferData(Et.ARRAY_BUFFER,Rr,Mr)}if(zr){for(Dr=0;Dr<qr;Dr++)Br=Fr[Dr],Hr=Dr*3,Ur[Hr]=Br.r,Ur[Hr+1]=Br.g,Ur[Hr+2]=Br.b;Et.bindBuffer(Et.ARRAY_BUFFER,Or.__webglColorBuffer),Et.bufferData(Et.ARRAY_BUFFER,Ur,Mr)}if(Wr){Xr=0;for(Vr=Wr.length;Xr<Vr;Xr++){Qr=Wr[Xr];if(Qr.needsUpdate&&(Qr.boundTo===void 0||Qr.boundTo==="vertices")){Hr=0,Jr=Qr.value.length;if(Qr.size===1)for($r=0;$r<Jr;$r++)Qr.array[$r]=Qr.value[$r];else if(Qr.size===2)for($r=0;$r<Jr;$r++)Kr=Qr.value[$r],Qr.array[Hr]=Kr.x,Qr.array[Hr+1]=Kr.y,Hr+=2;else if(Qr.size===3)if(Qr.type==="c")for($r=0;$r<Jr;$r++)Kr=Qr.value[$r],Qr.array[Hr]=Kr.r,Qr.array[Hr+1]=Kr.g,Qr.array[Hr+2]=Kr.b,Hr+=3;else for($r=0;$r<Jr;$r++)Kr=Qr.value[$r],Qr.array[Hr]=Kr.x,Qr.array[Hr+1]=Kr.y,Qr.array[Hr+2]=Kr.z,Hr+=3;else if(Qr.size===4)for($r=0;$r<Jr;$r++)Kr=Qr.value[$r],Qr.array[Hr]=Kr.x,Qr.array[Hr+1]=Kr.y,Qr.array[Hr+2]=Kr.z,Qr.array[Hr+3]=Kr.w,Hr+=4;Et.bindBuffer(Et.ARRAY_BUFFER,Qr.buffer),Et.bufferData(Et.ARRAY_BUFFER,Qr.array,Mr)}}}}mt.verticesNeedUpdate=!1,mt.colorsNeedUpdate=!1,bt.attributes&&v(bt)}else vt instanceof THREE.ParticleSystem&&(mt instanceof THREE.BufferGeometry?((mt.verticesNeedUpdate||mt.colorsNeedUpdate)&&u(mt,Et.DYNAMIC_DRAW,!mt.dynamic),mt.verticesNeedUpdate=!1,mt.colorsNeedUpdate=!1):(bt=n(vt,gt),yt=bt.attributes&&d(bt),(mt.verticesNeedUpdate||mt.colorsNeedUpdate||vt.sortParticles||yt)&&o(mt,Et.DYNAMIC_DRAW,vt),mt.verticesNeedUpdate=!1,mt.colorsNeedUpdate=!1,bt.attributes&&v(bt)))}},this.initMaterial=function(e,t,n,r){var i,s,o,u,a,f,l,c,h;e instanceof THREE.MeshDepthMaterial?h="depth":e instanceof THREE.MeshNormalMaterial?h="normal":e instanceof THREE.MeshBasicMaterial?h="basic":e instanceof THREE.MeshLambertMaterial?h="lambert":e instanceof THREE.MeshPhongMaterial?h="phong":e instanceof THREE.LineBasicMaterial?h="basic":e instanceof THREE.ParticleBasicMaterial&&(h="particle_basic");if(h){var p=THREE.ShaderLib[h];e.uniforms=THREE.UniformsUtils.clone(p.uniforms),e.vertexShader=p.vertexShader,e.fragmentShader=p.fragmentShader}var d,v;d=u=s=i=p=0;for(o=t.length;d<o;d++)v=t[d],v.onlyShadow||(v instanceof THREE.DirectionalLight&&u++,v instanceof THREE.PointLight&&s++,v instanceof THREE.SpotLight&&i++,v instanceof THREE.HemisphereLight&&p++);s+i+u+p<=I?(d=u,o=i):(d=Math.ceil(I*u/(s+u)),o=s=I-d,p=d),i=d,u=p,p=c=0;for(d=t.length;p<d;p++)v=t[p],v.castShadow&&(v instanceof THREE.SpotLight&&c++,v instanceof THREE.DirectionalLight&&!v.shadowCascade&&c++);At&&r&&r.useVertexTexture?l=1024:(t=Et.getParameter(Et.MAX_VERTEX_UNIFORM_VECTORS),t=Math.floor((t-20)/4),r!==void 0&&r instanceof THREE.SkinnedMesh&&(t=Math.min(r.bones.length,t),t<r.bones.length&&console.warn("WebGLRenderer: too many bones - "+r.bones.length+", this GPU supports just "+t+" (try OpenGL instead of ANGLE)")),l=t);var m;e:{v=e.fragmentShader,d=e.vertexShader;var p=e.uniforms,t=e.attributes,n={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:n,useFog:e.fog,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:l,useVertexTexture:At&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:i,maxPointLights:s,maxSpotLights:o,maxHemiLights:u,maxShadows:c,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide},g,r=[];h?r.push(h):(r.push(v),r.push(d));for(g in n)r.push(g),r.push(n[g]);h=r.join(),g=0;for(r=R.length;g<r;g++){i=R[g];if(i.code===h){i.usedTimes++,m=i.program;break e}}g=Et.createProgram(),r=["precision "+M+" float;",Lt?"#define VERTEX_TEXTURES":"",q.gammaInput?"#define GAMMA_INPUT":"",q.gammaOutput?"#define GAMMA_OUTPUT":"",q.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.boneTextureWidth?"#define N_BONE_PIXEL_X "+n.boneTextureWidth.toFixed(1):"",n.boneTextureHeight?"#define N_BONE_PIXEL_Y "+n.boneTextureHeight.toFixed(1):"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapSoft?"#define SHADOWMAP_SOFT":"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),i=["precision "+M+" float;",n.bumpMap||n.normalMap?"#extension GL_OES_standard_derivatives : enable":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",q.gammaInput?"#define GAMMA_INPUT":"",q.gammaOutput?"#define GAMMA_OUTPUT":"",q.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.metal?"#define METAL":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapSoft?"#define SHADOWMAP_SOFT":"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),i=N("fragment",i+v),r=N("vertex",r+d),Et.attachShader(g,r),Et.attachShader(g,i),Et.linkProgram(g),Et.getProgramParameter(g,Et.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+Et.getProgramParameter(g,Et.VALIDATE_STATUS)+", gl error ["+Et.getError()+"]"),Et.deleteShader(i),Et.deleteShader(r),g.uniforms={},g.attributes={};var y,r=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"];n.useVertexTexture?r.push("boneTexture"):r.push("boneGlobalMatrices");for(y in p)r.push(y);y=r,r=0;for(p=y.length;r<p;r++)i=y[r],g.uniforms[i]=Et.getUniformLocation(g,i);r=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight"];for(y=0;y<n.maxMorphTargets;y++)r.push("morphTarget"+y);for(y=0;y<n.maxMorphNormals;y++)r.push("morphNormal"+y);for(m in t)r.push(m);m=r,y=0;for(n=m.length;y<n;y++)r=m[y],g.attributes[r]=Et.getAttribLocation(g,r);g.id=U++,R.push({program:g,code:h,usedTimes:1}),q.info.memory.programs=R.length,m=g}e.program=m,m=e.program.attributes,m.position>=0&&Et.enableVertexAttribArray(m.position),m.color>=0&&Et.enableVertexAttribArray(m.color),m.normal>=0&&Et.enableVertexAttribArray(m.normal),m.tangent>=0&&Et.enableVertexAttribArray(m.tangent),e.skinning&&m.skinIndex>=0&&m.skinWeight>=0&&(Et.enableVertexAttribArray(m.skinIndex),Et.enableVertexAttribArray(m.skinWeight));if(e.attributes)for(f in e.attributes)m[f]!==void 0&&m[f]>=0&&Et.enableVertexAttribArray(m[f]);if(e.morphTargets){e.numSupportedMorphTargets=0,g="morphTarget";for(f=0;f<this.maxMorphTargets;f++)y=g+f,m[y]>=0&&(Et.enableVertexAttribArray(m[y]),e.numSupportedMorphTargets++)}if(e.morphNormals){e.numSupportedMorphNormals=0,g="morphNormal";for(f=0;f<this.maxMorphNormals;f++)y=g+f,m[y]>=0&&(Et.enableVertexAttribArray(m[y]),e.numSupportedMorphNormals++)}e.uniformsList=[];for(a in e.uniforms)e.uniformsList.push([e.uniforms[a],a])},this.setFaceCulling=function(e,t){e?(!t||t==="ccw"?Et.frontFace(Et.CCW):Et.frontFace(Et.CW),e==="back"?Et.cullFace(Et.BACK):e==="front"?Et.cullFace(Et.FRONT):Et.cullFace(Et.FRONT_AND_BACK),Et.enable(Et.CULL_FACE)):Et.disable(Et.CULL_FACE)},this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide,e=e.side===THREE.BackSide;Q!==t&&(t?Et.disable(Et.CULL_FACE):Et.enable(Et.CULL_FACE),Q=t),G!==e&&(e?Et.frontFace(Et.CW):Et.frontFace(Et.CCW),G=e)},this.setDepthTest=function(e){nt!==e&&(e?Et.enable(Et.DEPTH_TEST):Et.disable(Et.DEPTH_TEST),nt=e)},this.setDepthWrite=function(e){rt!==e&&(Et.depthMask(e),rt=e)},this.setBlending=function(e,t,n,r){e!==Y&&(e===THREE.NoBlending?Et.disable(Et.BLEND):e===THREE.AdditiveBlending?(Et.enable(Et.BLEND),Et.blendEquation(Et.FUNC_ADD),Et.blendFunc(Et.SRC_ALPHA,Et.ONE)):e===THREE.SubtractiveBlending?(Et.enable(Et.BLEND),Et.blendEquation(Et.FUNC_ADD),Et.blendFunc(Et.ZERO,Et.ONE_MINUS_SRC_COLOR)):e===THREE.MultiplyBlending?(Et.enable(Et.BLEND),Et.blendEquation(Et.FUNC_ADD),Et.blendFunc(Et.ZERO,Et.SRC_COLOR)):e===THREE.CustomBlending?Et.enable(Et.BLEND):(Et.enable(Et.BLEND),Et.blendEquationSeparate(Et.FUNC_ADD,Et.FUNC_ADD),Et.blendFuncSeparate(Et.SRC_ALPHA,Et.ONE_MINUS_SRC_ALPHA,Et.ONE,Et.ONE_MINUS_SRC_ALPHA)),Y=e);if(e===THREE.CustomBlending){t!==Z&&(Et.blendEquation(A(t)),Z=t);if(n!==et||r!==tt)Et.blendFunc(A(n),A(r)),et=n,tt=r}else tt=et=Z=null},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.__webglTexture=Et.createTexture(),q.info.memory.textures++),Et.activeTexture(Et.TEXTURE0+t),Et.bindTexture(Et.TEXTURE_2D,e.__webglTexture),Et.pixelStorei(Et.UNPACK_FLIP_Y_WEBGL,e.flipY),Et.pixelStorei(Et.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);var n=e.image,r=(n.width&n.width-1)===0&&(n.height&n.height-1)===0,i=A(e.format),s=A(e.type);C(Et.TEXTURE_2D,e,r);if(e instanceof THREE.CompressedTexture)for(var s=e.mipmaps,o=0,u=s.length;o<u;o++)n=s[o],Et.compressedTexImage2D(Et.TEXTURE_2D,o,i,n.width,n.height,0,n.data);else e instanceof THREE.DataTexture?Et.texImage2D(Et.TEXTURE_2D,0,i,n.width,n.height,0,i,s,n.data):Et.texImage2D(Et.TEXTURE_2D,0,i,i,s,e.image);e.generateMipmaps&&r&&Et.generateMipmap(Et.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Et.activeTexture(Et.TEXTURE0+t),Et.bindTexture(Et.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){e.depthBuffer===void 0&&(e.depthBuffer=!0),e.stencilBuffer===void 0&&(e.stencilBuffer=!0),e.__webglTexture=Et.createTexture();var n=(e.width&e.width-1)===0&&(e.height&e.height-1)===0,r=A(e.format),i=A(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Et.bindTexture(Et.TEXTURE_CUBE_MAP,e.__webglTexture),C(Et.TEXTURE_CUBE_MAP,e,n);for(var s=0;s<6;s++){e.__webglFramebuffer[s]=Et.createFramebuffer(),e.__webglRenderbuffer[s]=Et.createRenderbuffer(),Et.texImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,r,e.width,e.height,0,r,i,null);var o=e,u=Et.TEXTURE_CUBE_MAP_POSITIVE_X+s;Et.bindFramebuffer(Et.FRAMEBUFFER,e.__webglFramebuffer[s]),Et.framebufferTexture2D(Et.FRAMEBUFFER,Et.COLOR_ATTACHMENT0,u,o.__webglTexture,0),k(e.__webglRenderbuffer[s],e)}n&&Et.generateMipmap(Et.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=Et.createFramebuffer(),e.__webglRenderbuffer=Et.createRenderbuffer(),Et.bindTexture(Et.TEXTURE_2D,e.__webglTexture),C(Et.TEXTURE_2D,e,n),Et.texImage2D(Et.TEXTURE_2D,0,r,e.width,e.height,0,r,i,null),r=Et.TEXTURE_2D,Et.bindFramebuffer(Et.FRAMEBUFFER,e.__webglFramebuffer),Et.framebufferTexture2D(Et.FRAMEBUFFER,Et.COLOR_ATTACHMENT0,r,e.__webglTexture,0),k(e.__webglRenderbuffer,e),n&&Et.generateMipmap(Et.TEXTURE_2D);t?Et.bindTexture(Et.TEXTURE_CUBE_MAP,null):Et.bindTexture(Et.TEXTURE_2D,null),Et.bindRenderbuffer(Et.RENDERBUFFER,null),Et.bindFramebuffer(Et.FRAMEBUFFER,null)}e?(t=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,n=e.width,e=e.height,i=r=0):(t=null,n=lt,e=ct,r=at,i=ft),t!==W&&(Et.bindFramebuffer(Et.FRAMEBUFFER,t),Et.viewport(r,i,n,e),W=t),ht=n,pt=e},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,n){this.width=e,this.height=t,n=n||{},this.wrapS=n.wrapS!==void 0?n.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=n.wrapT!==void 0?n.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=n.magFilter!==void 0?n.magFilter:THREE.LinearFilter,this.minFilter=n.minFilter!==void 0?n.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=n.anisotropy!==void 0?n.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=n.format!==void 0?n.format:THREE.RGBAFormat,this.type=n.type!==void 0?n.type:THREE.UnsignedByteType,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!0,this.generateMipmaps=!0},THREE.WebGLRenderTarget.prototype.clone=function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.anisotropy=this.anisotropy,e.minFilter=this.minFilter,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e},THREE.WebGLRenderTargetCube=function(e,t,n){THREE.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.z=this.object=null},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=this.object=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.material=null},THREE.ColorUtils={adjustHSV:function(e,t,n,r){var i=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(e,i),i.h=THREE.Math.clamp(i.h+t,0,1),i.s=THREE.Math.clamp(i.s+n,0,1),i.v=THREE.Math.clamp(i.v+r,0,1),e.setHSV(i.h,i.s,i.v)},rgbToHsv:function(e,t){var n=e.r,r=e.g,i=e.b,s=Math.max(Math.max(n,r),i),o=Math.min(Math.min(n,r),i);if(o===s)o=n=0;else{var u=s-o,o=u/s,n=(n===s?(r-i)/u:r===s?2+(i-n)/u:4+(n-r)/u)/6;n<0&&(n+=1),n>1&&(n-=1)}return t===void 0&&(t={h:0,s:0,v:0}),t.h=n,t.s=o,t.v=s,t}},THREE.ColorUtils.__hsv={h:0,s:0,v:0},THREE.GeometryUtils={merge:function(e,t){for(var n,r,i=e.vertices.length,s=t instanceof THREE.Mesh?t.geometry:t,o=e.vertices,u=s.vertices,a=e.faces,f=s.faces,l=e.faceVertexUvs[0],c=s.faceVertexUvs[0],h={},p=0;p<e.materials.length;p++)h[e.materials[p].id]=p;t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,r=new THREE.Matrix4,r.extractRotation(n,t.scale));for(var p=0,d=u.length;p<d;p++){var v=u[p].clone();n&&n.multiplyVector3(v),o.push(v)}p=0;for(d=f.length;p<d;p++){var o=f[p],m,g,y=o.vertexNormals,b=o.vertexColors;o instanceof THREE.Face3?m=new THREE.Face3(o.a+i,o.b+i,o.c+i):o instanceof THREE.Face4&&(m=new THREE.Face4(o.a+i,o.b+i,o.c+i,o.d+i)),m.normal.copy(o.normal),r&&r.multiplyVector3(m.normal),u=0;for(v=y.length;u<v;u++)g=y[u].clone(),r&&r.multiplyVector3(g),m.vertexNormals.push(g);m.color.copy(o.color),u=0;for(v=b.length;u<v;u++)g=b[u],m.vertexColors.push(g.clone());o.materialIndex!==void 0&&(u=s.materials[o.materialIndex],v=u.id,b=h[v],b===void 0&&(b=e.materials.length,h[v]=b,e.materials.push(u)),m.materialIndex=b),m.centroid.copy(o.centroid),n&&n.multiplyVector3(m.centroid),a.push(m)}p=0;for(d=c.length;p<d;p++){n=c[p],r=[],u=0;for(v=n.length;u<v;u++)r.push(new THREE.UV(n[u].u,n[u].v));l.push(r)}},clone:function(e){var t=new THREE.Geometry,n,r=e.vertices,i=e.faces,s=e.faceVertexUvs[0];e.materials&&(t.materials=e.materials.slice()),e=0;for(n=r.length;e<n;e++)t.vertices.push(r[e].clone());e=0;for(n=i.length;e<n;e++)t.faces.push(i[e].clone());e=0;for(n=s.length;e<n;e++){for(var r=s[e],i=[],o=0,u=r.length;o<u;o++)i.push(new THREE.UV(r[o].u,r[o].v));t.faceVertexUvs[0].push(i)}return t},randomPointInTriangle:function(e,t,n){var r,i,s,o=new THREE.Vector3,u=THREE.GeometryUtils.__v1;return r=THREE.GeometryUtils.random(),i=THREE.GeometryUtils.random(),r+i>1&&(r=1-r,i=1-i),s=1-r-i,o.copy(e),o.multiplyScalar(r),u.copy(t),u.multiplyScalar(i),o.addSelf(u),u.copy(n),u.multiplyScalar(s),o.addSelf(u),o},randomPointInFace:function(e,t,n){var r,i,s;if(e instanceof THREE.Face3)return r=t.vertices[e.a],i=t.vertices[e.b],s=t.vertices[e.c],THREE.GeometryUtils.randomPointInTriangle(r,i,s);if(e instanceof THREE.Face4){r=t.vertices[e.a],i=t.vertices[e.b],s=t.vertices[e.c];var t=t.vertices[e.d],o;return n?e._area1&&e._area2?(n=e._area1,o=e._area2):(n=THREE.GeometryUtils.triangleArea(r,i,t),o=THREE.GeometryUtils.triangleArea(i,s,t),e._area1=n,e._area2=o):(n=THREE.GeometryUtils.triangleArea(r,i,t),o=THREE.GeometryUtils.triangleArea(i,s,t)),THREE.GeometryUtils.random()*(n+o)<n?THREE.GeometryUtils.randomPointInTriangle(r,i,t):THREE.GeometryUtils.randomPointInTriangle(i,s,t)}},randomPointsInGeometry:function(e,t){function n(e){function t(n,r){if(r<n)return n;var i=n+Math.floor((r-n)/2);return f[i]>e?t(n,i-1):f[i]<e?t(i+1,r):i}return t(0,f.length-1)}var r,i,s=e.faces,o=e.vertices,u=s.length,a=0,f=[],l,c,h,p;for(i=0;i<u;i++)r=s[i],r instanceof THREE.Face3?(l=o[r.a],c=o[r.b],h=o[r.c],r._area=THREE.GeometryUtils.triangleArea(l,c,h)):r instanceof THREE.Face4&&(l=o[r.a],c=o[r.b],h=o[r.c],p=o[r.d],r._area1=THREE.GeometryUtils.triangleArea(l,c,p),r._area2=THREE.GeometryUtils.triangleArea(c,h,p),r._area=r._area1+r._area2),a+=r._area,f[i]=a;r=[];for(i=0;i<t;i++)o=THREE.GeometryUtils.random()*a,o=n(o),r[i]=THREE.GeometryUtils.randomPointInFace(s[o],e,!0);return r},triangleArea:function(e,t,n){var r,i=THREE.GeometryUtils.__v1;return i.sub(e,t),r=i.length(),i.sub(e,n),e=i.length(),i.sub(t,n),n=i.length(),t=.5*(r+e+n),Math.sqrt(t*(t-r)*(t-e)*(t-n))},center:function(e){e.computeBoundingBox();var t=e.boundingBox,n=new THREE.Vector3;return n.add(t.min,t.max),n.multiplyScalar(-0.5),e.applyMatrix((new THREE.Matrix4).makeTranslation(n.x,n.y,n.z)),e.computeBoundingBox(),n},normalizeUVs:function(e){for(var e=e.faceVertexUvs[0],t=0,n=e.length;t<n;t++)for(var r=e[t],i=0,s=r.length;i<s;i++)r[i].u!==1&&(r[i].u=r[i].u-Math.floor(r[i].u)),r[i].v!==1&&(r[i].v=r[i].v-Math.floor(r[i].v))},triangulateQuads:function(e){var t,n,r,i,s=[],o=[],u=[];t=0;for(n=e.faceUvs.length;t<n;t++)o[t]=[];t=0;for(n=e.faceVertexUvs.length;t<n;t++)u[t]=[];t=0;for(n=e.faces.length;t<n;t++){r=e.faces[t];if(r instanceof THREE.Face4){i=r.a;var a=r.b,f=r.c,l=r.d,c=new THREE.Face3,h=new THREE.Face3;c.color.copy(r.color),h.color.copy(r.color),c.materialIndex=r.materialIndex,h.materialIndex=r.materialIndex,c.a=i,c.b=a,c.c=l,h.a=a,h.b=f,h.c=l,r.vertexColors.length===4&&(c.vertexColors[0]=r.vertexColors[0].clone(),c.vertexColors[1]=r.vertexColors[1].clone(),c.vertexColors[2]=r.vertexColors[3].clone(),h.vertexColors[0]=r.vertexColors[1].clone(),h.vertexColors[1]=r.vertexColors[2].clone(),h.vertexColors[2]=r.vertexColors[3].clone()),s.push(c,h),r=0;for(i=e.faceVertexUvs.length;r<i;r++)e.faceVertexUvs[r].length&&(c=e.faceVertexUvs[r][t],a=c[1],f=c[2],l=c[3],c=[c[0].clone(),a.clone(),l.clone()],a=[a.clone(),f.clone(),l.clone()],u[r].push(c,a));r=0;for(i=e.faceUvs.length;r<i;r++)e.faceUvs[r].length&&(a=e.faceUvs[r][t],o[r].push(a,a))}else{s.push(r),r=0;for(i=e.faceUvs.length;r<i;r++)o[r].push(e.faceUvs[r][t]);r=0;for(i=e.faceVertexUvs.length;r<i;r++)u[r].push(e.faceVertexUvs[r][t])}}e.faces=s,e.faceUvs=o,e.faceVertexUvs=u,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},explode:function(e){for(var t=[],n=0,r=e.faces.length;n<r;n++){var i=t.length,s=e.faces[n];if(s instanceof THREE.Face4){var o=s.a,u=s.b,a=s.c,o=e.vertices[o],u=e.vertices[u],a=e.vertices[a],f=e.vertices[s.d];t.push(o.clone()),t.push(u.clone()),t.push(a.clone()),t.push(f.clone()),s.a=i,s.b=i+1,s.c=i+2,s.d=i+3}else o=s.a,u=s.b,a=s.c,o=e.vertices[o],u=e.vertices[u],a=e.vertices[a],t.push(o.clone()),t.push(u.clone()),t.push(a.clone()),s.a=i,s.b=i+1,s.c=i+2}e.vertices=t,delete e.__tmpVertices},tessellate:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E=[],S=[];n=0;for(r=e.faceVertexUvs.length;n<r;n++)S[n]=[];n=0;for(r=e.faces.length;n<r;n++){i=e.faces[n];if(i instanceof THREE.Face3){s=i.a,o=i.b,u=i.c,f=e.vertices[s],l=e.vertices[o],c=e.vertices[u],p=f.distanceTo(l),d=l.distanceTo(c),h=f.distanceTo(c);if(p>t||d>t||h>t){a=e.vertices.length,b=i.clone(),w=i.clone(),p>=d&&p>=h?(f=f.clone(),f.lerpSelf(l,.5),b.a=s,b.b=a,b.c=u,w.a=a,w.b=o,w.c=u,i.vertexNormals.length===3&&(s=i.vertexNormals[0].clone(),s.lerpSelf(i.vertexNormals[1],.5),b.vertexNormals[1].copy(s),w.vertexNormals[0].copy(s)),i.vertexColors.length===3&&(s=i.vertexColors[0].clone(),s.lerpSelf(i.vertexColors[1],.5),b.vertexColors[1].copy(s),w.vertexColors[0].copy(s)),i=0):d>=p&&d>=h?(f=l.clone(),f.lerpSelf(c,.5),b.a=s,b.b=o,b.c=a,w.a=a,w.b=u,w.c=s,i.vertexNormals.length===3&&(s=i.vertexNormals[1].clone(),s.lerpSelf(i.vertexNormals[2],.5),b.vertexNormals[2].copy(s),w.vertexNormals[0].copy(s),w.vertexNormals[1].copy(i.vertexNormals[2]),w.vertexNormals[2].copy(i.vertexNormals[0])),i.vertexColors.length===3&&(s=i.vertexColors[1].clone(),s.lerpSelf(i.vertexColors[2],.5),b.vertexColors[2].copy(s),w.vertexColors[0].copy(s),w.vertexColors[1].copy(i.vertexColors[2]),w.vertexColors[2].copy(i.vertexColors[0])),i=1):(f=f.clone(),f.lerpSelf(c,.5),b.a=s,b.b=o,b.c=a,w.a=a,w.b=o,w.c=u,i.vertexNormals.length===3&&(s=i.vertexNormals[0].clone(),s.lerpSelf(i.vertexNormals[2],.5),b.vertexNormals[2].copy(s),w.vertexNormals[0].copy(s)),i.vertexColors.length===3&&(s=i.vertexColors[0].clone(),s.lerpSelf(i.vertexColors[2],.5),b.vertexColors[2].copy(s),w.vertexColors[0].copy(s)),i=2),E.push(b,w),e.vertices.push(f),s=0;for(o=e.faceVertexUvs.length;s<o;s++)e.faceVertexUvs[s].length&&(f=e.faceVertexUvs[s][n],w=f[0],u=f[1],b=f[2],i===0?(l=w.clone(),l.lerpSelf(u,.5),f=[w.clone(),l.clone(),b.clone()],u=[l.clone(),u.clone(),b.clone()]):i===1?(l=u.clone(),l.lerpSelf(b,.5),f=[w.clone(),u.clone(),l.clone()],u=[l.clone(),b.clone(),w.clone()]):(l=w.clone(),l.lerpSelf(b,.5),f=[w.clone(),u.clone(),l.clone()],u=[l.clone(),u.clone(),b.clone()]),S[s].push(f,u))}else{E.push(i),s=0;for(o=e.faceVertexUvs.length;s<o;s++)S[s].push(e.faceVertexUvs[s][n])}}else{s=i.a,o=i.b,u=i.c,a=i.d,f=e.vertices[s],l=e.vertices[o],c=e.vertices[u],h=e.vertices[a],p=f.distanceTo(l),d=l.distanceTo(c),v=c.distanceTo(h),m=f.distanceTo(h);if(p>t||d>t||v>t||m>t){g=e.vertices.length,y=e.vertices.length+1,b=i.clone(),w=i.clone(),p>=d&&p>=v&&p>=m||v>=d&&v>=p&&v>=m?(p=f.clone(),p.lerpSelf(l,.5),l=c.clone(),l.lerpSelf(h,.5),b.a=s,b.b=g,b.c=y,b.d=a,w.a=g,w.b=o,w.c=u,w.d=y,i.vertexNormals.length===4&&(s=i.vertexNormals[0].clone(),s.lerpSelf(i.vertexNormals[1],.5),o=i.vertexNormals[2].clone(),o.lerpSelf(i.vertexNormals[3],.5),b.vertexNormals[1].copy(s),b.vertexNormals[2].copy(o),w.vertexNormals[0].copy(s),w.vertexNormals[3].copy(o)),i.vertexColors.length===4&&(s=i.vertexColors[0].clone(),s.lerpSelf(i.vertexColors[1],.5),o=i.vertexColors[2].clone(),o.lerpSelf(i.vertexColors[3],.5),b.vertexColors[1].copy(s),b.vertexColors[2].copy(o),w.vertexColors[0].copy(s),w.vertexColors[3].copy(o)),i=0):(p=l.clone(),p.lerpSelf(c,.5),l=h.clone(),l.lerpSelf(f,.5),b.a=s,b.b=o,b.c=g,b.d=y,w.a=y,w.b=g,w.c=u,w.d=a,i.vertexNormals.length===4&&(s=i.vertexNormals[1].clone(),s.lerpSelf(i.vertexNormals[2],.5),o=i.vertexNormals[3].clone(),o.lerpSelf(i.vertexNormals[0],.5),b.vertexNormals[2].copy(s),b.vertexNormals[3].copy(o),w.vertexNormals[0].copy(o),w.vertexNormals[1].copy(s)),i.vertexColors.length===4&&(s=i.vertexColors[1].clone(),s.lerpSelf(i.vertexColors[2],.5),o=i.vertexColors[3].clone(),o.lerpSelf(i.vertexColors[0],.5),b.vertexColors[2].copy(s),b.vertexColors[3].copy(o),w.vertexColors[0].copy(o),w.vertexColors[1].copy(s)),i=1),E.push(b,w),e.vertices.push(p,l),s=0;for(o=e.faceVertexUvs.length;s<o;s++)e.faceVertexUvs[s].length&&(f=e.faceVertexUvs[s][n],w=f[0],u=f[1],b=f[2],f=f[3],i===0?(l=w.clone(),l.lerpSelf(u,.5),c=b.clone(),c.lerpSelf(f,.5),w=[w.clone(),l.clone(),c.clone(),f.clone()],u=[l.clone(),u.clone(),b.clone(),c.clone()]):(l=u.clone(),l.lerpSelf(b,.5),c=f.clone(),c.lerpSelf(w,.5),w=[w.clone(),u.clone(),l.clone(),c.clone()],u=[c.clone(),l.clone(),b.clone(),f.clone()]),S[s].push(w,u))}else{E.push(i),s=0;for(o=e.faceVertexUvs.length;s<o;s++)S[s].push(e.faceVertexUvs[s][n])}}}e.faces=E,e.faceVertexUvs=S}},THREE.GeometryUtils.random=THREE.Math.random16,THREE.GeometryUtils.__v1=new THREE.Vector3,THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,n,r){var i=new Image,s=new THREE.Texture(i,t),t=new THREE.ImageLoader;return t.addEventListener("load",function(e){s.image=e.content,s.needsUpdate=!0,n&&n(s)}),t.addEventListener("error",function(e){r&&r(e.message)}),t.crossOrigin=this.crossOrigin,t.load(e,i),s},loadCompressedTexture:function(e,t,n,r){var i=new THREE.CompressedTexture;i.mapping=t;var s=new XMLHttpRequest;return s.onload=function(){var e=THREE.ImageUtils.parseDDS(s.response,!0);i.format=e.format,i.mipmaps=e.mipmaps,i.image.width=e.width,i.image.height=e.height,i.generateMipmaps=!1,i.needsUpdate=!0,n&&n(i)},s.onerror=r,s.open("GET",e,!0),s.responseType="arraybuffer",s.send(null),i},loadTextureCube:function(e,t,n,r){var i=[];i.loadCount=0;var s=new THREE.Texture;s.image=i,t!==void 0&&(s.mapping=t),s.flipY=!1;for(var t=0,o=e.length;t<o;++t){var u=new Image;i[t]=u,u.onload=function(){i.loadCount=i.loadCount+1,i.loadCount===6&&(s.needsUpdate=!0,n&&n())},u.onerror=r,u.crossOrigin=this.crossOrigin,u.src=e[t]}return s},loadCompressedTextureCube:function(e,t,n,r){var i=[];i.loadCount=0;var s=new THREE.CompressedTexture;s.image=i,t!==void 0&&(s.mapping=t),s.flipY=!1,s.generateMipmaps=!1;for(var t=function(e,t){return function(){var r=THREE.ImageUtils.parseDDS(e.response,!0);t.format=r.format,t.mipmaps=r.mipmaps,t.width=r.width,t.height=r.height,i.loadCount=i.loadCount+1,i.loadCount===6&&(s.format=r.format,s.needsUpdate=!0,n&&n())}},o=0,u=e.length;o<u;++o){var a={};i[o]=a;var f=new XMLHttpRequest;f.onload=t(f,a),f.onerror=r,f.open("GET",e[o],!0),f.responseType="arraybuffer",f.send(null)}return s},parseDDS:function(e,t){function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},i=n("DXT1"),s=n("DXT3"),o=n("DXT5"),u=new Int32Array(e,0,31);if(u[0]!==542327876)return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),r;if(!u[20]&4)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),r;var a=u[21];switch(a){case i:i=8,r.format=THREE.RGB_S3TC_DXT1_Format;break;case s:i=16,r.format=THREE.RGBA_S3TC_DXT3_Format;break;case o:i=16,r.format=THREE.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)),r}r.mipmapCount=1,u[2]&131072&&t!==!1&&(r.mipmapCount=Math.max(1,u[7])),r.width=u[4],r.height=u[3],u=u[1]+4,s=r.width,o=r.height;for(a=0;a<r.mipmapCount;a++){var f=Math.max(4,s)/4*Math.max(4,o)/4*i,l={data:new Uint8Array(e,u,f),width:s,height:o};r.mipmaps.push(l),u+=f,s=Math.max(s*.5,1),o=Math.max(o*.5,1)}return r},getNormalMap:function(e,t){var n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},t=t|1,r=e.width,i=e.height,s=document.createElement("canvas");s.width=r,s.height=i;var o=s.getContext("2d");o.drawImage(e,0,0);for(var u=o.getImageData(0,0,r,i).data,a=o.createImageData(r,i),f=a.data,l=0;l<r;l++)for(var c=0;c<i;c++){var h=c-1<0?0:c-1,p=c+1>i-1?i-1:c+1,d=l-1<0?0:l-1,v=l+1>r-1?r-1:l+1,m=[],g=[0,0,u[(c*r+l)*4]/255*t];m.push([-1,0,u[(c*r+d)*4]/255*t]),m.push([-1,-1,u[(h*r+d)*4]/255*t]),m.push([0,-1,u[(h*r+l)*4]/255*t]),m.push([1,-1,u[(h*r+v)*4]/255*t]),m.push([1,0,u[(c*r+v)*4]/255*t]),m.push([1,1,u[(p*r+v)*4]/255*t]),m.push([0,1,u[(p*r+l)*4]/255*t]),m.push([-1,1,u[(p*r+d)*4]/255*t]),h=[],d=m.length;for(p=0;p<d;p++){var v=m[p],y=m[(p+1)%d],v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]],y=[y[0]-g[0],y[1]-g[1],y[2]-g[2]];h.push(n([v[1]*y[2]-v[2]*y[1],v[2]*y[0]-v[0]*y[2],v[0]*y[1]-v[1]*y[0]]))}m=[0,0,0];for(p=0;p<h.length;p++)m[0]=m[0]+h[p][0],m[1]=m[1]+h[p][1],m[2]=m[2]+h[p][2];m[0]=m[0]/h.length,m[1]=m[1]/h.length,m[2]=m[2]/h.length,g=(c*r+l)*4,f[g]=(m[0]+1)/2*255|0,f[g+1]=(m[1]+1)/2*255|0,f[g+2]=m[2]*255|0,f[g+3]=255}return o.putImageData(a,0,0),s},generateDataTexture:function(e,t,n){for(var r=e*t,i=new Uint8Array(3*r),s=Math.floor(n.r*255),o=Math.floor(n.g*255),n=Math.floor(n.b*255),u=0;u<r;u++)i[u*3]=s,i[u*3+1]=o,i[u*3+2]=n;return e=new THREE.DataTexture(i,e,t,THREE.RGBFormat),e.needsUpdate=!0,e}},THREE.SceneUtils={showHierarchy:function(e,t){THREE.SceneUtils.traverseHierarchy(e,function(e){e.visible=t})},traverseHierarchy:function(e,t){var n,r,i=e.children.length;for(r=0;r<i;r++)n=e.children[r],t(n),THREE.SceneUtils.traverseHierarchy(n,t)},createMultiMaterialObject:function(e,t){var n,r=t.length,i=new THREE.Object3D;for(n=0;n<r;n++){var s=new THREE.Mesh(e,t[n]);i.add(s)}return i},cloneObject:function(e){var t;e instanceof THREE.MorphAnimMesh?(t=new THREE.MorphAnimMesh(e.geometry,e.material),t.duration=e.duration,t.mirroredLoop=e.mirroredLoop,t.time=e.time,t.lastKeyframe=e.lastKeyframe,t.currentKeyframe=e.currentKeyframe,t.direction=e.direction,t.directionBackwards=e.directionBackwards):e instanceof THREE.SkinnedMesh?t=new THREE.SkinnedMesh(e.geometry,e.material,e.useVertexTexture):e instanceof THREE.Mesh?t=new THREE.Mesh(e.geometry,e.material):e instanceof THREE.Line?t=new THREE.Line(e.geometry,e.material,e.type):e instanceof THREE.Ribbon?t=new THREE.Ribbon(e.geometry,e.material):e instanceof THREE.ParticleSystem?(t=new THREE.ParticleSystem(e.geometry,e.material),t.sortParticles=e.sortParticles):e instanceof THREE.Particle?t=new THREE.Particle(e.material):e instanceof THREE.Sprite?(t=new THREE.Sprite({}),t.color.copy(e.color),t.map=e.map,t.blending=e.blending,t.useScreenCoordinates=e.useScreenCoordinates,t.mergeWith3D=e.mergeWith3D,t.affectedByDistance=e.affectedByDistance,t.scaleByViewport=e.scaleByViewport,t.alignment=e.alignment,t.rotation3d.copy(e.rotation3d),t.rotation=e.rotation,t.opacity=e.opacity,t.uvOffset.copy(e.uvOffset),t.uvScale.copy(e.uvScale)):e instanceof THREE.LOD?t=new THREE.LOD:e instanceof THREE.Object3D&&(t=new THREE.Object3D),t.name=e.name,t.parent=e.parent,t.up.copy(e.up),t.position.copy(e.position),t.rotation instanceof THREE.Vector3&&t.rotation.copy(e.rotation),t.eulerOrder=e.eulerOrder,t.scale.copy(e.scale),t.dynamic=e.dynamic,t.renderDepth=e.renderDepth,t.rotationAutoUpdate=e.rotationAutoUpdate,t.matrix.copy(e.matrix),t.matrixWorld.copy(e.matrixWorld),t.matrixRotationWorld.copy(e.matrixRotationWorld),t.matrixAutoUpdate=e.matrixAutoUpdate,t.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,t.quaternion.copy(e.quaternion),t.useQuaternion=e.useQuaternion,t.boundRadius=e.boundRadius,t.boundRadiusScale=e.boundRadiusScale,t.visible=e.visible,t.castShadow=e.castShadow,t.receiveShadow=e.receiveShadow,t.frustumCulled=e.frustumCulled;for(var n=0;n<e.children.length;n++){var r=THREE.SceneUtils.cloneObject(e.children[n]);t.children[n]=r,r.parent=t}if(e instanceof THREE.LOD)for(n=0;n<e.LODs.length;n++)t.LODs[n]={visibleAtDistance:e.LODs[n].visibleAtDistance,object3D:t.children[n]};return t},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){var r=new THREE.Matrix4;r.getInverse(n.matrixWorld),e.applyMatrix(r),t.remove(e),n.add(e)}},THREE.WebGLRenderer&&(THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = modelMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float uRefractionRatio;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\n#ifdef FLIP_SIDED\nfinalNormal = -finalNormal;\n#endif\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointVector = lPosition.xyz + vViewPosition.xyz;\nfloat pointDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\npointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\npointVector = normalize( pointVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 spotVector = lPosition.xyz + vViewPosition.xyz;\nfloat spotDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\nspotVector = normalize( spotVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n#endif\nspotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;\nvec3 spotHalfVector = normalize( spotVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );\nvec3 lVector = normalize( lPosition.xyz + vViewPosition.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += uDiffuseColor * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );\nvec3 lVectorGround = normalize( -lPosition.xyz + vViewPosition.xyz );\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;\n#endif\nif ( enableReflection ) {\nvec3 vReflect;\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, normal, uRefractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, normal );\n}\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING\nvNormal = normalMatrix * skinnedNormal.xyz;\nvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\nvTangent = normalMatrix * skinnedTangent.xyz;\n#else\nvNormal = normalMatrix * normal;\nvTangent = normalMatrix * tangent.xyz;\n#endif\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvUv = uv * uRepeat + uOffset;\nvec3 displacedPosition;\n#ifdef VERTEX_TEXTURES\nif ( enableDisplacement ) {\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\ndisplacedPosition = position + normalize( normal ) * df;\n} else {\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n}\n#else\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\nvec4 mPosition = modelMatrix * vec4( displacedPosition, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\nvWorldPosition = mPosition.xyz;\nvViewPosition = -mvPosition.xyz;\n#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * mPosition;\n}\n#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = modelMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}),THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){for(var t=this.getFace(),n=this.size/t.resolution,r=0,i=String(e).split(""),s=i.length,o=[],e=0;e<s;e++){var u=new THREE.Path,u=this.extractGlyphPoints(i[e],t,n,r,u),r=r+u.offset;o.push(u.path)}return{paths:o,offset:r/2}},extractGlyphPoints:function(e,t,n,r,i){var s=[],o,u,a,f,l,c,h,p,d,v,m,g=t.glyphs[e]||t.glyphs["?"];if(g){if(g.o){t=g._cachedOutline||(g._cachedOutline=g.o.split(" ")),f=t.length;for(e=0;e<f;){a=t[e++];switch(a){case"m":a=t[e++]*n+r,l=t[e++]*n,i.moveTo(a,l);break;case"l":a=t[e++]*n+r,l=t[e++]*n,i.lineTo(a,l);break;case"q":a=t[e++]*n+r,l=t[e++]*n,p=t[e++]*n+r,d=t[e++]*n,i.quadraticCurveTo(p,d,a,l);if(o=s[s.length-1]){c=o.x,h=o.y,o=1;for(u=this.divisions;o<=u;o++){var y=o/u;THREE.Shape.Utils.b2(y,c,p,a),THREE.Shape.Utils.b2(y,h,d,l)}}break;case"b":a=t[e++]*n+r,l=t[e++]*n,p=t[e++]*n+r,d=t[e++]*-n,v=t[e++]*n+r,m=t[e++]*-n,i.bezierCurveTo(a,l,p,d,v,m);if(o=s[s.length-1]){c=o.x,h=o.y,o=1;for(u=this.divisions;o<=u;o++)y=o/u,THREE.Shape.Utils.b3(y,c,p,v,a),THREE.Shape.Utils.b3(y,h,d,m,l)}}}}return{offset:g.ha*n,path:i}}}},THREE.FontUtils.generateShapes=function(e,t){var t=t||{},n=t.curveSegments!==void 0?t.curveSegments:4,r=t.font!==void 0?t.font:"helvetiker",i=t.weight!==void 0?t.weight:"normal",s=t.style!==void 0?t.style:"normal";THREE.FontUtils.size=t.size!==void 0?t.size:100,THREE.FontUtils.divisions=n,THREE.FontUtils.face=r,THREE.FontUtils.weight=i,THREE.FontUtils.style=s,n=THREE.FontUtils.drawText(e).paths,r=[],i=0;for(s=n.length;i<s;i++)Array.prototype.push.apply(r,n[i].toShapes());return r},function(e){var t=function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return n*.5};return e.Triangulate=function(e,n){var r=e.length;if(r<3)return null;var i=[],s=[],o=[],u,a,f;if(t(e)>0)for(a=0;a<r;a++)s[a]=a;else for(a=0;a<r;a++)s[a]=r-1-a;var l=2*r;for(a=r-1;r>2;){if(l--<=0){console.log("Warning, unable to triangulate polygon!");break}u=a,r<=u&&(u=0),a=u+1,r<=a&&(a=0),f=a+1,r<=f&&(f=0);var c;e:{c=e;var h=u,p=a,d=f,v=r,m=s,g=void 0,y=void 0,w=void 0,E=void 0,S=void 0,x=void 0,T=void 0,N=void 0,C=void 0,y=c[m[h]].x,w=c[m[h]].y,E=c[m[p]].x,S=c[m[p]].y,x=c[m[d]].x,T=c[m[d]].y;if(1e-10>(E-y)*(T-w)-(S-w)*(x-y))c=!1;else{for(g=0;g<v;g++)if(g!=h&&g!=p&&g!=d){var N=c[m[g]].x,C=c[m[g]].y,k=void 0,L=void 0,A=void 0,O=void 0,M=void 0,_=void 0,D=void 0,P=void 0,H=void 0,B=void 0,j=void 0,F=void 0,k=A=M=void 0,k=x-E,L=T-S,A=y-x,O=w-T,M=E-y,_=S-w,D=N-y,P=C-w,H=N-E,B=C-S,j=N-x,F=C-T,k=k*B-L*H,M=M*P-_*D,A=A*F-O*j;if(k>=0&&A>=0&&M>=0){c=!1;break e}}c=!0}}if(c){i.push([e[s[u]],e[s[a]],e[s[f]]]),o.push([s[u],s[a],s[f]]),u=a;for(f=a+1;f<r;u++,f++)s[u]=s[f];r--,l=2*r}}return n?o:i},e.Triangulate.area=t,e}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){return e=this.getUtoTmapping(e),this.getPoint(e)},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],n,r=this.getPoint(0),i,s=0;t.push(0);for(i=1;i<=e;i++)n=this.getPoint(i/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths(),r=0,i=n.length,s;s=t?t:e*n[i-1];for(var o=0,u=i-1,a;o<=u;){r=Math.floor(o+(u-o)/2),a=n[r]-s;if(a<0)o=r+1;else{if(!(a>0)){u=r;break}u=r-1}}return r=u,n[r]==s?r/(i-1):(o=n[r],n=(r+(s-o)/(n[r+1]-o))/(i-1))},THREE.Curve.prototype.getNormalVector=function(e){return e=this.getTangent(e),new THREE.Vector2(-e.y,e.x)},THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4,e=e+1e-4;return t<0&&(t=0),e>1&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().subSelf(t).normalize()},THREE.Curve.prototype.getTangentAt=function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().subSelf(this.v1);return t.multiplyScalar(e).addSelf(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(){return this.v2.clone().subSelf(this.v1).normalize()},THREE.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,e)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.CubicBezierCurve=function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,e)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.SplineCurve=function(e){this.points=e==void 0?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(e){var t=new THREE.Vector2,n=[],r=this.points,i;return i=(r.length-1)*e,e=Math.floor(i),i-=e,n[0]=e==0?e:e-1,n[1]=e,n[2]=e>r.length-2?r.length-1:e+1,n[3]=e>r.length-3?r.length-1:e+2,t.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,i),t.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,i),t},THREE.EllipseCurve=function(e,t,n,r,i,s,o){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;return this.aClockwise||(e=1-e),t=this.aStartAngle+e*t,e=this.aX+this.xRadius*Math.cos(t),t=this.aY+this.yRadius*Math.sin(t),new THREE.Vector2(e,t)},THREE.ArcCurve=function(e,t,n,r,i,s){THREE.EllipseCurve.call(this,e,t,n,n,r,i,s)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,r,i){var e=(n-e)*.5,r=(r-t)*.5,s=i*i;return(2*t-2*n+e+r)*i*s+(-3*t+3*n-2*e-r)*s+e*i+t}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.getPoint=t,e},THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.sub(this.v2,this.v1),t.multiplyScalar(e),t.addSelf(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t,n;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),n=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),e=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,n,e)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},function(e){var t,n;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,n,e)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=e==void 0?[]:e},function(e){var t=new THREE.Vector3,n=[],r=this.points,i,e=(r.length-1)*e;i=Math.floor(e),e-=i,n[0]=i==0?i:i-1,n[1]=i,n[2]=i>r.length-2?r.length-1:i+1,n[3]=i>r.length-3?r.length-1:i+2,i=r[n[0]];var s=r[n[1]],o=r[n[2]],n=r[n[3]];return t.x=THREE.Curve.Utils.interpolate(i.x,s.x,o.x,n.x,e),t.y=THREE.Curve.Utils.interpolate(i.y,s.y,o.y,n.y,e),t.z=THREE.Curve.Utils.interpolate(i.z,s.z,o.z,n.z,e),t}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=e==void 0?[]:e},function(e){var t=new THREE.Vector3,n=[],r=this.points,i;return i=(r.length-0)*e,e=Math.floor(i),i-=e,e+=e>0?0:(Math.floor(Math.abs(e)/r.length)+1)*r.length,n[0]=(e-1)%r.length,n[1]=e%r.length,n[2]=(e+1)%r.length,n[3]=(e+2)%r.length,t.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,i),t.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,i),t.z=THREE.Curve.Utils.interpolate(r[n[0]].z,r[n[1]].z,r[n[2]].z,r[n[3]].z,i),t}),THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),e=0;e<n.length;){if(n[e]>=t)return t=n[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],t=0,n,r=this.curves.length;for(n=0;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e},THREE.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),t,n,r,i,s,o;t=n=Number.NEGATIVE_INFINITY,i=s=Number.POSITIVE_INFINITY;var u,a,f,l,c=e[0]instanceof THREE.Vector3;l=c?new THREE.Vector3:new THREE.Vector2,a=0;for(f=e.length;a<f;a++)u=e[a],u.x>t?t=u.x:u.x<i&&(i=u.x),u.y>n?n=u.y:u.y<s&&(s=u.y),c&&(u.z>r?r=u.z:u.z<o&&(o=u.z)),l.addSelf(u);return e={minX:i,minY:s,maxX:t,maxY:n,centroid:l.divideScalar(f)},c&&(e.maxZ=r,e.minZ=o),e},THREE.CurvePath.prototype.createPointsGeometry=function(e){return e=this.getPoints(e,!0),this.createGeometry(e)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){return e=this.getSpacedPoints(e,!0),this.createGeometry(e)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,n=0;n<e.length;n++)t.vertices.push(new THREE.Vector3(e[n].x,e[n].y,e[n].z||0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox(),r,i,s,o,u,a;r=0;for(i=e.length;r<i;r++)s=e[r],o=s.x,u=s.y,a=o/n.maxX,a=t.getUtoTmapping(a,o),o=t.getPoint(a),u=t.getNormalVector(a).multiplyScalar(u),s.x=o.x+u.x,s.y=o.y+u.y;return e},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?(this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:n})},THREE.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,r=new THREE.LineCurve(new THREE.Vector2(r[r.length-2],r[r.length-1]),new THREE.Vector2(e,t));this.curves.push(r),this.actions.push({action:THREE.PathActions.LINE_TO,args:n})},THREE.Path.prototype.quadraticCurveTo=function(e,t,n,r){var i=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,s=new THREE.QuadraticBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r));this.curves.push(s),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:i})},THREE.Path.prototype.bezierCurveTo=function(e,t,n,r,i,s){var o=Array.prototype.slice.call(arguments),u=this.actions[this.actions.length-1].args,u=new THREE.CubicBezierCurve(new THREE.Vector2(u[u.length-2],u[u.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r),new THREE.Vector2(i,s));this.curves.push(u),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:o})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=[new THREE.Vector2(n[n.length-2],n[n.length-1])];Array.prototype.push.apply(n,e),n=new THREE.SplineCurve(n),this.curves.push(n),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,n,r,i,s){var o=this.actions[this.actions.length-1].args;this.absarc(e+o[o.length-2],t+o[o.length-1],n,r,i,s)},THREE.Path.prototype.absarc=function(e,t,n,r,i,s){this.absellipse(e,t,n,n,r,i,s)},THREE.Path.prototype.ellipse=function(e,t,n,r,i,s,o){var u=this.actions[this.actions.length-1].args;this.absellipse(e+u[u.length-2],t+u[u.length-1],n,r,i,s,o)},THREE.Path.prototype.absellipse=function(e,t,n,r,i,s,o){var u=Array.prototype.slice.call(arguments),a=new THREE.EllipseCurve(e,t,n,r,i,s,o);this.curves.push(a),a=a.getPoint(o?1:0),u.push(a.x),u.push(a.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:u})},THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],n=0;n<e;n++)t.push(this.getPoint(n/e));return t},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);var e=e||12,n=[],r,i,s,o,u,a,f,l,c,h,p,d,v;r=0;for(i=this.actions.length;r<i;r++){s=this.actions[r],o=s.action,s=s.args;switch(o){case THREE.PathActions.MOVE_TO:n.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.LINE_TO:n.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:u=s[2],a=s[3],c=s[0],h=s[1],n.length>0?(o=n[n.length-1],p=o.x,d=o.y):(o=this.actions[r-1].args,p=o[o.length-2],d=o[o.length-1]);for(s=1;s<=e;s++)v=s/e,o=THREE.Shape.Utils.b2(v,p,c,u),v=THREE.Shape.Utils.b2(v,d,h,a),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.BEZIER_CURVE_TO:u=s[4],a=s[5],c=s[0],h=s[1],f=s[2],l=s[3],n.length>0?(o=n[n.length-1],p=o.x,d=o.y):(o=this.actions[r-1].args,p=o[o.length-2],d=o[o.length-1]);for(s=1;s<=e;s++)v=s/e,o=THREE.Shape.Utils.b3(v,p,c,f,u),v=THREE.Shape.Utils.b3(v,d,h,l,a),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.CSPLINE_THRU:o=this.actions[r-1].args,v=[new THREE.Vector2(o[o.length-2],o[o.length-1])],o=e*s[0].length,v=v.concat(s[0]),v=new THREE.SplineCurve(v);for(s=1;s<=o;s++)n.push(v.getPointAt(s/o));break;case THREE.PathActions.ARC:u=s[0],a=s[1],h=s[2],f=s[3],o=s[4],c=!!s[5],p=o-f,d=e*2;for(s=1;s<=d;s++)v=s/d,c||(v=1-v),v=f+v*p,o=u+h*Math.cos(v),v=a+h*Math.sin(v),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.ELLIPSE:u=s[0],a=s[1],h=s[2],l=s[3],f=s[4],o=s[5],c=!!s[6],p=o-f,d=e*2;for(s=1;s<=d;s++)v=s/d,c||(v=1-v),v=f+v*p,o=u+h*Math.cos(v),v=a+l*Math.sin(v),n.push(new THREE.Vector2(o,v))}}return r=n[n.length-1],Math.abs(r.x-n[0].x)<1e-10&&Math.abs(r.y-n[0].y)<1e-10&&n.splice(n.length-1,1),t&&n.push(n[0]),n},THREE.Path.prototype.toShapes=function(){var e,t,n,r,i=[],s=new THREE.Path;e=0;for(t=this.actions.length;e<t;e++)n=this.actions[e],r=n.args,n=n.action,n==THREE.PathActions.MOVE_TO&&s.actions.length!=0&&(i.push(s),s=new THREE.Path),s[n].apply(s,r);s.actions.length!=0&&i.push(s);if(i.length==0)return[];var o;r=[],e=!THREE.Shape.Utils.isClockWise(i[0].getPoints());if(i.length==1)return s=i[0],o=new THREE.Shape,o.actions=s.actions,o.curves=s.curves,r.push(o),r;if(e){o=new THREE.Shape,e=0;for(t=i.length;e<t;e++)s=i[e],THREE.Shape.Utils.isClockWise(s.getPoints())?(o.actions=s.actions,o.curves=s.curves,r.push(o),o=new THREE.Shape):o.holes.push(s)}else{e=0;for(t=i.length;e<t;e++)s=i[e],THREE.Shape.Utils.isClockWise(s.getPoints())?(o&&r.push(o),o=new THREE.Shape,o.actions=s.actions,o.curves=s.curves):o.holes.push(s);r.push(o)}return r},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.makeGeometry=function(e){return new THREE.ShapeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={removeHoles:function(e,t){var n=e.concat(),r=n.concat(),i,s,o,u,a,f,l,c,h,p,d=[];for(a=0;a<t.length;a++){f=t[a],Array.prototype.push.apply(r,f),s=Number.POSITIVE_INFINITY;for(i=0;i<f.length;i++){h=f[i],p=[];for(c=0;c<n.length;c++)l=n[c],l=h.distanceToSquared(l),p.push(l),l<s&&(s=l,o=i,u=c)}i=u-1>=0?u-1:n.length-1,s=o-1>=0?o-1:f.length-1;var v=[f[o],n[u],n[i]];c=THREE.FontUtils.Triangulate.area(v);var m=[f[o],f[s],n[u]];h=THREE.FontUtils.Triangulate.area(m),p=u,l=o,u+=1,o+=-1,u<0&&(u+=n.length),u%=n.length,o<0&&(o+=f.length),o%=f.length,i=u-1>=0?u-1:n.length-1,s=o-1>=0?o-1:f.length-1,v=[f[o],n[u],n[i]],v=THREE.FontUtils.Triangulate.area(v),m=[f[o],f[s],n[u]],m=THREE.FontUtils.Triangulate.area(m),c+h>v+m&&(u=p,o=l,u<0&&(u+=n.length),u%=n.length,o<0&&(o+=f.length),o%=f.length,i=u-1>=0?u-1:n.length-1,s=o-1>=0?o-1:f.length-1),c=n.slice(0,u),h=n.slice(u),p=f.slice(o),l=f.slice(0,o),s=[f[o],f[s],n[u]],d.push([f[o],n[u],n[i]]),d.push(s),n=c.concat(p).concat(l).concat(h)}return{shape:n,isolatedPts:d,allpoints:r}},triangulateShape:function(e,t){var n=THREE.Shape.Utils.removeHoles(e,t),r=n.allpoints,i=n.isolatedPts,n=THREE.FontUtils.Triangulate(n.shape,!1),s,o,u,a,f={};s=0;for(o=r.length;s<o;s++)a=r[s].x+":"+r[s].y,f[a]!==void 0&&console.log("Duplicate point",a),f[a]=s;s=0;for(o=n.length;s<o;s++){u=n[s];for(r=0;r<3;r++)a=u[r].x+":"+u[r].y,a=f[a],a!==void 0&&(u[r]=a)}s=0;for(o=i.length;s<o;s++){u=i[s];for(r=0;r<3;r++)a=u[r].x+":"+u[r].y,a=f[a],a!==void 0&&(u[r]=a)}return n.concat(i)},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},THREE.AnimationHandler=function(){var e=[],t={},n={update:function(t){for(var n=0;n<e.length;n++)e[n].update(t)},addToUpdate:function(t){e.indexOf(t)===-1&&e.push(t)},removeFromUpdate:function(t){t=e.indexOf(t),t!==-1&&e.splice(t,1)},add:function(e){t[e.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e;if(e.initialized!==!0){for(var n=0;n<e.hierarchy.length;n++){for(var r=0;r<e.hierarchy[n].keys.length;r++){e.hierarchy[n].keys[r].time<0&&(e.hierarchy[n].keys[r].time=0);if(e.hierarchy[n].keys[r].rot!==void 0&&!(e.hierarchy[n].keys[r].rot instanceof THREE.Quaternion)){var i=e.hierarchy[n].keys[r].rot;e.hierarchy[n].keys[r].rot=new THREE.Quaternion(i[0],i[1],i[2],i[3])}}if(e.hierarchy[n].keys.length&&e.hierarchy[n].keys[0].morphTargets!==void 0){i={};for(r=0;r<e.hierarchy[n].keys.length;r++)for(var s=0;s<e.hierarchy[n].keys[r].morphTargets.length;s++){var o=e.hierarchy[n].keys[r].morphTargets[s];i[o]=-1}e.hierarchy[n].usedMorphTargets=i;for(r=0;r<e.hierarchy[n].keys.length;r++){var u={};for(o in i){for(s=0;s<e.hierarchy[n].keys[r].morphTargets.length;s++)if(e.hierarchy[n].keys[r].morphTargets[s]===o){u[o]=e.hierarchy[n].keys[r].morphTargetsInfluences[s];break}s===e.hierarchy[n].keys[r].morphTargets.length&&(u[o]=0)}e.hierarchy[n].keys[r].morphTargetsInfluences=u}}for(r=1;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].time===e.hierarchy[n].keys[r-1].time&&(e.hierarchy[n].keys.splice(r,1),r--);for(r=0;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].index=r}r=parseInt(e.length*e.fps,10),e.JIT={},e.JIT.hierarchy=[];for(n=0;n<e.hierarchy.length;n++)e.JIT.hierarchy.push(Array(r));e.initialized=!0}},get:function(e){if(typeof e=="string")return t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var n=0;n<e.bones.length;n++)t.push(e.bones[n]);else r(e,t);return t}},r=function(e,t){t.push(e);for(var n=0;n<e.children.length;n++)r(e.children[n],t)};return n.LINEAR=0,n.CATMULLROM=1,n.CATMULLROM_FORWARD=2,n}(),THREE.Animation=function(e,t,n){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=n!==void 0?n:THREE.AnimationHandler.LINEAR,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(e,t){if(this.isPlaying===!1){this.isPlaying=!0,this.loop=e!==void 0?e:!0,this.currentTime=t!==void 0?t:0;var n,r=this.hierarchy.length,i;for(n=0;n<r;n++){i=this.hierarchy[n],this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD&&(i.useQuaternion=!0),i.matrixAutoUpdate=!0,i.animationCache===void 0&&(i.animationCache={},i.animationCache.prevKey={pos:0,rot:0,scl:0},i.animationCache.nextKey={pos:0,rot:0,scl:0},i.animationCache.originalMatrix=i instanceof THREE.Bone?i.skinMatrix:i.matrix);var s=i.animationCache.prevKey;i=i.animationCache.nextKey,s.pos=this.data.hierarchy[n].keys[0],s.rot=this.data.hierarchy[n].keys[0],s.scl=this.data.hierarchy[n].keys[0],i.pos=this.getNextKeyWith("pos",n,1),i.rot=this.getNextKeyWith("rot",n,1),i.scl=this.getNextKeyWith("scl",n,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){this.isPaused===!0?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this)},THREE.Animation.prototype.update=function(e){if(this.isPlaying!==!1){var t=["pos","rot","scl"],n,r,i,s,o,u,a,f,l;l=this.currentTime=this.currentTime+e*this.timeScale,f=this.currentTime=this.currentTime%this.data.length,parseInt(Math.min(f*this.data.fps,this.data.length*this.data.fps),10);for(var c=0,h=this.hierarchy.length;c<h;c++){e=this.hierarchy[c],a=e.animationCache;for(var p=0;p<3;p++){n=t[p],o=a.prevKey[n],u=a.nextKey[n];if(u.time<=l){if(f<l){if(!this.loop){this.stop();return}o=this.data.hierarchy[c].keys[0];for(u=this.getNextKeyWith(n,c,1);u.time<f;)o=u,u=this.getNextKeyWith(n,c,u.index+1)}else do o=u,u=this.getNextKeyWith(n,c,u.index+1);while(u.time<f);a.prevKey[n]=o,a.nextKey[n]=u}e.matrixAutoUpdate=!0,e.matrixWorldNeedsUpdate=!0,r=(f-o.time)/(u.time-o.time),i=o[n],s=u[n];if(r<0||r>1)console.log("THREE.Animation.update: Warning! Scale out of bounds:"+r+" on bone "+c),r=r<0?0:1;if(n==="pos"){n=e.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR)n.x=i[0]+(s[0]-i[0])*r,n.y=i[1]+(s[1]-i[1])*r,n.z=i[2]+(s[2]-i[2])*r;else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)this.points[0]=this.getPrevKeyWith("pos",c,o.index-1).pos,this.points[1]=i,this.points[2]=s,this.points[3]=this.getNextKeyWith("pos",c,u.index+1).pos,r=r*.33+.33,i=this.interpolateCatmullRom(this.points,r),n.x=i[0],n.y=i[1],n.z=i[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(r=this.interpolateCatmullRom(this.points,r*1.01),this.target.set(r[0],r[1],r[2]),this.target.subSelf(n),this.target.y=0,this.target.normalize(),r=Math.atan2(this.target.x,this.target.z),e.rotation.set(0,r,0))}else n==="rot"?THREE.Quaternion.slerp(i,s,e.quaternion,r):n==="scl"&&(n=e.scale,n.x=i[0]+(s[0]-i[0])*r,n.y=i[1]+(s[1]-i[1])*r,n.z=i[2]+(s[2]-i[2])*r)}}}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var n=[],r=[],i,s,o,u,a,f;return i=(e.length-1)*t,s=Math.floor(i),i-=s,n[0]=s===0?s:s-1,n[1]=s,n[2]=s>e.length-2?s:s+1,n[3]=s>e.length-3?s:s+2,s=e[n[0]],u=e[n[1]],a=e[n[2]],f=e[n[3]],n=i*i,o=i*n,r[0]=this.interpolate(s[0],u[0],a[0],f[0],i,n,o),r[1]=this.interpolate(s[1],u[1],a[1],f[1],i,n,o),r[2]=this.interpolate(s[2],u[2],a[2],f[2],i,n,o),r},THREE.Animation.prototype.interpolate=function(e,t,n,r,i,s,o){return e=(n-e)*.5,r=(r-t)*.5,(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,n){for(var r=this.data.hierarchy[t].keys,n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n<r.length-1?n:r.length-1:n%r.length;n<r.length;n++)if(r[n][e]!==void 0)return r[n];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,n){for(var r=this.data.hierarchy[t].keys,n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+r.length;n>=0;n--)if(r[n][e]!==void 0)return r[n];return this.data.hierarchy[t].keys[r.length-1]},THREE.KeyFrameAnimation=function(e,t,n){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,this.JITCompile=n!==void 0?n:!0,e=0;for(t=this.hierarchy.length;e<t;e++){var n=this.data.hierarchy[e].sids,r=this.hierarchy[e];if(this.data.hierarchy[e].keys.length&&n){for(var i=0;i<n.length;i++){var s=n[i],o=this.getNextKeyWith(s,e,0);o&&o.apply(s)}r.matrixAutoUpdate=!1,this.data.hierarchy[e].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=e!==void 0?e:!0,this.currentTime=t!==void 0?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var n,r=this.hierarchy.length,i,s;for(n=0;n<r;n++)i=this.hierarchy[n],s=this.data.hierarchy[n],i.useQuaternion=!0,s.animationCache===void 0&&(s.animationCache={},s.animationCache.prevKey=null,s.animationCache.nextKey=null,s.animationCache.originalMatrix=i instanceof THREE.Bone?i.skinMatrix:i.matrix),i=this.data.hierarchy[n].keys,i.length&&(s.animationCache.prevKey=i[0],s.animationCache.nextKey=i[1],this.startTime=Math.min(i[0].time,this.startTime),this.endTime=Math.max(i[i.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],n=this.data.hierarchy[e];if(n.animationCache!==void 0){var r=n.animationCache.originalMatrix;t instanceof THREE.Bone?(r.copy(t.skinMatrix),t.skinMatrix=r):(r.copy(t.matrix),t.matrix=r),delete n.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,n,r,i,s=this.data.JIT.hierarchy,o,u,a;u=this.currentTime=this.currentTime+e*this.timeScale,o=this.currentTime=this.currentTime%this.data.length,o<this.startTimeMs&&(o=this.currentTime=this.startTimeMs+o),i=parseInt(Math.min(o*this.data.fps,this.data.length*this.data.fps),10);if((a=o<u)&&!this.loop){for(var e=0,f=this.hierarchy.length;e<f;e++){var l=this.data.hierarchy[e].keys,s=this.data.hierarchy[e].sids;r=l.length-1,i=this.hierarchy[e];if(l.length){for(l=0;l<s.length;l++)o=s[l],(u=this.getPrevKeyWith(o,e,r))&&u.apply(o);this.data.hierarchy[e].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}this.stop()}else if(!(o<this.startTime)){e=0;for(f=this.hierarchy.length;e<f;e++){r=this.hierarchy[e],t=this.data.hierarchy[e];var l=t.keys,c=t.animationCache;if(this.JITCompile&&s[e][i]!==void 0)r instanceof THREE.Bone?(r.skinMatrix=s[e][i],r.matrixWorldNeedsUpdate=!1):(r.matrix=s[e][i],r.matrixWorldNeedsUpdate=!0);else if(l.length){this.JITCompile&&c&&(r instanceof THREE.Bone?r.skinMatrix=c.originalMatrix:r.matrix=c.originalMatrix),t=c.prevKey,n=c.nextKey;if(t&&n){if(n.time<=u){if(a&&this.loop){t=l[0];for(n=l[1];n.time<o;)t=n,n=l[t.index+1]}else if(!a)for(var h=l.length-1;n.time<o&&n.index!==h;)t=n,n=l[t.index+1];c.prevKey=t,c.nextKey=n}n.time>=o?t.interpolate(n,o):t.interpolate(n,n.time)}this.data.hierarchy[e].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&s[0][i]===void 0){this.hierarchy[0].updateMatrixWorld(!0);for(e=0;e<this.hierarchy.length;e++)s[e][i]=this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix.clone():this.hierarchy[e].matrix.clone()}}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n%=t.length;n<t.length;n++)if(t[n].hasTarget(e))return t[n];return t[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n=n>=0?n:n+t.length;n>=0;n--)if(t[n].hasTarget(e))return t[n];return t[t.length-1]},THREE.CubeCamera=function(e,t,n){THREE.Object3D.call(this);var r=new THREE.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new THREE.Vector3(1,0,0)),this.add(r);var i=new THREE.PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new THREE.Vector3(-1,0,0)),this.add(i);var s=new THREE.PerspectiveCamera(90,1,e,t);s.up.set(0,0,1),s.lookAt(new THREE.Vector3(0,1,0)),this.add(s);var o=new THREE.PerspectiveCamera(90,1,e,t);o.up.set(0,0,-1),o.lookAt(new THREE.Vector3(0,-1,0)),this.add(o);var u=new THREE.PerspectiveCamera(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new THREE.Vector3(0,0,1)),this.add(u);var a=new THREE.PerspectiveCamera(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new THREE.Vector3(0,0,-1)),this.add(a),this.renderTarget=new THREE.WebGLRenderTargetCube(n,n,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,l=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,r,n),n.activeCubeFace=1,e.render(t,i,n),n.activeCubeFace=2,e.render(t,s,n),n.activeCubeFace=3,e.render(t,o,n),n.activeCubeFace=4,e.render(t,u,n),n.generateMipmaps=l,n.activeCubeFace=5,e.render(t,a,n)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CombinedCamera=function(e,t,n,r,i,s,o){THREE.Camera.call(this),this.fov=n,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,s,o),this.cameraP=new THREE.PerspectiveCamera(n,e/t,r,i),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){t===void 0&&(t=24);var n=2*Math.atan(t/(e*2))*(180/Math.PI);return this.setFov(n),n},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.FirstPersonControls=function(e,t){function n(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=t!==void 0?t:document,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0,this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1,this.viewHalfY=this.viewHalfX=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation();if(this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){e.preventDefault(),e.stopPropagation();if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(e){var t=0;if(!this.freeze){this.heightSpeed?(t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin,this.autoSpeedFactor=e*t*this.heightCoef):this.autoSpeedFactor=0,t=e*this.movementSpeed,(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t),e*=this.lookSpeed,this.activeLook||(e=0),this.lon=this.lon+this.mouseX*e,this.lookVertical&&(this.lat=this.lat-this.mouseY*e),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180;var t=this.target,n=this.object.position;t.x=n.x+100*Math.sin(this.phi)*Math.cos(this.theta),t.y=n.y+100*Math.cos(this.phi),t.z=n.z+100*Math.sin(this.phi)*Math.sin(this.theta),t=1,this.constrainVertical&&(t=Math.PI/(this.verticalMax-this.verticalMin)),this.lon=this.lon+this.mouseX*e,this.lookVertical&&(this.lat=this.lat-this.mouseY*e*t),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180,this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),t=this.target,n=this.object.position,t.x=n.x+100*Math.sin(this.phi)*Math.cos(this.theta),t.y=n.y+100*Math.cos(this.phi),t.z=n.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(t)}},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",n(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",n(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",n(this,this.onMouseUp),!1),this.domElement.addEventListener("keydown",n(this,this.onKeyDown),!1),this.domElement.addEventListener("keyup",n(this,this.onKeyUp),!1),this.handleResize()},THREE.PathControls=function(e,t){function n(e){return(e*=2)<1?.5*e*e:-0.5*(--e*(e-2)-1)}function r(e,t){return function(){t.apply(e,arguments)}}function i(e,t,n,r){var i={name:n,fps:.6,length:r,hierarchy:[]},s,o=t.getControlPointsArray(),u=t.getLength(),a=o.length,f=0;s=a-1,t={parent:-1,keys:[]},t.keys[0]={time:0,pos:o[0],rot:[0,0,0,1],scl:[1,1,1]},t.keys[s]={time:r,pos:o[s],rot:[0,0,0,1],scl:[1,1,1]};for(s=1;s<a-1;s++)f=r*u.chunks[s]/u.total,t.keys[s]={time:f,pos:o[s]};return i.hierarchy[0]=t,THREE.AnimationHandler.add(i),new THREE.Animation(e,n,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function s(e,t){var n,r,i=new THREE.Geometry;for(n=0;n<e.points.length*t;n++)r=n/(e.points.length*t),r=e.getPoint(r),i.vertices[n]=new THREE.Vector3(r.x,r.y,r.z);return i}this.object=e,this.domElement=t!==void 0?t:document,this.id="PathControls"+THREE.PathControlsIdCounter++,this.duration=1e4,this.waypoints=[],this.useConstantSpeed=!0,this.resamplingCoef=50,this.debugPath=new THREE.Object3D,this.debugDummy=new THREE.Object3D,this.animationParent=new THREE.Object3D,this.lookSpeed=.005,this.lookHorizontal=this.lookVertical=!0,this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.target=new THREE.Object3D,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;var o=Math.PI*2,u=Math.PI/180;this.viewHalfY=this.viewHalfX=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.update=function(e){var t;this.lookHorizontal&&(this.lon=this.lon+this.mouseX*this.lookSpeed*e),this.lookVertical&&(this.lat=this.lat-this.mouseY*this.lookSpeed*e),this.lon=Math.max(0,Math.min(360,this.lon)),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*u,this.theta=this.lon*u,e=this.phi%o,this.phi=e>=0?e:e+o,t=this.verticalAngleMap.srcRange,e=this.verticalAngleMap.dstRange,t=THREE.Math.mapLinear(this.phi,t[0],t[1],e[0],e[1]);var r=e[1]-e[0];this.phi=n((t-e[0])/r)*r+e[0],t=this.horizontalAngleMap.srcRange,e=this.horizontalAngleMap.dstRange,t=THREE.Math.mapLinear(this.theta,t[0],t[1],e[0],e[1]),r=e[1]-e[0],this.theta=n((t-e[0])/r)*r+e[0],e=this.target.position,e.x=100*Math.sin(this.phi)*Math.cos(this.theta),e.y=100*Math.cos(this.phi),e.z=100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(this.target.position)},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.init=function(){this.spline=new THREE.Spline,this.spline.initFromArray(this.waypoints),this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var e=new THREE.MeshLambertMaterial({color:30719}),t=new THREE.MeshLambertMaterial({color:65280}),n=new THREE.CubeGeometry(10,10,20),o=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(n,e),e=new THREE.Mesh(o,t),e.position.set(0,10,0),this.animation=i(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.object),this.animationParent.add(this.target),this.animationParent.add(e)}else this.animation=i(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object);if(this.createDebugPath){var e=this.debugPath,t=this.spline,o=s(t,10),n=s(t,10),u=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),o=new THREE.Line(o,u),n=new THREE.ParticleSystem(n,new THREE.ParticleBasicMaterial({color:16755200,size:3}));o.scale.set(1,1,1),e.add(o),n.scale.set(1,1,1),e.add(n);for(var o=new THREE.SphereGeometry(1,16,8),u=new THREE.MeshBasicMaterial({color:65280}),a=0;a<t.points.length;a++)n=new THREE.Mesh(o,u),n.position.copy(t.points[a]),e.add(n)}this.domElement.addEventListener("mousemove",r(this,this.onMouseMove),!1)},this.handleResize()},THREE.PathControlsIdCounter=0,THREE.FlyControls=function(e,t){function n(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.domElement=t!==void 0?t:document,t&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.autoForward=this.dragToLook=!1,this.object.useQuaternion=!0,this.tmpQuaternion=new THREE.Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new THREE.Vector3(0,0,0),this.rotationVector=new THREE.Vector3(0,0,0),this.handleEvent=function(e){typeof this[e.type]=="function"&&this[e.type](e)},this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(e.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),n=t.size[0]/2,r=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.pageY-t.offset[1]-r)/r,this.updateRotationVector()}},this.mouseup=function(e){e.preventDefault(),e.stopPropagation();if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()},this.update=function(e){var t=e*this.movementSpeed,e=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize(),this.object.quaternion.multiplySelf(this.tmpQuaternion),this.object.matrix.setPosition(this.object.position),this.object.matrix.setRotationFromQuaternion(this.object.quaternion),this.object.matrixWorldNeedsUpdate=!0},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement.addEventListener("mousemove",n(this,this.mousemove),!1),this.domElement.addEventListener("mousedown",n(this,this.mousedown),!1),this.domElement.addEventListener("mouseup",n(this,this.mouseup),!1),this.domElement.addEventListener("keydown",n(this,this.keydown),!1),this.domElement.addEventListener("keyup",n(this,this.keyup),!1),this.updateMovementVector(),this.updateRotationVector()},THREE.RollControls=function(e,t){this.object=e,this.domElement=t!==void 0?t:document,this.mouseLook=!0,this.autoForward=!1,this.rollSpeed=this.movementSpeed=this.lookSpeed=1,this.constrainVertical=[-0.9,.9],this.object.matrixAutoUpdate=!1,this.forward=new THREE.Vector3(0,0,1),this.roll=0;var n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3,s=new THREE.Matrix4,o=!1,u=1,a=0,f=0,l=0,c=0,h=0,p=0,d=0;this.handleResize=function(){p=window.innerWidth/2,d=window.innerHeight/2},this.update=function(e){if(this.mouseLook){var t=e*this.lookSpeed;this.rotateHorizontally(t*c),this.rotateVertically(t*h)}t=e*this.movementSpeed,this.object.translateZ(-t*(a>0||this.autoForward&&!(a<0)?1:a)),this.object.translateX(t*f),this.object.translateY(t*l),o&&(this.roll=this.roll+this.rollSpeed*e*u),this.forward.y>this.constrainVertical[1]?(this.forward.y=this.constrainVertical[1],this.forward.normalize()):this.forward.y<this.constrainVertical[0]&&(this.forward.y=this.constrainVertical[0],this.forward.normalize()),i.copy(this.forward),r.set(0,1,0),n.cross(r,i).normalize(),r.cross(i,n).normalize(),this.object.matrix.elements[0]=n.x,this.object.matrix.elements[4]=r.x,this.object.matrix.elements[8]=i.x,this.object.matrix.elements[1]=n.y,this.object.matrix.elements[5]=r.y,this.object.matrix.elements[9]=i.y,this.object.matrix.elements[2]=n.z,this.object.matrix.elements[6]=r.z,this.object.matrix.elements[10]=i.z,s.identity(),s.elements[0]=Math.cos(this.roll),s.elements[4]=-Math.sin(this.roll),s.elements[1]=Math.sin(this.roll),s.elements[5]=Math.cos(this.roll),this.object.matrix.multiplySelf(s),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.elements[12]=this.object.position.x,this.object.matrix.elements[13]=this.object.position.y,this.object.matrix.elements[14]=this.object.position.z},this.translateX=function(e){this.object.position.x=this.object.position.x+this.object.matrix.elements[0]*e,this.object.position.y=this.object.position.y+this.object.matrix.elements[1]*e,this.object.position.z=this.object.position.z+this.object.matrix.elements[2]*e},this.translateY=function(e){this.object.position.x=this.object.position.x+this.object.matrix.elements[4]*e,this.object.position.y=this.object.position.y+this.object.matrix.elements[5]*e,this.object.position.z=this.object.position.z+this.object.matrix.elements[6]*e},this.translateZ=function(e){this.object.position.x=this.object.position.x-this.object.matrix.elements[8]*e,this.object.position.y=this.object.position.y-this.object.matrix.elements[9]*e,this.object.position.z=this.object.position.z-this.object.matrix.elements[10]*e},this.rotateHorizontally=function(e){n.set(this.object.matrix.elements[0],this.object.matrix.elements[1],this.object.matrix.elements[2]),n.multiplyScalar(e),this.forward.subSelf(n),this.forward.normalize()},this.rotateVertically=function(e){r.set(this.object.matrix.elements[4],this.object.matrix.elements[5],this.object.matrix.elements[6]),r.multiplyScalar(e),this.forward.addSelf(r),this.forward.normalize()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){c=(e.clientX-p)/window.innerWidth,h=(e.clientY-d)/window.innerHeight},!1),this.domElement.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation();switch(e.button){case 0:a=1;break;case 2:a=-1}},!1),this.domElement.addEventListener("mouseup",function(e){e.preventDefault(),e.stopPropagation();switch(e.button){case 0:a=0;break;case 2:a=0}},!1),this.domElement.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 87:a=1;break;case 37:case 65:f=-1;break;case 40:case 83:a=-1;break;case 39:case 68:f=1;break;case 81:o=!0,u=1;break;case 69:o=!0,u=-1;break;case 82:l=1;break;case 70:l=-1}},!1),this.domElement.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 87:a=0;break;case 37:case 65:f=0;break;case 40:case 83:a=0;break;case 39:case 68:f=0;break;case 81:o=!1;break;case 69:o=!1;break;case 82:l=0;break;case 70:l=0}},!1),this.handleResize()},THREE.TrackballControls=function(e,t){function n(e){if(r.enabled){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),l.y=l.y+1/t*.05}}THREE.EventTarget.call(this);var r=this;this.object=e,this.domElement=t!==void 0?t:document,this.enabled=!0,this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=Infinity,this.keys=[65,83,68],this.target=new THREE.Vector3;var i=new THREE.Vector3,s=!1,o=-1,u=new THREE.Vector3,a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector2,c=new THREE.Vector2,h=new THREE.Vector2,p=new THREE.Vector2,d={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth,this.screen.height=window.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleEvent=function(e){typeof this[e.type]=="function"&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THREE.Vector2((e-r.screen.offsetLeft)/r.radius*.5,(t-r.screen.offsetTop)/r.radius*.5)},this.getMouseProjectionOnBall=function(e,t){var n=new THREE.Vector3((e-r.screen.width*.5-r.screen.offsetLeft)/r.radius,(r.screen.height*.5+r.screen.offsetTop-t)/r.radius,0),i=n.length();return i>1?n.normalize():n.z=Math.sqrt(1-i*i),u.copy(r.object.position).subSelf(r.target),i=r.object.up.clone().setLength(n.y),i.addSelf(r.object.up.clone().crossSelf(u).setLength(n.x)),i.addSelf(u.setLength(n.z)),i},this.rotateCamera=function(){var e=Math.acos(a.dot(f)/a.length()/f.length());if(e){var t=(new THREE.Vector3).cross(a,f).normalize(),n=new THREE.Quaternion,e=e*r.rotateSpeed;n.setFromAxisAngle(t,-e),n.multiplyVector3(u),n.multiplyVector3(r.object.up),n.multiplyVector3(f),r.staticMoving?a.copy(f):(n.setFromAxisAngle(t,e*(r.dynamicDampingFactor-1)),n.multiplyVector3(a))}},this.zoomCamera=function(){var e=1+(c.y-l.y)*r.zoomSpeed;e!==1&&e>0&&(u.multiplyScalar(e),r.staticMoving?l.copy(c):l.y=l.y+(c.y-l.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=p.clone().subSelf(h);if(e.lengthSq()){e.multiplyScalar(u.length()*r.panSpeed);var t=u.clone().crossSelf(r.object.up).setLength(e.x);t.addSelf(r.object.up.clone().setLength(e.y)),r.object.position.addSelf(t),r.target.addSelf(t),r.staticMoving?h=p:h.addSelf(e.sub(p,h).multiplyScalar(r.dynamicDampingFactor))}},this.checkDistances=function(){if(!r.noZoom||!r.noPan)r.object.position.lengthSq()>r.maxDistance*r.maxDistance&&r.object.position.setLength(r.maxDistance),u.lengthSq()<r.minDistance*r.minDistance&&r.object.position.add(r.target,u.setLength(r.minDistance))},this.update=function(){u.copy(r.object.position).subSelf(r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.add(r.target,u),r.checkDistances(),r.object.lookAt(r.target),i.distanceToSquared(r.object.position)>0&&(r.dispatchEvent(d),i.copy(r.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){r.enabled&&(s&&(a=f=r.getMouseProjectionOnBall(e.clientX,e.clientY),l=c=r.getMouseOnScreen(e.clientX,e.clientY),h=p=r.getMouseOnScreen(e.clientX,e.clientY),s=!1),o!==-1&&(o===0&&!r.noRotate?f=r.getMouseProjectionOnBall(e.clientX,e.clientY):o===1&&!r.noZoom?c=r.getMouseOnScreen(e.clientX,e.clientY):o===2&&!r.noPan&&(p=r.getMouseOnScreen(e.clientX,e.clientY))))},!1),this.domElement.addEventListener("mousedown",function(e){r.enabled&&(e.preventDefault(),e.stopPropagation(),o===-1&&(o=e.button,o===0&&!r.noRotate?a=f=r.getMouseProjectionOnBall(e.clientX,e.clientY):o===1&&!r.noZoom?l=c=r.getMouseOnScreen(e.clientX,e.clientY):this.noPan||(h=p=r.getMouseOnScreen(e.clientX,e.clientY))))},!1),this.domElement.addEventListener("mouseup",function(e){r.enabled&&(e.preventDefault(),e.stopPropagation(),o=-1)},!1),this.domElement.addEventListener("DOMMouseScroll",n,!1),this.domElement.addEventListener("mousewheel",n,!1),window.addEventListener("keydown",function(e){r.enabled&&o===-1&&(e.keyCode===r.keys[0]&&!r.noRotate?o=0:e.keyCode===r.keys[1]&&!r.noZoom?o=1:e.keyCode===r.keys[2]&&!r.noPan&&(o=2),o!==-1&&(s=!0))},!1),window.addEventListener("keyup",function(){r.enabled&&o!==-1&&(o=-1)},!1),this.handleResize()},THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*s.autoRotateSpeed}function r(e){e.preventDefault(),y===g.ROTATE?(a.set(e.clientX,e.clientY),f.sub(a,u),s.rotateLeft(2*Math.PI*f.x/o*s.userRotateSpeed),s.rotateUp(2*Math.PI*f.y/o*s.userRotateSpeed),u.copy(a)):y===g.ZOOM&&(c.set(e.clientX,e.clientY),h.sub(c,l),h.y>0?s.zoomIn():s.zoomOut(),l.copy(c))}function i(){s.userRotate&&(document.removeEventListener("mousemove",r,!1),document.removeEventListener("mouseup",i,!1),y=g.NONE)}THREE.EventTarget.call(this),this.object=e,this.domElement=t!==void 0?t:document,this.center=new THREE.Vector3,this.userZoom=!0,this.userZoomSpeed=1,this.userRotate=!0,this.userRotateSpeed=1,this.autoRotate=!1,this.autoRotateSpeed=2;var s=this,o=1800,u=new THREE.Vector2,a=new THREE.Vector2,f=new THREE.Vector2,l=new THREE.Vector2,c=new THREE.Vector2,h=new THREE.Vector2,p=0,d=0,v=1,m=new THREE.Vector3,g={NONE:-1,ROTATE:0,ZOOM:1},y=g.NONE,b={type:"change"};this.rotateLeft=function(e){e===void 0&&(e=n()),d-=e},this.rotateRight=function(e){e===void 0&&(e=n()),d+=e},this.rotateUp=function(e){e===void 0&&(e=n()),p-=e},this.rotateDown=function(e){e===void 0&&(e=n()),p+=e},this.zoomIn=function(e){e===void 0&&(e=Math.pow(.95,s.userZoomSpeed)),v/=e},this.zoomOut=function(e){e===void 0&&(e=Math.pow(.95,s.userZoomSpeed)),v*=e},this.update=function(){var e=this.object.position,t=e.clone().subSelf(this.center),r=Math.atan2(t.x,t.z),i=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);this.autoRotate&&this.rotateLeft(n());var r=r+d,i=i+p,i=Math.max(1e-6,Math.min(Math.PI-1e-6,i)),s=t.length();t.x=s*Math.sin(i)*Math.sin(r),t.y=s*Math.cos(i),t.z=s*Math.sin(i)*Math.cos(r),t.multiplyScalar(v),e.copy(this.center).addSelf(t),this.object.lookAt(this.center),p=d=0,v=1,m.distanceTo(this.object.position)>0&&(this.dispatchEvent(b),m.copy(this.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",function(e){s.userRotate&&(e.preventDefault(),e.button===0||e.button===2?(y=g.ROTATE,u.set(e.clientX,e.clientY)):e.button===1&&(y=g.ZOOM,l.set(e.clientX,e.clientY)),document.addEventListener("mousemove",r,!1),document.addEventListener("mouseup",i,!1))},!1),this.domElement.addEventListener("mousewheel",function(e){s.userZoom&&(e.wheelDelta>0?s.zoomOut():s.zoomIn())},!1)},THREE.CircleGeometry=function(e,t,n,r){THREE.Geometry.call(this);var e=e||50,n=n!==void 0?n:0,r=r!==void 0?r:Math.PI*2,t=t!==void 0?Math.max(3,t):8,i,s=[];i=new THREE.Vector3;var o=new THREE.UV(.5,.5);this.vertices.push(i),s.push(o);for(i=0;i<=t;i++){var u=new THREE.Vector3;u.x=e*Math.cos(n+i/t*r),u.y=e*Math.sin(n+i/t*r),this.vertices.push(u),s.push(new THREE.UV((u.x/e+1)/2,-(u.y/e+1)/2+1))}n=new THREE.Vector3(0,0,-1);for(i=1;i<=t;i++)this.faces.push(new THREE.Face3(i,i+1,0,[n,n,n])),this.faceVertexUvs[0].push([s[i],s[i+1],o]);this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:e}},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=function(e,t,n,r,i,s,o,u){function a(e,t,n,o,u,a,l,c){var h,p=r||1,d=i||1,v=u/2,m=a/2,g=f.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x")h="z";else if(e==="x"&&t==="z"||e==="z"&&t==="x")h="y",d=s||1;else if(e==="z"&&t==="y"||e==="y"&&t==="z")h="x",p=s||1;var y=p+1,b=d+1,w=u/p,E=a/d,S=new THREE.Vector3;S[h]=l>0?1:-1;for(u=0;u<b;u++)for(a=0;a<y;a++){var x=new THREE.Vector3;x[e]=(a*w-v)*n,x[t]=(u*E-m)*o,x[h]=l,f.vertices.push(x)}for(u=0;u<d;u++)for(a=0;a<p;a++)e=new THREE.Face4(a+y*u+g,a+y*(u+1)+g,a+1+y*(u+1)+g,a+1+y*u+g),e.normal.copy(S),e.vertexNormals.push(S.clone(),S.clone(),S.clone(),S.clone()),e.materialIndex=c,f.faces.push(e),f.faceVertexUvs[0].push([new THREE.UV(a/p,1-u/d),new THREE.UV(a/p,1-(u+1)/d),new THREE.UV((a+1)/p,1-(u+1)/d),new THREE.UV((a+1)/p,1-u/d)])}THREE.Geometry.call(this);var f=this,l=e/2,c=t/2,h=n/2,p,d,v,m,g,y;if(o!==void 0){if(o instanceof Array)this.materials=o;else{this.materials=[];for(p=0;p<6;p++)this.materials.push(o)}p=0,m=1,d=2,g=3,v=4,y=5}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(u!=void 0)for(var b in u)this.sides[b]!==void 0&&(this.sides[b]=u[b]);this.sides.px&&a("z","y",-1,-1,n,t,l,p),this.sides.nx&&a("z","y",1,-1,n,t,-l,m),this.sides.py&&a("x","z",1,1,e,n,c,d),this.sides.ny&&a("x","z",1,-1,e,n,-c,g),this.sides.pz&&a("x","y",1,-1,e,t,h,v),this.sides.nz&&a("x","y",-1,-1,e,t,-h,y),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this);var e=e!==void 0?e:20,t=t!==void 0?t:20,n=n!==void 0?n:100,o=n/2,r=r||8,i=i||1,u,a,f=[],l=[];for(a=0;a<=i;a++){var c=[],h=[],p=a/i,d=p*(t-e)+e;for(u=0;u<=r;u++){var v=u/r,m=new THREE.Vector3;m.x=d*Math.sin(v*Math.PI*2),m.y=-p*n+o,m.z=d*Math.cos(v*Math.PI*2),this.vertices.push(m),c.push(this.vertices.length-1),h.push(new THREE.UV(v,1-p))}f.push(c),l.push(h)}n=(t-e)/n;for(u=0;u<r;u++){e!==0?(c=this.vertices[f[0][u]].clone(),h=this.vertices[f[0][u+1]].clone()):(c=this.vertices[f[1][u]].clone(),h=this.vertices[f[1][u+1]].clone()),c.setY(Math.sqrt(c.x*c.x+c.z*c.z)*n).normalize(),h.setY(Math.sqrt(h.x*h.x+h.z*h.z)*n).normalize();for(a=0;a<i;a++){var p=f[a][u],d=f[a+1][u],v=f[a+1][u+1],m=f[a][u+1],g=c.clone(),y=c.clone(),b=h.clone(),w=h.clone(),E=l[a][u].clone(),S=l[a+1][u].clone(),x=l[a+1][u+1].clone(),T=l[a][u+1].clone();this.faces.push(new THREE.Face4(p,d,v,m,[g,y,b,w])),this.faceVertexUvs[0].push([E,S,x,T])}}if(!s&&e>0){this.vertices.push(new THREE.Vector3(0,o,0));for(u=0;u<r;u++)p=f[0][u],d=f[0][u+1],v=this.vertices.length-1,g=new THREE.Vector3(0,1,0),y=new THREE.Vector3(0,1,0),b=new THREE.Vector3(0,1,0),E=l[0][u].clone(),S=l[0][u+1].clone(),x=new THREE.UV(S.u,0),this.faces.push(new THREE.Face3(p,d,v,[g,y,b])),this.faceVertexUvs[0].push([E,S,x])}if(!s&&t>0){this.vertices.push(new THREE.Vector3(0,-o,0));for(u=0;u<r;u++)p=f[a][u+1],d=f[a][u],v=this.vertices.length-1,g=new THREE.Vector3(0,-1,0),y=new THREE.Vector3(0,-1,0),b=new THREE.Vector3(0,-1,0),E=l[a][u+1].clone(),S=l[a][u].clone(),x=new THREE.UV(S.u,1),this.faces.push(new THREE.Face3(p,d,v,[g,y,b])),this.faceVertexUvs[0].push([E,S,x])}this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(e,t){typeof e!="undefined"&&(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var n=e.length,r=0;r<n;r++)this.addShape(e[r],t)},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function n(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).addSelf(e)}function r(e,t,n){var r=THREE.ExtrudeGeometry.__v1,i=THREE.ExtrudeGeometry.__v2,s=THREE.ExtrudeGeometry.__v3,o=THREE.ExtrudeGeometry.__v4,u=THREE.ExtrudeGeometry.__v5,a=THREE.ExtrudeGeometry.__v6;return r.set(e.x-t.x,e.y-t.y),i.set(e.x-n.x,e.y-n.y),r=r.normalize(),i=i.normalize(),s.set(-r.y,r.x),o.set(i.y,-i.x),u.copy(e).addSelf(s),a.copy(e).addSelf(o),u.equals(a)?o.clone():(u.copy(t).addSelf(s),a.copy(n).addSelf(o),s=r.dot(o),o=a.subSelf(u).dot(o),s===0&&(console.log("Either infinite or no solutions!"),o===0?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),o/=s,o<0?(t=Math.atan2(t.y-e.y,t.x-e.x),e=Math.atan2(n.y-e.y,n.x-e.x),t>e&&(e+=Math.PI*2),n=(t+e)/2,e=-Math.cos(n),n=-Math.sin(n),new THREE.Vector2(e,n)):r.multiplyScalar(o).addSelf(u).subSelf(e).clone())}function i(n,r){var i,s;for(F=n.length;--F>=0;){i=F,s=F-1,s<0&&(s=n.length-1);for(var o=0,u=h+l*2,o=0;o<u;o++){var a=H*o,f=H*(o+1),c=r+i+a,a=r+s+a,p=r+s+f,f=r+i+f,d=n,v=o,m=u,b=i,w=s,c=c+k,a=a+k,p=p+k,f=f+k;C.faces.push(new THREE.Face4(c,a,p,f,null,null,g)),c=y.generateSideWallUV(C,e,d,t,c,a,p,f,v,m,b,w),C.faceVertexUvs[0].push(c)}}}function s(e,t,n){C.vertices.push(new THREE.Vector3(e,t,n))}function o(n,r,i,s){n+=k,r+=k,i+=k,C.faces.push(new THREE.Face3(n,r,i,null,null,m)),n=s?y.generateBottomUV(C,e,t,n,r,i):y.generateTopUV(C,e,t,n,r,i),C.faceVertexUvs[0].push(n)}var u=t.amount!==void 0?t.amount:100,a=t.bevelThickness!==void 0?t.bevelThickness:6,f=t.bevelSize!==void 0?t.bevelSize:a-2,l=t.bevelSegments!==void 0?t.bevelSegments:3,c=t.bevelEnabled!==void 0?t.bevelEnabled:!0,h=t.steps!==void 0?t.steps:1,p=t.extrudePath,d,v=!1,m=t.material,g=t.extrudeMaterial,y=t.UVGenerator!==void 0?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,b,w,E,S;p&&(d=p.getSpacedPoints(h),v=!0,c=!1,b=t.frames!==void 0?t.frames:new THREE.TubeGeometry.FrenetFrames(p,h,!1),w=new THREE.Vector3,E=new THREE.Vector3,S=new THREE.Vector3),c||(f=a=l=0);var x,T,N,C=this,k=this.vertices.length,p=e.extractPoints(),L=p.shape,p=p.holes,A=!THREE.Shape.Utils.isClockWise(L);if(A){L=L.reverse(),T=0;for(N=p.length;T<N;T++)x=p[T],THREE.Shape.Utils.isClockWise(x)&&(p[T]=x.reverse());A=!1}var O=THREE.Shape.Utils.triangulateShape(L,p),A=L;T=0;for(N=p.length;T<N;T++)x=p[T],L=L.concat(x);var M,_,D,P,H=L.length,B=O.length,j=[],F=0,I=A.length;M=I-1;for(_=F+1;F<I;F++,M++,_++)M===I&&(M=0),_===I&&(_=0),j[F]=r(A[F],A[M],A[_]);var q=[],R,U=j.concat();T=0;for(N=p.length;T<N;T++){x=p[T],R=[],F=0,I=x.length,M=I-1;for(_=F+1;F<I;F++,M++,_++)M===I&&(M=0),_===I&&(_=0),R[F]=r(x[F],x[M],x[_]);q.push(R),U=U.concat(R)}for(M=0;M<l;M++){x=M/l,D=a*(1-x),_=f*Math.sin(x*Math.PI/2),F=0;for(I=A.length;F<I;F++)P=n(A[F],j[F],_),s(P.x,P.y,-D);T=0;for(N=p.length;T<N;T++){x=p[T],R=q[T],F=0;for(I=x.length;F<I;F++)P=n(x[F],R[F],_),s(P.x,P.y,-D)}}_=f;for(F=0;F<H;F++)P=c?n(L[F],U[F],_):L[F],v?(E.copy(b.normals[0]).multiplyScalar(P.x),w.copy(b.binormals[0]).multiplyScalar(P.y),S.copy(d[0]).addSelf(E).addSelf(w),s(S.x,S.y,S.z)):s(P.x,P.y,0);for(x=1;x<=h;x++)for(F=0;F<H;F++)P=c?n(L[F],U[F],_):L[F],v?(E.copy(b.normals[x]).multiplyScalar(P.x),w.copy(b.binormals[x]).multiplyScalar(P.y),S.copy(d[x]).addSelf(E).addSelf(w),s(S.x,S.y,S.z)):s(P.x,P.y,u/h*x);for(M=l-1;M>=0;M--){x=M/l,D=a*(1-x),_=f*Math.sin(x*Math.PI/2),F=0;for(I=A.length;F<I;F++)P=n(A[F],j[F],_),s(P.x,P.y,u+D);T=0;for(N=p.length;T<N;T++){x=p[T],R=q[T],F=0;for(I=x.length;F<I;F++)P=n(x[F],R[F],_),v?s(P.x,P.y+d[h-1].y,d[h-1].x+D):s(P.x,P.y,u+D)}}if(c){a=H*0;for(F=0;F<B;F++)u=O[F],o(u[2]+a,u[1]+a,u[0]+a,!0);a=H*(h+l*2);for(F=0;F<B;F++)u=O[F],o(u[0]+a,u[1]+a,u[2]+a,!1)}else{for(F=0;F<B;F++)u=O[F],o(u[2],u[1],u[0],!0);for(F=0;F<B;F++)u=O[F],o(u[0]+H*h,u[1]+H*h,u[2]+H*h,!1)}u=0,i(A,u),u+=A.length,T=0;for(N=p.length;T<N;T++)x=p[T],i(x,u),u+=x.length},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,r,i,s){return t=e.vertices[i].x,i=e.vertices[i].y,n=e.vertices[s].x,s=e.vertices[s].y,[new THREE.UV(e.vertices[r].x,e.vertices[r].y),new THREE.UV(t,i),new THREE.UV(n,s)]},generateBottomUV:function(e,t,n,r,i,s){return this.generateTopUV(e,t,n,r,i,s)},generateSideWallUV:function(e,t,n,r,i,s,o,u){var t=e.vertices[i].x,n=e.vertices[i].y,i=e.vertices[i].z,r=e.vertices[s].x,a=e.vertices[s].y,s=e.vertices[s].z,f=e.vertices[o].x,l=e.vertices[o].y,o=e.vertices[o].z,c=e.vertices[u].x,h=e.vertices[u].y,e=e.vertices[u].z;return Math.abs(n-a)<.01?[new THREE.UV(t,1-i),new THREE.UV(r,1-s),new THREE.UV(f,1-o),new THREE.UV(c,1-e)]:[new THREE.UV(n,1-i),new THREE.UV(a,1-s),new THREE.UV(l,1-o),new THREE.UV(h,1-e)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),e instanceof Array==0&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,r=e.length;n<r;n++)this.addShape(e[n],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){t===void 0&&(t={});var n=t.material,r=t.UVGenerator===void 0?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,i,s,o,u=this.vertices.length;i=e.extractPoints();var a=i.shape,f=i.holes;if(!THREE.Shape.Utils.isClockWise(a)){a=a.reverse(),i=0;for(s=f.length;i<s;i++)o=f[i],THREE.Shape.Utils.isClockWise(o)&&(f[i]=o.reverse())}var l=THREE.Shape.Utils.triangulateShape(a,f);i=0;for(s=f.length;i<s;i++)o=f[i],a=a.concat(o);f=a.length,s=l.length;for(i=0;i<f;i++)o=a[i],this.vertices.push(new THREE.Vector3(o.x,o.y,0));for(i=0;i<s;i++)f=l[i],a=f[2]+u,o=f[1]+u,f=f[0]+u,this.faces.push(new THREE.Face3(a,o,f,null,null,n)),this.faceVertexUvs[0].push(r.generateBottomUV(this,e,t,a,o,f))},THREE.LatheGeometry=function(e,t,n){THREE.Geometry.call(this);for(var t=t||12,n=n||2*Math.PI,r=[],i=(new THREE.Matrix4).makeRotationZ(n/t),s=0;s<e.length;s++)r[s]=e[s].clone(),this.vertices.push(r[s]);for(var o=t+1,n=0;n<o;n++)for(s=0;s<r.length;s++)r[s]=i.multiplyVector3(r[s].clone()),this.vertices.push(r[s]);for(n=0;n<t;n++){r=0;for(i=e.length;r<i-1;r++)this.faces.push(new THREE.Face4(n*i+r,(n+1)%o*i+r,(n+1)%o*i+(r+1)%i,n*i+(r+1)%i)),this.faceVertexUvs[0].push([new THREE.UV(1-n/t,r/i),new THREE.UV(1-(n+1)/t,r/i),new THREE.UV(1-(n+1)/t,(r+1)/i),new THREE.UV(1-n/t,(r+1)/i)])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(e,t,n,r){THREE.Geometry.call(this);for(var i=e/2,s=t/2,n=n||1,r=r||1,o=n+1,u=r+1,a=e/n,f=t/r,l=new THREE.Vector3(0,0,1),e=0;e<u;e++)for(t=0;t<o;t++)this.vertices.push(new THREE.Vector3(t*a-i,-(e*f-s),0));for(e=0;e<r;e++)for(t=0;t<n;t++)i=new THREE.Face4(t+o*e,t+o*(e+1),t+1+o*(e+1),t+1+o*e),i.normal.copy(l),i.vertexNormals.push(l.clone(),l.clone(),l.clone(),l.clone()),this.faces.push(i),this.faceVertexUvs[0].push([new THREE.UV(t/n,1-e/r),new THREE.UV(t/n,1-(e+1)/r),new THREE.UV((t+1)/n,1-(e+1)/r),new THREE.UV((t+1)/n,1-e/r)]);this.computeCentroids()},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(e,t,n,r,i,s,o){THREE.Geometry.call(this);var e=e||50,r=r!==void 0?r:0,i=i!==void 0?i:Math.PI*2,s=s!==void 0?s:0,o=o!==void 0?o:Math.PI,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),u,a,f=[],l=[];for(a=0;a<=n;a++){var c=[],h=[];for(u=0;u<=t;u++){var p=u/t,d=a/n,v=new THREE.Vector3;v.x=-e*Math.cos(r+p*i)*Math.sin(s+d*o),v.y=e*Math.cos(s+d*o),v.z=e*Math.sin(r+p*i)*Math.sin(s+d*o),this.vertices.push(v),c.push(this.vertices.length-1),h.push(new THREE.UV(p,1-d))}f.push(c),l.push(h)}for(a=0;a<n;a++)for(u=0;u<t;u++){var r=f[a][u+1],i=f[a][u],s=f[a+1][u],o=f[a+1][u+1],c=this.vertices[r].clone().normalize(),h=this.vertices[i].clone().normalize(),p=this.vertices[s].clone().normalize(),d=this.vertices[o].clone().normalize(),v=l[a][u+1].clone(),m=l[a][u].clone(),g=l[a+1][u].clone(),y=l[a+1][u+1].clone();Math.abs(this.vertices[r].y)==e?(this.faces.push(new THREE.Face3(r,s,o,[c,p,d])),this.faceVertexUvs[0].push([v,g,y])):Math.abs(this.vertices[s].y)==e?(this.faces.push(new THREE.Face3(r,i,s,[c,h,p])),this.faceVertexUvs[0].push([v,m,g])):(this.faces.push(new THREE.Face4(r,i,s,o,[c,h,p,d])),this.faceVertexUvs[0].push([v,m,g,y]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:e}},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(e,t){var n=THREE.FontUtils.generateShapes(e,t);t.amount=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,n,t)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(e,t,n,r,i){THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.segmentsR=n||8,this.segmentsT=r||6,this.arc=i||Math.PI*2,i=new THREE.Vector3,e=[],t=[];for(n=0;n<=this.segmentsR;n++)for(r=0;r<=this.segmentsT;r++){var s=r/this.segmentsT*this.arc,o=n/this.segmentsR*Math.PI*2;i.x=this.radius*Math.cos(s),i.y=this.radius*Math.sin(s);var u=new THREE.Vector3;u.x=(this.radius+this.tube*Math.cos(o))*Math.cos(s),u.y=(this.radius+this.tube*Math.cos(o))*Math.sin(s),u.z=this.tube*Math.sin(o),this.vertices.push(u),e.push(new THREE.UV(r/this.segmentsT,n/this.segmentsR)),t.push(u.clone().subSelf(i).normalize())}for(n=1;n<=this.segmentsR;n++)for(r=1;r<=this.segmentsT;r++){var i=(this.segmentsT+1)*n+r-1,s=(this.segmentsT+1)*(n-1)+r-1,o=(this.segmentsT+1)*(n-1)+r,u=(this.segmentsT+1)*n+r,a=new THREE.Face4(i,s,o,u,[t[i],t[s],t[o],t[u]]);a.normal.addSelf(t[i]),a.normal.addSelf(t[s]),a.normal.addSelf(t[o]),a.normal.addSelf(t[u]),a.normal.normalize(),this.faces.push(a),this.faceVertexUvs[0].push([e[i].clone(),e[s].clone(),e[o].clone(),e[u].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(e,t,n,r,i,s,o){function u(e,t,n,r,i,s){var o=Math.cos(e);return Math.cos(t),t=Math.sin(e),e=n/r*e,n=Math.cos(e),o=i*(2+n)*.5*o,t=i*(2+n)*t*.5,i=s*i*Math.sin(e)*.5,new THREE.Vector3(o,t,i)}THREE.Geometry.call(this),this.radius=e||200,this.tube=t||40,this.segmentsR=n||64,this.segmentsT=r||8,this.p=i||2,this.q=s||3,this.heightScale=o||1,this.grid=Array(this.segmentsR),n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3;for(e=0;e<this.segmentsR;++e){this.grid[e]=Array(this.segmentsT);for(t=0;t<this.segmentsT;++t){var a=e/this.segmentsR*2*this.p*Math.PI,o=t/this.segmentsT*2*Math.PI,s=u(a,o,this.q,this.p,this.radius,this.heightScale),a=u(a+.01,o,this.q,this.p,this.radius,this.heightScale);n.sub(a,s),r.add(a,s),i.cross(n,r),r.cross(i,n),i.normalize(),r.normalize(),a=-this.tube*Math.cos(o),o=this.tube*Math.sin(o),s.x=s.x+(a*r.x+o*i.x),s.y=s.y+(a*r.y+o*i.y),s.z=s.z+(a*r.z+o*i.z),this.grid[e][t]=this.vertices.push(new THREE.Vector3(s.x,s.y,s.z))-1}}for(e=0;e<this.segmentsR;++e)for(t=0;t<this.segmentsT;++t){var i=(e+1)%this.segmentsR,s=(t+1)%this.segmentsT,n=this.grid[e][t],r=this.grid[i][t],i=this.grid[i][s],s=this.grid[e][s],o=new THREE.UV(e/this.segmentsR,t/this.segmentsT),a=new THREE.UV((e+1)/this.segmentsR,t/this.segmentsT),f=new THREE.UV((e+1)/this.segmentsR,(t+1)/this.segmentsT),l=new THREE.UV(e/this.segmentsR,(t+1)/this.segmentsT);this.faces.push(new THREE.Face4(n,r,i,s)),this.faceVertexUvs[0].push([o,a,f,l])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=n||1,this.segmentsRadius=r||8,this.closed=i||!1,s&&(this.debug=new THREE.Object3D),this.grid=[];var o,u,s=this.segments+1,a,f,l,c=new THREE.Vector3,h,p,d,t=new THREE.TubeGeometry.FrenetFrames(e,t,i);h=t.tangents,p=t.normals,d=t.binormals,this.tangents=h,this.normals=p,this.binormals=d;for(t=0;t<s;t++){this.grid[t]=[],r=t/(s-1),l=e.getPointAt(r),r=h[t],o=p[t],u=d[t],this.debug&&(this.debug.add(new THREE.ArrowHelper(r,l,n,255)),this.debug.add(new THREE.ArrowHelper(o,l,n,16711680)),this.debug.add(new THREE.ArrowHelper(u,l,n,65280)));for(r=0;r<this.segmentsRadius;r++)a=r/this.segmentsRadius*2*Math.PI,f=-this.radius*Math.cos(a),a=this.radius*Math.sin(a),c.copy(l),c.x=c.x+(f*o.x+a*u.x),c.y=c.y+(f*o.y+a*u.y),c.z=c.z+(f*o.z+a*u.z),this.grid[t][r]=this.vertices.push(new THREE.Vector3(c.x,c.y,c.z))-1}for(t=0;t<this.segments;t++)for(r=0;r<this.segmentsRadius;r++)s=i?(t+1)%this.segments:t+1,c=(r+1)%this.segmentsRadius,e=this.grid[t][r],n=this.grid[s][r],s=this.grid[s][c],c=this.grid[t][c],h=new THREE.UV(t/this.segments,r/this.segmentsRadius),p=new THREE.UV((t+1)/this.segments,r/this.segmentsRadius),d=new THREE.UV((t+1)/this.segments,(r+1)/this.segmentsRadius),o=new THREE.UV(t/this.segments,(r+1)/this.segmentsRadius),this.faces.push(new THREE.Face4(e,n,s,c)),this.faceVertexUvs[0].push([h,p,d,o]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(e,t,n){new THREE.Vector3;var r=new THREE.Vector3;new THREE.Vector3;var i=[],s=[],o=[],u=new THREE.Vector3,a=new THREE.Matrix4,t=t+1,f,l,c;this.tangents=i,this.normals=s,this.binormals=o;for(f=0;f<t;f++)l=f/(t-1),i[f]=e.getTangentAt(l),i[f].normalize();s[0]=new THREE.Vector3,o[0]=new THREE.Vector3,e=Number.MAX_VALUE,f=Math.abs(i[0].x),l=Math.abs(i[0].y),c=Math.abs(i[0].z),f<=e&&(e=f,r.set(1,0,0)),l<=e&&(e=l,r.set(0,1,0)),c<=e&&r.set(0,0,1),u.cross(i[0],r).normalize(),s[0].cross(i[0],u),o[0].cross(i[0],s[0]);for(f=1;f<t;f++)s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),u.cross(i[f-1],i[f]),u.length()>1e-4&&(u.normalize(),r=Math.acos(i[f-1].dot(i[f])),a.makeRotationAxis(u,r).multiplyVector3(s[f])),o[f].cross(i[f],s[f]);if(n){r=Math.acos(s[0].dot(s[t-1])),r/=t-1,i[0].dot(u.cross(s[0],s[t-1]))>0&&(r=-r);for(f=1;f<t;f++)a.makeRotationAxis(i[f],r*f).multiplyVector3(s[f]),o[f].cross(i[f],s[f])}},THREE.PolyhedronGeometry=function(e,t,n,r){function i(e){var t=e.normalize().clone();t.index=a.vertices.push(t)-1;var n=Math.atan2(e.z,-e.x)/2/Math.PI+.5,e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5;return t.uv=new THREE.UV(n,1-e),t}function s(e,t,n,r){r<1?(r=new THREE.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]),r.centroid.addSelf(e).addSelf(t).addSelf(n).divideScalar(3),r.normal=r.centroid.clone().normalize(),a.faces.push(r),r=Math.atan2(r.centroid.z,-r.centroid.x),a.faceVertexUvs[0].push([u(e.uv,e,r),u(t.uv,t,r),u(n.uv,n,r)])):(r-=1,s(e,o(e,t),o(e,n),r),s(o(e,t),t,o(t,n),r),s(o(e,n),o(t,n),n,r),s(o(e,t),o(t,n),o(e,n),r))}function o(e,t){c[e.index]||(c[e.index]=[]),c[t.index]||(c[t.index]=[]);var n=c[e.index][t.index];return n===void 0&&(c[e.index][t.index]=c[t.index][e.index]=n=i((new THREE.Vector3).add(e,t).divideScalar(2))),n}function u(e,t,n){return n<0&&e.u===1&&(e=new THREE.UV(e.u-1,e.v)),t.x===0&&t.z===0&&(e=new THREE.UV(n/2/Math.PI+.5,e.v)),e}THREE.Geometry.call(this);for(var n=n||1,r=r||0,a=this,f=0,l=e.length;f<l;f++)i(new THREE.Vector3(e[f][0],e[f][1],e[f][2]));for(var c=[],e=this.vertices,f=0,l=t.length;f<l;f++)s(e[t[f][0]],e[t[f][1]],e[t[f][2]],r);this.mergeVertices(),f=0;for(l=this.vertices.length;f<l;f++)this.vertices[f].multiplyScalar(n);this.computeCentroids(),this.boundingSphere={radius:n}},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(e,t){var n=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[[-1,n,0],[1,n,0],[-1,-n,0],[1,-n,0],[0,-1,n],[0,1,n],[0,-1,-n],[0,1,-n],[n,0,-1],[n,0,1],[-n,0,-1],[-n,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(e,t,n,r){THREE.Geometry.call(this);var i=this.vertices,s=this.faces,o=this.faceVertexUvs[0],r=r===void 0?!1:r,u,a,f,l,c=t+1;for(u=0;u<=n;u++){l=u/n;for(a=0;a<=t;a++)f=a/t,f=e(f,l),i.push(f)}var h,p,d,v;for(u=0;u<n;u++)for(a=0;a<t;a++)e=u*c+a,i=u*c+a+1,l=(u+1)*c+a,f=(u+1)*c+a+1,h=new THREE.UV(a/t,u/n),p=new THREE.UV((a+1)/t,u/n),d=new THREE.UV(a/t,(u+1)/n),v=new THREE.UV((a+1)/t,(u+1)/n),r?(s.push(new THREE.Face3(e,i,l)),s.push(new THREE.Face3(i,f,l)),o.push([h,p,d]),o.push([p,v,d])):(s.push(new THREE.Face4(e,i,f,l)),o.push([h,p,v,d]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ConvexGeometry=function(e){function t(e){var t=e.length();return new THREE.UV(e.x/t,e.y/t)}THREE.Geometry.call(this);for(var n=[[0,1,2],[0,2,1]],r=3;r<e.length;r++){var i=r,s=e[i].clone(),o=s.length();s.x=s.x+o*(Math.random()-.5)*2e-6,s.y=s.y+o*(Math.random()-.5)*2e-6,s.z=s.z+o*(Math.random()-.5)*2e-6;for(var o=[],u=0;u<n.length;){var a=n[u],f=s,l=e[a[0]],c;c=l;var h=e[a[1]],p=e[a[2]],d=new THREE.Vector3,v=new THREE.Vector3;d.sub(p,h),v.sub(c,h),d.crossSelf(v),d.isZero()||d.normalize(),c=d,l=c.dot(l);if(c.dot(f)>=l){for(f=0;f<3;f++){l=[a[f],a[(f+1)%3]],c=!0;for(h=0;h<o.length;h++)if(o[h][0]===l[1]&&o[h][1]===l[0]){o[h]=o[o.length-1],o.pop(),c=!1;break}c&&o.push(l)}n[u]=n[n.length-1],n.pop()}else u++}for(h=0;h<o.length;h++)n.push([o[h][0],o[h][1],i])}i=0,s=Array(e.length);for(r=0;r<n.length;r++){o=n[r];for(u=0;u<3;u++)s[o[u]]===void 0&&(s[o[u]]=i++,this.vertices.push(e[o[u]])),o[u]=s[o[u]]}for(r=0;r<n.length;r++)this.faces.push(new THREE.Face3(n[r][0],n[r][1],n[r][2]));for(r=0;r<this.faces.length;r++)o=this.faces[r],this.faceVertexUvs[0].push([t(this.vertices[o.a]),t(this.vertices[o.b]),t(this.vertices[o.c])]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ConvexGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.AxisHelper=function(){THREE.Object3D.call(this);var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3),e.vertices.push(new THREE.Vector3(0,100,0));var t=new THREE.CylinderGeometry(0,5,25,5,1),n;n=new THREE.Line(e,new THREE.LineBasicMaterial({color:16711680})),n.rotation.z=-Math.PI/2,this.add(n),n=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:16711680})),n.position.x=100,n.rotation.z=-Math.PI/2,this.add(n),n=new THREE.Line(e,new THREE.LineBasicMaterial({color:65280})),this.add(n),n=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:65280})),n.position.y=100,this.add(n),n=new THREE.Line(e,new THREE.LineBasicMaterial({color:255})),n.rotation.x=Math.PI/2,this.add(n),n=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:255})),n.position.z=100,n.rotation.x=Math.PI/2,this.add(n)},THREE.AxisHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper=function(e,t,n,r){THREE.Object3D.call(this),r===void 0&&(r=16776960),n===void 0&&(n=20);var i=new THREE.Geometry;i.vertices.push(new THREE.Vector3(0,0,0)),i.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(i,new THREE.LineBasicMaterial({color:r})),this.add(this.line),i=new THREE.CylinderGeometry(0,.05,.25,5,1),this.cone=new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:r})),this.cone.position.set(0,1,0),this.add(this.cone),t instanceof THREE.Vector3&&(this.position=t),this.setDirection(e),this.setLength(n)},THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.setDirection=function(e){var t=(new THREE.Vector3(0,1,0)).crossSelf(e),e=Math.acos((new THREE.Vector3(0,1,0)).dot(e.clone().normalize()));this.matrix=(new THREE.Matrix4).makeRotationAxis(t.normalize(),e),this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)},THREE.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},THREE.CameraHelper=function(e){function t(e,t,r){n(e,r),n(t,r)}function n(e,t){r.geometry.vertices.push(new THREE.Vector3),r.geometry.colors.push(new THREE.Color(t)),r.pointMap[e]===void 0&&(r.pointMap[e]=[]),r.pointMap[e].push(r.geometry.vertices.length-1)}THREE.Line.call(this);var r=this;this.geometry=new THREE.Geometry,this.material=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),this.type=THREE.LinePieces,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap={},t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),this.camera=e,this.update(e)},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.update=function(){function e(e,n,r,i){THREE.CameraHelper.__v.set(n,r,i),THREE.CameraHelper.__projector.unprojectVector(THREE.CameraHelper.__v,THREE.CameraHelper.__c),e=t.pointMap[e];if(e!==void 0){n=0;for(r=e.length;n<r;n++)t.geometry.vertices[e[n]].copy(THREE.CameraHelper.__v)}}var t=this;THREE.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-0.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0},THREE.CameraHelper.__projector=new THREE.Projector,THREE.CameraHelper.__v=new THREE.Vector3,THREE.CameraHelper.__c=new THREE.Camera,THREE.SubdivisionModifier=function(e){this.subdivisions=e===void 0?1:e,this.useOldVertexColors=!1,this.supportUVs=!0,this.debug=!1},THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-->0;)this.smooth(e)},THREE.SubdivisionModifier.prototype.smooth=function(e){function t(){l.debug&&console.log.apply(console,arguments)}function n(){console&&console.log.apply(console,arguments)}function r(e,n,r,i,o,u,c){var h=new THREE.Face4(e,n,r,i,null,o.color,o.materialIndex);if(l.useOldVertexColors){h.vertexColors=[];for(var p,d,v,m=0;m<4;m++){v=u[m],p=new THREE.Color,p.setRGB(0,0,0);for(var g=0;g<v.length;g++)d=o.vertexColors[v[g]-1],p.r=p.r+d.r,p.g=p.g+d.g,p.b=p.b+d.b;p.r=p.r/v.length,p.g=p.g/v.length,p.b=p.b/v.length,h.vertexColors[m]=p}}a.push(h),l.supportUVs&&(o=[s(e,""),s(n,c),s(r,c),s(i,c)],o[0]?o[1]?o[2]?o[3]?f.push(o):t("d :( ",i+":"+c):t("c :( ",r+":"+c):t("b :( ",n+":"+c):t("a :( ",e+":"+c))}function i(e,t){return Math.min(e,t)+"_"+Math.max(e,t)}function s(e,r){var i=e+":"+r,s=m[i];return s?s:(e>=g&&e<g+h.length?t("face pt"):t("edge pt"),n("warning, UV not found for",i),null)}function o(e,t,r){var i=e+":"+t;i in m?n("dup vertexNo",e,"oldFaceNo",t,"value",r,"key",i,m[i]):m[i]=r}var u=[],a=[],f=[],l=this,c=e.vertices,h=e.faces,u=c.concat(),p=[],d={},v={},m={},g=c.length,y,b,w,E,S,x=e.faceVertexUvs[0];t("originalFaces, uvs, originalVerticesLength",h.length,x.length,g);if(l.supportUVs){y=0;for(b=x.length;y<b;y++){w=0;for(E=x[y].length;w<E;w++)S=h[y]["abcd".charAt(w)],o(S,y,x[y][w])}}x.length==0&&(l.supportUVs=!1),y=0;for(var T in m)y++;y||(l.supportUVs=!1,t("no uvs")),t("-- Original Faces + Vertices UVs completed",m,"vs",x.length);var N;y=0;for(b=h.length;y<b;y++)S=h[y],p.push(S.centroid),u.push(S.centroid),l.supportUVs&&(N=new THREE.UV,S instanceof THREE.Face3?(N.u=s(S.a,y).u+s(S.b,y).u+s(S.c,y).u,N.v=s(S.a,y).v+s(S.b,y).v+s(S.c,y).v,N.u=N.u/3,N.v=N.v/3):S instanceof THREE.Face4&&(N.u=s(S.a,y).u+s(S.b,y).u+s(S.c,y).u+s(S.d,y).u,N.v=s(S.a,y).v+s(S.b,y).v+s(S.c,y).v+s(S.d,y).v,N.u=N.u/4,N.v=N.v/4),o(g+y,"",N));t("-- added UVs for new Faces",m),T=function(e,t){C[e]===void 0&&(C[e]=[]),C[e].push(t)};var C={},x=0;for(b=e.faces.length;x<b;x++)S=e.faces[x],S instanceof THREE.Face3?(N=i(S.a,S.b),T(N,x),N=i(S.b,S.c),T(N,x),N=i(S.c,S.a),T(N,x)):S instanceof THREE.Face4&&(N=i(S.a,S.b),T(N,x),N=i(S.b,S.c),T(N,x),N=i(S.c,S.d),T(N,x),N=i(S.d,S.a),T(N,x));b=C;var k=0,L,A;T={},x={};for(y in b){N=b[y],L=y.split("_"),A=L[0],L=L[1],w=A,S=[A,L],T[w]===void 0&&(T[w]=[]),T[w].push(S),w=L,S=[A,L],T[w]===void 0&&(T[w]=[]),T[w].push(S),w=0;for(E=N.length;w<E;w++){S=N[w];var O=A,M=S,_=y;x[O]===void 0&&(x[O]={}),x[O][M]=_,O=L,M=y,x[O]===void 0&&(x[O]={}),x[O][S]=M}N.length<2&&(v[y]=!0)}t("vertexEdgeMap",T,"vertexFaceMap",x);for(y in b)N=b[y],S=N[0],E=N[1],L=y.split("_"),A=L[0],L=L[1],N=new THREE.Vector3,v[y]?(N.addSelf(c[A]),N.addSelf(c[L]),N.multiplyScalar(.5)):(N.addSelf(p[S]),N.addSelf(p[E]),N.addSelf(c[A]),N.addSelf(c[L]),N.multiplyScalar(.25)),d[y]=g+h.length+k,u.push(N),k++,l.supportUVs&&(N=new THREE.UV,N.u=s(A,S).u+s(L,S).u,N.v=s(A,S).v+s(L,S).v,N.u=N.u/2,N.v=N.v/2,o(d[y],S,N),v[y]||(N=new THREE.UV,N.u=s(A,E).u+s(L,E).u,N.v=s(A,E).v+s(L,E).v,N.u=N.u/2,N.v=N.v/2,o(d[y],E,N)));t("-- Step 2 done");var D,P;L=["123","12","2","23"],E=["123","23","3","31"];var O=["123","31","1","12"],M=["1234","12","2","23"],_=["1234","23","3","34"],H=["1234","34","4","41"],B=["1234","41","1","12"];y=0;for(b=p.length;y<b;y++)S=h[y],N=g+y,S instanceof THREE.Face3?(k=i(S.a,S.b),A=i(S.b,S.c),D=i(S.c,S.a),r(N,d[k],S.b,d[A],S,L,y),r(N,d[A],S.c,d[D],S,E,y),r(N,d[D],S.a,d[k],S,O,y)):S instanceof THREE.Face4?(k=i(S.a,S.b),A=i(S.b,S.c),D=i(S.c,S.d),P=i(S.d,S.a),r(N,d[k],S.b,d[A],S,M,y),r(N,d[A],S.c,d[D],S,_,y),r(N,d[D],S.d,d[P],S,H,y),r(N,d[P],S.a,d[k],S,B,y)):t("face should be a face!",S);d=new THREE.Vector3,S=new THREE.Vector3,y=0;for(b=c.length;y<b;y++)if(T[y]!==void 0){d.set(0,0,0),S.set(0,0,0),A=new THREE.Vector3(0,0,0),N=0;for(w in x[y])d.addSelf(p[w]),N++;L=0,k=T[y].length;for(w=0;w<k;w++)v[i(T[y][w][0],T[y][w][1])]&&L++;if(L!=2){d.divideScalar(N);for(w=0;w<k;w++)N=T[y][w],N=c[N[0]].clone().addSelf(c[N[1]]).divideScalar(2),S.addSelf(N);S.divideScalar(k),A.addSelf(c[y]),A.multiplyScalar(k-3),A.addSelf(d),A.addSelf(S.multiplyScalar(2)),A.divideScalar(k),u[y]=A}}e.vertices=u,e.faces=a,e.faceVertexUvs[0]=f,delete e.__tmpVertices,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals()},THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare=function(e,t,n,r,i){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,e!==void 0&&this.add(e,t,n,r,i)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.add=function(e,t,n,r,i,s){t===void 0&&(t=-1),n===void 0&&(n=0),s===void 0&&(s=1),i===void 0&&(i=new THREE.Color(16777215)),r===void 0&&(r=THREE.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:s,color:i,blending:r})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length,n,r=-this.positionScreen.x*2,i=-this.positionScreen.y*2;for(e=0;e<t;e++)n=this.lensFlares[e],n.x=this.positionScreen.x+r*n.distance,n.y=this.positionScreen.y+i*n.distance,n.wantedRotation=n.x*Math.PI*.25,n.rotation=n.rotation+(n.wantedRotation-n.rotation)*.25},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length;this.createAnimation("__default",0,n-1,n/1),this.setAnimationWeight("__default",1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){t={startFrame:t,endFrame:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t=/([a-z]+)(\d+)/,n,r={},i=this.geometry,s=0,o=i.morphTargets.length;s<o;s++){var u=i.morphTargets[s].name.match(t);if(u&&u.length>1){var a=u[1];r[a]||(r[a]={start:Infinity,end:-Infinity}),u=r[a],s<u.start&&(u.start=s),s>u.end&&(u.end=s),n||(n=a)}}for(a in r)u=r[a],this.createAnimation(a,u.start,u.end,e);this.firstAnimation=n},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){if(e=this.animationsMap[e])e.direction=1,e.directionBackwards=!1},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){if(e=this.animationsMap[e])e.direction=-1,e.directionBackwards=!0},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;if(e=this.animationsMap[e])t=e.time;return t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;if(e=this.animationsMap[e])t=e.duration;return t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){if(e=this.animationsMap[e])e.active=!1},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var r=this.animationsList[t];if(r.active){var i=r.duration/r.length;r.time=r.time+r.direction*e;if(r.mirroredLoop){if(r.time>r.duration||r.time<0)r.direction=r.direction*-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)}else r.time=r.time%r.duration,r.time<0&&(r.time=r.time+r.duration);var s=r.startFrame+THREE.Math.clamp(Math.floor(r.time/i),0,r.length-1),o=r.weight;s!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*o,this.morphTargetInfluences[s]=0,r.lastFrame=r.currentFrame,r.currentFrame=s),i=r.time%i/i,r.directionBackwards&&(i=1-i),this.morphTargetInfluences[r.currentFrame]=i*o,this.morphTargetInfluences[r.lastFrame]=(1-i)*o}}},THREE.LensFlarePlugin=function(){function e(e){var n=t.createProgram(),r=t.createShader(t.FRAGMENT_SHADER),i=t.createShader(t.VERTEX_SHADER);return t.shaderSource(r,e.fragmentShader),t.shaderSource(i,e.vertexShader),t.compileShader(r),t.compileShader(i),t.attachShader(n,r),t.attachShader(n,i),t.linkProgram(n),n}var t,n,r,i,s,o,u,a,f,l,c,h,p;this.init=function(v){t=v.context,n=v,r=new Float32Array(16),i=new Uint16Array(6),v=0,r[v++]=-1,r[v++]=-1,r[v++]=0,r[v++]=0,r[v++]=1,r[v++]=-1,r[v++]=1,r[v++]=0,r[v++]=1,r[v++]=1,r[v++]=1,r[v++]=1,r[v++]=-1,r[v++]=1,r[v++]=0,r[v++]=1,v=0,i[v++]=0,i[v++]=1,i[v++]=2,i[v++]=0,i[v++]=2,i[v++]=3,s=t.createBuffer(),o=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),u=t.createTexture(),a=t.createTexture(),t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(f=!1,l=e(THREE.ShaderFlares.lensFlare)):(f=!0,l=e(THREE.ShaderFlares.lensFlareVertexTexture)),c={},h={},c.vertex=t.getAttribLocation(l,"position"),c.uv=t.getAttribLocation(l,"uv"),h.renderType=t.getUniformLocation(l,"renderType"),h.map=t.getUniformLocation(l,"map"),h.occlusionMap=t.getUniformLocation(l,"occlusionMap"),h.opacity=t.getUniformLocation(l,"opacity"),h.color=t.getUniformLocation(l,"color"),h.scale=t.getUniformLocation(l,"scale"),h.rotation=t.getUniformLocation(l,"rotation"),h.screenPosition=t.getUniformLocation(l,"screenPosition"),p=!1},this.render=function(e,r,i,d){var e=e.__webglFlares,v=e.length;if(v){var y=new THREE.Vector3,w=d/i,E=i*.5,S=d*.5,x=16/d,T=new THREE.Vector2(x*w,x),N=new THREE.Vector3(1,1,0),C=new THREE.Vector2(1,1),k=h,x=c;t.useProgram(l),p||(t.enableVertexAttribArray(c.vertex),t.enableVertexAttribArray(c.uv),p=!0),t.uniform1i(k.occlusionMap,0),t.uniform1i(k.map,1),t.bindBuffer(t.ARRAY_BUFFER,s),t.vertexAttribPointer(x.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(x.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.disable(t.CULL_FACE),t.depthMask(!1);var L,A,O,M,_;for(L=0;L<v;L++){x=16/d,T.set(x*w,x),M=e[L],y.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),r.matrixWorldInverse.multiplyVector3(y),r.projectionMatrix.multiplyVector3(y),N.copy(y),C.x=N.x*E+E,C.y=N.y*S+S;if(f||C.x>0&&C.x<i&&C.y>0&&C.y<d){t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,u),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,C.x-8,C.y-8,16,16,0),t.uniform1i(k.renderType,0),t.uniform2f(k.scale,T.x,T.y),t.uniform3f(k.screenPosition,N.x,N.y,N.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,C.x-8,C.y-8,16,16,0),t.uniform1i(k.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,u),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),M.positionScreen.copy(N),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),t.uniform1i(k.renderType,2),t.enable(t.BLEND),A=0;for(O=M.lensFlares.length;A<O;A++)_=M.lensFlares[A],_.opacity>.001&&_.scale>.001&&(N.x=_.x,N.y=_.y,N.z=_.z,x=_.size*_.scale/d,T.x=x*w,T.y=x,t.uniform3f(k.screenPosition,N.x,N.y,N.z),t.uniform2f(k.scale,T.x,T.y),t.uniform1f(k.rotation,_.rotation),t.uniform1f(k.opacity,_.opacity),t.uniform3f(k.color,_.color.r,_.color.g,_.color.b),n.setBlending(_.blending,_.blendEquation,_.blendSrc,_.blendDst),n.setTexture(_.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}}t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){var e,t,n,r,i,s,o=new THREE.Frustum,u=new THREE.Matrix4,a=new THREE.Vector3,f=new THREE.Vector3;this.init=function(o){e=o.context,t=o;var o=THREE.ShaderLib.depthRGBA,u=THREE.UniformsUtils.clone(o.uniforms);n=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u}),r=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0}),i=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,skinning:!0}),s=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0},this.render=function(e,n){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,n)},this.update=function(l,p){var v,m,y,w,E,S,x,T,N,C=[];w=0,e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),t.shadowMapCullFrontFaces?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),v=0;for(m=l.__lights.length;v<m;v++){y=l.__lights[v];if(y.castShadow)if(y instanceof THREE.DirectionalLight&&y.shadowCascade)for(E=0;E<y.shadowCascadeCount;E++){var k;if(y.shadowCascadeArray[E])k=y.shadowCascadeArray[E];else{N=y,x=E,k=new THREE.DirectionalLight,k.isVirtual=!0,k.onlyShadow=!0,k.castShadow=!0,k.shadowCameraNear=N.shadowCameraNear,k.shadowCameraFar=N.shadowCameraFar,k.shadowCameraLeft=N.shadowCameraLeft,k.shadowCameraRight=N.shadowCameraRight,k.shadowCameraBottom=N.shadowCameraBottom,k.shadowCameraTop=N.shadowCameraTop,k.shadowCameraVisible=N.shadowCameraVisible,k.shadowDarkness=N.shadowDarkness,k.shadowBias=N.shadowCascadeBias[x],k.shadowMapWidth=N.shadowCascadeWidth[x],k.shadowMapHeight=N.shadowCascadeHeight[x],k.pointsWorld=[],k.pointsFrustum=[],T=k.pointsWorld,S=k.pointsFrustum;for(var L=0;L<8;L++)T[L]=new THREE.Vector3,S[L]=new THREE.Vector3;T=N.shadowCascadeNearZ[x],N=N.shadowCascadeFarZ[x],S[0].set(-1,-1,T),S[1].set(1,-1,T),S[2].set(-1,1,T),S[3].set(1,1,T),S[4].set(-1,-1,N),S[5].set(1,-1,N),S[6].set(-1,1,N),S[7].set(1,1,N),k.originalCamera=p,S=new THREE.Gyroscope,S.position=y.shadowCascadeOffset,S.add(k),S.add(k.target),p.add(S),y.shadowCascadeArray[E]=k,console.log("Created virtualLight",k)}x=y,T=E,N=x.shadowCascadeArray[T],N.position.copy(x.position),N.target.position.copy(x.target.position),N.lookAt(N.target),N.shadowCameraVisible=x.shadowCameraVisible,N.shadowDarkness=x.shadowDarkness,N.shadowBias=x.shadowCascadeBias[T],S=x.shadowCascadeNearZ[T],x=x.shadowCascadeFarZ[T],N=N.pointsFrustum,N[0].z=S,N[1].z=S,N[2].z=S,N[3].z=S,N[4].z=x,N[5].z=x,N[6].z=x,N[7].z=x,C[w]=k,w++}else C[w]=y,w++}v=0;for(m=C.length;v<m;v++){y=C[v],y.shadowMap||(y.shadowMap=new THREE.WebGLRenderTarget(y.shadowMapWidth,y.shadowMapHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),y.shadowMapSize=new THREE.Vector2(y.shadowMapWidth,y.shadowMapHeight),y.shadowMatrix=new THREE.Matrix4);if(!y.shadowCamera){if(y instanceof THREE.SpotLight)y.shadowCamera=new THREE.PerspectiveCamera(y.shadowCameraFov,y.shadowMapWidth/y.shadowMapHeight,y.shadowCameraNear,y.shadowCameraFar);else{if(!(y instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}y.shadowCamera=new THREE.OrthographicCamera(y.shadowCameraLeft,y.shadowCameraRight,y.shadowCameraTop,y.shadowCameraBottom,y.shadowCameraNear,y.shadowCameraFar)}l.add(y.shadowCamera),t.autoUpdateScene&&l.updateMatrixWorld()}y.shadowCameraVisible&&!y.cameraHelper&&(y.cameraHelper=new THREE.CameraHelper(y.shadowCamera),y.shadowCamera.add(y.cameraHelper));if(y.isVirtual&&k.originalCamera==p){E=p,w=y.shadowCamera,S=y.pointsFrustum,N=y.pointsWorld,a.set(Infinity,Infinity,Infinity),f.set(-Infinity,-Infinity,-Infinity);for(x=0;x<8;x++)T=N[x],T.copy(S[x]),THREE.ShadowMapPlugin.__projector.unprojectVector(T,E),w.matrixWorldInverse.multiplyVector3(T),T.x<a.x&&(a.x=T.x),T.x>f.x&&(f.x=T.x),T.y<a.y&&(a.y=T.y),T.y>f.y&&(f.y=T.y),T.z<a.z&&(a.z=T.z),T.z>f.z&&(f.z=T.z);w.left=a.x,w.right=f.x,w.top=f.y,w.bottom=a.y,w.updateProjectionMatrix()}w=y.shadowMap,S=y.shadowMatrix,E=y.shadowCamera,E.position.copy(y.matrixWorld.getPosition()),E.lookAt(y.target.matrixWorld.getPosition()),E.updateMatrixWorld(),E.matrixWorldInverse.getInverse(E.matrixWorld),y.cameraHelper&&(y.cameraHelper.visible=y.shadowCameraVisible),y.shadowCameraVisible&&y.cameraHelper.update(),S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiplySelf(E.projectionMatrix),S.multiplySelf(E.matrixWorldInverse),E._viewMatrixArray||(E._viewMatrixArray=new Float32Array(16)),E._projectionMatrixArray||(E._projectionMatrixArray=new Float32Array(16)),E.matrixWorldInverse.flattenToArray(E._viewMatrixArray),E.projectionMatrix.flattenToArray(E._projectionMatrixArray),u.multiply(E.projectionMatrix,E.matrixWorldInverse),o.setFromMatrix(u),t.setRenderTarget(w),t.clear(),N=l.__webglObjects,y=0;for(w=N.length;y<w;y++)x=N[y],S=x.object,x.render=!1,S.visible&&S.castShadow&&(!(S instanceof THREE.Mesh)||!S.frustumCulled||o.contains(S))&&(S._modelViewMatrix.multiply(E.matrixWorldInverse,S.matrixWorld),x.render=!0);y=0;for(w=N.length;y<w;y++)x=N[y],x.render&&(S=x.object,x=x.buffer,T=S.customDepthMaterial?S.customDepthMaterial:S instanceof THREE.SkinnedMesh?S.geometry.morphTargets.length?s:i:S.geometry.morphTargets.length?r:n,x instanceof THREE.BufferGeometry?t.renderBufferDirect(E,l.__lights,null,T,x,S):t.renderBuffer(E,l.__lights,null,T,x,S));N=l.__webglObjectsImmediate,y=0;for(w=N.length;y<w;y++)x=N[y],S=x.object,S.visible&&S.castShadow&&(S._modelViewMatrix.multiply(E.matrixWorldInverse,S.matrixWorld),t.renderImmediateObject(E,l.__lights,null,n,S))}v=t.getClearColor(),m=t.getClearAlpha(),e.clearColor(v.r,v.g,v.b,m),e.enable(e.BLEND),t.shadowMapCullFrontFaces&&e.cullFace(e.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function e(e,t){return t.z-e.z}var t,n,r,i,s,o,u,a,f,l;this.init=function(e){t=e.context,n=e,r=new Float32Array(16),i=new Uint16Array(6),e=0,r[e++]=-1,r[e++]=-1,r[e++]=0,r[e++]=0,r[e++]=1,r[e++]=-1,r[e++]=1,r[e++]=0,r[e++]=1,r[e++]=1,r[e++]=1,r[e++]=1,r[e++]=-1,r[e++]=1,r[e++]=0,r[e++]=1,e=0,i[e++]=0,i[e++]=1,i[e++]=2,i[e++]=0,i[e++]=2,i[e++]=3,s=t.createBuffer(),o=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW);var e=THREE.ShaderSprite.sprite,p=t.createProgram(),v=t.createShader(t.FRAGMENT_SHADER),m=t.createShader(t.VERTEX_SHADER);t.shaderSource(v,e.fragmentShader),t.shaderSource(m,e.vertexShader),t.compileShader(v),t.compileShader(m),t.attachShader(p,v),t.attachShader(p,m),t.linkProgram(p),u=p,a={},f={},a.position=t.getAttribLocation(u,"position"),a.uv=t.getAttribLocation(u,"uv"),f.uvOffset=t.getUniformLocation(u,"uvOffset"),f.uvScale=t.getUniformLocation(u,"uvScale"),f.rotation=t.getUniformLocation(u,"rotation"),f.scale=t.getUniformLocation(u,"scale"),f.alignment=t.getUniformLocation(u,"alignment"),f.color=t.getUniformLocation(u,"color"),f.map=t.getUniformLocation(u,"map"),f.opacity=t.getUniformLocation(u,"opacity"),f.useScreenCoordinates=t.getUniformLocation(u,"useScreenCoordinates"),f.affectedByDistance=t.getUniformLocation(u,"affectedByDistance"),f.screenPosition=t.getUniformLocation(u,"screenPosition"),f.modelViewMatrix=t.getUniformLocation(u,"modelViewMatrix"),f.projectionMatrix=t.getUniformLocation(u,"projectionMatrix"),l=!1},this.render=function(r,i,p,d){var r=r.__webglSprites,v=r.length;if(v){var m=a,y=f,w=d/p,p=p*.5,E=d*.5,S=!0;t.useProgram(u),l||(t.enableVertexAttribArray(m.position),t.enableVertexAttribArray(m.uv),l=!0),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.depthMask(!0),t.bindBuffer(t.ARRAY_BUFFER,s),t.vertexAttribPointer(m.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(m.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.uniformMatrix4fv(y.projectionMatrix,!1,i._projectionMatrixArray),t.activeTexture(t.TEXTURE0),t.uniform1i(y.map,0);for(var x,T=[],m=0;m<v;m++)x=r[m],x.visible&&x.opacity!==0&&(x.useScreenCoordinates?x.z=-x.position.z:(x._modelViewMatrix.multiply(i.matrixWorldInverse,x.matrixWorld),x.z=-x._modelViewMatrix.elements[14]));r.sort(e);for(m=0;m<v;m++)x=r[m],x.visible&&x.opacity!==0&&x.map&&x.map.image&&x.map.image.width&&(x.useScreenCoordinates?(t.uniform1i(y.useScreenCoordinates,1),t.uniform3f(y.screenPosition,(x.position.x-p)/p,(E-x.position.y)/E,Math.max(0,Math.min(1,x.position.z)))):(t.uniform1i(y.useScreenCoordinates,0),t.uniform1i(y.affectedByDistance,x.affectedByDistance?1:0),t.uniformMatrix4fv(y.modelViewMatrix,!1,x._modelViewMatrix.elements)),i=x.map.image.width/(x.scaleByViewport?d:1),T[0]=i*w*x.scale.x,T[1]=i*x.scale.y,t.uniform2f(y.uvScale,x.uvScale.x,x.uvScale.y),t.uniform2f(y.uvOffset,x.uvOffset.x,x.uvOffset.y),t.uniform2f(y.alignment,x.alignment.x,x.alignment.y),t.uniform1f(y.opacity,x.opacity),t.uniform3f(y.color,x.color.r,x.color.g,x.color.b),t.uniform1f(y.rotation,x.rotation),t.uniform2fv(y.scale,T),x.mergeWith3D&&!S?(t.enable(t.DEPTH_TEST),S=!0):!x.mergeWith3D&&S&&(t.disable(t.DEPTH_TEST),S=!1),n.setBlending(x.blending,x.blendEquation,x.blendSrc,x.blendDst),n.setTexture(x.map,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,n,r,i=new THREE.Frustum,s=new THREE.Matrix4;this.init=function(i){e=i.context,t=i;var i=THREE.ShaderLib.depthRGBA,s=THREE.UniformsUtils.clone(i.uniforms);n=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:s}),r=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:s,morphTargets:!0}),n._shadowPass=!0,r._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(o,u){var l,h,p,v,m,g;e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),t.autoUpdateScene&&o.updateMatrixWorld(),u._viewMatrixArray||(u._viewMatrixArray=new Float32Array(16)),u._projectionMatrixArray||(u._projectionMatrixArray=new Float32Array(16)),u.matrixWorldInverse.getInverse(u.matrixWorld),u.matrixWorldInverse.flattenToArray(u._viewMatrixArray),u.projectionMatrix.flattenToArray(u._projectionMatrixArray),s.multiply(u.projectionMatrix,u.matrixWorldInverse),i.setFromMatrix(s),t.setRenderTarget(this.renderTarget),t.clear(),g=o.__webglObjects,l=0;for(h=g.length;l<h;l++)p=g[l],m=p.object,p.render=!1,m.visible&&(!(m instanceof THREE.Mesh)||!m.frustumCulled||i.contains(m))&&(m._modelViewMatrix.multiply(u.matrixWorldInverse,m.matrixWorld),p.render=!0);l=0;for(h=g.length;l<h;l++)p=g[l],p.render&&(m=p.object,p=p.buffer,m.material&&t.setMaterialFaces(m.material),v=m.customDepthMaterial?m.customDepthMaterial:m.geometry.morphTargets.length?r:n,p instanceof THREE.BufferGeometry?t.renderBufferDirect(u,o.__lights,null,v,p,m):t.renderBuffer(u,o.__lights,null,v,p,m));g=o.__webglObjectsImmediate,l=0;for(h=g.length;l<h;l++)p=g[l],m=p.object,m.visible&&m.castShadow&&(m._modelViewMatrix.multiply(u.matrixWorldInverse,m.matrixWorld),t.renderImmediateObject(u,o.__lights,null,n,m));l=t.getClearColor(),h=t.getClearAlpha(),e.clearColor(l.r,l.g,l.b,h),e.enable(e.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},THREE.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"}},define("three.min",[],function(){}),requirejs.config({paths:{jquery:"http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min","socket.io":"/socket.io/socket.io"}}),require(["connector","render-v2","scenario","jquery","three.min","jc"],function(e,t,n){$(function(){var r=document.createElement("canvas");r.width=window.innerWidth/8,r.height=window.innerHeight/8,t.init(r),initThree(r),e.onEstablished(function(){n.run()})})}),define("overhead",[],function(){})