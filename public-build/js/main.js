/*!
 * jCanvaScript JavaScript Library v 1.5.15
 * http://jcscript.com/
 *
 * Copyright 2012, Alexander Savin
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */

// Underscore.js 1.3.3
// (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
// Underscore is freely distributable under the MIT license.
// Portions of Underscore are inspired or borrowed from Prototype,
// Oliver Steele's Functional, and John Resig's Micro-Templating.
// For all details and documentation:
// http://documentcloud.github.com/underscore

(function(e,t){function k(e,t,r){var i=n[e].layers[t].objs,s=n[e].layers[t].grdntsnptrns,o=i.length,u=s.length;r=r.slice(1);for(var a=0;a<o;a++)if(i[a].optns.id==r)return i[a];for(a=0;a<u;a++)if(s[a].optns.id==r)return s[a];return!1}function L(e,t,r,i){function a(e,t,n){var r=n.length,i,s,o,u;for(o=0;o<r;o++){if(!n[o]._name)continue;i=n[o]._name.split(" ");if(t.length>i.length)continue;var a=t.concat();for(s=0;s<i.length;s++){for(u=0;u<a.length;u++)if(i[s]===a[u]){a.splice(u,1),u--;continue}if(!a.length){e.elements.push(n[o]);break}}}}var s=n[e].layers[t].objs,o=n[e].layers[t].grdntsnptrns,u=i.slice(1).split(".");return a(r,u,s),a(r,u,o),r}function A(e,t,r){var i=n[e].layers[t].objs,s=n[e].layers[t].grdntsnptrns,o=i.length,u=s.length;for(var a=0;a<o;a++)r.elements.push(i[a]);for(a=0;a<u;a++)r.elements.push(s[a]);return r}function M(e){var t=e.optns;e.matrix(U(U(U(t.transformMatrix,t.translateMatrix),t.scaleMatrix),t.rotateMatrix)),D(e)}function _(e,n){for(var r in n)e[r]===t&&(e[r]=n[r]);return e}function D(e){nt(e).optns.redraw=1}function P(e){var n=e.timeDiff,r=1;for(var i=0;i<this.animateQueue.length;i++){var s=this.animateQueue[i],o=s.duration,u=s.easing,a=s.step,f=s.onstep,l=u["type"]=="in"||u["type"]=="inOut"&&r<.5,c=u["type"]=="out"||u["type"]=="inOut"&&r>.5;s.step+=n,r=a/o;for(var h in s)if(this[h]!==t&&s[h]){var p=s[h],d=p.to,v=p.from;H(h,this,s),l&&(this[h]=(d-v)*q[u.fn](r,u)+v),c&&(this[h]=(d-v)*(1-q[u.fn](1-r,u))+v),f&&f.fn.call(this,f),a>=o&&(this[h]=d,H(h,this,s),s[h]=!1,s.animateKeyCount--,s.animateKeyCount||(s.animateFn&&s.animateFn.apply(this),this.animateQueue.splice(i,1),i--))}}return this.animateQueue.length?D(this):this.optns.animated=!1,this}function H(e,n,r){var i=n[e],s=r[e].prev;switch(e){case"_rotateAngle":n.rotate(i-s,n._rotateX,n._rotateY);break;case"_translateX":n.translate(i-s,0);break;case"_translateY":n.translate(0,i-s);break;case"_translateToX":n.translateTo(i,t);break;case"_translateToY":n.translateTo(t,i);break;case"_scaleX":s||(s=1),n.scale(i/s,1);break;case"_scaleY":s||(s=1),n.scale(1,i/s);break;default:return}r[e].prev=i}function B(t,n,r){t=t||e.event,r[n].event=t,r[n].code=t.charCode||t.keyCode,r[n].val=!0,r.redraw=1}function j(t,n,r){if(!r[n].val)return;t=t||e.event;var i={pageX:t.pageX||t.clientX,pageY:t.pageY||t.clientY};r[n].event=t,r[n].x=i.pageX-r.x,r[n].y=i.pageY-r.y,r.redraw=1}function F(e,n){e===t?this["on"+n]():this["on"+n]=e;if(n=="mouseover"||n=="mouseout")n="mousemove";return nt(this).optns[n].val=!0,this}function I(e,n){return e===t?this[n]():this[n]=e,this}function U(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1],e[0][0]*t[0][2]+e[0][1]*t[1][2]+e[0][2]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1],e[1][0]*t[0][2]+e[1][1]*t[1][2]+e[1][2]]]}function z(e,t,n){return{x:e*n[0][0]+t*n[0][1]+n[0][2],y:e*n[1][0]+t*n[1][1]+n[1][2]}}function W(e,t,n){return{x:(e*n[1][1]-t*n[0][1]+n[0][1]*n[1][2]-n[1][1]*n[0][2])/(n[0][0]*n[1][1]-n[1][0]*n[0][1]),y:(-e*n[1][0]+t*n[0][0]-n[0][0]*n[1][2]+n[1][0]*n[0][2])/(n[0][0]*n[1][1]-n[1][0]*n[0][1])}}function X(e,t,n){if(n=="poor")return t;var r={x:t.x,y:t.y},i={x:t.x+t.width,y:t.y+t.height},s=U(e.matrix(),tt(e).matrix()),o=z(r.x,r.y,s),u=z(i.x,r.y,s),a=z(r.x,i.y,s),f=z(i.x,i.y,s),l=[[o.x,o.y],[u.x,u.y],[a.x,a.y],[f.x,f.y]];if(n=="coords")return l;var c,h,p=c=o.x,d=h=o.y;for(var v=0;v<4;v++)p<l[v][0]&&(p=l[v][0]),d<l[v][1]&&(d=l[v][1]),c>l[v][0]&&(c=l[v][0]),h>l[v][1]&&(h=l[v][1]);return{x:c,y:h,width:p-c,height:d-h}}function V(e,t,n){return n=="poor"?t:z(t.x,t.y,U(e.matrix(),tt(e).matrix()))}function $(e){var n={color:{val:e,notColor:t},r:0,g:0,b:0,a:1};if(e.id!==t)return n.color.notColor={level:e._level,canvas:e.optns.canvas.number,layer:e.optns.layer.number},n;if(e.r!==t)return n=_(e,{r:0,g:0,b:0,a:1}),n.color={val:"rgba("+n.r+","+n.g+","+n.b+","+n.a+")",notColor:t},n;if(e.charAt(0)=="#")if(e.length>4)n.r=parseInt(e.substr(1,2),16),n.g=parseInt(e.substr(3,2),16),n.b=parseInt(e.substr(5,2),16);else{var r=e.charAt(1),i=e.charAt(2),s=e.charAt(3);n.r=parseInt(r+r,16),n.g=parseInt(i+i,16),n.b=parseInt(s+s,16)}else{var o=e.split(",");if(o.length==4){var u=o[0].split("("),a=o[3].split(")");n.r=parseInt(u[1]),n.g=parseInt(o[1]),n.b=parseInt(o[2]),n.a=parseFloat(a[0])}if(o.length==3){u=o[0].split("(");var f=o[2].split(")");n.r=parseInt(u[1]),n.g=parseInt(o[1]),n.b=parseInt(f[0])}}return n.color.notColor=t,n}function J(e){return e.getBoundingClientRect?Q(e):K(e)}function K(e){var t=0,n=0;while(e)t+=parseInt(e.offsetTop),n+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:n}}function Q(t){var n=t.getBoundingClientRect(),r=document.body||{},i=document.documentElement,s=e.pageYOffset||i.scrollTop||r.scrollTop,o=e.pageXOffset||i.scrollLeft||r.scrollLeft,u=i.clientTop||r.clientTop||0,a=i.clientLeft||r.clientLeft||0,f=n.top+s-u,l=n.left+o-a;return{top:b(f),left:b(l)}}function G(e,t){et(e,t),Y(e,t)}function Y(e,t){if(!e.optns.focused)return;t.keyDown.val!=0&&typeof e.onkeydown=="function"&&e.onkeydown(t.keyDown),t.keyUp.val!=0&&typeof e.onkeyup=="function"&&e.onkeyup(t.keyUp),t.keyPress.val!=0&&typeof e.onkeypress=="function"&&e.onkeypress(t.keyPress)}function Z(e,n,r){var i={},s=nt(e),o=s.optns.ctx,u=s.layers[e.optns.layer.number];i.x=n,i.y=r,C&&(i=W(n,r,u.matrix()),i=W(i.x,i.y,e.matrix()));if(o.isPointInPath===t||e._img!==t||e._imgData!==t||e._proto=="text"){var a=e.getRect("poor");i=W(n,r,U(e.matrix(),u.matrix()));if(a.x<=i.x&&a.y<=i.y&&a.x+a.width>=i.x&&a.y+a.height>=i.y)return i}else if(o.isPointInPath(i.x,i.y))return i;return!1}function et(e,t){var n=!1,r=t.mousemove,i=t.mousedown,s=t.mouseup,o=t.click,u=t.dblclick,a=r.x||i.x||s.x||u.x||o.x,f=r.y||i.y||s.y||u.y||o.y;a!=0&&(n=Z(e,a,f)),n&&(r.x!=0&&(r.object=e),i.x!=0&&(i.objects[i.objects.length]=e),o.x!=0&&(o.objects[o.objects.length]=e),u.x!=0&&(u.objects[u.objects.length]=e),s.x!=0&&(s.objects[s.objects.length]=e),t.point=n)}function tt(e){return nt(e).layers[e.optns.layer.number]}function nt(e){return n[e.optns.canvas.number]}function rt(e,r,i){D(r);var s=r.optns.canvas,o=r.optns.layer;if(e===t)return o.id;if(o.id==e)return r;var u={i:s.number,j:o.number};o.id=e;var a=O.layer(e),f={i:a.optns.canvas.number,j:a.optns.number},l=n[u.i].layers[u.j][i],c=n[f.i].layers[f.j][i];return l.splice(r.optns.number,1),r._level=r.optns.number=c.length,c[r._level]=r,o.number=f.j,s.number=f.i,s.id=a.optns.canvas.id,D(r),r}function it(e,n){for(var r in n)switch(typeof n[r]){case"function":if(r.substr(0,2)=="on")break;e[r]===t&&(e[r]=n[r]);break;case"object":if(r=="optns"||r=="animateQueue")break;if(r=="objs"||r=="grdntsnptrns"){for(var i in n[r])n[r].hasOwnProperty(i)&&n[r][i].clone().layer(e.optns.id);break}if(!n[r]||r==="ctx")continue;e[r]=typeof n[r].pop=="function"?[]:{},it(e[r],n[r]);break;default:if(r=="_level")break;e[r]=n[r]}}function st(e,r,i){D(r);var s=r.optns.canvas,o=r.optns.layer;if(e===t)return n[s.number].optns.id;if(n[s.number].optns.id==e)return r;var u={i:s.number,j:o.number};O.canvas(e);for(var a=0;a<n.length;a++){var f=n[a];if(f.optns.id==e){var l=n[u.i].layers[u.j][i],c=f.layers[0][i];l.splice(r.optns.number,1),ot(l),r._level=r.optns.number=c.length,c[r._level]=r,o.number=0,s.number=a,s.id=f.optns.id,o.id=f.layers[0].optns.id}}return D(r),r}function ot(e){for(var t=0;t<e.length;t++)e[t].optns.number=t}function ut(e,t,n,r,i){var s=e.length,o,u,a;for(var f=0;f<s;f++)o=e[f].optns,u=o.canvas,a=o.layer,u.id=r,u.number=i,a.id=t,a.number=n}function at(e){return e.sort(function(e,t){return e._level>t._level?1:e._level<t._level?-1:0}),ot(e),e.length}function ft(e){var t;do{t=!1;for(var n=0;n<e.length;n++)e[n].optns.deleted&&(e.splice(n,1),t=!0)}while(t);return ot(e),e.length}function ct(e){var t=new lt.layer;return t.base(e)}function ht(){var e=new lt.group;return e.base()}function pt(e,t,n){var r=n.drag;return n.drag.init&&n.drag.object?(e.optns.drop.val==1?(r.init==r.object&&r.init.visible(!0),typeof e.optns.drop.fn=="function"&&e.optns.drop.fn.call(e,r.init)):(r.object.visible(!1),r.init.visible(!0),r.init.optns.translateMatrix[0][2]=r.object.optns.translateMatrix[0][2],r.init.optns.translateMatrix[1][2]=r.object.optns.translateMatrix[1][2],M(r.init),r.object!=r.init&&r.object.visible(!1),typeof r.init.optns.drag.stop=="function"&&r.init.optns.drag.stop.call(r.init,{x:t.x,y:t.y})),r.x!=r.startX||r.y!==r.startY):!1}var n=[],r=Math,i=r.PI,s=i*2,o=0,u=0,a=!1,f=!1,l=/[A-z]+?/,c=/\d.\w\w/,h=e.navigator.userAgent.match(/Firefox\/\w+\.\w+/i),p=180/i,d=r.max,v=r.min,m=r.cos,g=r.sin,y=r.floor,b=r.round,w=r.abs,E=r.pow,S=r.sqrt,x=1e3/60,T=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e,t){return setTimeout(e,x)}}(),N=function(){return e.cancelAnimationFrame||e.webkitCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||e.oCancelRequestAnimationFrame||e.msCancelRequestAnimationFrame||clearTimeout}();if(h!=""&&h!==null)var C=parseInt(h[0].split(/[ \/\.]/i)[1])<7;var O=function(e,r){if(e===t)return this;typeof e=="object"&&(r=e,e=t);var i=-1,s=-1,o=n.length,u=ht(),a,f,l,c,h,p,d;if(r===t){if(e.charAt(0)==="#")for(a=0;a<o;a++){d=n[a].layers.length;for(f=0;f<d;f++){p=k(a,f,e);if(p)return p}}if(e.charAt(0)===".")for(a=0;a<o;a++){d=n[a].layers.length;for(f=0;f<d;f++)u=L(a,f,u,e)}}else{if(r.canvas!==t)for(a=0;a<o;a++)if(n[a].optns.id==r.canvas){i=a,l=n[a];break}if(r.layer!==t)if(i!=-1){d=l.layers.length;for(a=0;a<d;a++)if(l.layers[a].optns.id==r.layer){s=a,c=l.layers[a];break}}else for(a=0;a<o;a++){h=n[a].layers,d=h.length;for(f=0;f<d;f++)if(h[f].optns.id==r.layer){i=a,s=f,l=n[a],c=l.layers[f];break}if(c>-1)break}if(s<0&&i<0)return ht();if(s<0){h=l.layers,d=h.length;if(e===t)for(f=0;f<d;f++)u=A(i,f,u);else if(e.charAt(0)==="#")for(f=0;f<d;f++){p=k(i,f,e);if(p)return p}else if(e.charAt(0)===".")for(f=0;f<d;f++)u=L(i,f,u,e)}else{e===t&&(u=A(i,s,u));if(e.charAt(0)==="#")return k(i,s,e);e.charAt(0)==="."&&(u=L(i,s,u,e))}}if(r!==t)if(r.attrs!==t||r.fns!==t)return u.find(r);return u.elements.length?u:ht()},q={linear:function(e,t){return e},exp:function(e,t){var n=t.n||2;return E(e,n)},circ:function(e,t){return 1-S(1-e*e)},sine:function(e,t){return 1-g((1-e)*i/2)},back:function(e,t){var n=t.n||2,r=t.x||1.5;return E(e,n)*((r+1)*e-r)},elastic:function(e,t){var n=t.n||2,r=t.m||20,s=t.k||3,o=t.x||1.5;return E(n,10*(e-1))*m(r*e*i*o/s)},bounce:function(e,t){var n=t.n||4,r=t.b||.25,i=[1];for(var s=1;s<n;s++)i[s]=i[s-1]+E(r,s/2);var o=2*i[n-1]-1;for(s=0;s<n;s++)if(o*e>=(s>0?2*i[s-1]-1:0)&&o*e<=2*i[s]-1)return E(o*(e-(2*i[s]-1-E(r,s/2))/o),2)+1-E(r,s);return 1}},R={color:{fn:function(e,t,n,r){var i,s,o;n=n[r];for(s=0;s<e;s++)for(o=0;o<t;o++)i=this.getPixel(s,o),i[n[0]]=i[n[0]]*2-i[n[1]]-i[n[2]],i[n[1]]=0,i[n[2]]=0,i[n[0]]=i[n[0]]>255?255:i[n[0]],this.setPixel(s,o,i)},matrix:{red:[0,1,2],green:[1,0,2],blue:[2,0,1]}},linear:{fn:function(e,t,n,r){var i=[],s,o,u,a,f,l;n=n[r],f=n.length,l=n[0].length;for(o=0;o<e;o++){i[o]=[];for(u=0;u<t;u++){i[o][u]=[0,0,0,1];for(f=0;f<3;f++)for(l=0;l<3;l++){s=this.getPixel(o-parseInt(f/2),u-parseInt(l/2));for(a=0;a<3;a++)i[o][u][a]+=s[a]*n[f][l]}}}for(o=0;o<e;o++)for(u=0;u<t;u++)this.setPixel(o,u,i[o][u])},matrix:{sharp:[[-0.375,-0.375,-0.375],[-0.375,4,-0.375],[-0.375,-0.375,-0.375]],blur:[[.111,.111,.111],[.111,.111,.111],[.111,.111,.111]]}}},lt={};lt.object=function(){this.getCenter=function(e){var t=this.getRect("poor"),n={x:(t.x*2+t.width)/2,y:(t.y*2+t.height)/2};return V(this,n,e)},this.position=function(){return z(this._x,this._y,U(this.matrix(),tt(this).matrix()))},this.buffer=function(e){var n=this.optns.buffer;if(e===t)return n.val?n.cnv:!1;if(n.val===e)return this;if(e){var r=n.cnv=document.createElement("canvas"),i=n.ctx=r.getContext("2d"),s=n.rect=this.getRect(),o=this.transform();r.setAttribute("width",s.width),r.setAttribute("height",s.height),n.x=this._x,n.y=this._y,n.dx=this._transformdx,n.dy=this._transformdy,this._x=this._y=0,this.transform(1,0,0,1,-s.x+n.dx,-s.y+n.dy,!0),this.setOptns(i),it(n.optns={},nt(this).optns),n.optns.ctx=i,this.draw(n.optns),this._x=n.x,this._y=n.y,this.transform(o[0][0],o[1][0],o[0][1],o[1][1],s.x,s.y,!0),n.val=!0}else this.translate(-n.rect.x+n.dx,-n.rect.y+n.dy),this.optns.buffer={val:!1};return this},this.clone=function(e){var n=new lt[this._proto];return lt[this._proto].prototype.base.call(n),it(n,this),n.layer(tt(this).optns.id),it(n.optns.transformMatrix,this.optns.transformMatrix),it(n.optns.translateMatrix,this.optns.translateMatrix),it(n.optns.scaleMatrix,this.optns.scaleMatrix),it(n.optns.rotateMatrix,this.optns.rotateMatrix),e===t?n:n.animate(e)},this.shadow=function(e){for(var t in e)switch(t){case"x":this._shadowX=e.x;break;case"y":this._shadowY=e.y;break;case"blur":this._shadowBlur=e.blur;break;case"color":var n=$(e.color);this._shadowColor=e.color.val,this._shadowColorR=n.r,this._shadowColorG=n.g,this._shadowColorB=n.b,this._shadowColorA=n.a}return D(this),this},this.setOptns=function(e){e.globalAlpha=this._opacity,e.shadowOffsetX=this._shadowX,e.shadowOffsetY=this._shadowY,e.shadowBlur=this._shadowBlur,e.globalCompositeOperation=this._composite;var t=parseInt(this._shadowColorR),n=parseInt(this._shadowColorG),r=parseInt(this._shadowColorB),i=parseInt(this._shadowColorA*100)/100;return this._shadowColorRPrev!==t||this._shadowColorGPrev!==n||this._shadowColorBPrev!==r||this._shadowColorAPrev!==i?(e.shadowColor=this._shadowColor="rgba("+t+", "+n+", "+r+", "+i+")",this._shadowColorRPrev=t,this._shadowColorGPrev=n,this._shadowColorBPrev=r,this._shadowColorAPrev=i):e.shadowColor=this._shadowColor,e.transform(this._transform11,this._transform12,this._transform21,this._transform22,this._transformdx,this._transformdy),this},this.up=function(e){e===t&&(e=1);if(e=="top")this.level(e);else{var n=tt(this).objs[this.optns.number+e];n!==t&&(e=n._level+1-this._level),this.level(this._level+e)}return this},this.down=function(e){e==t&&(e=1);if(e=="bottom")this.level(e);else{var n=tt(this).objs[this.optns.number-e];n!==t&&(e=this._level-(n._level-1)),this.level(this._level-e)}return this},this.level=function(e){if(e==t)return this._level;var n=tt(this);return e=="bottom"&&(this.optns.number==0?e=this._level:e=n.objs[0]._level-1),e=="top"&&(this.optns.number==n.objs.length?e=this._level:e=n.objs[n.objs.length-1]._level+1),this._level=e,n.optns.anyObjLevelChanged=!0,D(this),this},this.del=function(){this.optns.deleted=!0,tt(this).optns.anyObjDeleted=!0,D(this)},this.focus=function(e){return e===t?(this.optns.focused=!0,typeof this.onfocus=="function"&&this.onfocus()):this.onfocus=e,this},this.blur=function(e){return e===t?(this.optns.focused=!1,typeof this.onblur=="function"&&this.onblur()):this.onblur=e,this},this.click=function(e){return F.call(this,e,"click")},this.dblclick=function(e){return F.call(this,e,"dblclick")},this.keypress=function(e){return I.call(this,e,"onkeypress")},this.keydown=function(e){return I.call(this,e,"onkeydown")},this.keyup=function(e){return I.call(this,e,"onkeyup")},this.mousedown=function(e){return F.call(this,e,"mousedown")},this.mouseup=function(e){return F.call(this,e,"mouseup")},this.mousemove=function(e){return F.call(this,e,"mousemove")},this.mouseover=function(e){return F.call(this,e,"mouseover")},this.mouseout=function(e){return F.call(this,e,"mouseout")},this.attr=function(e,n){if(typeof e=="object")var r=e;else{if(n===t)return this["_"+e];r={},r[e]=n}return this.animate(r)},this.queue=function(){var e=this.animateQueue.length,n,r,i,s=0,o=0,u,a=arguments;for(r=0;r<a.length;r++)if(typeof a[r]=="function"){a[r].apply(this),a[r]=!1,r++;if(this.animateQueue.length>e){for(i=e;i<this.animateQueue.length;i++){n=this.animateQueue[i];if(n.duration!==t){n.duration>s&&(s=n.duration,o=i);break}}if(s){n=this.animateQueue[o],n.animateFn?(u=n.animateFn,n.animateFn=function(){u.apply(this),this.queue.apply(this,a)}):n.animateFn=function(){this.queue.apply(this,a)};break}}}},this.stop=function(e,n){this.optns.animated=!1,n===t&&(n=!1),e===t&&(e=!1);for(var r=0;r<this.animateQueue.length;r++){var i=this.animateQueue[r];n&&i.animateFn.call(this);if(e)for(var s in i)i[s].from!==t&&(this[s]=i[s].to,H(s,this,i))}return this.animateQueue=[],this},this.animate=function(e,n,r,i,s){n===t?n=1:(typeof n=="function"&&(s=n,n=1),typeof n=="object"&&(r=n,n=1)),r===t?r={fn:"linear",type:"in"}:(typeof r=="function"&&(s=r,r={fn:"linear",type:"in"}),r.type===t&&(r.type="in")),i===t?i=!1:typeof i=="function"&&(s=i,i=!1),e.scale!==t&&(this._scaleX=this._scaleY=1,typeof e.scale!="object"?e.scaleX=e.scaleY=e.scale:(e.scaleX=e.scale.x||1,e.scaleY=e.scale.y||1)),e.translate!==t&&(this._translateX=this._translateY=0,typeof e.translate!="object"?e.translateX=e.translateY=e.translate:(e.translateX=e.translate.x||0,e.translateY=e.translate.y||0),e.translate=t);if(e.translateTo!==t){var o=this.position();this._translateToX=o.x,this._translateToY=o.y,typeof e.translateTo!="object"?e.translateToX=e.translateToY=e.translateTo:(e.translateToX=e.translateTo.x||0,e.translateToY=e.translateTo.y||0),e.translateTo=t}e.rotate!==t&&(e.rotateAngle=e.rotate.angle,this._rotateAngle=0,this._rotateX=e.rotate.x||0,this._rotateY=e.rotate.y||0,e.rotate=t);if(e.color!==t){var u=$(e.color);u.color.notColor?this.optns.color.notColor=u.color.notColor:(e.colorR=u.r,e.colorG=u.g,e.colorB=u.b,e.alpha=u.a),e.color=t}e.shadowColor!==t&&(u=$(e.shadowColor),e.shadowColorR=u.r,e.shadowColorG=u.g,e.shadowColorB=u.b,e.shadowColorA=u.a,e.shadowColor=t);if(n>1){var a=this.animateQueue[this.animateQueue.length]={animateKeyCount:0};a.animateFn=s||!1,this.optns.animated=!0,a.duration=n,a.step=0,a.easing=r,a.onstep=i}for(var f in e)if(this["_"+f]!==t&&e[f]!==t){var c=e[f],h="_"+f;c!=this[h]&&(c.charAt&&(f=="string"?this._string=c:c.charAt(1)=="="?c=this[h]+parseInt(c.charAt(0)+"1")*parseInt(c.substr(2)):l.test(c)?this[h]=c:c=parseInt(c)),n==1?this[h]=c:(a[h]={from:this[h],to:c,prev:0},a.animateKeyCount++))}return n==1&&(e.rotateAngle&&this.rotate(this._rotateAngle,this._rotateX,this._rotateY),(e.translateX||e.translateY)&&this.translate(this._translateX,this._translateY),(e.translateToX||e.translateToY)&&this.translate(this._translateToX,this._translateToY),(e.scaleX||e.scaleY)&&this.scale(this._scaleX,this._scaleY)),D(this),this},this.matrix=function(e){return e===t?[[this._transform11,this._transform21,this._transformdx],[this._transform12,this._transform22,this._transformdy]]:(this._transform11=e[0][0],this._transform21=e[0][1],this._transform12=e[1][0],this._transform22=e[1][1],this._transformdx=e[0][2],this._transformdy=e[1][2],this)},this.translateTo=function(e,n,r,i,s,o){if(r!==t)return this.animate({translateTo:{x:e,y:n}},r,i,s,o);var u=this.position(),a=0,f=0;return e!==t&&(a=e-u.x),n!==t&&(f=n-u.y),this.translate(a,f)},this.translate=function(e,n,r,i,s,o){return r!==t?this.animate({translate:{x:e,y:n}},r,i,s,o):(this.optns.translateMatrix=U(this.optns.translateMatrix,[[1,0,e],[0,1,n]]),M(this),this)},this.scale=function(e,n,r,i,s,o){return r!==t?this.animate({scale:{x:e,y:n}},r,i,s,o):(n===t&&(n=e),this.optns.scaleMatrix=U(this.optns.scaleMatrix,[[e,0,this._x*(1-e)],[0,n,this._y*(1-n)]]),M(this),this)},this.rotate=function(e,n,r,i,s,o,u){if(i!==t)return this.animate({rotate:{angle:e,x:n,y:r}},i,s,o,u);e/=p;var a=m(e),f=g(e),l=0,c=0;if(n!==t){if(n=="center"){var h=this.getCenter("poor");r===t?(n=h.x,r=h.y):(n=h.x+r.x,r=h.y+r.y)}l=-n*(a-1)+r*f,c=-r*(a-1)-n*f}return this.optns.rotateMatrix=U(this.optns.rotateMatrix,[[a,-f,l],[f,a,c]]),M(this),this},this.transform=function(e,n,r,i,s,o,u){if(e===t)return this.matrix();var a=this.optns;return u!==t?(a.transformMatrix=[[e,r,s],[n,i,o]],a.rotateMatrix=[[1,0,0],[0,1,0]],a.scaleMatrix=[[1,0,0],[0,1,0]],a.translateMatrix=[[1,0,0],[0,1,0]]):a.transformMatrix=U(a.transformMatrix,[[e,r,s],[n,i,o]]),M(this),this},this.beforeDraw=function(e){if(!this._visible)return!1;var t=e.ctx;t.save();if(this.optns.clipObject){var n=this.optns.clipObject;n._visible=!0,n.optns.animated&&P.call(n,e),n.setOptns(t),t.beginPath(),n.draw(t),t.clip()}return this.setOptns(t),this.optns.animated&&P.call(this,e),t.beginPath(),!0},this.clip=function(e){return e===t?this.optns.clipObject:(tt(this).objs.splice(e.optns.number,1),this.optns.clipObject=e,this)},this.afterDraw=function(e){e.ctx.closePath(),G(this,e),e.ctx.restore(),this.optns.clipObject&&lt.shape.prototype.afterDraw.call(this.optns.clipObject,e)},this.isPointIn=function(e,n,r){var i=nt(this).optns,s=i.ctx,o=!1,u=this.optns,a=!1;r!==t&&(e-=i.x,n-=i.y),u.animated&&(o=!0),u.animated=!1;if(u.clipObject){var f=u.clipObject,l=f.optns;l.animated&&(a=!0,l.animated=!1)}tt(this).setOptns(s),this.beforeDraw(i),this.draw(s);var c=Z(this,e,n);return s.closePath(),s.restore(),u.animated=o,a&&(l.animated=a),c},this.layer=function(e){return rt(e,this,"objs")},this.canvas=function(e){return st(e,this,"objs")},this.draggable=function(e,n,r){if(n===t&&typeof e=="object"&&e.optns===t){n=e.params,r=e.drag;var i=e.start,s=e.stop,o=e.disabled;e=e.object}var u=this,a=this.optns.drag;typeof n=="function"&&(r=n,n=t),typeof e=="function"&&(r=e,e=t),a.shiftX=0,a.shiftY=0,n!==t&&(n.shiftX!==t&&(a.shiftX=n.shiftX,n.shiftX=t),n.shiftY!==t&&(a.shiftY=n.shiftY,n.shiftY=t)),e!==t&&(e.id&&(u=n===t?e.visible(!1):e.animate(n).visible(!1)),e=="clone"&&(u=this.clone(n).visible(!1),a.type="clone")),a.val=!0,a.x=this._x,a.y=this._y,a.dx=this._transformdx,a.dy=this._transformdy,a.object=u,a.params=n,a.drag=r||!1,a.start=i||!1,a.stop=s||!1,a.disabled=o||!1;var f=nt(this).optns;return f.mousemove.val=!0,f.mousedown.val=!0,f.mouseup.val=!0,this},this.droppable=function(e){return this.optns.drop.val=!0,e!==t&&(this.optns.drop.fn=e),this},this.name=function(e){return this.attr("name",e)},this.hasName=function(e){var t=this.attr("name").split(" "),n=0;while(n<t.length){if(t[n]===e)return!0;n++}return!1},this.addName=function(e){var t=this.attr("name").split(" "),n=0;while(n<t.length){if(t[n]===e)return this;n++}return t.push(e),this.attr("name",t.join(" "))},this.removeName=function(e){var t=this.attr("name").split(" "),n=0;while(n<t.length){if(t[n]===e)return t.splice(n,1),this.attr("name",t.join(" "));n++}return this},this.visible=function(e){return this.attr("visible",e)},this.composite=function(e){return this.attr("composite",e)},this.id=function(e){return e===t?this.optns.id:(this.optns.id=e,this)},this.opacity=function(e){return this.attr("opacity",e)},this.fadeIn=function(e,t,n,r){return this.fadeTo(1,e,t,n,r)},this.fadeOut=function(e,t,n,r){return this.fadeTo(0,e,t,n,r)},this.fadeTo=function(e,n,r,i,s){return n===t&&(n=600),this.animate({opacity:e},n,r,i,s)},this.fadeToggle=function(e,t,n,r){return this._opacity?this.fadeOut(e,t,n,r):this.fadeIn(e,t,n,r),this},this.instanceOf=function(e){return e===t?this._proto:this instanceof lt[e]},this.base=function(e,r,i){typeof e=="object"?(e=_(e,{x:0,y:0,service:!1}),i=e.service,r=e.y,e=e.x):i===t&&(i=!1);var s=n[o];this.optns={animated:!1,clipObject:!1,drop:{val:!1,fn:function(){}},drag:{val:!1},layer:{id:s.optns.id+"Layer0",number:0},canvas:{number:0},focused:!1,buffer:{val:!1},rotateMatrix:[[1,0,0],[0,1,0]],scaleMatrix:[[1,0,0],[0,1,0]],translateMatrix:[[1,0,0],[0,1,0]],transformMatrix:[[1,0,0],[0,1,0]]},this.animateQueue=[],this._x=e,this._y=r;if(i==0&&s!==t&&s.layers[0]!==t){this.optns.layer.number=0,this.optns.canvas.number=o;var u=tt(this),a=u.objs.length;this.optns.number=a,this._level=a?u.objs[a-1]._level+1:0,u.objs[a]=this,this.optns.layer.id=u.optns.id,D(this)}return this},this._visible=!0,this._composite="source-over",this._name="",this._opacity=1,this._shadowX=0,this._shadowY=0,this._shadowBlur=0,this._shadowColor="rgba(0,0,0,0)",this._shadowColorR=0,this._shadowColorG=0,this._shadowColorB=0,this._shadowColorA=0,this._shadowColorRPrev=0,this._shadowColorGPrev=0,this._shadowColorBPrev=0,this._shadowColorAPrev=0,this._translateX=0,this._translateY=0,this._scaleX=1,this._scaleY=1,this._rotateAngle=0,this._rotateX=0,this._rotateY=0,this._transform11=1,this._transform12=0,this._transform21=0,this._transform22=1,this._transformdx=0,this._transformdy=0,this._matrixChanged=!1},lt.object.prototype=new lt.object,lt.shape=function(){this.color=function(e){return e===t?[this._colorR,this._colorG,this._colorB,this._alpha]:this.attr("color",e)},this.lineStyle=function(e){return this.attr(e)},this.setOptns=function(e){lt.shape.prototype.setOptns.call(this,e),e.lineWidth=this._lineWidth,e.lineCap=this._cap,e.lineJoin=this._join,e.miterLimit=this._miterLimit;var r=this.optns.color;if(r.notColor===t){var i=parseInt(this._colorR),s=parseInt(this._colorG),o=parseInt(this._colorB),u=parseInt(this._alpha*100)/100;this._colorRPrev!==i||this._colorGPrev!==s||this._colorBPrev!==o||this._alphaPrev!==u?(r.val=this._color="rgba("+i+", "+s+", "+o+", "+u+")",this._colorRPrev=i,this._colorGPrev=s,this._colorBPrev=o,this._alphaPrev=u):r.val=this._color}else{var a=r.notColor,f=n[a.canvas].layers[a.layer];f.grdntsnptrns[a.level]!==t&&(r.val=f.grdntsnptrns[a.level].val)}this._fill?e.fillStyle=r.val:e.strokeStyle=r.val},this.afterDraw=function(e){this._fill?e.ctx.fill():e.ctx.stroke(),lt.shape.prototype.afterDraw.call(this,e)},this.base=function(e){return e===t&&(e={}),e.color===t?e.color="rgba(0,0,0,1)":!e.color.charAt&&e.color.id===t&&e.color.r===t&&(e.fill=e.color,e.color="rgba(0,0,0,1)"),e=_(e,{color:"rgba(0,0,0,1)",fill:0}),lt.shape.prototype.base.call(this,e),this._fill=e.fill,this.optns.color={val:e.color,notColor:t},this.color(e.color)},this._colorR=0,this._colorG=0,this._colorB=0,this._alpha=0,this._colorRPrev=0,this._colorGPrev=0,this._colorBPrev=0,this._alphaPrev=0,this._color="rgba(0,0,0,0)",this._lineWidth=1,this._cap="butt",this._join="miter",this._miterLimit=1},lt.shape.prototype=new lt.object,lt.lines=function(){this.getCenter=function(e){var t={x:this._x0,y:this._y0};for(var n=1;n<this.shapesCount;n++)t.x+=this["_x"+n],t.y+=this["_y"+n];return t.x=t.x/this.shapesCount,t.y=t.y/this.shapesCount,V(this,t,e)},this.position=function(){return z(this._x0,this._y0,U(this.matrix(),tt(this).matrix()))},this.getRect=function(e){var t,n,r=t=this._x0,i=n=this._y0;for(var s=1;s<this.shapesCount;s++)r<this["_x"+s]&&(r=this["_x"+s]),i<this["_y"+s]&&(i=this["_y"+s]),t>this["_x"+s]&&(t=this["_x"+s]),n>this["_y"+s]&&(n=this["_y"+s]);var o={x:t,y:n,width:r-t,height:i-n};return X(this,o,e)},this.addPoint=function(){D(this);var e=this.pointNames;for(var t=0;t<e.length;t++)this[e[t]+this.shapesCount]=arguments[t];return this.shapesCount++,this},this.delPoint=function(e,n,r){D(this);if(n===t){var i=this.points();i.splice(e,1),this.points(i)}else{r=r||0;for(var s=0;s<this.shapesCount;s++)this["_x"+s]<e+r&&this["_x"+s]>e-r&&this["_y"+s]<n+r&&this["_y"+s]<n+r&&(this.delPoint(s),s--)}return this},this.points=function(e){var n=this.pointNames;if(e===t){e=[];for(var r=0;r<this.shapesCount;r++){e[r]=[];for(var i=0;i<n.length;i++)e[r][i]=this[n[i]+r]}return e}D(this);var s=this.shapesCount;this.shapesCount=e.length;for(r=0;r<this.shapesCount;r++)for(i=0;i<n.length;i++)this[n[i]+r]=e[r][i];for(r=this.shapesCount;r<s;r++)for(i=0;i<n.length;i++)this[n[i]+r]=t;return this},this.base=function(e,n,r){return e!==t&&typeof e.pop=="function"&&(e={points:e,color:n,fill:r}),lt.lines.prototype.base.call(this,e),this.shapesCount=0,e!==t&&e.points!==t&&this.points(e.points),this}},lt.lines.prototype=new lt.shape,lt.line=function(){this.draw=function(e){if(this._x0===t)return;e.moveTo(this._x0,this._y0);for(var n=1;n<this.shapesCount;n++)e.lineTo(this["_x"+n],this["_y"+n])},this.base=function(e,t,n){return lt.line.prototype.base.call(this,e,t,n),this},this._proto="line",this.pointNames=["_x","_y"]},lt.line.prototype=new lt.lines,lt.qCurve=function(){this.draw=function(e){if(this._x0===t)return;e.moveTo(this._x0,this._y0);for(var n=1;n<this.shapesCount;n++)e.quadraticCurveTo(this["_cp1x"+n],this["_cp1y"+n],this["_x"+n],this["_y"+n])},this.base=function(e,t,n){return lt.qCurve.prototype.base.call(this,e,t,n),this},this._proto="qCurve",this.pointNames=["_x","_y","_cp1x","_cp1y"]},lt.qCurve.prototype=new lt.lines,lt.bCurve=function(){this.draw=function(e){if(this._x0===t)return;e.moveTo(this._x0,this._y0);for(var n=1;n<this.shapesCount;n++)e.bezierCurveTo(this["_cp1x"+n],this["_cp1y"+n],this["_cp2x"+n],this["_cp2y"+n],this["_x"+n],this["_y"+n])},this.base=function(e,t,n){return lt.bCurve.prototype.base.call(this,e,t,n),this},this._proto="bCurve",this.pointNames=["_x","_y","_cp1x","_cp1y","_cp2x","_cp2y"]},lt.bCurve.prototype=new lt.lines,lt.circle=function(){this.getCenter=function(e){return V(this,{x:this._x,y:this._y},e)},this.getRect=function(e){var t={x:Math.floor(this._x-this._radius),y:Math.floor(this._y-this._radius)};return t.width=t.height=Math.ceil(this._radius)*2,X(this,t,e)},this.draw=function(e){e.arc(this._x,this._y,this._radius,0,s,!0)},this.base=function(e,t,n,r,i){return typeof e!="object"&&(e={x:e,y:t,radius:n,color:r,fill:i}),e=_(e,{radius:0}),lt.circle.prototype.base.call(this,e),this._radius=e.radius,this},this._proto="circle"},lt.circle.prototype=new lt.shape,lt.rect=function(){this.getRect=function(e){return X(this,{x:this._x,y:this._y,width:this._width,height:this._height},e)},this.draw=function(e){e.rect(this._x,this._y,this._width,this._height)},this.base=function(e,t,n,r,i,s){return typeof e!="object"&&(e={x:e,y:t,width:n,height:r,color:i,fill:s}),e=_(e,{width:0,height:0}),lt.rect.prototype.base.call(this,e),this._width=e.width,this._height=e.height,this},this._proto="rect"},lt.rect.prototype=new lt.shape,lt.arc=function(){this.getRect=function(e){var t={x:this._x,y:this._y},n=this._startAngle,r=this._endAngle,i=this._radius,s=y(g(n/p)*i),o=y(m(n/p)*i),u=y(g(r/p)*i),a=y(m(r/p)*i),f=o>0&&a>0,l=o<0&&a<0,c=s>0&&u>0,h=s<0&&u<0;return t.width=t.height=i,this._anticlockwise&&n<r||!this._anticlockwise&&n>r?(l||f&&(h||c)||o==0&&a==0?(t.y-=i,t.height+=i):f&&u<0&&s>0?(t.y+=u,t.height+=u):a>0&&u<0&&o<0?(t.y+=v(u,s),t.height-=v(u,s)):(h?t.y-=d(u,s):t.y-=i,t.height+=d(u,s)),c||h&&(l||f)||s==0&&u==0?(t.x-=i,t.width+=i):u<0&&s>0?(t.x+=v(a,o),t.width-=v(a,o)):(l?t.x-=d(a,o):t.x-=i,t.width+=d(a,o))):(f=o>=0&&a>=0,c=s>=0&&u>=0,l=o<=0&&a<=0,h=s<=0&&u<=0,h&&f?(t.x+=v(a,o),t.width-=v(a,o),t.y+=v(u,s),t.height+=d(u,s)):h&&l?(t.x+=v(a,o),t.width+=d(a,o),t.y+=v(u,s),t.height+=d(u,s)):h?(t.x+=v(a,o),t.width+=d(a,o),t.y-=i,t.height+=d(u,s)):f&&c?(t.x+=v(a,o),t.width=w(a-o),t.y+=v(u,s),t.height-=v(u,s)):c?(t.x+=v(a,o),t.width=w(a)+w(o),t.y+=v(u,s),t.height-=v(u,s)):l?(t.x-=i,t.width+=d(a,o),t.y-=i,t.height+=d(u,s)):f&&(t.x-=i,t.width+=d(a,o),t.y-=i,t.height+=i)),X(this,t,e)},this.draw=function(e){e.arc(this._x,this._y,this._radius,this._startAngle/p,this._endAngle/p,this._anticlockwise)},this.base=function(e,n,r,i,s,o,u,a){return o!==t&&(o.charAt&&(u=o),o?o=!0:o=!1),typeof e!="object"&&(e={x:e,y:n,radius:r,startAngle:i,endAngle:s,anticlockwise:o,color:u,fill:a}),e=_(e,{radius:0,startAngle:0,endAngle:0,anticlockwise:!0}),lt.arc.prototype.base.call(this,e),this._radius=e.radius,this._startAngle=e.startAngle,this._endAngle=e.endAngle,this._anticlockwise=e.anticlockwise,this},this._proto="arc"},lt.arc.prototype=new lt.shape,lt.text=function(){this.font=function(e){return this.attr("font",e)},this._font="10px sans-serif",this.align=function(e){return this.attr("align",e)},this._align="start",this.baseline=function(e){return this.attr("baseline",e)},this._baseline="alphabetic",this.string=function(e){return this.attr("string",e)},this.position=function(){var e={x:this._x,y:this._y},t=nt(this).optns.ctx;return e.height=parseInt(this._font.match(c)[0]),e.y-=e.height,t.save(),t.textBaseline=this._baseline,t.font=this._font,t.textAlign=this._align,e.width=t.measureText(this._string).width,t.restore(),X(this,e)},this.getRect=function(e){var t={x:this._x,y:this._y},n=nt(this).optns.ctx;return t.height=parseInt(this._font.match(c)[0]),t.y-=t.height,n.save(),n.textBaseline=this._baseline,n.font=this._font,n.textAlign=this._align,t.width=n.measureText(this._string).width,this._align=="center"&&(t.x-=t.width/2),this._align=="right"&&(t.x-=t.width),n.restore(),X(this,t,e)},this.setOptns=function(e){lt.text.prototype.setOptns.call(this,e),e.textBaseline=this._baseline,e.font=this._font,e.textAlign=this._align},this.draw=function(e){this._maxWidth===!1?this._fill?e.fillText(this._string,this._x,this._y):e.strokeText(this._string,this._x,this._y):this._fill?e.fillText(this._string,this._x,this._y,this._maxWidth):e.strokeText(this._string,this._x,this._y,this._maxWidth)},this.base=function(e,n,r,i,s,o){return i!==t&&i.charAt&&(s!==t&&(o=s),s=i,i=!1),typeof e!="object"&&(e={string:e,x:n,y:r,maxWidth:i,color:s,fill:o}),e=_(e,{string:"",maxWidth:!1,fill:1}),lt.text.prototype.base.call(this,e),this._string=e.string,this._maxWidth=e.maxWidth,this},this._proto="text"},lt.text.prototype=new lt.shape,lt.grdntsnptrn=function(){this.layer=function(e){return rt(e,this,"grdntsnptrns")},this.canvas=function(e){return st(e,this,"grdntsnptrns")};var e=new lt.object;return this.animate=e.animate,this.attr=e.attr,this.id=e.id,this.name=e.name,this.level=e.level,this.base=function(){this.animateQueue=[],this.optns={animated:!1,name:"",layer:{id:n[0].optns.id+"Layer_0",number:0},canvas:{number:0},visible:!0},this.optns.layer.id=n[o].optns.id+"Layer_0",this.optns.layer.number=0,this.optns.canvas.number=o;var e=n[o].layers[0].grdntsnptrns;this._level=e.length,e[this._level]=this,D(this)},this},lt.gradients=function(){this.colorStopsCount=0,this.paramNames=["_pos","_colorR","_colorG","_colorB","_alpha","_name"],this.addColorStop=function(e,t){D(this);var n=$(t),r=this.colorStopsCount;return this["_pos"+r]=e,this["_colorR"+r]=n.r,this["_colorG"+r]=n.g,this["_colorB"+r]=n.b,this["_alpha"+r]=n.a,this.colorStopsCount++,this},this.animate=function(e,t,n,r,i){for(var s in e)if(s.substr(0,5)=="color"){var o=s.substring(5),u=$(e[s]);e["colorR"+o]=u.r,e["colorG"+o]=u.g,e["colorB"+o]=u.b,e["alpha"+o]=u.a}lt.gradients.prototype.animate.call(this,e,t,n,r,i)},this.delColorStop=function(e){D(this);var t=this.colorStops();return t.splice(e,1),t.length>0?this.colorStops(t):this.colorStopsCount=0,this},this.colorStops=function(e){var n=this.paramNames;if(e===t){e=[];for(var r=0;r<this.colorStopsCount;r++){e[r]=[];for(var i=0;i<n.length;i++)e[r][i]=this[n[i]+r]}return e}D(this);var s=this.colorStopsCount,o=e.length;if(e[0].length==2)for(r=0;r<o;r++)this.addColorStop(e[r][0],e[r][1]);else for(r=0;r<o;r++)for(i=0;i<n.length;i++)this[n[i]+r]=e[r][i];for(r=o;r<s;r++)for(i=0;i<n.length;i++)this[n[i]+r]=t;return this.colorStopsCount=o,this},this.base=function(e){return lt.gradients.prototype.base.call(this),e==t?this:this.colorStops(e)}},lt.gradients.prototype=new lt.grdntsnptrn,lt.pattern=function(){this.create=function(e){this.optns.animated&&P.call(this,e),this.val=e.ctx.createPattern(this._img,this._type)},this.base=function(e,t){return e.onload&&(e={image:e,type:t}),e=_(e,{type:"repeat"}),lt.pattern.prototype.base.call(this),this._img=e.image,this._type=e.type,this},this._proto="pattern"},lt.pattern.prototype=new lt.grdntsnptrn,lt.lGradient=function(){this.create=function(e){this.optns.animated&&P.call(this,e),this.val=e.ctx.createLinearGradient(this._x1,this._y1,this._x2,this._y2);for(var t=0;t<this.colorStopsCount;t++)this.val.addColorStop(this["_pos"+t],"rgba("+parseInt(this["_colorR"+t])+","+parseInt(this["_colorG"+t])+","+parseInt(this["_colorB"+t])+","+this["_alpha"+t]+")")},this.base=function(e,t,n,r,i){return typeof e!="object"&&(e={x1:e,y1:t,x2:n,y2:r,colors:i}),e=_(e,{x1:0,y1:0,x2:0,y2:0}),lt.lGradient.prototype.base.call(this,e.colors),this._x1=e.x1,this._y1=e.y1,this._x2=e.x2,this._y2=e.y2,this},this._proto="lGradient"},lt.lGradient.prototype=new lt.gradients,lt.rGradient=function(){this.create=function(e){this.optns.animated&&P.call(this,e),this.val=e.ctx.createRadialGradient(this._x1,this._y1,this._r1,this._x2,this._y2,this._r2);for(var t=0;t<this.colorStopsCount;t++)this.val.addColorStop(this["_pos"+t],"rgba("+parseInt(this["_colorR"+t])+","+parseInt(this["_colorG"+t])+","+parseInt(this["_colorB"+t])+","+this["_alpha"+t]+")")},this.base=function(e,t,n,r,i,s,o){return typeof e!="object"&&(e={x1:e,y1:t,r1:n,x2:r,y2:i,r2:s,colors:o}),e=_(e,{x1:0,y1:0,r1:0,x2:0,y2:0,r2:0}),lt.rGradient.prototype.base.call(this,e.colors),this._x1=e.x1,this._y1=e.y1,this._r1=e.r1,this._x2=e.x2,this._y2=e.y2,this._r2=e.r2,this},this._proto="rGradient"},lt.rGradient.prototype=new lt.gradients,lt.layer=function(){this.position=function(){var e=this.objs,n,r,i,s=e.length;for(i=0;i<s;i++)r=e[i].position(),n===t&&(n=r),n.x>r.x&&(n.x=r.x),n.y>r.y&&(n.y=r.y);return n},this.getRect=function(e){var n=this.objs,r,i,s,o=n.length;if(n.length==0)return!1;if(e=="coords"){for(s=0;s<o;s++)i=n[s].getRect(e),r===t&&(r=i),r[0][0]>i[0][0]&&(r[0][0]=i[0][0]),r[0][1]>i[0][1]&&(r[0][1]=i[0][1]),r[1][0]<i[1][0]&&(r[1][0]=i[1][0]),r[1][1]>i[1][1]&&(r[1][1]=i[1][1]),r[2][0]>i[2][0]&&(r[2][0]=i[2][0]),r[2][1]<i[2][1]&&(r[2][1]=i[2][1]),r[3][0]<i[3][0]&&(r[3][0]=i[3][0]),r[3][1]<i[3][1]&&(r[3][1]=i[3][1]);return r}for(s=0;s<o;s++)i=n[s].getRect(e),i.right=i.width+i.x,i.bottom=i.height+i.y,r===t&&(r=i),r.x>i.x&&(r.x=i.x),r.y>i.y&&(r.y=i.y),r.right<i.right&&(r.right=i.right),r.bottom<i.bottom&&(r.bottom=i.bottom);return r.width=r.right-r.x,r.height=r.bottom-r.y,r},this.canvas=function(e){if(e===t)return this.idCanvas;if(this.optns.canvas.id==e)return this;var r=-1,i=0,s=n.length;for(var o=0;o<s;o++){var u=n[o].optns.id;u==e&&(r=o),u==this.optns.canvas.id&&(i=o)}r<0&&(r=n.length,O.canvas(e)),this.optns.canvas.id=e,this.optns.canvas.number=r,n[i].layers.splice(this.optns.number,1);var a=n[r].layers;return this._level=this.optns.number=a.length,a[this._level]=this,ut(this.objs,this.optns.id,this._level,e,r),ut(this.grdntsnptrns,this.optns.id,this._level,e,r),n[r].optns.redraw=1,this},this.up=function(e){e===t&&(e=1);if(e=="top")this.level(e);else{var n=nt(this).layers[this.optns.number+e];n!==t&&(e=n._level+1-this._level),this.level(this._level+e)}return this},this.down=function(e){e==t&&(e=1);if(e=="bottom")this.level(e);else{var n=nt(this).layers[this.optns.number-e];n!==t&&(e=this._level-(n._level-1)),this.level(this._level-e)}return this},this.level=function(e){if(e==t)return this._level;var n=nt(this),r=n.optns;return e=="bottom"&&(this.optns.number==0?e=this._level:e=n.layers[0]._level-1),e=="top"&&(this.optns.number==n.layers.length-1?e=this._level:e=n.layers[n.layers.length-1]._level+1),this._level=e,r.anyLayerLevelChanged=!0,r.redraw=1,this},this.del=function(){var e=nt(this).optns;e.anyLayerDeleted=!0,this.draw=!1,e.redraw=1;return},this.setOptns=function(e){return e.setTransform(1,0,0,1,0,0),lt.layer.prototype.setOptns.call(this,e),this},this.afterDraw=function(e){e.ctx.closePath(),e.ctx.restore(),this.optns.clipObject&&lt.layer.prototype.afterDraw.call(this.optns.clipObject,e)},this.clone=function(e,n){var r=O.layer(e);return it(r,this),it(r.optns.transformMatrix,this.optns.transformMatrix),it(r.optns.translateMatrix,this.optns.translateMatrix),it(r.optns.scaleMatrix,this.optns.scaleMatrix),it(r.optns.rotateMatrix,this.optns.rotateMatrix),r.canvas(nt(this).optns.id),n===t?r:r.animate(n)},this.isPointIn=function(e,t,n){var r=this.objs,i;for(i=0;i<r.length;i++)if(r[i].isPointIn(e,t,n))return!0;return!1},this.opacity=function(e){var t=this.objs;for(var n=0;n<t.length;n++)t[n].attr("opacity",e);return this},this.fadeTo=function(e,n,r,i,s){n===t&&(n=600);var o=this.objs;for(var u=0;u<o.length;u++)o[u].animate({opacity:e},n,r,i,s);return this},this.draw=function(e){var t=this.optns,n=t.buffer,r=e.ctx;if(n.val)return r.drawImage(n.cnv,n.x,n.y),this;for(var i=0;i<this.grdntsnptrns.length;i++)this.grdntsnptrns[i].create(e);t.anyObjLevelChanged&&(at(this.objs),t.anyObjLevelChanged=!1),t.anyObjDeleted&&(ft(this.objs),t.anyObjDeleted=!1),r.globalCompositeOperation=t.gCO;for(i=0;i<this.objs.length;i++){var s=this.objs[i];if(typeof s.draw=="function"){this.setOptns(r);if(s.beforeDraw(e)&&typeof s.draw=="function"){var o=s.optns.buffer;o.val?r.drawImage(o.cnv,o.x,o.y):s.draw(r),n.optns?s.afterDraw(n.optns):s.afterDraw(e)}}}return this},this.objects=function(e){var n=ht(),r=0;while(this.objs[r]!==t)n.elements[r]=this.objs[r++];return e!==t?n.find(e):n},this.base=function(e){var t=n[o],r=t.layers,i=t.optns;lt.layer.prototype.base.call(this,0,0,!0);var s=r.length;r[s]=this,this.objs=[],this.grdntsnptrns=[],this._level=s?r[s-1]._level+1:0,this.optns.number=s,this.optns.id=e;var u=this.optns;return u.anyObjDeleted=!1,u.anyObjLevelChanged=!1,u.gCO=i.gCO,u.canvas.id=i.id,u.canvas.number=o,this},this._proto="layer"},lt.layer.prototype=new lt.object,lt.imageData=function(){this.filter=function(e,t){var n=R[e];return n.fn.call(this,this._width,this._height,n.matrix,t),this},this.getRect=function(e){var t={x:this._x,y:this._y,width:this._width,height:this._height};return X(this,t,e)},this.setPixel=function(e,n,r){var i,s=(e+n*this._width)*4;return r.r!==t?i=r:r[0]!==t&&(r.charAt?i=$(r):i={r:r[0],g:r[1],b:r[2],a:r[3]}),this._data[s+0]=i.r,this._data[s+1]=i.g,this._data[s+2]=i.b,this._data[s+3]=i.a*255,D(this),this},this.getPixel=function(e,t){var n=(e+t*this._width)*4;return[this._data[n+0],this._data[n+1],this._data[n+2],this._data[n+3]/255]},this._getX=0,this._getY=0,this.getData=function(e,t,n,r){this._getX=e,this._getY=t,this._width=n,this._height=r;var i=nt(this).optns.ctx;try{this._imgData=i.getImageData(this._getX,this._getY,this._width,this._height)}catch(s){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),this._imgData=i.getImageData(this._getX,this._getY,this._width,this._height)}return this._data=this._imgData.data,D(this),this},this.putData=function(e,n){return e!==t&&(this._x=e),n!==t&&(this._y=n),this._putData=!0,D(this),this},this.clone=function(){var e=lt.imageData.prototype.clone.call(this);return e._imgData=t,e},this.draw=function(e){if(this._imgData===t){this._imgData=e.createImageData(this._width,this._height);for(var n=0;n<this._width*this._height*4;n++)this._imgData.data[n]=this._data[n];this._data=this._imgData.data}this._putData&&e.putImageData(this._imgData,this._x,this._y)},this.base=function(e,n){lt.imageData.prototype.base.call(this);if(n===t){var r=e;r._width!==t?(e=r._width,n=r._height):(e=_(e,{width:0,height:0}),n=e.height,e=e.width)}this._width=e,this._height=n,this._data=[];for(var i=0;i<this._width;i++)for(var s=0;s<this._height;s++){var o=(i+s*this._width)*4;this._data[o+0]=0,this._data[o+1]=0,this._data[o+2]=0,this._data[o+3]=0}return this},this._putData=!1,this._proto="imageData"},lt.imageData.prototype=new lt.object,lt.image=function(){this.getRect=function(e){var t={x:this._x,y:this._y,width:this._width,height:this._height};return X(this,t,e)},this.draw=function(e){e.drawImage(this._img,this._sx,this._sy,this._swidth,this._sheight,this._x,this._y,this._width,this._height)},this.base=function(e,n,r,i,s,o,u,a,f){if(typeof e!="object"||e.src!==t||e.nodeName!==t)e={image:e,x:n,y:r,width:i,height:s,sx:o,sy:u,swidth:a,sheight:f};return e=_(e,{width:!1,height:!1,sx:0,sy:0,swidth:!1,sheight:!1}),e.width===!1&&(e.width=e.image.width,e.height=e.image.height),e.swidth===!1&&(e.swidth=e.image.width,e.sheight=e.image.height),lt.image.prototype.base.call(this,e),this._img=e.image,this._width=e.width,this._height=e.height,this._sx=e.sx,this._sy=e.sy,this._swidth=e.swidth,this._sheight=e.sheight,this},this._proto="image"},lt.image.prototype=new lt.object,lt.groups=function(){for(var e in lt){if(e=="group"||e=="groups")continue;var n=new lt[e];for(var r in n)typeof n[r]=="function"&&this[r]===t&&function(e,n){e[n]=function(){var e=[],r=[],i=0;while(arguments[i]!==t)r[i]=arguments[i++];for(i=0;i<this.elements.length;i++){var s=this.elements[i];it(e,r),typeof s[n]=="function"&&s[n].apply(s,e)}return this}}(this,r)}this.reverse=function(){var e=this.elements;return this.elements=this.unmatchedElements,this.unmatchedElements=e,this},this.end=function(e){return this.previousGroup===t||e===0?this:(e!==t&&e--,this.previousGroup.end(e))},this.find=function(e){var n=ht(),r=e.attrs,i=e.fns||[],s,o,u,a,f,l,c;n.previousGroup=this;for(s=0;s<this.elements.length;s++)n.elements[s]=this.elements[s];if(r!==t)for(o in r)r.hasOwnProperty(o)&&(typeof r[o]!="object"&&(r[o]={val:r[o],rel:"=="}),i[i.length]={fn:"attr",args:[o],val:r[o].val,rel:r[o].rel});if(i.length)for(s=0;s<n.elements.length;s++){u=n.elements[s];for(o=0;o<i.length;o++){f=i[o],c=f.val,a=f.rel,typeof u[f.fn]=="function"?l=u[f.fn].apply(u,f.args):a="del";switch(a){case"!=":l==c&&(a="del");break;case"!==":l===c&&(a="del");break;case"==":l!=c&&(a="del");break;case"===":l!==c&&(a="del");break;case">=":l>=c||(a="del");break;case"<=":l<=c||(a="del");break;case">":l>c||(a="del");break;case"<":l<c||(a="del");break;case"typeof":typeof l!=c&&(a="del")}if(a=="del"){n.unmatchedElements[n.unmatchedElements.length]=u,n.elements.splice(s,1),s--;break}}}return n},this.base=function(){return this.elements=[],this.unmatchedElements=[],this}},lt.group=function(){this._proto="group"},lt.group.prototype=new lt.groups,O.addFunction=function(e,t,n){return lt[n||"object"].prototype[e]=t,O},O.addObject=function(e,n,r,i){lt[e]=function(e){this.draw=lt[e].draw,this.base=lt[e].base,this._proto=e};var s=lt[e];return i===t&&(i="shape"),s.prototype=new lt[i],s.draw=r,s.base=function(e,t,n){s.prototype.base.call(this,t);var r=0;for(var i in t)this["_"+i]=n[r]||t[i],i=="color"&&this.color(n[r]||t[i]),r++;return this},function(e,t){O[e]=function(){var n=new lt[e](e);return n.base(e,t,arguments)}}(e,n),O},O.addAnimateFunction=function(e,t){return q[e]=t,O},O.addImageDataFilter=function(e,n){return R[e]===t&&(R[e]={}),n.fn!==t&&(R[e].fn=n.fn),n.matrix!==t&&n.type===t&&(R[e].matrix=n.matrix),n.type!==t&&(R[e].matrix[type]=n.matrix),O},O.clear=function(e){return n[0]===t?O:e===t?(n[0].clear(),O):(O.canvas(e).clear(),O)},O.pause=function(e){return e===t?(n[0].pause(),O):(O.canvas(e).pause(),O)},O.start=function(e,t){return O.canvas(e).start(t),O},O.pattern=function(e,t){var n=new lt.pattern;return n.base(e,t)},O.lGradient=function(e,t,n,r,i){var s=new lt.lGradient;return s.base(e,t,n,r,i)},O.rGradient=function(e,t,n,r,i,s,o){var u=new lt.rGradient;return u.base(e,t,n,r,i,s,o)},O.line=function(e,t,n){var r=new lt.line;return r.base(e,t,n)},O.qCurve=function(e,t,n){var r=new lt.qCurve;return r.base(e,t,n)},O.bCurve=function(e,t,n){var r=new lt.bCurve;return r.base(e,t,n)},O.imageData=function(e,t){var n=new lt.imageData;return n.base(e,t)},O.image=function(e,t,n,r,i,s,o,u,a){var f=new lt.image;return f.base(e,t,n,r,i,s,o,u,a)},O.circle=function(e,t,n,r,i){var s=new lt.circle;return s.base(e,t,n,r,i)},O.rect=function(e,t,n,r,i,s){var o=new lt.rect;return o.base(e,t,n,r,i,s)},O.arc=function(e,t,n,r,i,s,o,u){var a=new lt.arc;return a.base(e,t,n,r,i,s,o,u)},O.text=function(e,t,n,r,i,s){var o=new lt.text;return o.base(e,t,n,r,i,s)},O.canvas=function(e){if(e===t)return n[0];var r=n.length;for(var i=0;i<r;i++)if(n[i].optns&&n[i].optns.id==e)return n[i];var s={id:function(e){return e===t?this.optns.id:(this.optns.id=e,this)}};return n[r]=s,o=r,s.cnv=document.getElementById(e),s.width=function(e){return e===t?this.cnv.width:(this.optns.width=this.cnv.width=e,this.cnv.style.width=e+"px",this.optns.redraw=1,this)},s.height=function(e){return e===t?this.cnv.height:(this.optns.heigth=this.cnv.height=e,this.cnv.style.height=e+"px",this.optns.redraw=1,this)},s.optns={id:e,number:o,ctx:s.cnv.getContext("2d"),width:s.cnv.offsetWidth||s.cnv.width,height:s.cnv.offsetHeight||s.cnv.height,anyLayerDeleted:!1,anyLayerLevelChanged:!1,keyDown:{val:!1,code:!1},keyUp:{val:!1,code:!1},keyPress:{val:!1,code:!1},mousemove:{val:!1,x:!1,y:!1,object:!1},click:{val:!1,x:!1,y:!1,objects:[]},dblclick:{val:!1,x:!1,y:!1,objects:[]},mouseup:{val:!1,x:!1,y:!1,objects:[]},mousedown:{val:!1,x:!1,y:!1,objects:[]},drag:{object:!1,x:0,y:0},gCO:"source-over",redraw:1},s.toDataURL=function(){return s.cnv.toDataURL.apply(s.cnv,arguments)},s.layers=[],s.interval=0,O.layer(e+"Layer_0").canvas(e),s.start=function(e){o=this.optns.number;if(!e)return this.frame();if(this.interval)return this;this.isAnimated=e;var t=J(this.cnv);this.optns.x=t.left+(parseInt(this.cnv.style.borderTopWidth)||0),this.optns.y=t.top+(parseInt(this.cnv.style.borderLeftWidth)||0);var r=n[this.optns.number],i=r.optns;return this.cnv.onclick=function(e){j(e,"click",i)},this.cnv.ondblclick=function(e){j(e,"dblclick",i);var t=i.mousemove.val;i.mousemove.val=!0,setTimeout(function(){i.mousemove.val=t},3e3)},this.cnv.onmousedown=function(e){j(e,"mousedown",i)},this.cnv.onmouseup=function(e){j(e,"mouseup",i)},this.cnv.onkeyup=function(e){B(e,"keyUp",i)},this.cnv.onkeydown=function(e){B(e,"keyDown",i)},this.cnv.onkeypress=function(e){B(e,"keyPress",i)},this.cnv.onmouseout=this.cnv.onmousemove=function(e){j(e,"mousemove",i)},i.timeLast=new Date,this.interval=T(function(e){r.interval=r.interval||1,r.frame(e)},this.cnv),this},s.pause=function(){return N(this.interval),this.interval=0,this},s.restart=function(){return this.pause().start(!0)},s.del=function(){N(this.interval),this.layers=[],n.splice(this.optns.number,1);for(var e=0;e<n.length;e++){var t=n[e],r=t.layers,i=r.length;t.optns.number=e;for(var s=0;s<i;s++){var u=r[s];u.optns.canvas.number=e,ut(u.objs,u.optns.id,u.optns.number,t.optns.id,t.optns.number),ut(u.grdntsnptrns,u.optns.id,u.optns.number,t.optns.id,t.optns.number)}}return this.cnv.parentNode&&this.cnv.parentNode.removeChild(this.cnv),o=0,!1},s.clear=function(){return N(this.interval),this.interval=0,this.layers=[],O.layer(this.optns.id+"Layer_0").canvas(this.optns.id),this.optns.ctx.clearRect(0,0,this.optns.width,this.optns.height),this.optns.redraw++,this},s.frame=function(n){var i=this.optns,s=this;n=n||new Date,i.timeDiff=n-i.timeLast,i.timeLast=n,this.interval&&(this.interval=T(function(e){s.frame(e)},s.cnv),this.interval=this.interval||1);if(!i.redraw)return this;i.redraw--,i.ctx.clearRect(0,0,i.width,i.height);if(this.layers.length==0)return this;r=this.layers.length,i.anyLayerLevelChanged&&(r=at(this.layers)),i.anyLayerDeleted&&(r=ft(this.layers));if(i.anyLayerLevelChanged||i.anyLayerDeleted){i.anyLayerLevelChanged=i.anyLayerDeleted=!1;for(var o=0;o<r;o++){var u=this.layers[o],l=u.optns;ut(u.objs,l.id,l.number,this.optns.id,this.optns.number),ut(u.grdntsnptrns,l.id,l.number,e,this.optns.number)}}for(o=0;o<r;o++){var c=this.layers[o];typeof c.draw=="function"&&c.beforeDraw(i)&&typeof c.draw=="function"&&(c.draw(i),c.afterDraw(i))}var h=i.mousemove,p=i.mousedown,d=i.mouseup,v=this.optns.click,m=this.optns.dblclick;if(h.x!=0){if(i.drag.object!=0){var g=i.drag,y=g.object;y.translate(h.x-g.x,h.y-g.y),g.x=h.x,g.y=h.y,g.drag&&g.drag.call(y,{x:h.x,y:h.y})}var b=this.optns.point||{};b.event=h.event;if(h.object!=0){var w=h.object,E=tt(w);a===w?(typeof w.onmousemove=="function"&&w.onmousemove(b),E===f?typeof E.onmousemove=="function"&&E.onmousemove(b):(f&&typeof f.onmouseout=="function"&&f.onmouseout(b),typeof E.onmouseover=="function"&&E.onmouseover(b),f=E)):(a&&typeof a.onmouseout=="function"&&a.onmouseout(b),typeof w.onmouseover=="function"&&w.onmouseover(b),a=w)}else a&&(typeof a.onmouseout=="function"&&a.onmouseout(b),a=!1),f&&(typeof f.onmouseout=="function"&&f.onmouseout(b),f=!1);i.mousemove.object=!1}if(p.objects.length){var S=p.objects.length-1;e:for(o=S;o>-1;o--){var x=[p.objects[o],tt(p.objects[o])],N;for(var C=0;C<2;C++){N=x[C];if(N.optns.drag.val==1&&N.optns.drag.disabled==0&&o==S){g=i.drag,y=g.object=N.optns.drag.object.visible(!0),g.drag=N.optns.drag.drag,g.init=N;var k=g.init.optns;k.drag.params!==t&&y.animate(k.drag.params),g.x=g.startX=p.x,g.y=g.startY=p.y,y!=g.init&&k.drag.type!="clone"&&(b=W(p.x,p.y,y.matrix()),y.translate(b.x-y._x,b.y-y._y)),y.translate(k.drag.shiftX,k.drag.shiftY),typeof k.drag.start=="function"&&k.drag.start.call(y,{x:p.x,y:p.y})}if(typeof N.onmousedown=="function"&&N.onmousedown({x:p.x,y:p.y,event:p.event})===!1)break e}}p.objects=[]}if(d.objects.length){t:for(o=d.objects.length-1;o>-1;o--){var L=[d.objects[o],tt(d.objects[o])],A;for(C=0;C<2;C++){A=L[C],pt(A,d,i)&&(v.objects=[]);if(typeof A.onmouseup=="function"&&A.onmouseup({x:d.x,y:d.y,event:d.event})===!1)break t}}this.optns.drag={object:!1,x:0,y:0},d.objects=[]}if(v.objects.length){n:for(o=v.objects.length-1;o>-1;o--){var O=[v.objects[o],tt(v.objects[o])],M;for(C=0;C<2;C++){M=O[C],pt(M,v,i);if(typeof M.onclick=="function"&&M.onclick({x:v.x,y:v.y,event:v.event})===!1)break n}}this.optns.drag={object:!1,x:0,y:0},v.objects=[]}if(m.objects.length){r:for(o=m.objects.length-1;o>-1;o--){var _=[m.objects[o],tt(m.objects[o])];for(C=0;C<2;C++)if(typeof _[C].ondblclick=="function"&&_[C].ondblclick({x:m.x,y:m.y,event:m.event})===!1)break r}m.objects=[]}return i.keyUp.val=i.keyDown.val=i.keyPress.val=v.x=m.x=d.x=p.x=h.x=!1,this},s},O.layer=function(e){if(e===t)return n[0].layers[0];for(var r=0;r<n.length;r++){var i=n[r].layers;for(var s=0;s<i.length;s++)if(i[s].optns.id==e)return i[s]}return ct(e)},e.jCanvaScript=e.jc=O})(window,undefined),define("jc",[],function(){}),define("connector",["socket.io"],function(){function i(){e.emit("ping",{time:(new Date).getTime()})}var e=io.connect("/"),t=0,n=0,r=function(){return(new Date).getTime()-n};return e.on("ping",function(e){t=((new Date).getTime()-e.yours.time)/2,n=(new Date).getTime()-(e.now+t),setTimeout(i,2e3)}),i(),{socket:e,currentTime:r}}),function(){function e(t,n,r){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped);if(t.isEqual&&E.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&E.isFunction(n.isEqual))return n.isEqual(t);var i=a.call(t);if(i!=a.call(n))return!1;switch(i){case"[object String]":return t==""+n;case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=typeof t||"object"!=typeof n)return!1;for(var s=r.length;s--;)if(r[s]==t)return!0;r.push(t);var s=0,o=!0;if("[object Array]"==i){if(s=t.length,o=s==n.length)for(;s--&&(o=s in t==s in n&&e(t[s],n[s],r)););}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var u in t)if(E.has(t,u)&&(s++,!(o=E.has(n,u)&&e(t[u],n[u],r))))break;if(o){for(u in n)if(E.has(n,u)&&!(s--))break;o=!s}}return r.pop(),o}var t=this,n=t._,r={},i=Array.prototype,s=Object.prototype,o=i.slice,u=i.unshift,a=s.toString,f=s.hasOwnProperty,l=i.forEach,c=i.map,h=i.reduce,p=i.reduceRight,d=i.filter,v=i.every,m=i.some,g=i.indexOf,y=i.lastIndexOf,s=Array.isArray,b=Object.keys,w=Function.prototype.bind,E=function(e){return new _(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=E),exports._=E):t._=E,E.VERSION="1.3.3";var S=E.each=E.forEach=function(e,t,n){if(e!=null)if(l&&e.forEach===l)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(n,e[i],i,e)===r)break}else for(i in e)if(E.has(e,i)&&t.call(n,e[i],i,e)===r)break};E.map=E.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(S(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},E.reduce=E.foldl=E.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=E.bind(t,r)),i?e.reduce(t,n):e.reduce(t);S(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},E.reduceRight=E.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=E.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=E.toArray(e).reverse();return r&&!i&&(t=E.bind(t,r)),i?E.reduce(s,t,n,r):E.reduce(s,t)},E.find=E.detect=function(e,t,n){var r;return x(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},E.filter=E.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(S(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},E.reject=function(e,t,n){var r=[];return e==null?r:(S(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},E.every=E.all=function(e,t,n){var i=!0;return e==null?i:v&&e.every===v?e.every(t,n):(S(e,function(e,s,o){if(!(i=i&&t.call(n,e,s,o)))return r}),!!i)};var x=E.some=E.any=function(e,t,n){t||(t=E.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,n):(S(e,function(e,s,o){if(i||(i=t.call(n,e,s,o)))return r}),!!i)};E.include=E.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:n=x(e,function(e){return e===t})},E.invoke=function(e,t){var n=o.call(arguments,2);return E.map(e,function(e){return(E.isFunction(t)?t||e:e[t]).apply(e,n)})},E.pluck=function(e,t){return E.map(e,function(e){return e[t]})},E.max=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&E.isEmpty(e))return-Infinity;var r={computed:-Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i>=r.computed&&(r={value:e,computed:i})}),r.value},E.min=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&E.isEmpty(e))return Infinity;var r={computed:Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i<r.computed&&(r={value:e,computed:i})}),r.value},E.shuffle=function(e){var t=[],n;return S(e,function(e,r){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},E.sortBy=function(e,t,n){var r=E.isFunction(t)?t:function(e){return e[t]};return E.pluck(E.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},E.groupBy=function(e,t){var n={},r=E.isFunction(t)?t:function(e){return e[t]};return S(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},E.sortedIndex=function(e,t,n){n||(n=E.identity);for(var r=0,i=e.length;r<i;){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},E.toArray=function(e){return e?E.isArray(e)||E.isArguments(e)?o.call(e):e.toArray&&E.isFunction(e.toArray)?e.toArray():E.values(e):[]},E.size=function(e){return E.isArray(e)?e.length:E.keys(e).length},E.first=E.head=E.take=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},E.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},E.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},E.rest=E.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},E.compact=function(e){return E.filter(e,function(e){return!!e})},E.flatten=function(e,t){return E.reduce(e,function(e,n){return E.isArray(n)?e.concat(t?n:E.flatten(n)):(e[e.length]=n,e)},[])},E.without=function(e){return E.difference(e,o.call(arguments,1))},E.uniq=E.unique=function(e,t,n){var n=n?E.map(e,n):e,r=[];return e.length<3&&(t=!0),E.reduce(n,function(n,i,s){if(t?E.last(n)!==i||!n.length:!E.include(n,i))n.push(i),r.push(e[s]);return n},[]),r},E.union=function(){return E.uniq(E.flatten(arguments,!0))},E.intersection=E.intersect=function(e){var t=o.call(arguments,1);return E.filter(E.uniq(e),function(e){return E.every(t,function(t){return E.indexOf(t,e)>=0})})},E.difference=function(e){var t=E.flatten(o.call(arguments,1),!0);return E.filter(e,function(e){return!E.include(t,e)})},E.zip=function(){for(var e=o.call(arguments),t=E.max(E.pluck(e,"length")),n=Array(t),r=0;r<t;r++)n[r]=E.pluck(e,""+r);return n},E.indexOf=function(e,t,n){if(e==null)return-1;var r;if(n)return n=E.sortedIndex(e,t),e[n]===t?n:-1;if(g&&e.indexOf===g)return e.indexOf(t);n=0;for(r=e.length;n<r;n++)if(n in e&&e[n]===t)return n;return-1},E.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},E.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0);for(var n=arguments[2]||1,r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);i<r;)s[i++]=e,e+=n;return s};var T=function(){};E.bind=function(e,t){var n,r;if(e.bind===w&&w)return w.apply(e,o.call(arguments,1));if(!E.isFunction(e))throw new TypeError;return r=o.call(arguments,2),n=function(){if(this instanceof n){T.prototype=e.prototype;var i=new T,s=e.apply(i,r.concat(o.call(arguments)));return Object(s)===s?s:i}return e.apply(t,r.concat(o.call(arguments)))}},E.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=E.functions(e)),S(t,function(t){e[t]=E.bind(e[t],e)}),e},E.memoize=function(e,t){var n={};return t||(t=E.identity),function(){var r=t.apply(this,arguments);return E.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},E.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},E.defer=function(e){return E.delay.apply(E,[e,1].concat(o.call(arguments,1)))},E.throttle=function(e,t){var n,r,i,s,o,u,a=E.debounce(function(){o=s=!1},t);return function(){return n=this,r=arguments,i||(i=setTimeout(function(){i=null,o&&e.apply(n,r),a()},t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},E.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments;n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,s)},t)}},E.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},E.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},E.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},E.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},E.keys=b||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[],n;for(n in e)E.has(e,n)&&(t[t.length]=n);return t},E.values=function(e){return E.map(e,E.identity)},E.functions=E.methods=function(e){var t=[],n;for(n in e)E.isFunction(e[n])&&t.push(n);return t.sort()},E.extend=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},E.pick=function(e){var t={};return S(E.flatten(o.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},E.defaults=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},E.clone=function(e){return E.isObject(e)?E.isArray(e)?e.slice():E.extend({},e):e},E.tap=function(e,t){return t(e),e},E.isEqual=function(t,n){return e(t,n,[])},E.isEmpty=function(e){if(e==null)return!0;if(E.isArray(e)||E.isString(e))return e.length===0;for(var t in e)if(E.has(e,t))return!1;return!0},E.isElement=function(e){return!!e&&e.nodeType==1},E.isArray=s||function(e){return a.call(e)=="[object Array]"},E.isObject=function(e){return e===Object(e)},E.isArguments=function(e){return a.call(e)=="[object Arguments]"},E.isArguments(arguments)||(E.isArguments=function(e){return!!e&&!!E.has(e,"callee")}),E.isFunction=function(e){return a.call(e)=="[object Function]"},E.isString=function(e){return a.call(e)=="[object String]"},E.isNumber=function(e){return a.call(e)=="[object Number]"},E.isFinite=function(e){return E.isNumber(e)&&isFinite(e)},E.isNaN=function(e){return e!==e},E.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},E.isDate=function(e){return a.call(e)=="[object Date]"},E.isRegExp=function(e){return a.call(e)=="[object RegExp]"},E.isNull=function(e){return e===null},E.isUndefined=function(e){return e===void 0},E.has=function(e,t){return f.call(e,t)},E.noConflict=function(){return t._=n,this},E.identity=function(e){return e},E.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},E.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},E.result=function(e,t){if(e==null)return null;var n=e[t];return E.isFunction(n)?n.call(e):n},E.mixin=function(e){S(E.functions(e),function(t){P(t,E[t]=e[t])})};var N=0;E.uniqueId=function(e){var t=N++;return e?e+t:t},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/.^/,k={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"},L;for(L in k)k[k[L]]=L;var A=/\\|'|\r|\n|\t|\u2028|\u2029/g,O=/\\(\\|'|r|n|t|u2028|u2029)/g,M=function(e){return e.replace(O,function(e,t){return k[t]})};E.template=function(e,t,n){n=E.defaults(n||{},E.templateSettings),e="__p+='"+e.replace(A,function(e){return"\\"+k[e]}).replace(n.escape||C,function(e,t){return"'+\n_.escape("+M(t)+")+\n'"}).replace(n.interpolate||C,function(e,t){return"'+\n("+M(t)+")+\n'"}).replace(n.evaluate||C,function(e,t){return"';\n"+M(t)+"\n;__p+='"})+"';\n",n.variable||(e="with(obj||{}){\n"+e+"}\n");var e="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+e+"return __p;\n",r=new Function(n.variable||"obj","_",e);return t?r(t,E):(t=function(e){return r.call(this,e,E)},t.source="function("+(n.variable||"obj")+"){\n"+e+"}",t)},E.chain=function(e){return E(e).chain()};var _=function(e){this._wrapped=e};E.prototype=_.prototype;var D=function(e,t){return t?E(e).chain():e},P=function(e,t){_.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),D(t.apply(E,e),this._chain)}};E.mixin(E),S("pop,push,reverse,shift,sort,splice,unshift".split(","),function(e){var t=i[e];_.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],D(n,this._chain)}}),S(["concat","join","slice"],function(e){var t=i[e];_.prototype[e]=function(){return D(t.apply(this._wrapped,arguments),this._chain)}}),_.prototype.chain=function(){return this._chain=!0,this},_.prototype.value=function(){return this._wrapped}}.call(this),define("_",[],function(){}),define("render-v2",["connector","_","jc","jquery"],function(e){function r(){return 6e4/(n.bpm||100)}function i(){jc.start("canvas",!0),t=jc.rect(0,0,window.innerWidth,window.innerHeight,"#131013",!0).id("background"),u&&u()}function s(){var t,i=r(),s=e.currentTime(),u=n.start+Math.ceil((s-n.start)/i)*i;setTimeout(function(){o(Math.round((e.currentTime()-n.start)/i),i)},u-e.currentTime())}function o(e,t){a&&a(e,t),setTimeout(function(){s()},10)}var t,n={bpm:100,start:(new Date).getTime()};$(function(){function t(){e.attr("height",window.innerHeight),e.attr("width",window.innerWidth)}var e=$("#canvas");$(window).resize(function(){t(),jc.clear(),i()}),t(),i()}),e.socket.on("loop-stats",function(e){n=e}),s();var u,a;return{getBackground:function(){return t},onInit:function(e){u=e},onLoop:function(e){a=e},stats:n}}),define("user",["connector","render-v2","jquery"],function(e,t){function n(e){return e*window.innerWidth}function r(e){return e*window.innerHeight}t.onLoop(function(e,n){$("#counter").html(e);if(!t.getBackground())return;e%2==0&&t.getBackground().animate({color:"#262326"},n/2,function(){t.getBackground().animate({color:"#131013"},n/2)})}),t.onInit(function(){})}),requirejs.config({paths:{jquery:"http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min","socket.io":"/socket.io/socket.io"}}),require(["jquery","jc","user"],function(){$(function(){})}),define("main",[],function(){})